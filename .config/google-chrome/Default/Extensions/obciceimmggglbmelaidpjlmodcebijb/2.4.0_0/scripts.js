!function(){this.BH={Views:{},Modals:{},Models:{},Collections:{},Lib:{ContextMenus:{}},Modules:{},Templates:{},Trackers:{},Presenters:{},Persistence:{},Migrations:{},Init:{},Chrome:{},Base:function(){}};if(typeof onServer!=="undefined"&&onServer!==null){module.exports=this.BH}}.call(this);!function(){!function(window,undefined){var TraceKit={};var _oldTraceKit=window.TraceKit;var _slice=[].slice;var UNKNOWN_FUNCTION="?";function _has(object,key){return Object.prototype.hasOwnProperty.call(object,key)}function _isUndefined(what){return typeof what==="undefined"}TraceKit.noConflict=function noConflict(){window.TraceKit=_oldTraceKit;return TraceKit};TraceKit.wrap=function traceKitWrapper(func){function wrapped(){try{return func.apply(this,arguments)}catch(e){TraceKit.report(e);throw e}}return wrapped};TraceKit.report=function reportModuleWrapper(){var handlers=[],lastException=null,lastExceptionStack=null;function subscribe(handler){installGlobalHandler();handlers.push(handler)}function unsubscribe(handler){for(var i=handlers.length-1;i>=0;--i){if(handlers[i]===handler){handlers.splice(i,1)}}}function notifyHandlers(stack,windowError){var exception=null;if(windowError&&!TraceKit.collectWindowErrors){return}for(var i in handlers){if(_has(handlers,i)){try{handlers[i].apply(null,[stack].concat(_slice.call(arguments,2)))}catch(inner){exception=inner}}}if(exception){throw exception}}var _oldOnerrorHandler,_onErrorHandlerInstalled;function traceKitWindowOnError(message,url,lineNo){var stack=null;if(lastExceptionStack){TraceKit.computeStackTrace.augmentStackTraceWithInitialElement(lastExceptionStack,url,lineNo,message);stack=lastExceptionStack;lastExceptionStack=null;lastException=null}else{var location={url:url,line:lineNo};location.func=TraceKit.computeStackTrace.guessFunctionName(location.url,location.line);location.context=TraceKit.computeStackTrace.gatherContext(location.url,location.line);stack={mode:"onerror",message:message,url:document.location.href,stack:[location],useragent:navigator.userAgent}}notifyHandlers(stack,"from window.onerror");if(_oldOnerrorHandler){return _oldOnerrorHandler.apply(this,arguments)}return false}function installGlobalHandler(){if(_onErrorHandlerInstalled===true){return}_oldOnerrorHandler=window.onerror;window.onerror=traceKitWindowOnError;_onErrorHandlerInstalled=true}function report(ex){var args=_slice.call(arguments,1);if(lastExceptionStack){if(lastException===ex){return}else{var s=lastExceptionStack;lastExceptionStack=null;lastException=null;notifyHandlers.apply(null,[s,null].concat(args))}}var stack=TraceKit.computeStackTrace(ex);lastExceptionStack=stack;lastException=ex;window.setTimeout(function(){if(lastException===ex){lastExceptionStack=null;lastException=null;notifyHandlers.apply(null,[stack,null].concat(args))}},stack.incomplete?2e3:0);throw ex}report.subscribe=subscribe;report.unsubscribe=unsubscribe;return report}();TraceKit.computeStackTrace=function computeStackTraceWrapper(){var debug=false,sourceCache={};function loadSource(url){if(!TraceKit.remoteFetching){return""}try{function getXHR(){try{return new window.XMLHttpRequest}catch(e){return new window.ActiveXObject("Microsoft.XMLHTTP")}}var request=getXHR();request.open("GET",url,false);request.send("");return request.responseText}catch(e){return""}}function getSource(url){if(!_has(sourceCache,url)){var source="";if(url.indexOf(document.domain)!==-1){source=loadSource(url)}sourceCache[url]=source?source.split("\n"):[]}return sourceCache[url]}function guessFunctionName(url,lineNo){var reFunctionArgNames=/function ([^(]*)\(([^)]*)\)/,reGuessFunction=/['"]?([0-9A-Za-z$_]+)['"]?\s*[:=]\s*(function|eval|new Function)/,line="",maxLines=10,source=getSource(url),m;if(!source.length){return UNKNOWN_FUNCTION}for(var i=0;i<maxLines;++i){line=source[lineNo-i]+line;if(!_isUndefined(line)){if(m=reGuessFunction.exec(line)){return m[1]}else if(m=reFunctionArgNames.exec(line)){return m[1]}}}return UNKNOWN_FUNCTION}function gatherContext(url,line){var source=getSource(url);if(!source.length){return null}var context=[],linesBefore=Math.floor(TraceKit.linesOfContext/2),linesAfter=linesBefore+TraceKit.linesOfContext%2,start=Math.max(0,line-linesBefore-1),end=Math.min(source.length,line+linesAfter-1);line-=1;for(var i=start;i<end;++i){if(!_isUndefined(source[i])){context.push(source[i])}}return context.length>0?context:null}function escapeRegExp(text){return text.replace(/[\-\[\]{}()*+?.,\\\^$|#]/g,"\\$&")}function escapeCodeAsRegExpForMatchingInsideHTML(body){return escapeRegExp(body).replace("<","(?:<|&lt;)").replace(">","(?:>|&gt;)").replace("&","(?:&|&amp;)").replace('"','(?:"|&quot;)').replace(/\s+/g,"\\s+")}function findSourceInUrls(re,urls){var source,m;for(var i=0,j=urls.length;i<j;++i){if((source=getSource(urls[i])).length){source=source.join("\n");if(m=re.exec(source)){return{url:urls[i],line:source.substring(0,m.index).split("\n").length,column:m.index-source.lastIndexOf("\n",m.index)-1}}}}return null}function findSourceInLine(fragment,url,line){var source=getSource(url),re=new RegExp("\\b"+escapeRegExp(fragment)+"\\b"),m;line-=1;if(source&&source.length>line&&(m=re.exec(source[line]))){return m.index}return null}function findSourceByFunctionBody(func){var urls=[window.location.href],scripts=document.getElementsByTagName("script"),body,code=""+func,codeRE=/^function(?:\s+([\w$]+))?\s*\(([\w\s,]*)\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/,eventRE=/^function on([\w$]+)\s*\(event\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/,re,parts,result;for(var i=0;i<scripts.length;++i){var script=scripts[i];if(script.src){urls.push(script.src)}}if(!(parts=codeRE.exec(code))){re=new RegExp(escapeRegExp(code).replace(/\s+/g,"\\s+"))}else{var name=parts[1]?"\\s+"+parts[1]:"",args=parts[2].split(",").join("\\s*,\\s*");body=escapeRegExp(parts[3]).replace(/;$/,";?");re=new RegExp("function"+name+"\\s*\\(\\s*"+args+"\\s*\\)\\s*{\\s*"+body+"\\s*}")}if(result=findSourceInUrls(re,urls)){return result}if(parts=eventRE.exec(code)){var event=parts[1];body=escapeCodeAsRegExpForMatchingInsideHTML(parts[2]);re=new RegExp("on"+event+"=[\\'\"]\\s*"+body+"\\s*[\\'\"]","i");if(result=findSourceInUrls(re,urls[0])){return result}re=new RegExp(body);if(result=findSourceInUrls(re,urls)){return result}}return null}function computeStackTraceFromStackProp(ex){if(!ex.stack){return null}var chrome=/^\s*at (?:((?:\[object object\])?\S+(?: \[as \S+\])?) )?\(?((?:file|http|https):.*?):(\d+)(?::(\d+))?\)?\s*$/i,gecko=/^\s*(\S*)(?:\((.*?)\))?@((?:file|http|https).*?):(\d+)(?::(\d+))?\s*$/i,lines=ex.stack.split("\n"),stack=[],parts,element,reference=/^(.*) is undefined$/.exec(ex.message);for(var i=0,j=lines.length;i<j;++i){if(parts=gecko.exec(lines[i])){element={url:parts[3],func:parts[1]||UNKNOWN_FUNCTION,args:parts[2]?parts[2].split(","):"",line:+parts[4],column:parts[5]?+parts[5]:null}}else if(parts=chrome.exec(lines[i])){element={url:parts[2],func:parts[1]||UNKNOWN_FUNCTION,line:+parts[3],column:parts[4]?+parts[4]:null}}else{continue}if(!element.func&&element.line){element.func=guessFunctionName(element.url,element.line)}if(element.line){element.context=gatherContext(element.url,element.line)}stack.push(element)}if(stack[0]&&stack[0].line&&!stack[0].column&&reference){stack[0].column=findSourceInLine(reference[1],stack[0].url,stack[0].line)}if(!stack.length){return null}return{mode:"stack",name:ex.name,message:ex.message,url:document.location.href,stack:stack,useragent:navigator.userAgent}}function computeStackTraceFromStacktraceProp(ex){var stacktrace=ex.stacktrace;var testRE=/ line (\d+), column (\d+) in (?:<anonymous function: ([^>]+)>|([^\)]+))\((.*)\) in (.*):\s*$/i,lines=stacktrace.split("\n"),stack=[],parts;for(var i=0,j=lines.length;i<j;i+=2){if(parts=testRE.exec(lines[i])){var element={line:+parts[1],column:+parts[2],func:parts[3]||parts[4],args:parts[5]?parts[5].split(","):[],url:parts[6]};if(!element.func&&element.line){element.func=guessFunctionName(element.url,element.line)}if(element.line){try{element.context=gatherContext(element.url,element.line)}catch(exc){}}if(!element.context){element.context=[lines[i+1]]}stack.push(element)}}if(!stack.length){return null}return{mode:"stacktrace",name:ex.name,message:ex.message,url:document.location.href,stack:stack,useragent:navigator.userAgent}}function computeStackTraceFromOperaMultiLineMessage(ex){var lines=ex.message.split("\n");if(lines.length<4){return null}var lineRE1=/^\s*Line (\d+) of linked script ((?:file|http|https)\S+)(?:: in function (\S+))?\s*$/i,lineRE2=/^\s*Line (\d+) of inline#(\d+) script in ((?:file|http|https)\S+)(?:: in function (\S+))?\s*$/i,lineRE3=/^\s*Line (\d+) of function script\s*$/i,stack=[],scripts=document.getElementsByTagName("script"),inlineScriptBlocks=[],parts,i,len,source;for(i in scripts){if(_has(scripts,i)&&!scripts[i].src){inlineScriptBlocks.push(scripts[i])}}for(i=2,len=lines.length;i<len;i+=2){var item=null;if(parts=lineRE1.exec(lines[i])){item={url:parts[2],func:parts[3],line:+parts[1]}}else if(parts=lineRE2.exec(lines[i])){item={url:parts[3],func:parts[4]};var relativeLine=+parts[1];var script=inlineScriptBlocks[parts[2]-1];if(script){source=getSource(item.url);if(source){source=source.join("\n");var pos=source.indexOf(script.innerText);if(pos>=0){item.line=relativeLine+source.substring(0,pos).split("\n").length}}}}else if(parts=lineRE3.exec(lines[i])){var url=window.location.href.replace(/#.*$/,""),line=parts[1];var re=new RegExp(escapeCodeAsRegExpForMatchingInsideHTML(lines[i+1]));source=findSourceInUrls(re,[url]);item={url:url,line:source?source.line:line,func:""}}if(item){if(!item.func){item.func=guessFunctionName(item.url,item.line)}var context=gatherContext(item.url,item.line);var midline=context?context[Math.floor(context.length/2)]:null;if(context&&midline.replace(/^\s*/,"")===lines[i+1].replace(/^\s*/,"")){item.context=context}else{item.context=[lines[i+1]]}stack.push(item)}}if(!stack.length){return null}return{mode:"multiline",name:ex.name,message:lines[0],url:document.location.href,stack:stack,useragent:navigator.userAgent}}function augmentStackTraceWithInitialElement(stackInfo,url,lineNo,message){var initial={url:url,line:lineNo};if(initial.url&&initial.line){stackInfo.incomplete=false;if(!initial.func){initial.func=guessFunctionName(initial.url,initial.line)}if(!initial.context){initial.context=gatherContext(initial.url,initial.line)}var reference=/ '([^']+)' /.exec(message);if(reference){initial.column=findSourceInLine(reference[1],initial.url,initial.line)}if(stackInfo.stack.length>0){if(stackInfo.stack[0].url===initial.url){if(stackInfo.stack[0].line===initial.line){return false}else if(!stackInfo.stack[0].line&&stackInfo.stack[0].func===initial.func){stackInfo.stack[0].line=initial.line;stackInfo.stack[0].context=initial.context;return false}}}stackInfo.stack.unshift(initial);stackInfo.partial=true;return true}else{stackInfo.incomplete=true}return false}function computeStackTraceByWalkingCallerChain(ex,depth){var functionName=/function\s+([_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*)?\s*\(/i,stack=[],funcs={},recursion=false,parts,item,source;for(var curr=computeStackTraceByWalkingCallerChain.caller;curr&&!recursion;curr=curr.caller){if(curr===computeStackTrace||curr===TraceKit.report){continue}item={url:null,func:UNKNOWN_FUNCTION,line:null,column:null};if(curr.name){item.func=curr.name}else if(parts=functionName.exec(curr.toString())){item.func=parts[1]}if(source=findSourceByFunctionBody(curr)){item.url=source.url;item.line=source.line;if(item.func===UNKNOWN_FUNCTION){item.func=guessFunctionName(item.url,item.line)}var reference=/ '([^']+)' /.exec(ex.message||ex.description);if(reference){item.column=findSourceInLine(reference[1],source.url,source.line)}}if(funcs[""+curr]){recursion=true}else{funcs[""+curr]=true}stack.push(item)}if(depth){stack.splice(0,depth)}var result={mode:"callers",name:ex.name,message:ex.message,url:document.location.href,stack:stack,useragent:navigator.userAgent};augmentStackTraceWithInitialElement(result,ex.sourceURL||ex.fileName,ex.line||ex.lineNumber,ex.message||ex.description);return result}function computeStackTrace(ex,depth){var stack=null;depth=depth==null?0:+depth;try{stack=computeStackTraceFromStacktraceProp(ex);if(stack){return stack}}catch(e){if(debug){throw e}}try{stack=computeStackTraceFromStackProp(ex);if(stack){return stack}}catch(e){if(debug){throw e}}try{stack=computeStackTraceFromOperaMultiLineMessage(ex);if(stack){return stack}}catch(e){if(debug){throw e}}try{stack=computeStackTraceByWalkingCallerChain(ex,depth+1);if(stack){return stack}}catch(e){if(debug){throw e}}return{mode:"failed"}}function computeStackTraceOfCaller(depth){depth=(depth==null?0:+depth)+1;try{throw new Error}catch(ex){return computeStackTrace(ex,depth+1)}return null}computeStackTrace.augmentStackTraceWithInitialElement=augmentStackTraceWithInitialElement;computeStackTrace.guessFunctionName=guessFunctionName;computeStackTrace.gatherContext=gatherContext;computeStackTrace.ofCaller=computeStackTraceOfCaller;return computeStackTrace}();!function extendToAsynchronousCallbacks(){var _helper=function _helper(fnName){var originalFn=window[fnName];window[fnName]=function traceKitAsyncExtension(){var args=_slice.call(arguments);var originalCallback=args[0];if(typeof originalCallback==="function"){args[0]=TraceKit.wrap(originalCallback)}if(originalFn.apply){return originalFn.apply(this,args)}else{return originalFn(args[0],args[1])}}};_helper("setTimeout");_helper("setInterval")}();if(!TraceKit.remoteFetching){TraceKit.remoteFetching=true}if(!TraceKit.collectWindowErrors){TraceKit.collectWindowErrors=true}if(!TraceKit.linesOfContext||TraceKit.linesOfContext<1){TraceKit.linesOfContext=11}window.TraceKit=TraceKit}(window);var Notice;Notice=function(){function Notice(options){var k,v,_ref,_ref1,_ref2,_ref3,_ref4;this.options=options!=null?options:{};this.stackInfo=this.options.stackInfo||this.options.error&&TraceKit.computeStackTrace(this.options.error);this.trace=this._parseBacktrace((_ref=this.stackInfo)!=null?_ref.stack:void 0);this["class"]=(_ref1=this.stackInfo)!=null?_ref1.name:void 0;this.message=(_ref2=this.stackInfo)!=null?_ref2.message:void 0;this.source=this.stackInfo&&this._extractSource(this.stackInfo.stack);this.url=document.URL;this.project_root=Honeybadger.configuration.project_root;this.environment=Honeybadger.configuration.environment;this.component=Honeybadger.configuration.component;this.action=Honeybadger.configuration.action;this.context={};_ref3=Honeybadger.context;for(k in _ref3){v=_ref3[k];this.context[k]=v}if(this.options.context){_ref4=this.options.context;for(k in _ref4){v=_ref4[k];this.context[k]=v}}}Notice.prototype.toJSON=function(){return JSON.stringify({notifier:{name:"honeybadger.js",url:"https://github.com/honeybadger-io/honeybadger-js",version:Honeybadger.version,language:"javascript"},error:{"class":this["class"],message:this.message,backtrace:this.trace,source:this.source},request:{url:this.url,component:this.component,action:this.action,context:this.context,cgi_data:this._cgiData()},server:{project_root:this.project_root,environment_name:this.environment}})};Notice.prototype._parseBacktrace=function(stack){var backtrace,trace,_i,_len,_ref,_ref1;if(stack==null){stack=[]}backtrace=[];for(_i=0,_len=stack.length;_i<_len;_i++){trace=stack[_i];if((_ref=trace.url)!=null?_ref.match(/honeybadger(?:\.min)?\.js/):void 0){continue}backtrace.push({file:((_ref1=trace.url)!=null?_ref1.replace(Honeybadger.configuration.project_root,"[PROJECT_ROOT]"):void 0)||"unknown",number:trace.line,method:trace.func})}return backtrace};Notice.prototype._extractSource=function(stack){var i,line,source,_i,_len,_ref,_ref1,_ref2;if(stack==null){stack=[]}source={};_ref2=(_ref=(_ref1=stack[0])!=null?_ref1.context:void 0)!=null?_ref:[];for(i=_i=0,_len=_ref2.length;_i<_len;i=++_i){line=_ref2[i];source[i]=line}return source};Notice.prototype._cgiData=function(){var data,k,v;data={};for(k in navigator){v=navigator[k];if(typeof v!=="object"){data[k.split(/(?=[A-Z][a-z]*)/).join("_").toUpperCase()]=v}}data["HTTP_USER_AGENT"]=data["USER_AGENT"];delete data["USER_AGENT"];if(document.referrer.match(/\S/)){data["HTTP_REFERER"]=document.referrer}return data};return Notice}();var Honeybadger;Honeybadger=function(){var _this=this;function Honeybadger(){}Honeybadger.version="0.0.2";Honeybadger.default_configuration={api_key:null,host:"api.honeybadger.io",ssl:true,project_root:window.location.protocol+"//"+window.location.host,environment:"production",component:null,action:null,disabled:true,onerror:false};Honeybadger.configured=false;Honeybadger.configure=function(options){var k,v;if(options==null){options={}}if(this.configured===false){if(typeof options.disabled==="undefined"){options["disabled"]=false}this.configured=true}for(k in options){v=options[k];this.configuration[k]=v}TraceKit.collectWindowErrors=this.configuration.onerror;return this};Honeybadger.configuration={reset:function(){var k,v,_ref;Honeybadger.configured=false;_ref=Honeybadger.default_configuration;for(k in _ref){v=_ref[k];Honeybadger.configuration[k]=v}TraceKit.collectWindowErrors=Honeybadger.configuration.onerror;return Honeybadger}};Honeybadger.configuration.reset();Honeybadger.context={};Honeybadger.resetContext=function(options){if(options==null){options={}}this.context=options;return this};Honeybadger.setContext=function(options){var k,v;if(options==null){options={}}for(k in options){v=options[k];this.context[k]=v}return this};Honeybadger.notify=function(error,options){var notice;if(options==null){options={}}if(this.configuration.disabled===true){return false}if(error){options["error"]=error}notice=new Notice(options);return this._sendRequest(notice.toJSON())};Honeybadger._sendRequest=function(data){var url;url="http"+(this.configuration.ssl&&"s"||"")+"://"+this.configuration.host+"/v1/notices.html";return this._crossDomainPost(url,data)};Honeybadger._crossDomainPost=function(url,payload){var form,iframe,input,uniqueNameOfFrame;iframe=document.createElement("iframe");uniqueNameOfFrame="_hb_"+(new Date).getTime();document.body.appendChild(iframe);iframe.style.display="none";iframe.contentWindow.name=uniqueNameOfFrame;form=document.createElement("form");form.target=uniqueNameOfFrame;form.action=url;form.method="POST";input=document.createElement("input");input.type="hidden";input.name="payload";input.value=payload;form.appendChild(input);input=document.createElement("input");input.type="hidden";input.name="api_key";input.value=this.configuration.api_key;form.appendChild(input);document.body.appendChild(form);return form.submit()};Honeybadger._handleTraceKitSubscription=function(stackInfo){return Honeybadger.notify(null,{stackInfo:stackInfo})};return Honeybadger}.call(this);TraceKit.report.subscribe(Honeybadger._handleTraceKitSubscription);(typeof exports!=="undefined"&&exports!==null?exports:this).Honeybadger=Honeybadger}.call(this);!function(){var root=this;var previousUnderscore=root._;var breaker={};var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var push=ArrayProto.push,slice=ArrayProto.slice,concat=ArrayProto.concat,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind;var _=function(obj){if(obj instanceof _)return obj;if(!(this instanceof _))return new _(obj);this._wrapped=obj};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=_}exports._=_}else{root._=_}_.VERSION="1.4.3";var each=_.each=_.forEach=function(obj,iterator,context){if(obj==null)return;if(nativeForEach&&obj.forEach===nativeForEach){obj.forEach(iterator,context)}else if(obj.length===+obj.length){for(var i=0,l=obj.length;i<l;i++){if(iterator.call(context,obj[i],i,obj)===breaker)return}}else{for(var key in obj){if(_.has(obj,key)){if(iterator.call(context,obj[key],key,obj)===breaker)return}}}};_.map=_.collect=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeMap&&obj.map===nativeMap)return obj.map(iterator,context);each(obj,function(value,index,list){results[results.length]=iterator.call(context,value,index,list)});return results};var reduceError="Reduce of empty array with no initial value";_.reduce=_.foldl=_.inject=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null)obj=[];if(nativeReduce&&obj.reduce===nativeReduce){if(context)iterator=_.bind(iterator,context);return initial?obj.reduce(iterator,memo):obj.reduce(iterator)}each(obj,function(value,index,list){if(!initial){memo=value;initial=true}else{memo=iterator.call(context,memo,value,index,list)}});if(!initial)throw new TypeError(reduceError);return memo};_.reduceRight=_.foldr=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null)obj=[];if(nativeReduceRight&&obj.reduceRight===nativeReduceRight){if(context)iterator=_.bind(iterator,context);return initial?obj.reduceRight(iterator,memo):obj.reduceRight(iterator)}var length=obj.length;if(length!==+length){var keys=_.keys(obj);length=keys.length}each(obj,function(value,index,list){index=keys?keys[--length]:--length;if(!initial){memo=obj[index];initial=true}else{memo=iterator.call(context,memo,obj[index],index,list)}});if(!initial)throw new TypeError(reduceError);return memo};_.find=_.detect=function(obj,iterator,context){var result;any(obj,function(value,index,list){if(iterator.call(context,value,index,list)){result=value;return true}});return result};_.filter=_.select=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeFilter&&obj.filter===nativeFilter)return obj.filter(iterator,context);each(obj,function(value,index,list){if(iterator.call(context,value,index,list))results[results.length]=value});return results};_.reject=function(obj,iterator,context){return _.filter(obj,function(value,index,list){return!iterator.call(context,value,index,list)},context)};_.every=_.all=function(obj,iterator,context){iterator||(iterator=_.identity);var result=true;if(obj==null)return result;if(nativeEvery&&obj.every===nativeEvery)return obj.every(iterator,context);each(obj,function(value,index,list){if(!(result=result&&iterator.call(context,value,index,list)))return breaker});return!!result};var any=_.some=_.any=function(obj,iterator,context){iterator||(iterator=_.identity);var result=false;if(obj==null)return result;if(nativeSome&&obj.some===nativeSome)return obj.some(iterator,context);each(obj,function(value,index,list){if(result||(result=iterator.call(context,value,index,list)))return breaker});return!!result};_.contains=_.include=function(obj,target){if(obj==null)return false;if(nativeIndexOf&&obj.indexOf===nativeIndexOf)return obj.indexOf(target)!=-1;return any(obj,function(value){return value===target})};_.invoke=function(obj,method){var args=slice.call(arguments,2);return _.map(obj,function(value){return(_.isFunction(method)?method:value[method]).apply(value,args)})};_.pluck=function(obj,key){return _.map(obj,function(value){return value[key]})};_.where=function(obj,attrs){if(_.isEmpty(attrs))return[];return _.filter(obj,function(value){for(var key in attrs){if(attrs[key]!==value[key])return false}return true})};_.max=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535){return Math.max.apply(Math,obj)}if(!iterator&&_.isEmpty(obj))return-Infinity;var result={computed:-Infinity,value:-Infinity};each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed>=result.computed&&(result={value:value,computed:computed})});return result.value};_.min=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535){return Math.min.apply(Math,obj)}if(!iterator&&_.isEmpty(obj))return Infinity;var result={computed:Infinity,value:Infinity};each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed<result.computed&&(result={value:value,computed:computed})});return result.value};_.shuffle=function(obj){var rand;var index=0;var shuffled=[];each(obj,function(value){rand=_.random(index++);shuffled[index-1]=shuffled[rand];shuffled[rand]=value});return shuffled};var lookupIterator=function(value){return _.isFunction(value)?value:function(obj){return obj[value]}};_.sortBy=function(obj,value,context){var iterator=lookupIterator(value);return _.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iterator.call(context,value,index,list)}}).sort(function(left,right){var a=left.criteria;var b=right.criteria;if(a!==b){if(a>b||a===void 0)return 1;if(a<b||b===void 0)return-1}return left.index<right.index?-1:1}),"value")};var group=function(obj,value,context,behavior){var result={};var iterator=lookupIterator(value||_.identity);each(obj,function(value,index){var key=iterator.call(context,value,index,obj);behavior(result,key,value)});return result};_.groupBy=function(obj,value,context){return group(obj,value,context,function(result,key,value){(_.has(result,key)?result[key]:result[key]=[]).push(value)})};_.countBy=function(obj,value,context){return group(obj,value,context,function(result,key){if(!_.has(result,key))result[key]=0;result[key]++})};_.sortedIndex=function(array,obj,iterator,context){iterator=iterator==null?_.identity:lookupIterator(iterator);var value=iterator.call(context,obj);var low=0,high=array.length;while(low<high){var mid=low+high>>>1;iterator.call(context,array[mid])<value?low=mid+1:high=mid}return low};_.toArray=function(obj){if(!obj)return[];if(_.isArray(obj))return slice.call(obj);if(obj.length===+obj.length)return _.map(obj,_.identity);return _.values(obj)};_.size=function(obj){if(obj==null)return 0;return obj.length===+obj.length?obj.length:_.keys(obj).length};_.first=_.head=_.take=function(array,n,guard){if(array==null)return void 0;return n!=null&&!guard?slice.call(array,0,n):array[0]};_.initial=function(array,n,guard){return slice.call(array,0,array.length-(n==null||guard?1:n))};_.last=function(array,n,guard){if(array==null)return void 0;if(n!=null&&!guard){return slice.call(array,Math.max(array.length-n,0))}else{return array[array.length-1]}};_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,n==null||guard?1:n)};_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,output){each(input,function(value){if(_.isArray(value)){shallow?push.apply(output,value):flatten(value,shallow,output)}else{output.push(value)}});return output};_.flatten=function(array,shallow){return flatten(array,shallow,[])};_.without=function(array){return _.difference(array,slice.call(arguments,1))};_.uniq=_.unique=function(array,isSorted,iterator,context){if(_.isFunction(isSorted)){context=iterator;iterator=isSorted;isSorted=false}var initial=iterator?_.map(array,iterator,context):array;var results=[];var seen=[];each(initial,function(value,index){if(isSorted?!index||seen[seen.length-1]!==value:!_.contains(seen,value)){seen.push(value);results.push(array[index])}});return results};_.union=function(){return _.uniq(concat.apply(ArrayProto,arguments))};_.intersection=function(array){var rest=slice.call(arguments,1);return _.filter(_.uniq(array),function(item){return _.every(rest,function(other){return _.indexOf(other,item)>=0})})};_.difference=function(array){var rest=concat.apply(ArrayProto,slice.call(arguments,1));return _.filter(array,function(value){return!_.contains(rest,value)})};_.zip=function(){var args=slice.call(arguments);var length=_.max(_.pluck(args,"length"));var results=new Array(length);for(var i=0;i<length;i++){results[i]=_.pluck(args,""+i)}return results};_.object=function(list,values){if(list==null)return{};var result={};for(var i=0,l=list.length;i<l;i++){if(values){result[list[i]]=values[i]}else{result[list[i][0]]=list[i][1]}}return result};_.indexOf=function(array,item,isSorted){if(array==null)return-1;var i=0,l=array.length;if(isSorted){if(typeof isSorted=="number"){i=isSorted<0?Math.max(0,l+isSorted):isSorted}else{i=_.sortedIndex(array,item);return array[i]===item?i:-1}}if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item,isSorted);for(;i<l;i++)if(array[i]===item)return i;return-1};_.lastIndexOf=function(array,item,from){if(array==null)return-1;var hasIndex=from!=null;if(nativeLastIndexOf&&array.lastIndexOf===nativeLastIndexOf){return hasIndex?array.lastIndexOf(item,from):array.lastIndexOf(item)}var i=hasIndex?from:array.length;while(i--)if(array[i]===item)return i;return-1};_.range=function(start,stop,step){if(arguments.length<=1){stop=start||0;start=0}step=arguments[2]||1;var len=Math.max(Math.ceil((stop-start)/step),0);var idx=0;var range=new Array(len);while(idx<len){range[idx++]=start;start+=step}return range};var ctor=function(){};_.bind=function(func,context){var args,bound;if(func.bind===nativeBind&&nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError;args=slice.call(arguments,2);return bound=function(){if(!(this instanceof bound))return func.apply(context,args.concat(slice.call(arguments)));ctor.prototype=func.prototype;var self=new ctor;ctor.prototype=null;var result=func.apply(self,args.concat(slice.call(arguments)));if(Object(result)===result)return result;return self}};_.bindAll=function(obj){var funcs=slice.call(arguments,1);if(funcs.length==0)funcs=_.functions(obj);each(funcs,function(f){obj[f]=_.bind(obj[f],obj)});return obj};_.memoize=function(func,hasher){var memo={};hasher||(hasher=_.identity);return function(){var key=hasher.apply(this,arguments);return _.has(memo,key)?memo[key]:memo[key]=func.apply(this,arguments)}};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)};_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)))};_.throttle=function(func,wait){var context,args,timeout,result;var previous=0;var later=function(){previous=new Date;timeout=null;result=func.apply(context,args)};return function(){var now=new Date;var remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0){clearTimeout(timeout);timeout=null;previous=now;result=func.apply(context,args)}else if(!timeout){timeout=setTimeout(later,remaining)}return result}};_.debounce=function(func,wait,immediate){var timeout,result;return function(){var context=this,args=arguments;var later=function(){timeout=null;if(!immediate)result=func.apply(context,args)};var callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);if(callNow)result=func.apply(context,args);return result}};_.once=function(func){var ran=false,memo;return function(){if(ran)return memo;ran=true;memo=func.apply(this,arguments);func=null;return memo}};_.wrap=function(func,wrapper){return function(){var args=[func];push.apply(args,arguments);return wrapper.apply(this,args)}};_.compose=function(){var funcs=arguments;return function(){var args=arguments;for(var i=funcs.length-1;i>=0;i--){args=[funcs[i].apply(this,args)]}return args[0]}};_.after=function(times,func){if(times<=0)return func();return function(){if(--times<1){return func.apply(this,arguments)}}};_.keys=nativeKeys||function(obj){if(obj!==Object(obj))throw new TypeError("Invalid object");var keys=[];for(var key in obj)if(_.has(obj,key))keys[keys.length]=key;return keys};_.values=function(obj){var values=[];for(var key in obj)if(_.has(obj,key))values.push(obj[key]);return values};_.pairs=function(obj){var pairs=[];for(var key in obj)if(_.has(obj,key))pairs.push([key,obj[key]]);return pairs};_.invert=function(obj){var result={};for(var key in obj)if(_.has(obj,key))result[obj[key]]=key;return result
};_.functions=_.methods=function(obj){var names=[];for(var key in obj){if(_.isFunction(obj[key]))names.push(key)}return names.sort()};_.extend=function(obj){each(slice.call(arguments,1),function(source){if(source){for(var prop in source){obj[prop]=source[prop]}}});return obj};_.pick=function(obj){var copy={};var keys=concat.apply(ArrayProto,slice.call(arguments,1));each(keys,function(key){if(key in obj)copy[key]=obj[key]});return copy};_.omit=function(obj){var copy={};var keys=concat.apply(ArrayProto,slice.call(arguments,1));for(var key in obj){if(!_.contains(keys,key))copy[key]=obj[key]}return copy};_.defaults=function(obj){each(slice.call(arguments,1),function(source){if(source){for(var prop in source){if(obj[prop]==null)obj[prop]=source[prop]}}});return obj};_.clone=function(obj){if(!_.isObject(obj))return obj;return _.isArray(obj)?obj.slice():_.extend({},obj)};_.tap=function(obj,interceptor){interceptor(obj);return obj};var eq=function(a,b,aStack,bStack){if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;if(a instanceof _)a=a._wrapped;if(b instanceof _)b=b._wrapped;var className=toString.call(a);if(className!=toString.call(b))return false;switch(className){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:a==0?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if(typeof a!="object"||typeof b!="object")return false;var length=aStack.length;while(length--){if(aStack[length]==a)return bStack[length]==b}aStack.push(a);bStack.push(b);var size=0,result=true;if(className=="[object Array]"){size=a.length;result=size==b.length;if(result){while(size--){if(!(result=eq(a[size],b[size],aStack,bStack)))break}}}else{var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)){return false}for(var key in a){if(_.has(a,key)){size++;if(!(result=_.has(b,key)&&eq(a[key],b[key],aStack,bStack)))break}}if(result){for(key in b){if(_.has(b,key)&&!size--)break}result=!size}}aStack.pop();bStack.pop();return result};_.isEqual=function(a,b){return eq(a,b,[],[])};_.isEmpty=function(obj){if(obj==null)return true;if(_.isArray(obj)||_.isString(obj))return obj.length===0;for(var key in obj)if(_.has(obj,key))return false;return true};_.isElement=function(obj){return!!(obj&&obj.nodeType===1)};_.isArray=nativeIsArray||function(obj){return toString.call(obj)=="[object Array]"};_.isObject=function(obj){return obj===Object(obj)};each(["Arguments","Function","String","Number","Date","RegExp"],function(name){_["is"+name]=function(obj){return toString.call(obj)=="[object "+name+"]"}});if(!_.isArguments(arguments)){_.isArguments=function(obj){return!!(obj&&_.has(obj,"callee"))}}if(typeof/./!=="function"){_.isFunction=function(obj){return typeof obj==="function"}}_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))};_.isNaN=function(obj){return _.isNumber(obj)&&obj!=+obj};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)=="[object Boolean]"};_.isNull=function(obj){return obj===null};_.isUndefined=function(obj){return obj===void 0};_.has=function(obj,key){return hasOwnProperty.call(obj,key)};_.noConflict=function(){root._=previousUnderscore;return this};_.identity=function(value){return value};_.times=function(n,iterator,context){var accum=Array(n);for(var i=0;i<n;i++)accum[i]=iterator.call(context,i);return accum};_.random=function(min,max){if(max==null){max=min;min=0}return min+(0|Math.random()*(max-min+1))};var entityMap={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};entityMap.unescape=_.invert(entityMap.escape);var entityRegexes={escape:new RegExp("["+_.keys(entityMap.escape).join("")+"]","g"),unescape:new RegExp("("+_.keys(entityMap.unescape).join("|")+")","g")};_.each(["escape","unescape"],function(method){_[method]=function(string){if(string==null)return"";return(""+string).replace(entityRegexes[method],function(match){return entityMap[method][match]})}});_.result=function(object,property){if(object==null)return null;var value=object[property];return _.isFunction(value)?value.call(object):value};_.mixin=function(obj){each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];push.apply(args,arguments);return result.call(this,func.apply(_,args))}})};var idCounter=0;_.uniqueId=function(prefix){var id=""+ ++idCounter;return prefix?prefix+id:id};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/;var escapes={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"};var escaper=/\\|'|\r|\n|\t|\u2028|\u2029/g;_.template=function(text,data,settings){settings=_.defaults({},settings,_.templateSettings);var matcher=new RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g");var index=0;var source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,function(match){return"\\"+escapes[match]});if(escape){source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'"}if(interpolate){source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'"}if(evaluate){source+="';\n"+evaluate+"\n__p+='"}index=offset+match.length;return match});source+="';\n";if(!settings.variable)source="with(obj||{}){\n"+source+"}\n";source="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{var render=new Function(settings.variable||"obj","_",source)}catch(e){e.source=source;throw e}if(data)return render(data,_);var template=function(data){return render.call(this,data,_)};template.source="function("+(settings.variable||"obj")+"){\n"+source+"}";return template};_.chain=function(obj){return _(obj).chain()};var result=function(obj){return this._chain?_(obj).chain():obj};_.mixin(_);each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;method.apply(obj,arguments);if((name=="shift"||name=="splice")&&obj.length===0)delete obj[0];return result.call(this,obj)}});each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result.call(this,method.apply(this._wrapped,arguments))}});_.extend(_.prototype,{chain:function(){this._chain=true;return this},value:function(){return this._wrapped}})}.call(this);!function(a){String.prototype.trim===a&&(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}),Array.prototype.reduce===a&&(Array.prototype.reduce=function(b){if(this===void 0||this===null)throw new TypeError;var c=Object(this),d=c.length>>>0,e=0,f;if(typeof b!="function")throw new TypeError;if(d==0&&arguments.length==1)throw new TypeError;if(arguments.length>=2)f=arguments[1];else do{if(e in c){f=c[e++];break}if(++e>=d)throw new TypeError}while(!0);while(e<d)e in c&&(f=b.call(a,f,c[e],e,c)),e++;return f})}();var Zepto=function(){function A(a){return v.call(a)=="[object Function]"}function B(a){return a instanceof Object}function C(b){var c,d;if(v.call(b)!=="[object Object]")return!1;d=A(b.constructor)&&b.constructor.prototype;if(!d||!hasOwnProperty.call(d,"isPrototypeOf"))return!1;for(c in b);return c===a||hasOwnProperty.call(b,c)}function D(a){return a instanceof Array}function E(a){return typeof a.length=="number"}function F(b){return b.filter(function(b){return b!==a&&b!==null})}function G(a){return a.length>0?[].concat.apply([],a):a}function H(a){return a.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function I(a){return a in i?i[a]:i[a]=new RegExp("(^|\\s)"+a+"(\\s|$)")}function J(a,b){return typeof b=="number"&&!k[H(a)]?b+"px":b}function K(a){var b,c;return h[a]||(b=g.createElement(a),g.body.appendChild(b),c=j(b,"").getPropertyValue("display"),b.parentNode.removeChild(b),c=="none"&&(c="block"),h[a]=c),h[a]}function L(b,d){return d===a?c(b):c(b).filter(d)}function M(a,b,c,d){return A(b)?b.call(a,c,d):b}function N(a,b,d){var e=a%2?b:b.parentNode;e?e.insertBefore(d,a?a==1?e.firstChild:a==2?b:null:b.nextSibling):c(d).remove()}function O(a,b){b(a);for(var c in a.childNodes)O(a.childNodes[c],b)}var a,b,c,d,e=[],f=e.slice,g=window.document,h={},i={},j=g.defaultView.getComputedStyle,k={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},l=/^\s*<(\w+|!)[^>]*>/,m=[1,3,8,9,11],n=["after","prepend","before","append"],o=g.createElement("table"),p=g.createElement("tr"),q={tr:g.createElement("tbody"),tbody:o,thead:o,tfoot:o,td:p,th:p,"*":g.createElement("div")},r=/complete|loaded|interactive/,s=/^\.([\w-]+)$/,t=/^#([\w-]+)$/,u=/^[\w-]+$/,v={}.toString,w={},x,y,z=g.createElement("div");return w.matches=function(a,b){if(!a||a.nodeType!==1)return!1;var c=a.webkitMatchesSelector||a.mozMatchesSelector||a.oMatchesSelector||a.matchesSelector;if(c)return c.call(a,b);var d,e=a.parentNode,f=!e;return f&&(e=z).appendChild(a),d=~w.qsa(e,b).indexOf(a),f&&z.removeChild(a),d},x=function(a){return a.replace(/-+(.)?/g,function(a,b){return b?b.toUpperCase():""})},y=function(a){return a.filter(function(b,c){return a.indexOf(b)==c})},w.fragment=function(b,d){d===a&&(d=l.test(b)&&RegExp.$1),d in q||(d="*");var e=q[d];return e.innerHTML=""+b,c.each(f.call(e.childNodes),function(){e.removeChild(this)})},w.Z=function(a,b){return a=a||[],a.__proto__=arguments.callee.prototype,a.selector=b||"",a},w.isZ=function(a){return a instanceof w.Z},w.init=function(b,d){if(!b)return w.Z();if(A(b))return c(g).ready(b);if(w.isZ(b))return b;var e;if(D(b))e=F(b);else if(C(b))e=[c.extend({},b)],b=null;else if(m.indexOf(b.nodeType)>=0||b===window)e=[b],b=null;else if(l.test(b))e=w.fragment(b.trim(),RegExp.$1),b=null;else{if(d!==a)return c(d).find(b);e=w.qsa(g,b)}return w.Z(e,b)},c=function(a,b){return w.init(a,b)},c.extend=function(c){return f.call(arguments,1).forEach(function(d){for(b in d)d[b]!==a&&(c[b]=d[b])}),c},w.qsa=function(a,b){var c;return a===g&&t.test(b)?(c=a.getElementById(RegExp.$1))?[c]:e:a.nodeType!==1&&a.nodeType!==9?e:f.call(s.test(b)?a.getElementsByClassName(RegExp.$1):u.test(b)?a.getElementsByTagName(b):a.querySelectorAll(b))},c.isFunction=A,c.isObject=B,c.isArray=D,c.isPlainObject=C,c.inArray=function(a,b,c){return e.indexOf.call(b,a,c)},c.trim=function(a){return a.trim()},c.uuid=0,c.map=function(a,b){var c,d=[],e,f;if(E(a))for(e=0;e<a.length;e++)c=b(a[e],e),c!=null&&d.push(c);else for(f in a)c=b(a[f],f),c!=null&&d.push(c);return G(d)},c.each=function(a,b){var c,d;if(E(a)){for(c=0;c<a.length;c++)if(b.call(a[c],c,a[c])===!1)return a}else for(d in a)if(b.call(a[d],d,a[d])===!1)return a;return a},c.fn={forEach:e.forEach,reduce:e.reduce,push:e.push,indexOf:e.indexOf,concat:e.concat,map:function(a){return c.map(this,function(b,c){return a.call(b,c,b)})},slice:function(){return c(f.apply(this,arguments))},ready:function(a){return r.test(g.readyState)?a(c):g.addEventListener("DOMContentLoaded",function(){a(c)},!1),this},get:function(b){return b===a?f.call(this):this[b]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){this.parentNode!=null&&this.parentNode.removeChild(this)})},each:function(a){return this.forEach(function(b,c){a.call(b,c,b)}),this},filter:function(a){return c([].filter.call(this,function(b){return w.matches(b,a)}))},add:function(a,b){return c(y(this.concat(c(a,b))))},is:function(a){return this.length>0&&w.matches(this[0],a)},not:function(b){var d=[];if(A(b)&&b.call!==a)this.each(function(a){b.call(this,a)||d.push(this)});else{var e=typeof b=="string"?this.filter(b):E(b)&&A(b.item)?f.call(b):c(b);this.forEach(function(a){e.indexOf(a)<0&&d.push(a)})}return c(d)},eq:function(a){return a===-1?this.slice(a):this.slice(a,+a+1)},first:function(){var a=this[0];return a&&!B(a)?a:c(a)},last:function(){var a=this[this.length-1];return a&&!B(a)?a:c(a)},find:function(a){var b;return this.length==1?b=w.qsa(this[0],a):b=this.map(function(){return w.qsa(this,a)}),c(b)},closest:function(a,b){var d=this[0];while(d&&!w.matches(d,a))d=d!==b&&d!==g&&d.parentNode;return c(d)},parents:function(a){var b=[],d=this;while(d.length>0)d=c.map(d,function(a){if((a=a.parentNode)&&a!==g&&b.indexOf(a)<0)return b.push(a),a});return L(b,a)},parent:function(a){return L(y(this.pluck("parentNode")),a)},children:function(a){return L(this.map(function(){return f.call(this.children)}),a)},siblings:function(a){return L(this.map(function(a,b){return f.call(b.parentNode.children).filter(function(a){return a!==b})}),a)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(a){return this.map(function(){return this[a]})},show:function(){return this.each(function(){this.style.display=="none"&&(this.style.display=null),j(this,"").getPropertyValue("display")=="none"&&(this.style.display=K(this.nodeName))})},replaceWith:function(a){return this.before(a).remove()},wrap:function(a){return this.each(function(){c(this).wrapAll(c(a)[0].cloneNode(!1))})},wrapAll:function(a){return this[0]&&(c(this[0]).before(a=c(a)),a.append(this)),this},unwrap:function(){return this.parent().each(function(){c(this).replaceWith(c(this).children())}),this},clone:function(){return c(this.map(function(){return this.cloneNode(!0)}))},hide:function(){return this.css("display","none")},toggle:function(b){return(b===a?this.css("display")=="none":b)?this.show():this.hide()},prev:function(){return c(this.pluck("previousElementSibling"))},next:function(){return c(this.pluck("nextElementSibling"))},html:function(b){return b===a?this.length>0?this[0].innerHTML:null:this.each(function(a){var d=this.innerHTML;c(this).empty().append(M(this,b,a,d))})},text:function(b){return b===a?this.length>0?this[0].textContent:null:this.each(function(){this.textContent=b})},attr:function(c,d){var e;return typeof c=="string"&&d===a?this.length==0||this[0].nodeType!==1?a:c=="value"&&this[0].nodeName=="INPUT"?this.val():!(e=this[0].getAttribute(c))&&c in this[0]?this[0][c]:e:this.each(function(a){if(this.nodeType!==1)return;if(B(c))for(b in c)this.setAttribute(b,c[b]);else this.setAttribute(c,M(this,d,a,this.getAttribute(c)))})},removeAttr:function(a){return this.each(function(){this.nodeType===1&&this.removeAttribute(a)})},prop:function(b,c){return c===a?this[0]?this[0][b]:a:this.each(function(a){this[b]=M(this,c,a,this[b])})},data:function(b,c){var d=this.attr("data-"+H(b),c);return d!==null?d:a},val:function(b){return b===a?this.length>0?this[0].value:a:this.each(function(a){this.value=M(this,b,a,this.value)})},offset:function(){if(this.length==0)return null;var a=this[0].getBoundingClientRect();return{left:a.left+window.pageXOffset,top:a.top+window.pageYOffset,width:a.width,height:a.height}},css:function(c,d){if(d===a&&typeof c=="string")return this.length==0?a:this[0].style[x(c)]||j(this[0],"").getPropertyValue(c);var e="";for(b in c)typeof c[b]=="string"&&c[b]==""?this.each(function(){this.style.removeProperty(H(b))}):e+=H(b)+":"+J(b,c[b])+";";return typeof c=="string"&&(d==""?this.each(function(){this.style.removeProperty(H(c))}):e=H(c)+":"+J(c,d)),this.each(function(){this.style.cssText+=";"+e})},index:function(a){return a?this.indexOf(c(a)[0]):this.parent().children().indexOf(this[0])},hasClass:function(a){return this.length<1?!1:I(a).test(this[0].className)},addClass:function(a){return this.each(function(b){d=[];var e=this.className,f=M(this,a,b,e);f.split(/\s+/g).forEach(function(a){c(this).hasClass(a)||d.push(a)},this),d.length&&(this.className+=(e?" ":"")+d.join(" "))})},removeClass:function(b){return this.each(function(c){if(b===a)return this.className="";d=this.className,M(this,b,c,d).split(/\s+/g).forEach(function(a){d=d.replace(I(a)," ")}),this.className=d.trim()})},toggleClass:function(b,d){return this.each(function(e){var f=M(this,b,e,this.className);(d===a?!c(this).hasClass(f):d)?c(this).addClass(f):c(this).removeClass(f)})}},["width","height"].forEach(function(b){c.fn[b]=function(d){var e,f=b.replace(/./,function(a){return a[0].toUpperCase()});return d===a?this[0]==window?window["inner"+f]:this[0]==g?g.documentElement["offset"+f]:(e=this.offset())&&e[b]:this.each(function(a){var e=c(this);e.css(b,M(this,d,a,e[b]()))})}}),n.forEach(function(a,b){c.fn[a]=function(){var a=c.map(arguments,function(a){return B(a)?a:w.fragment(a)});if(a.length<1)return this;var d=this.length,e=d>1,f=b<2;return this.each(function(c,g){for(var h=0;h<a.length;h++){var i=a[f?a.length-h-1:h];O(i,function(a){a.nodeName!=null&&a.nodeName.toUpperCase()==="SCRIPT"&&(!a.type||a.type==="text/javascript")&&window.eval.call(window,a.innerHTML)}),e&&c<d-1&&(i=i.cloneNode(!0)),N(b,g,i)}})},c.fn[b%2?a+"To":"insert"+(b?"Before":"After")]=function(b){return c(b)[a](this),this}}),w.Z.prototype=c.fn,w.camelize=x,w.uniq=y,c.zepto=w,c}();window.Zepto=Zepto,"$"in window||(window.$=Zepto),function(a){function f(a){return a._zid||(a._zid=d++)}function g(a,b,d,e){b=h(b);if(b.ns)var g=i(b.ns);return(c[f(a)]||[]).filter(function(a){return a&&(!b.e||a.e==b.e)&&(!b.ns||g.test(a.ns))&&(!d||f(a.fn)===f(d))&&(!e||a.sel==e)})}function h(a){var b=(""+a).split(".");return{e:b[0],ns:b.slice(1).sort().join(" ")}}function i(a){return new RegExp("(?:^| )"+a.replace(" "," .* ?")+"(?: |$)")}function j(b,c,d){a.isObject(b)?a.each(b,d):b.split(/\s/).forEach(function(a){d(a,c)})}function k(b,d,e,g,i,k){k=!!k;var l=f(b),m=c[l]||(c[l]=[]);j(d,e,function(c,d){var e=i&&i(d,c),f=e||d,j=function(a){var c=f.apply(b,[a].concat(a.data));return c===!1&&a.preventDefault(),c},l=a.extend(h(c),{fn:d,proxy:j,sel:g,del:e,i:m.length});m.push(l),b.addEventListener(l.e,j,k)})}function l(a,b,d,e){var h=f(a);j(b||"",d,function(b,d){g(a,b,d,e).forEach(function(b){delete c[h][b.i],a.removeEventListener(b.e,b.proxy,!1)})})}function p(b){var c=a.extend({originalEvent:b},b);return a.each(o,function(a,d){c[a]=function(){return this[d]=m,b[a].apply(b,arguments)},c[d]=n}),c}function q(a){if(!("defaultPrevented"in a)){a.defaultPrevented=!1;var b=a.preventDefault;a.preventDefault=function(){this.defaultPrevented=!0,b.call(this)}}}var b=a.zepto.qsa,c={},d=1,e={};e.click=e.mousedown=e.mouseup=e.mousemove="MouseEvents",a.event={add:k,remove:l},a.proxy=function(b,c){if(a.isFunction(b)){var d=function(){return b.apply(c,arguments)};return d._zid=f(b),d}if(typeof c=="string")return a.proxy(b[c],b);throw new TypeError("expected function")},a.fn.bind=function(a,b){return this.each(function(){k(this,a,b)})},a.fn.unbind=function(a,b){return this.each(function(){l(this,a,b)})},a.fn.one=function(a,b){return this.each(function(c,d){k(this,a,b,null,function(a,b){return function(){var c=a.apply(d,arguments);return l(d,b,a),c}})})};var m=function(){return!0},n=function(){return!1},o={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};a.fn.delegate=function(b,c,d){var e=!1;if(c=="blur"||c=="focus")a.iswebkit?c=c=="blur"?"focusout":c=="focus"?"focusin":c:e=!0;return this.each(function(f,g){k(g,c,d,b,function(c){return function(d){var e,f=a(d.target).closest(b,g).get(0);if(f)return e=a.extend(p(d),{currentTarget:f,liveFired:g}),c.apply(f,[e].concat([].slice.call(arguments,1)))}},e)})},a.fn.undelegate=function(a,b,c){return this.each(function(){l(this,b,c,a)})},a.fn.live=function(b,c){return a(document.body).delegate(this.selector,b,c),this},a.fn.die=function(b,c){return a(document.body).undelegate(this.selector,b,c),this},a.fn.on=function(b,c,d){return c==undefined||a.isFunction(c)?this.bind(b,c):this.delegate(c,b,d)},a.fn.off=function(b,c,d){return c==undefined||a.isFunction(c)?this.unbind(b,c):this.undelegate(c,b,d)},a.fn.trigger=function(b,c){return typeof b=="string"&&(b=a.Event(b)),q(b),b.data=c,this.each(function(){"dispatchEvent"in this&&this.dispatchEvent(b)})},a.fn.triggerHandler=function(b,c){var d,e;return this.each(function(f,h){d=p(typeof b=="string"?a.Event(b):b),d.data=c,d.target=h,a.each(g(h,b.type||b),function(a,b){e=b.proxy(d);if(d.isImmediatePropagationStopped())return!1})}),e},"focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout change select keydown keypress keyup error".split(" ").forEach(function(b){a.fn[b]=function(a){return this.bind(b,a)}}),["focus","blur"].forEach(function(b){a.fn[b]=function(a){if(a)this.bind(b,a);else if(this.length)try{this.get(0)[b]()}catch(c){}return this}}),a.Event=function(a,b){var c=document.createEvent(e[a]||"Events"),d=!0;if(b)for(var f in b)f=="bubbles"?d=!!b[f]:c[f]=b[f];return c.initEvent(a,d,!0,null,null,null,null,null,null,null,null,null,null,null,null),c}}(Zepto),function(a){function b(a){var b=this.os={},c=this.browser={},d=a.match(/WebKit\/([\d.]+)/),e=a.match(/(Android)\s+([\d.]+)/),f=a.match(/(iPad).*OS\s([\d_]+)/),g=!f&&a.match(/(iPhone\sOS)\s([\d_]+)/),h=a.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),i=h&&a.match(/TouchPad/),j=a.match(/Kindle\/([\d.]+)/),k=a.match(/Silk\/([\d._]+)/),l=a.match(/(BlackBerry).*Version\/([\d.]+)/);if(c.webkit=!!d)c.version=d[1];e&&(b.android=!0,b.version=e[2]),g&&(b.ios=b.iphone=!0,b.version=g[2].replace(/_/g,".")),f&&(b.ios=b.ipad=!0,b.version=f[2].replace(/_/g,".")),h&&(b.webos=!0,b.version=h[2]),i&&(b.touchpad=!0),l&&(b.blackberry=!0,b.version=l[2]),j&&(b.kindle=!0,b.version=j[1]),k&&(c.silk=!0,c.version=k[1]),!k&&b.android&&a.match(/Kindle Fire/)&&(c.silk=!0)}b.call(a,navigator.userAgent),a.__detect=b}(Zepto),function(a,b){function l(a){return a.toLowerCase()}function m(a){return d?d+a:l(a)}var c="",d,e,f,g={Webkit:"webkit",Moz:"",O:"o",ms:"MS"},h=window.document,i=h.createElement("div"),j=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i,k={};a.each(g,function(a,e){if(i.style[a+"TransitionProperty"]!==b)return c="-"+l(a)+"-",d=e,!1}),k[c+"transition-property"]=k[c+"transition-duration"]=k[c+"transition-timing-function"]=k[c+"animation-name"]=k[c+"animation-duration"]="",a.fx={off:d===b&&i.style.transitionProperty===b,cssPrefix:c,transitionEnd:m("TransitionEnd"),animationEnd:m("AnimationEnd")},a.fn.animate=function(b,c,d,e){return a.isObject(c)&&(d=c.easing,e=c.complete,c=c.duration),c&&(c/=1e3),this.anim(b,c,d,e)},a.fn.anim=function(d,e,f,g){var h,i={},l,m=this,n,o=a.fx.transitionEnd;e===b&&(e=.4),a.fx.off&&(e=0);if(typeof d=="string")i[c+"animation-name"]=d,i[c+"animation-duration"]=e+"s",o=a.fx.animationEnd;else{for(l in d)j.test(l)?(h||(h=[]),h.push(l+"("+d[l]+")")):i[l]=d[l];h&&(i[c+"transform"]=h.join(" ")),!a.fx.off&&typeof d=="object"&&(i[c+"transition-property"]=Object.keys(d).join(", "),i[c+"transition-duration"]=e+"s",i[c+"transition-timing-function"]=f||"linear")}return n=function(b){if(typeof b!="undefined"){if(b.target!==b.currentTarget)return;a(b.target).unbind(o,arguments.callee)}a(this).css(k),g&&g.call(this)},e>0&&this.bind(o,n),setTimeout(function(){m.css(i),e<=0&&setTimeout(function(){m.each(function(){n.call(this)})},0)},0),this},i=null}(Zepto),function($){function triggerAndReturn(a,b,c){var d=$.Event(b);return $(a).trigger(d,c),!d.defaultPrevented}function triggerGlobal(a,b,c,d){if(a.global)return triggerAndReturn(b||document,c,d)}function ajaxStart(a){a.global&&$.active++===0&&triggerGlobal(a,null,"ajaxStart")}function ajaxStop(a){a.global&&!--$.active&&triggerGlobal(a,null,"ajaxStop")}function ajaxBeforeSend(a,b){var c=b.context;if(b.beforeSend.call(c,a,b)===!1||triggerGlobal(b,c,"ajaxBeforeSend",[a,b])===!1)return!1;triggerGlobal(b,c,"ajaxSend",[a,b])}function ajaxSuccess(a,b,c){var d=c.context,e="success";c.success.call(d,a,e,b),triggerGlobal(c,d,"ajaxSuccess",[b,c,a]),ajaxComplete(e,b,c)}function ajaxError(a,b,c,d){var e=d.context;d.error.call(e,c,b,a),triggerGlobal(d,e,"ajaxError",[c,d,a]),ajaxComplete(b,c,d)}function ajaxComplete(a,b,c){var d=c.context;c.complete.call(d,b,a),triggerGlobal(c,d,"ajaxComplete",[b,c]),ajaxStop(c)}function empty(){}function mimeToDataType(a){return a&&(a==htmlType?"html":a==jsonType?"json":scriptTypeRE.test(a)?"script":xmlTypeRE.test(a)&&"xml")||"text"}function appendQuery(a,b){return(a+"&"+b).replace(/[&?]{1,2}/,"?")}function serializeData(a){isObject(a.data)&&(a.data=$.param(a.data)),a.data&&(!a.type||a.type.toUpperCase()=="GET")&&(a.url=appendQuery(a.url,a.data))}function serialize(a,b,c,d){var e=$.isArray(b);$.each(b,function(b,f){d&&(b=c?d:d+"["+(e?"":b)+"]"),!d&&e?a.add(f.name,f.value):(c?$.isArray(f):isObject(f))?serialize(a,f,c,b):a.add(b,f)})}var jsonpID=0,isObject=$.isObject,document=window.document,key,name,rscript=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,scriptTypeRE=/^(?:text|application)\/javascript/i,xmlTypeRE=/^(?:text|application)\/xml/i,jsonType="application/json",htmlType="text/html",blankRE=/^\s*$/;$.active=0,$.ajaxJSONP=function(a){var b="jsonp"+ ++jsonpID,c=document.createElement("script"),d=function(){$(c).remove(),b in window&&(window[b]=empty),ajaxComplete("abort",e,a)},e={abort:d},f;return a.error&&(c.onerror=function(){e.abort(),a.error()}),window[b]=function(d){clearTimeout(f),$(c).remove(),delete window[b],ajaxSuccess(d,e,a)},serializeData(a),c.src=a.url.replace(/=\?/,"="+b),$("head").append(c),a.timeout>0&&(f=setTimeout(function(){e.abort(),ajaxComplete("timeout",e,a)},a.timeout)),e},$.ajaxSettings={type:"GET",beforeSend:empty,success:empty,error:empty,complete:empty,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript",json:jsonType,xml:"application/xml, text/xml",html:htmlType,text:"text/plain"},crossDomain:!1,timeout:0},$.ajax=function(options){var settings=$.extend({},options||{});for(key in $.ajaxSettings)settings[key]===undefined&&(settings[key]=$.ajaxSettings[key]);ajaxStart(settings),settings.crossDomain||(settings.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(settings.url)&&RegExp.$2!=window.location.host);var dataType=settings.dataType,hasPlaceholder=/=\?/.test(settings.url);if(dataType=="jsonp"||hasPlaceholder)return hasPlaceholder||(settings.url=appendQuery(settings.url,"callback=?")),$.ajaxJSONP(settings);settings.url||(settings.url=window.location.toString()),serializeData(settings);var mime=settings.accepts[dataType],baseHeaders={},protocol=/^([\w-]+:)\/\//.test(settings.url)?RegExp.$1:window.location.protocol,xhr=$.ajaxSettings.xhr(),abortTimeout;settings.crossDomain||(baseHeaders["X-Requested-With"]="XMLHttpRequest"),mime&&(baseHeaders.Accept=mime,mime.indexOf(",")>-1&&(mime=mime.split(",",2)[0]),xhr.overrideMimeType&&xhr.overrideMimeType(mime));if(settings.contentType||settings.data&&settings.type.toUpperCase()!="GET")baseHeaders["Content-Type"]=settings.contentType||"application/x-www-form-urlencoded";settings.headers=$.extend(baseHeaders,settings.headers||{}),xhr.onreadystatechange=function(){if(xhr.readyState==4){clearTimeout(abortTimeout);var result,error=!1;if(xhr.status>=200&&xhr.status<300||xhr.status==304||xhr.status==0&&protocol=="file:"){dataType=dataType||mimeToDataType(xhr.getResponseHeader("content-type")),result=xhr.responseText;try{dataType=="script"?(1,eval)(result):dataType=="xml"?result=xhr.responseXML:dataType=="json"&&(result=blankRE.test(result)?null:JSON.parse(result))}catch(e){error=e}error?ajaxError(error,"parsererror",xhr,settings):ajaxSuccess(result,xhr,settings)}else ajaxError(null,"error",xhr,settings)}};var async="async"in settings?settings.async:!0;xhr.open(settings.type,settings.url,async);for(name in settings.headers)xhr.setRequestHeader(name,settings.headers[name]);return ajaxBeforeSend(xhr,settings)===!1?(xhr.abort(),!1):(settings.timeout>0&&(abortTimeout=setTimeout(function(){xhr.onreadystatechange=empty,xhr.abort(),ajaxError(null,"timeout",xhr,settings)},settings.timeout)),xhr.send(settings.data?settings.data:null),xhr)},$.get=function(a,b){return $.ajax({url:a,success:b})},$.post=function(a,b,c,d){return $.isFunction(b)&&(d=d||c,c=b,b=null),$.ajax({type:"POST",url:a,data:b,success:c,dataType:d})},$.getJSON=function(a,b){return $.ajax({url:a,success:b,dataType:"json"})},$.fn.load=function(a,b){if(!this.length)return this;var c=this,d=a.split(/\s/),e;return d.length>1&&(a=d[0],e=d[1]),$.get(a,function(a){c.html(e?$(document.createElement("div")).html(a.replace(rscript,"")).find(e).html():a),b&&b.call(c)}),this};var escape=encodeURIComponent;$.param=function(a,b){var c=[];return c.add=function(a,b){this.push(escape(a)+"="+escape(b))},serialize(c,a,b),c.join("&").replace("%20","+")}}(Zepto),function(a){a.fn.serializeArray=function(){var b=[],c;return a(Array.prototype.slice.call(this.get(0).elements)).each(function(){c=a(this);var d=c.attr("type");this.nodeName.toLowerCase()!="fieldset"&&!this.disabled&&d!="submit"&&d!="reset"&&d!="button"&&(d!="radio"&&d!="checkbox"||this.checked)&&b.push({name:c.attr("name"),value:c.val()})}),b},a.fn.serialize=function(){var a=[];return this.serializeArray().forEach(function(b){a.push(encodeURIComponent(b.name)+"="+encodeURIComponent(b.value))}),a.join("&")},a.fn.submit=function(b){if(b)this.bind("submit",b);else if(this.length){var c=a.Event("submit");this.eq(0).trigger(c),c.defaultPrevented||this.get(0).submit()}return this}}(Zepto),function(a){function d(a){return"tagName"in a?a:a.parentNode}function e(a,b,c,d){var e=Math.abs(a-b),f=Math.abs(c-d);return e>=f?a-b>0?"Left":"Right":c-d>0?"Up":"Down"}function h(){g=null,b.last&&(b.el.trigger("longTap"),b={})}function i(){g&&clearTimeout(g),g=null}var b={},c,f=750,g;a(document).ready(function(){var j,k;a(document.body).bind("touchstart",function(e){j=Date.now(),k=j-(b.last||j),b.el=a(d(e.touches[0].target)),c&&clearTimeout(c),b.x1=e.touches[0].pageX,b.y1=e.touches[0].pageY,k>0&&k<=250&&(b.isDoubleTap=!0),b.last=j,g=setTimeout(h,f)}).bind("touchmove",function(a){i(),b.x2=a.touches[0].pageX,b.y2=a.touches[0].pageY}).bind("touchend",function(a){i(),b.isDoubleTap?(b.el.trigger("doubleTap"),b={}):b.x2&&Math.abs(b.x1-b.x2)>30||b.y2&&Math.abs(b.y1-b.y2)>30?(b.el.trigger("swipe")&&b.el.trigger("swipe"+e(b.x1,b.x2,b.y1,b.y2)),b={}):"last"in b&&(b.el.trigger("tap"),c=setTimeout(function(){c=null,b.el.trigger("singleTap"),b={}},250))}).bind("touchcancel",function(){c&&clearTimeout(c),g&&clearTimeout(g),g=c=null,b={}})}),["swipe","swipeLeft","swipeRight","swipeUp","swipeDown","doubleTap","tap","singleTap","longTap"].forEach(function(b){a.fn[b]=function(a){return this.bind(b,a)}})}(Zepto);!function(){var root=this;var previousBackbone=root.Backbone;var array=[];var push=array.push;var slice=array.slice;var splice=array.splice;var Backbone;if(typeof exports!=="undefined"){Backbone=exports}else{Backbone=root.Backbone={}}Backbone.VERSION="1.0.0";var _=root._;if(!_&&typeof require!=="undefined")_=require("underscore");Backbone.$=root.jQuery||root.Zepto||root.ender||root.$;Backbone.noConflict=function(){root.Backbone=previousBackbone;return this};Backbone.emulateHTTP=false;Backbone.emulateJSON=false;var Events=Backbone.Events={on:function(name,callback,context){if(!eventsApi(this,"on",name,[callback,context])||!callback)return this;this._events||(this._events={});var events=this._events[name]||(this._events[name]=[]);events.push({callback:callback,context:context,ctx:context||this});return this},once:function(name,callback,context){if(!eventsApi(this,"once",name,[callback,context])||!callback)return this;var self=this;var once=_.once(function(){self.off(name,once);callback.apply(this,arguments)});once._callback=callback;return this.on(name,once,context)},off:function(name,callback,context){var retain,ev,events,names,i,l,j,k;if(!this._events||!eventsApi(this,"off",name,[callback,context]))return this;if(!name&&!callback&&!context){this._events={};return this}names=name?[name]:_.keys(this._events);for(i=0,l=names.length;i<l;i++){name=names[i];
if(events=this._events[name]){this._events[name]=retain=[];if(callback||context){for(j=0,k=events.length;j<k;j++){ev=events[j];if(callback&&callback!==ev.callback&&callback!==ev.callback._callback||context&&context!==ev.context){retain.push(ev)}}}if(!retain.length)delete this._events[name]}}return this},trigger:function(name){if(!this._events)return this;var args=slice.call(arguments,1);if(!eventsApi(this,"trigger",name,args))return this;var events=this._events[name];var allEvents=this._events.all;if(events)triggerEvents(events,args);if(allEvents)triggerEvents(allEvents,arguments);return this},stopListening:function(obj,name,callback){var listeners=this._listeners;if(!listeners)return this;var deleteListener=!name&&!callback;if(typeof name==="object")callback=this;if(obj)(listeners={})[obj._listenerId]=obj;for(var id in listeners){listeners[id].off(name,callback,this);if(deleteListener)delete this._listeners[id]}return this}};var eventSplitter=/\s+/;var eventsApi=function(obj,action,name,rest){if(!name)return true;if(typeof name==="object"){for(var key in name){obj[action].apply(obj,[key,name[key]].concat(rest))}return false}if(eventSplitter.test(name)){var names=name.split(eventSplitter);for(var i=0,l=names.length;i<l;i++){obj[action].apply(obj,[names[i]].concat(rest))}return false}return true};var triggerEvents=function(events,args){var ev,i=-1,l=events.length,a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:while(++i<l)(ev=events[i]).callback.call(ev.ctx);return;case 1:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1);return;case 2:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2);return;case 3:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2,a3);return;default:while(++i<l)(ev=events[i]).callback.apply(ev.ctx,args)}};var listenMethods={listenTo:"on",listenToOnce:"once"};_.each(listenMethods,function(implementation,method){Events[method]=function(obj,name,callback){var listeners=this._listeners||(this._listeners={});var id=obj._listenerId||(obj._listenerId=_.uniqueId("l"));listeners[id]=obj;if(typeof name==="object")callback=this;obj[implementation](name,callback,this);return this}});Events.bind=Events.on;Events.unbind=Events.off;_.extend(Backbone,Events);var Model=Backbone.Model=function(attributes,options){var defaults;var attrs=attributes||{};options||(options={});this.cid=_.uniqueId("c");this.attributes={};_.extend(this,_.pick(options,modelOptions));if(options.parse)attrs=this.parse(attrs,options)||{};if(defaults=_.result(this,"defaults")){attrs=_.defaults({},attrs,defaults)}this.set(attrs,options);this.changed={};this.initialize.apply(this,arguments)};var modelOptions=["url","urlRoot","collection"];_.extend(Model.prototype,Events,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(options){return _.clone(this.attributes)},sync:function(){return Backbone.sync.apply(this,arguments)},get:function(attr){return this.attributes[attr]},escape:function(attr){return _.escape(this.get(attr))},has:function(attr){return this.get(attr)!=null},set:function(key,val,options){var attr,attrs,unset,changes,silent,changing,prev,current;if(key==null)return this;if(typeof key==="object"){attrs=key;options=val}else{(attrs={})[key]=val}options||(options={});if(!this._validate(attrs,options))return false;unset=options.unset;silent=options.silent;changes=[];changing=this._changing;this._changing=true;if(!changing){this._previousAttributes=_.clone(this.attributes);this.changed={}}current=this.attributes,prev=this._previousAttributes;if(this.idAttribute in attrs)this.id=attrs[this.idAttribute];for(attr in attrs){val=attrs[attr];if(!_.isEqual(current[attr],val))changes.push(attr);if(!_.isEqual(prev[attr],val)){this.changed[attr]=val}else{delete this.changed[attr]}unset?delete current[attr]:current[attr]=val}if(!silent){if(changes.length)this._pending=true;for(var i=0,l=changes.length;i<l;i++){this.trigger("change:"+changes[i],this,current[changes[i]],options)}}if(changing)return this;if(!silent){while(this._pending){this._pending=false;this.trigger("change",this,options)}}this._pending=false;this._changing=false;return this},unset:function(attr,options){return this.set(attr,void 0,_.extend({},options,{unset:true}))},clear:function(options){var attrs={};for(var key in this.attributes)attrs[key]=void 0;return this.set(attrs,_.extend({},options,{unset:true}))},hasChanged:function(attr){if(attr==null)return!_.isEmpty(this.changed);return _.has(this.changed,attr)},changedAttributes:function(diff){if(!diff)return this.hasChanged()?_.clone(this.changed):false;var val,changed=false;var old=this._changing?this._previousAttributes:this.attributes;for(var attr in diff){if(_.isEqual(old[attr],val=diff[attr]))continue;(changed||(changed={}))[attr]=val}return changed},previous:function(attr){if(attr==null||!this._previousAttributes)return null;return this._previousAttributes[attr]},previousAttributes:function(){return _.clone(this._previousAttributes)},fetch:function(options){options=options?_.clone(options):{};if(options.parse===void 0)options.parse=true;var model=this;var success=options.success;options.success=function(resp){if(!model.set(model.parse(resp,options),options))return false;if(success)success(model,resp,options);model.trigger("sync",model,resp,options)};wrapError(this,options);return this.sync("read",this,options)},save:function(key,val,options){var attrs,method,xhr,attributes=this.attributes;if(key==null||typeof key==="object"){attrs=key;options=val}else{(attrs={})[key]=val}if(attrs&&(!options||!options.wait)&&!this.set(attrs,options))return false;options=_.extend({validate:true},options);if(!this._validate(attrs,options))return false;if(attrs&&options.wait){this.attributes=_.extend({},attributes,attrs)}if(options.parse===void 0)options.parse=true;var model=this;var success=options.success;options.success=function(resp){model.attributes=attributes;var serverAttrs=model.parse(resp,options);if(options.wait)serverAttrs=_.extend(attrs||{},serverAttrs);if(_.isObject(serverAttrs)&&!model.set(serverAttrs,options)){return false}if(success)success(model,resp,options);model.trigger("sync",model,resp,options)};wrapError(this,options);method=this.isNew()?"create":options.patch?"patch":"update";if(method==="patch")options.attrs=attrs;xhr=this.sync(method,this,options);if(attrs&&options.wait)this.attributes=attributes;return xhr},destroy:function(options){options=options?_.clone(options):{};var model=this;var success=options.success;var destroy=function(){model.trigger("destroy",model,model.collection,options)};options.success=function(resp){if(options.wait||model.isNew())destroy();if(success)success(model,resp,options);if(!model.isNew())model.trigger("sync",model,resp,options)};if(this.isNew()){options.success();return false}wrapError(this,options);var xhr=this.sync("delete",this,options);if(!options.wait)destroy();return xhr},url:function(){var base=_.result(this,"urlRoot")||_.result(this.collection,"url")||urlError();if(this.isNew())return base;return base+(base.charAt(base.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(resp,options){return resp},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(options){return this._validate({},_.extend(options||{},{validate:true}))},_validate:function(attrs,options){if(!options.validate||!this.validate)return true;attrs=_.extend({},this.attributes,attrs);var error=this.validationError=this.validate(attrs,options)||null;if(!error)return true;this.trigger("invalid",this,error,_.extend(options||{},{validationError:error}));return false}});var modelMethods=["keys","values","pairs","invert","pick","omit"];_.each(modelMethods,function(method){Model.prototype[method]=function(){var args=slice.call(arguments);args.unshift(this.attributes);return _[method].apply(_,args)}});var Collection=Backbone.Collection=function(models,options){options||(options={});if(options.url)this.url=options.url;if(options.model)this.model=options.model;if(options.comparator!==void 0)this.comparator=options.comparator;this._reset();this.initialize.apply(this,arguments);if(models)this.reset(models,_.extend({silent:true},options))};var setOptions={add:true,remove:true,merge:true};var addOptions={add:true,merge:false,remove:false};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options)})},sync:function(){return Backbone.sync.apply(this,arguments)},add:function(models,options){return this.set(models,_.defaults(options||{},addOptions))},remove:function(models,options){models=_.isArray(models)?models.slice():[models];options||(options={});var i,l,index,model;for(i=0,l=models.length;i<l;i++){model=this.get(models[i]);if(!model)continue;delete this._byId[model.id];delete this._byId[model.cid];index=this.indexOf(model);this.models.splice(index,1);this.length--;if(!options.silent){options.index=index;model.trigger("remove",model,this,options)}this._removeReference(model)}return this},set:function(models,options){options=_.defaults(options||{},setOptions);if(options.parse)models=this.parse(models,options);if(!_.isArray(models))models=models?[models]:[];var i,l,model,attrs,existing,sort;var at=options.at;var sortable=this.comparator&&at==null&&options.sort!==false;var sortAttr=_.isString(this.comparator)?this.comparator:null;var toAdd=[],toRemove=[],modelMap={};for(i=0,l=models.length;i<l;i++){if(!(model=this._prepareModel(models[i],options)))continue;if(existing=this.get(model)){if(options.remove)modelMap[existing.cid]=true;if(options.merge){existing.set(model.attributes,options);if(sortable&&!sort&&existing.hasChanged(sortAttr))sort=true}}else if(options.add){toAdd.push(model);model.on("all",this._onModelEvent,this);this._byId[model.cid]=model;if(model.id!=null)this._byId[model.id]=model}}if(options.remove){for(i=0,l=this.length;i<l;++i){if(!modelMap[(model=this.models[i]).cid])toRemove.push(model)}if(toRemove.length)this.remove(toRemove,options)}if(toAdd.length){if(sortable)sort=true;this.length+=toAdd.length;if(at!=null){splice.apply(this.models,[at,0].concat(toAdd))}else{push.apply(this.models,toAdd)}}if(sort)this.sort({silent:true});if(options.silent)return this;for(i=0,l=toAdd.length;i<l;i++){(model=toAdd[i]).trigger("add",model,this,options)}if(sort)this.trigger("sort",this,options);return this},reset:function(models,options){options||(options={});for(var i=0,l=this.models.length;i<l;i++){this._removeReference(this.models[i])}options.previousModels=this.models;this._reset();this.add(models,_.extend({silent:true},options));if(!options.silent)this.trigger("reset",this,options);return this},push:function(model,options){model=this._prepareModel(model,options);this.add(model,_.extend({at:this.length},options));return model},pop:function(options){var model=this.at(this.length-1);this.remove(model,options);return model},unshift:function(model,options){model=this._prepareModel(model,options);this.add(model,_.extend({at:0},options));return model},shift:function(options){var model=this.at(0);this.remove(model,options);return model},slice:function(begin,end){return this.models.slice(begin,end)},get:function(obj){if(obj==null)return void 0;return this._byId[obj.id!=null?obj.id:obj.cid||obj]},at:function(index){return this.models[index]},where:function(attrs,first){if(_.isEmpty(attrs))return first?void 0:[];return this[first?"find":"filter"](function(model){for(var key in attrs){if(attrs[key]!==model.get(key))return false}return true})},findWhere:function(attrs){return this.where(attrs,true)},sort:function(options){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");options||(options={});if(_.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this)}else{this.models.sort(_.bind(this.comparator,this))}if(!options.silent)this.trigger("sort",this,options);return this},sortedIndex:function(model,value,context){value||(value=this.comparator);var iterator=_.isFunction(value)?value:function(model){return model.get(value)};return _.sortedIndex(this.models,model,iterator,context)},pluck:function(attr){return _.invoke(this.models,"get",attr)},fetch:function(options){options=options?_.clone(options):{};if(options.parse===void 0)options.parse=true;var success=options.success;var collection=this;options.success=function(resp){var method=options.reset?"reset":"set";collection[method](resp,options);if(success)success(collection,resp,options);collection.trigger("sync",collection,resp,options)};wrapError(this,options);return this.sync("read",this,options)},create:function(model,options){options=options?_.clone(options):{};if(!(model=this._prepareModel(model,options)))return false;if(!options.wait)this.add(model,options);var collection=this;var success=options.success;options.success=function(resp){if(options.wait)collection.add(model,options);if(success)success(model,resp,options)};model.save(null,options);return model},parse:function(resp,options){return resp},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(attrs,options){if(attrs instanceof Model){if(!attrs.collection)attrs.collection=this;return attrs}options||(options={});options.collection=this;var model=new this.model(attrs,options);if(!model._validate(attrs,options)){this.trigger("invalid",this,attrs,options);return false}return model},_removeReference:function(model){if(this===model.collection)delete model.collection;model.off("all",this._onModelEvent,this)},_onModelEvent:function(event,model,collection,options){if((event==="add"||event==="remove")&&collection!==this)return;if(event==="destroy")this.remove(model,options);if(model&&event==="change:"+model.idAttribute){delete this._byId[model.previous(model.idAttribute)];if(model.id!=null)this._byId[model.id]=model}this.trigger.apply(this,arguments)}});var methods=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];_.each(methods,function(method){Collection.prototype[method]=function(){var args=slice.call(arguments);args.unshift(this.models);return _[method].apply(_,args)}});var attributeMethods=["groupBy","countBy","sortBy"];_.each(attributeMethods,function(method){Collection.prototype[method]=function(value,context){var iterator=_.isFunction(value)?value:function(model){return model.get(value)};return _[method](this.models,iterator,context)}});var View=Backbone.View=function(options){this.cid=_.uniqueId("view");this._configure(options||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var delegateEventSplitter=/^(\S+)\s*(.*)$/;var viewOptions=["model","collection","el","id","attributes","className","tagName","events"];_.extend(View.prototype,Events,{tagName:"div",$:function(selector){return this.$el.find(selector)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(element,delegate){if(this.$el)this.undelegateEvents();this.$el=element instanceof Backbone.$?element:Backbone.$(element);this.el=this.$el[0];if(delegate!==false)this.delegateEvents();return this},delegateEvents:function(events){if(!(events||(events=_.result(this,"events"))))return this;this.undelegateEvents();for(var key in events){var method=events[key];if(!_.isFunction(method))method=this[events[key]];if(!method)continue;var match=key.match(delegateEventSplitter);var eventName=match[1],selector=match[2];method=_.bind(method,this);eventName+=".delegateEvents"+this.cid;if(selector===""){this.$el.on(eventName,method)}else{this.$el.on(eventName,selector,method)}}return this},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid);return this},_configure:function(options){if(this.options)options=_.extend({},_.result(this,"options"),options);_.extend(this,_.pick(options,viewOptions));this.options=options},_ensureElement:function(){if(!this.el){var attrs=_.extend({},_.result(this,"attributes"));if(this.id)attrs.id=_.result(this,"id");if(this.className)attrs["class"]=_.result(this,"className");var $el=Backbone.$("<"+_.result(this,"tagName")+">").attr(attrs);this.setElement($el,false)}else{this.setElement(_.result(this,"el"),false)}}});Backbone.sync=function(method,model,options){var type=methodMap[method];_.defaults(options||(options={}),{emulateHTTP:Backbone.emulateHTTP,emulateJSON:Backbone.emulateJSON});var params={type:type,dataType:"json"};if(!options.url){params.url=_.result(model,"url")||urlError()}if(options.data==null&&model&&(method==="create"||method==="update"||method==="patch")){params.contentType="application/json";params.data=JSON.stringify(options.attrs||model.toJSON(options))}if(options.emulateJSON){params.contentType="application/x-www-form-urlencoded";params.data=params.data?{model:params.data}:{}}if(options.emulateHTTP&&(type==="PUT"||type==="DELETE"||type==="PATCH")){params.type="POST";if(options.emulateJSON)params.data._method=type;var beforeSend=options.beforeSend;options.beforeSend=function(xhr){xhr.setRequestHeader("X-HTTP-Method-Override",type);if(beforeSend)return beforeSend.apply(this,arguments)}}if(params.type!=="GET"&&!options.emulateJSON){params.processData=false}if(params.type==="PATCH"&&window.ActiveXObject&&!(window.external&&window.external.msActiveXFilteringEnabled)){params.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}var xhr=options.xhr=Backbone.ajax(_.extend(params,options));model.trigger("request",model,xhr,options);return xhr};var methodMap={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};Backbone.ajax=function(){return Backbone.$.ajax.apply(Backbone.$,arguments)};var Router=Backbone.Router=function(options){options||(options={});if(options.routes)this.routes=options.routes;this._bindRoutes();this.initialize.apply(this,arguments)};var optionalParam=/\((.*?)\)/g;var namedParam=/(\(\?)?:\w+/g;var splatParam=/\*\w+/g;var escapeRegExp=/[\-{}\[\]+?.,\\\^$|#\s]/g;_.extend(Router.prototype,Events,{initialize:function(){},route:function(route,name,callback){if(!_.isRegExp(route))route=this._routeToRegExp(route);if(_.isFunction(name)){callback=name;name=""}if(!callback)callback=this[name];var router=this;Backbone.history.route(route,function(fragment){var args=router._extractParameters(route,fragment);callback&&callback.apply(router,args);router.trigger.apply(router,["route:"+name].concat(args));router.trigger("route",name,args);Backbone.history.trigger("route",router,name,args)});return this},navigate:function(fragment,options){Backbone.history.navigate(fragment,options);return this},_bindRoutes:function(){if(!this.routes)return;this.routes=_.result(this,"routes");var route,routes=_.keys(this.routes);while((route=routes.pop())!=null){this.route(route,this.routes[route])}},_routeToRegExp:function(route){route=route.replace(escapeRegExp,"\\$&").replace(optionalParam,"(?:$1)?").replace(namedParam,function(match,optional){return optional?match:"([^/]+)"}).replace(splatParam,"(.*?)");return new RegExp("^"+route+"$")},_extractParameters:function(route,fragment){var params=route.exec(fragment).slice(1);return _.map(params,function(param){return param?decodeURIComponent(param):null})}});var History=Backbone.History=function(){this.handlers=[];_.bindAll(this,"checkUrl");if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var routeStripper=/^[#\/]|\s+$/g;var rootStripper=/^\/+|\/+$/g;var isExplorer=/msie [\w.]+/;var trailingSlash=/\/$/;History.started=false;_.extend(History.prototype,Events,{interval:50,getHash:function(window){var match=(window||this).location.href.match(/#(.*)$/);return match?match[1]:""},getFragment:function(fragment,forcePushState){if(fragment==null){if(this._hasPushState||!this._wantsHashChange||forcePushState){fragment=this.location.pathname;var root=this.root.replace(trailingSlash,"");if(!fragment.indexOf(root))fragment=fragment.substr(root.length)}else{fragment=this.getHash()}}return fragment.replace(routeStripper,"")},start:function(options){if(History.started)throw new Error("Backbone.history has already been started");History.started=true;this.options=_.extend({},{root:"/"},this.options,options);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var fragment=this.getFragment();var docMode=document.documentMode;var oldIE=isExplorer.exec(navigator.userAgent.toLowerCase())&&(!docMode||docMode<=7);this.root=("/"+this.root+"/").replace(rootStripper,"/");if(oldIE&&this._wantsHashChange){this.iframe=Backbone.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(fragment)}if(this._hasPushState){Backbone.$(window).on("popstate",this.checkUrl)}else if(this._wantsHashChange&&"onhashchange"in window&&!oldIE){Backbone.$(window).on("hashchange",this.checkUrl)}else if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}this.fragment=fragment;var loc=this.location;var atRoot=loc.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!atRoot){this.fragment=this.getFragment(null,true);this.location.replace(this.root+this.location.search+"#"+this.fragment);return true}else if(this._wantsPushState&&this._hasPushState&&atRoot&&loc.hash){this.fragment=this.getHash().replace(routeStripper,"");this.history.replaceState({},document.title,this.root+this.fragment+loc.search)}if(!this.options.silent)return this.loadUrl()},stop:function(){Backbone.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);History.started=false},route:function(route,callback){this.handlers.unshift({route:route,callback:callback})},checkUrl:function(e){var current=this.getFragment();if(current===this.fragment&&this.iframe){current=this.getFragment(this.getHash(this.iframe))}if(current===this.fragment)return false;if(this.iframe)this.navigate(current);this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(fragmentOverride){var fragment=this.fragment=this.getFragment(fragmentOverride);var matched=_.any(this.handlers,function(handler){if(handler.route.test(fragment)){handler.callback(fragment);return true}});return matched},navigate:function(fragment,options){if(!History.started)return false;if(!options||options===true)options={trigger:options};fragment=this.getFragment(fragment||"");if(this.fragment===fragment)return;this.fragment=fragment;var url=this.root+fragment;if(this._hasPushState){this.history[options.replace?"replaceState":"pushState"]({},document.title,url)}else if(this._wantsHashChange){this._updateHash(this.location,fragment,options.replace);if(this.iframe&&fragment!==this.getFragment(this.getHash(this.iframe))){if(!options.replace)this.iframe.document.open().close();this._updateHash(this.iframe.location,fragment,options.replace)}}else{return this.location.assign(url)}if(options.trigger)this.loadUrl(fragment)},_updateHash:function(location,fragment,replace){if(replace){var href=location.href.replace(/(javascript:|#).*$/,"");location.replace(href+"#"+fragment)}else{location.hash="#"+fragment}}});Backbone.history=new History;var extend=function(protoProps,staticProps){var parent=this;var child;if(protoProps&&_.has(protoProps,"constructor")){child=protoProps.constructor}else{child=function(){return parent.apply(this,arguments)}}_.extend(child,parent,staticProps);var Surrogate=function(){this.constructor=child};Surrogate.prototype=parent.prototype;child.prototype=new Surrogate;if(protoProps)_.extend(child.prototype,protoProps);child.__super__=parent.prototype;return child};Model.extend=Collection.extend=Router.extend=View.extend=History.extend=extend;var urlError=function(){throw new Error('A "url" property or function must be specified')};var wrapError=function(model,options){var error=options.error;options.error=function(resp){if(error)error(model,resp,options);model.trigger("error",model,resp,options)}}}.call(this);_.extend(Backbone.Model.prototype,{sync:_.wrap(Backbone.Model.prototype.sync,function(){var args;args=Array.prototype.slice.call(arguments,1);if(this.storeName){var _this=this;if(args[0]==="read"){if(typeof syncStore!=="undefined"){syncStore.get(this.storeName,function(data){args[2].success(data[_this.storeName]||{})})}}else if(args[0]==="create"){data={};data[this.storeName]=this.toJSON();if(typeof syncStore!=="undefined"){syncStore.set(data,function(){args[2].success(data[_this.storeName])})}}}else{return arguments[0].apply(this,args)}})});!function(root,factory){if(typeof exports==="object"&&exports){module.exports=factory}else if(typeof define==="function"&&define.amd){define(factory)}else{root.Mustache=factory}}(this,function(){var exports={};exports.name="mustache.js";exports.version="0.7.2";exports.tags=["{{","}}"];exports.Scanner=Scanner;exports.Context=Context;exports.Writer=Writer;var whiteRe=/\s*/;var spaceRe=/\s+/;var nonSpaceRe=/\S/;var eqRe=/\s*=/;var curlyRe=/\s*\}/;var tagRe=/#|\^|\/|>|\{|&|=|!/;function testRe(re,string){return RegExp.prototype.test.call(re,string)}function isWhitespace(string){return!testRe(nonSpaceRe,string)}var isArray=Array.isArray||function(obj){return Object.prototype.toString.call(obj)==="[object Array]"};function escapeRe(string){return string.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function escapeHtml(string){return String(string).replace(/[&<>"'\/]/g,function(s){return entityMap[s]})}exports.escape=escapeHtml;function Scanner(string){this.string=string;this.tail=string;this.pos=0}Scanner.prototype.eos=function(){return this.tail===""};Scanner.prototype.scan=function(re){var match=this.tail.match(re);if(match&&match.index===0){this.tail=this.tail.substring(match[0].length);this.pos+=match[0].length;return match[0]}return""};Scanner.prototype.scanUntil=function(re){var match,pos=this.tail.search(re);switch(pos){case-1:match=this.tail;this.pos+=this.tail.length;this.tail="";break;case 0:match="";break;default:match=this.tail.substring(0,pos);this.tail=this.tail.substring(pos);this.pos+=pos}return match};function Context(view,parent){this.view=view;this.parent=parent;this.clearCache()}Context.make=function(view){return view instanceof Context?view:new Context(view)};Context.prototype.clearCache=function(){this._cache={}};Context.prototype.push=function(view){return new Context(view,this)};Context.prototype.lookup=function(name){var value=this._cache[name];if(!value){if(name==="."){value=this.view}else{var context=this;while(context){if(name.indexOf(".")>0){var names=name.split("."),i=0;value=context.view;while(value&&i<names.length){value=value[names[i++]]}}else{value=context.view[name]}if(value!=null){break}context=context.parent}}this._cache[name]=value}if(typeof value==="function"){value=value.call(this.view)}return value};function Writer(){this.clearCache()}Writer.prototype.clearCache=function(){this._cache={};this._partialCache={}};Writer.prototype.compile=function(template,tags){var fn=this._cache[template];if(!fn){var tokens=exports.parse(template,tags);fn=this._cache[template]=this.compileTokens(tokens,template)}return fn};Writer.prototype.compilePartial=function(name,template,tags){var fn=this.compile(template,tags);this._partialCache[name]=fn;return fn};Writer.prototype.compileTokens=function(tokens,template){var fn=compileTokens(tokens);var self=this;return function(view,partials){if(partials){if(typeof partials==="function"){self._loadPartial=partials}else{for(var name in partials){self.compilePartial(name,partials[name])}}}return fn(self,Context.make(view),template)}};Writer.prototype.render=function(template,view,partials){return this.compile(template)(view,partials)};Writer.prototype._section=function(name,context,text,callback){var value=context.lookup(name);switch(typeof value){case"object":if(isArray(value)){var buffer="";for(var i=0,len=value.length;i<len;++i){buffer+=callback(this,context.push(value[i]))}return buffer}return value?callback(this,context.push(value)):"";case"function":var self=this;var scopedRender=function(template){return self.render(template,context)};var result=value.call(context.view,text,scopedRender);return result!=null?result:"";default:if(value){return callback(this,context)}}return""};Writer.prototype._inverted=function(name,context,callback){var value=context.lookup(name);if(!value||isArray(value)&&value.length===0){return callback(this,context)}return""};Writer.prototype._partial=function(name,context){if(!(name in this._partialCache)&&this._loadPartial){this.compilePartial(name,this._loadPartial(name))}var fn=this._partialCache[name];return fn?fn(context):""};Writer.prototype._name=function(name,context){var value=context.lookup(name);if(typeof value==="function"){value=value.call(context.view)}return value==null?"":String(value)};Writer.prototype._escaped=function(name,context){return exports.escape(this._name(name,context))};function compileTokens(tokens){var subRenders={};function subRender(i,tokens,template){if(!subRenders[i]){var fn=compileTokens(tokens);subRenders[i]=function(writer,context){return fn(writer,context,template)}}return subRenders[i]}return function(writer,context,template){var buffer="";var token,sectionText;for(var i=0,len=tokens.length;i<len;++i){token=tokens[i];switch(token[0]){case"#":sectionText=template.slice(token[3],token[5]);buffer+=writer._section(token[1],context,sectionText,subRender(i,token[4],template));break;case"^":buffer+=writer._inverted(token[1],context,subRender(i,token[4],template));break;case">":buffer+=writer._partial(token[1],context);break;case"&":buffer+=writer._name(token[1],context);break;case"name":buffer+=writer._escaped(token[1],context);break;case"text":buffer+=token[1];break}}return buffer}}function nestTokens(tokens){var tree=[];var collector=tree;var sections=[];var token;for(var i=0,len=tokens.length;i<len;++i){token=tokens[i];switch(token[0]){case"#":case"^":sections.push(token);collector.push(token);collector=token[4]=[];break;case"/":var section=sections.pop();section[5]=token[2];collector=sections.length>0?sections[sections.length-1][4]:tree;break;default:collector.push(token)}}return tree}function squashTokens(tokens){var squashedTokens=[];var token,lastToken;for(var i=0,len=tokens.length;i<len;++i){token=tokens[i];if(token[0]==="text"&&lastToken&&lastToken[0]==="text"){lastToken[1]+=token[1];lastToken[3]=token[3]}else{lastToken=token;squashedTokens.push(token)}}return squashedTokens}function escapeTags(tags){return[new RegExp(escapeRe(tags[0])+"\\s*"),new RegExp("\\s*"+escapeRe(tags[1]))]}exports.parse=function(template,tags){template=template||"";tags=tags||exports.tags;if(typeof tags==="string")tags=tags.split(spaceRe);if(tags.length!==2){throw new Error("Invalid tags: "+tags.join(", "))}var tagRes=escapeTags(tags);var scanner=new Scanner(template);var sections=[];var tokens=[];var spaces=[];var hasTag=false;var nonSpace=false;function stripSpace(){if(hasTag&&!nonSpace){while(spaces.length){tokens.splice(spaces.pop(),1)}}else{spaces=[]}hasTag=false;nonSpace=false}var start,type,value,chr;while(!scanner.eos()){start=scanner.pos;value=scanner.scanUntil(tagRes[0]);if(value){for(var i=0,len=value.length;i<len;++i){chr=value.charAt(i);if(isWhitespace(chr)){spaces.push(tokens.length)}else{nonSpace=true}tokens.push(["text",chr,start,start+1]);start+=1;if(chr==="\n"){stripSpace()}}}start=scanner.pos;if(!scanner.scan(tagRes[0])){break}hasTag=true;type=scanner.scan(tagRe)||"name";
scanner.scan(whiteRe);if(type==="="){value=scanner.scanUntil(eqRe);scanner.scan(eqRe);scanner.scanUntil(tagRes[1])}else if(type==="{"){var closeRe=new RegExp("\\s*"+escapeRe("}"+tags[1]));value=scanner.scanUntil(closeRe);scanner.scan(curlyRe);scanner.scanUntil(tagRes[1]);type="&"}else{value=scanner.scanUntil(tagRes[1])}if(!scanner.scan(tagRes[1])){throw new Error("Unclosed tag at "+scanner.pos)}if(type==="/"){if(sections.length===0){throw new Error('Unopened section "'+value+'" at '+start)}var section=sections.pop();if(section[1]!==value){throw new Error('Unclosed section "'+section[1]+'" at '+start)}}var token=[type,value,start,scanner.pos];tokens.push(token);if(type==="#"||type==="^"){sections.push(token)}else if(type==="name"||type==="{"||type==="&"){nonSpace=true}else if(type==="="){tags=value.split(spaceRe);if(tags.length!==2){throw new Error("Invalid tags at "+start+": "+tags.join(", "))}tagRes=escapeTags(tags)}}var section=sections.pop();if(section){throw new Error('Unclosed section "'+section[1]+'" at '+scanner.pos)}return nestTokens(squashTokens(tokens))};var _writer=new Writer;exports.clearCache=function(){return _writer.clearCache()};exports.compile=function(template,tags){return _writer.compile(template,tags)};exports.compilePartial=function(name,template,tags){return _writer.compilePartial(name,template,tags)};exports.compileTokens=function(tokens,template){return _writer.compileTokens(tokens,template)};exports.render=function(template,view,partials){return _writer.render(template,view,partials)};exports.to_html=function(template,view,partials,send){var result=exports.render(template,view,partials);if(typeof send==="function"){send(result)}else{return result}};return exports}());!function(undefined){var moment,VERSION="1.7.2",round=Math.round,i,languages={},currentLanguage="en",hasModule=typeof module!=="undefined"&&module.exports,langConfigProperties="months|monthsShort|weekdays|weekdaysShort|weekdaysMin|longDateFormat|calendar|relativeTime|ordinal|meridiem".split("|"),aspNetJsonRegex=/^\/?Date\((\-?\d+)/i,formattingTokens=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|zz?|ZZ?|.)/g,localFormattingTokens=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?)/g,parseMultipleFormatChunker=/([0-9a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)/gi,parseTokenOneOrTwoDigits=/\d\d?/,parseTokenOneToThreeDigits=/\d{1,3}/,parseTokenThreeDigits=/\d{3}/,parseTokenFourDigits=/\d{1,4}/,parseTokenWord=/[0-9a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+/i,parseTokenTimezone=/Z|[\+\-]\d\d:?\d\d/i,parseTokenT=/T/i,isoRegex=/^\s*\d{4}-\d\d-\d\d(T(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,isoFormat="YYYY-MM-DDTHH:mm:ssZ",isoTimes=[["HH:mm:ss.S",/T\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/T\d\d:\d\d:\d\d/],["HH:mm",/T\d\d:\d\d/],["HH",/T\d\d/]],parseTimezoneChunker=/([\+\-]|\d\d)/gi,proxyGettersAndSetters="Month|Date|Hours|Minutes|Seconds|Milliseconds".split("|"),unitMillisecondFactors={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},formatFunctions={},ordinalizeTokens="DDD w M D d".split(" "),paddedTokens="M D H h m s w".split(" "),formatTokenFunctions={M:function(){return this.month()+1},MMM:function(format){return getValueFromArray("monthsShort",this.month(),this,format)},MMMM:function(format){return getValueFromArray("months",this.month(),this,format)},D:function(){return this.date()},DDD:function(){var a=new Date(this.year(),this.month(),this.date()),b=new Date(this.year(),0,1);return~~((a-b)/864e5+1.5)},d:function(){return this.day()},dd:function(format){return getValueFromArray("weekdaysMin",this.day(),this,format)},ddd:function(format){return getValueFromArray("weekdaysShort",this.day(),this,format)},dddd:function(format){return getValueFromArray("weekdays",this.day(),this,format)},w:function(){var a=new Date(this.year(),this.month(),this.date()-this.day()+5),b=new Date(a.getFullYear(),0,4);return~~((a-b)/864e5/7+1.5)},YY:function(){return leftZeroFill(this.year()%100,2)},YYYY:function(){return leftZeroFill(this.year(),4)},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),true)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),false)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return~~(this.milliseconds()/100)},SS:function(){return leftZeroFill(~~(this.milliseconds()/10),2)},SSS:function(){return leftZeroFill(this.milliseconds(),3)},Z:function(){var a=-this.zone(),b="+";if(a<0){a=-a;b="-"}return b+leftZeroFill(~~(a/60),2)+":"+leftZeroFill(~~a%60,2)},ZZ:function(){var a=-this.zone(),b="+";if(a<0){a=-a;b="-"}return b+leftZeroFill(~~(10*a/6),4)}};function getValueFromArray(key,index,m,format){var lang=m.lang();return lang[key].call?lang[key](m,format):lang[key][index]}function padToken(func,count){return function(a){return leftZeroFill(func.call(this,a),count)}}function ordinalizeToken(func){return function(a){var b=func.call(this,a);return b+this.lang().ordinal(b)}}while(ordinalizeTokens.length){i=ordinalizeTokens.pop();formatTokenFunctions[i+"o"]=ordinalizeToken(formatTokenFunctions[i])}while(paddedTokens.length){i=paddedTokens.pop();formatTokenFunctions[i+i]=padToken(formatTokenFunctions[i],2)}formatTokenFunctions.DDDD=padToken(formatTokenFunctions.DDD,3);function Moment(date,isUTC,lang){this._d=date;this._isUTC=!!isUTC;this._a=date._a||null;this._lang=lang||false}function Duration(duration){var data=this._data={},years=duration.years||duration.y||0,months=duration.months||duration.M||0,weeks=duration.weeks||duration.w||0,days=duration.days||duration.d||0,hours=duration.hours||duration.h||0,minutes=duration.minutes||duration.m||0,seconds=duration.seconds||duration.s||0,milliseconds=duration.milliseconds||duration.ms||0;this._milliseconds=milliseconds+seconds*1e3+minutes*6e4+hours*36e5;this._days=days+weeks*7;this._months=months+years*12;data.milliseconds=milliseconds%1e3;seconds+=absRound(milliseconds/1e3);data.seconds=seconds%60;minutes+=absRound(seconds/60);data.minutes=minutes%60;hours+=absRound(minutes/60);data.hours=hours%24;days+=absRound(hours/24);days+=weeks*7;data.days=days%30;months+=absRound(days/30);data.months=months%12;years+=absRound(months/12);data.years=years;this._lang=false}function absRound(number){if(number<0){return Math.ceil(number)}else{return Math.floor(number)}}function leftZeroFill(number,targetLength){var output=number+"";while(output.length<targetLength){output="0"+output}return output}function addOrSubtractDurationFromMoment(mom,duration,isAdding){var ms=duration._milliseconds,d=duration._days,M=duration._months,currentDate;if(ms){mom._d.setTime(+mom+ms*isAdding)}if(d){mom.date(mom.date()+d*isAdding)}if(M){currentDate=mom.date();mom.date(1).month(mom.month()+M*isAdding).date(Math.min(currentDate,mom.daysInMonth()))}}function isArray(input){return Object.prototype.toString.call(input)==="[object Array]"}function compareArrays(array1,array2){var len=Math.min(array1.length,array2.length),lengthDiff=Math.abs(array1.length-array2.length),diffs=0,i;for(i=0;i<len;i++){if(~~array1[i]!==~~array2[i]){diffs++}}return diffs+lengthDiff}function dateFromArray(input,asUTC,hoursOffset,minutesOffset){var i,date,forValid=[];for(i=0;i<7;i++){forValid[i]=input[i]=input[i]==null?i===2?1:0:input[i]}input[7]=forValid[7]=asUTC;if(input[8]!=null){forValid[8]=input[8]}input[3]+=hoursOffset||0;input[4]+=minutesOffset||0;date=new Date(0);if(asUTC){date.setUTCFullYear(input[0],input[1],input[2]);date.setUTCHours(input[3],input[4],input[5],input[6])}else{date.setFullYear(input[0],input[1],input[2]);date.setHours(input[3],input[4],input[5],input[6])}date._a=forValid;return date}function loadLang(key,values){var i,m,parse=[];if(!values&&hasModule){values=require("./lang/"+key)}for(i=0;i<langConfigProperties.length;i++){values[langConfigProperties[i]]=values[langConfigProperties[i]]||languages.en[langConfigProperties[i]]}for(i=0;i<12;i++){m=moment([2e3,i]);parse[i]=new RegExp("^"+(values.months[i]||values.months(m,""))+"|^"+(values.monthsShort[i]||values.monthsShort(m,"")).replace(".",""),"i")}values.monthsParse=values.monthsParse||parse;languages[key]=values;return values}function getLangDefinition(m){var langKey=typeof m==="string"&&m||m&&m._lang||null;return langKey?languages[langKey]||loadLang(langKey):moment}function removeFormattingTokens(input){if(input.match(/\[.*\]/)){return input.replace(/^\[|\]$/g,"")}return input.replace(/\\/g,"")}function makeFormatFunction(format){var array=format.match(formattingTokens),i,length;for(i=0,length=array.length;i<length;i++){if(formatTokenFunctions[array[i]]){array[i]=formatTokenFunctions[array[i]]}else{array[i]=removeFormattingTokens(array[i])}}return function(mom){var output="";for(i=0;i<length;i++){output+=typeof array[i].call==="function"?array[i].call(mom,format):array[i]}return output}}function formatMoment(m,format){var i=5;function replaceLongDateFormatTokens(input){return m.lang().longDateFormat[input]||input}while(i--&&localFormattingTokens.test(format)){format=format.replace(localFormattingTokens,replaceLongDateFormatTokens)}if(!formatFunctions[format]){formatFunctions[format]=makeFormatFunction(format)}return formatFunctions[format](m)}function getParseRegexForToken(token){switch(token){case"DDDD":return parseTokenThreeDigits;case"YYYY":return parseTokenFourDigits;case"S":case"SS":case"SSS":case"DDD":return parseTokenOneToThreeDigits;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":case"a":case"A":return parseTokenWord;case"Z":case"ZZ":return parseTokenTimezone;case"T":return parseTokenT;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return parseTokenOneOrTwoDigits;default:return new RegExp(token.replace("\\",""))}}function addTimeToArrayFromToken(token,input,datePartArray,config){var a,b;switch(token){case"M":case"MM":datePartArray[1]=input==null?0:~~input-1;break;case"MMM":case"MMMM":for(a=0;a<12;a++){if(getLangDefinition().monthsParse[a].test(input)){datePartArray[1]=a;b=true;break}}if(!b){datePartArray[8]=false}break;case"D":case"DD":case"DDD":case"DDDD":if(input!=null){datePartArray[2]=~~input}break;case"YY":datePartArray[0]=~~input+(~~input>70?1900:2e3);break;case"YYYY":datePartArray[0]=~~Math.abs(input);break;case"a":case"A":config.isPm=(input+"").toLowerCase()==="pm";break;case"H":case"HH":case"h":case"hh":datePartArray[3]=~~input;break;case"m":case"mm":datePartArray[4]=~~input;break;case"s":case"ss":datePartArray[5]=~~input;break;case"S":case"SS":case"SSS":datePartArray[6]=~~(("0."+input)*1e3);break;case"Z":case"ZZ":config.isUTC=true;a=(input+"").match(parseTimezoneChunker);if(a&&a[1]){config.tzh=~~a[1]}if(a&&a[2]){config.tzm=~~a[2]}if(a&&a[0]==="+"){config.tzh=-config.tzh;config.tzm=-config.tzm}break}if(input==null){datePartArray[8]=false}}function makeDateFromStringAndFormat(string,format){var datePartArray=[0,0,1,0,0,0,0],config={tzh:0,tzm:0},tokens=format.match(formattingTokens),i,parsedInput;for(i=0;i<tokens.length;i++){parsedInput=(getParseRegexForToken(tokens[i]).exec(string)||[])[0];if(parsedInput){string=string.slice(string.indexOf(parsedInput)+parsedInput.length)}if(formatTokenFunctions[tokens[i]]){addTimeToArrayFromToken(tokens[i],parsedInput,datePartArray,config)}}if(config.isPm&&datePartArray[3]<12){datePartArray[3]+=12}if(config.isPm===false&&datePartArray[3]===12){datePartArray[3]=0}return dateFromArray(datePartArray,config.isUTC,config.tzh,config.tzm)}function makeDateFromStringAndArray(string,formats){var output,inputParts=string.match(parseMultipleFormatChunker)||[],formattedInputParts,scoreToBeat=99,i,currentDate,currentScore;for(i=0;i<formats.length;i++){currentDate=makeDateFromStringAndFormat(string,formats[i]);formattedInputParts=formatMoment(new Moment(currentDate),formats[i]).match(parseMultipleFormatChunker)||[];currentScore=compareArrays(inputParts,formattedInputParts);if(currentScore<scoreToBeat){scoreToBeat=currentScore;output=currentDate}}return output}function makeDateFromString(string){var format="YYYY-MM-DDT",i;if(isoRegex.exec(string)){for(i=0;i<4;i++){if(isoTimes[i][1].exec(string)){format+=isoTimes[i][0];break}}return parseTokenTimezone.exec(string)?makeDateFromStringAndFormat(string,format+" Z"):makeDateFromStringAndFormat(string,format)}return new Date(string)}function substituteTimeAgo(string,number,withoutSuffix,isFuture,lang){var rt=lang.relativeTime[string];return typeof rt==="function"?rt(number||1,!!withoutSuffix,string,isFuture):rt.replace(/%d/i,number||1)}function relativeTime(milliseconds,withoutSuffix,lang){var seconds=round(Math.abs(milliseconds)/1e3),minutes=round(seconds/60),hours=round(minutes/60),days=round(hours/24),years=round(days/365),args=seconds<45&&["s",seconds]||minutes===1&&["m"]||minutes<45&&["mm",minutes]||hours===1&&["h"]||hours<22&&["hh",hours]||days===1&&["d"]||days<=25&&["dd",days]||days<=45&&["M"]||days<345&&["MM",round(days/30)]||years===1&&["y"]||["yy",years];args[2]=withoutSuffix;args[3]=milliseconds>0;args[4]=lang;return substituteTimeAgo.apply({},args)}moment=function(input,format){if(input===null||input===""){return null}var date,matched;if(moment.isMoment(input)){return new Moment(new Date(+input._d),input._isUTC,input._lang)}else if(format){if(isArray(format)){date=makeDateFromStringAndArray(input,format)}else{date=makeDateFromStringAndFormat(input,format)}}else{matched=aspNetJsonRegex.exec(input);date=input===undefined?new Date:matched?new Date(+matched[1]):input instanceof Date?input:isArray(input)?dateFromArray(input):typeof input==="string"?makeDateFromString(input):new Date(input)}return new Moment(date)};moment.utc=function(input,format){if(isArray(input)){return new Moment(dateFromArray(input,true),true)}if(typeof input==="string"&&!parseTokenTimezone.exec(input)){input+=" +0000";if(format){format+=" Z"}}return moment(input,format).utc()};moment.unix=function(input){return moment(input*1e3)};moment.duration=function(input,key){var isDuration=moment.isDuration(input),isNumber=typeof input==="number",duration=isDuration?input._data:isNumber?{}:input,ret;if(isNumber){if(key){duration[key]=input}else{duration.milliseconds=input}}ret=new Duration(duration);if(isDuration){ret._lang=input._lang}return ret};moment.humanizeDuration=function(num,type,withSuffix){return moment.duration(num,type===true?null:type).humanize(type===true?true:withSuffix)};moment.version=VERSION;moment.defaultFormat=isoFormat;moment.lang=function(key,values){var i;if(!key){return currentLanguage}if(values||!languages[key]){loadLang(key,values)}if(languages[key]){for(i=0;i<langConfigProperties.length;i++){moment[langConfigProperties[i]]=languages[key][langConfigProperties[i]]}moment.monthsParse=languages[key].monthsParse;currentLanguage=key}};moment.langData=getLangDefinition;moment.isMoment=function(obj){return obj instanceof Moment};moment.isDuration=function(obj){return obj instanceof Duration};moment.lang("en",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},meridiem:function(hours,minutes,isLower){if(hours>11){return isLower?"pm":"PM"}else{return isLower?"am":"AM"}},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(number){var b=number%10;return~~(number%100/10)===1?"th":b===1?"st":b===2?"nd":b===3?"rd":"th"}});moment.fn=Moment.prototype={clone:function(){return moment(this)},valueOf:function(){return+this._d},unix:function(){return Math.floor(+this._d/1e3)},toString:function(){return this._d.toString()},toDate:function(){return this._d},toArray:function(){var m=this;return[m.year(),m.month(),m.date(),m.hours(),m.minutes(),m.seconds(),m.milliseconds(),!!this._isUTC]},isValid:function(){if(this._a){if(this._a[8]!=null){return!!this._a[8]}return!compareArrays(this._a,(this._a[7]?moment.utc(this._a):moment(this._a)).toArray())}return!isNaN(this._d.getTime())},utc:function(){this._isUTC=true;return this},local:function(){this._isUTC=false;return this},format:function(inputString){return formatMoment(this,inputString?inputString:moment.defaultFormat)},add:function(input,val){var dur=val?moment.duration(+val,input):moment.duration(input);addOrSubtractDurationFromMoment(this,dur,1);return this},subtract:function(input,val){var dur=val?moment.duration(+val,input):moment.duration(input);addOrSubtractDurationFromMoment(this,dur,-1);return this},diff:function(input,val,asFloat){var inputMoment=this._isUTC?moment(input).utc():moment(input).local(),zoneDiff=(this.zone()-inputMoment.zone())*6e4,diff=this._d-inputMoment._d-zoneDiff,year=this.year()-inputMoment.year(),month=this.month()-inputMoment.month(),date=this.date()-inputMoment.date(),output;if(val==="months"){output=year*12+month+date/30}else if(val==="years"){output=year+(month+date/30)/12}else{output=val==="seconds"?diff/1e3:val==="minutes"?diff/6e4:val==="hours"?diff/36e5:val==="days"?diff/864e5:val==="weeks"?diff/6048e5:diff}return asFloat?output:round(output)},from:function(time,withoutSuffix){return moment.duration(this.diff(time)).lang(this._lang).humanize(!withoutSuffix)},fromNow:function(withoutSuffix){return this.from(moment(),withoutSuffix)},calendar:function(){var diff=this.diff(moment().sod(),"days",true),calendar=this.lang().calendar,allElse=calendar.sameElse,format=diff<-6?allElse:diff<-1?calendar.lastWeek:diff<0?calendar.lastDay:diff<1?calendar.sameDay:diff<2?calendar.nextDay:diff<7?calendar.nextWeek:allElse;return this.format(typeof format==="function"?format.apply(this):format)},isLeapYear:function(){var year=this.year();return year%4===0&&year%100!==0||year%400===0},isDST:function(){return this.zone()<moment([this.year()]).zone()||this.zone()<moment([this.year(),5]).zone()},day:function(input){var day=this._isUTC?this._d.getUTCDay():this._d.getDay();return input==null?day:this.add({d:input-day})},startOf:function(val){switch(val.replace(/s$/,"")){case"year":this.month(0);case"month":this.date(1);case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return this},endOf:function(val){return this.startOf(val).add(val.replace(/s?$/,"s"),1).subtract("ms",1)},sod:function(){return this.clone().startOf("day")},eod:function(){return this.clone().endOf("day")},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},daysInMonth:function(){return moment.utc([this.year(),this.month()+1,0]).date()},lang:function(lang){if(lang===undefined){return getLangDefinition(this)}else{this._lang=lang;return this}}};function makeGetterAndSetter(name,key){moment.fn[name]=function(input){var utc=this._isUTC?"UTC":"";if(input!=null){this._d["set"+utc+key](input);return this}else{return this._d["get"+utc+key]()}}}for(i=0;i<proxyGettersAndSetters.length;i++){makeGetterAndSetter(proxyGettersAndSetters[i].toLowerCase(),proxyGettersAndSetters[i])}makeGetterAndSetter("year","FullYear");moment.duration.fn=Duration.prototype={weeks:function(){return absRound(this.days()/7)},valueOf:function(){return this._milliseconds+this._days*864e5+this._months*2592e6},humanize:function(withSuffix){var difference=+this,rel=this.lang().relativeTime,output=relativeTime(difference,!withSuffix,this.lang()),fromNow=difference<=0?rel.past:rel.future;if(withSuffix){if(typeof fromNow==="function"){output=fromNow(output)}else{output=fromNow.replace(/%s/i,output)}}return output},lang:moment.fn.lang};function makeDurationGetter(name){moment.duration.fn[name]=function(){return this._data[name]}}function makeDurationAsGetter(name,factor){moment.duration.fn["as"+name]=function(){return+this/factor}}for(i in unitMillisecondFactors){if(unitMillisecondFactors.hasOwnProperty(i)){makeDurationAsGetter(i,unitMillisecondFactors[i]);makeDurationGetter(i.toLowerCase())}}makeDurationAsGetter("Weeks",6048e5);if(hasModule){module.exports=moment}if(typeof ender==="undefined"){this["moment"]=moment}if(typeof define==="function"&&define.amd){define("moment",[],function(){return moment})}}.call(this);moment.fn.past=function(input,val){input=input.charAt(0).toUpperCase()+input.slice(1);var back=function(date,occurrences){if(date.format("dddd")!=input){return back(date.subtract("days",1),occurrences)}else{if(occurrences===0){return moment(date.id())}else{return back(date.subtract("days",1),occurrences-1)}}};return back(moment(this).lang("en"),val)};moment.fn.id=function(){return this.format("M-D-YY")};var moduleKeywords,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};moduleKeywords=["extended","included"];Module=function(){function Module(){}Module.extend=function(obj){var key,value,_ref;for(key in obj){value=obj[key];if(__indexOf.call(moduleKeywords,key)<0){this[key]=value}}if((_ref=obj.extended)!=null){_ref.apply(this)}return this};Module.include=function(obj){var key,value,_ref;for(key in obj){value=obj[key];if(__indexOf.call(moduleKeywords,key)<0){this.prototype[key]=value}}if((_ref=obj.included)!=null){_ref.apply(this)}return this};return Module}();if(typeof Backbone!="undefined"){Backbone.Model.include=Backbone.View.include=Backbone.Collection.include=Module.include}BH.Base.include=Module.include;var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-43186716-1"]);!function(){var ga=document.createElement("script");ga.type="text/javascript";ga.async=true;ga.src="https://ssl.google-analytics.com/ga.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(ga,s)}();var CryptoJS=CryptoJS||function(e,m){var p={},j=p.lib={},l=function(){},f=j.Base={extend:function(a){l.prototype=this;var c=new l;a&&c.mixIn(a);c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)});c.init.prototype=c;c.$super=this;return c},create:function(){var a=this.extend();a.init.apply(a,arguments);return a},init:function(){},mixIn:function(a){for(var c in a)a.hasOwnProperty(c)&&(this[c]=a[c]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},n=j.WordArray=f.extend({init:function(a,c){a=this.words=a||[];this.sigBytes=c!=m?c:4*a.length},toString:function(a){return(a||h).stringify(this)},concat:function(a){var c=this.words,q=a.words,d=this.sigBytes;a=a.sigBytes;this.clamp();if(d%4)for(var b=0;b<a;b++)c[d+b>>>2]|=(q[b>>>2]>>>24-8*(b%4)&255)<<24-8*((d+b)%4);else if(65535<q.length)for(b=0;b<a;b+=4)c[d+b>>>2]=q[b>>>2];else c.push.apply(c,q);this.sigBytes+=a;return this},clamp:function(){var a=this.words,c=this.sigBytes;a[c>>>2]&=4294967295<<32-8*(c%4);a.length=e.ceil(c/4)},clone:function(){var a=f.clone.call(this);a.words=this.words.slice(0);return a},random:function(a){for(var c=[],b=0;b<a;b+=4)c.push(4294967296*e.random()|0);return new n.init(c,a)}}),b=p.enc={},h=b.Hex={stringify:function(a){var c=a.words;a=a.sigBytes;for(var b=[],d=0;d<a;d++){var f=c[d>>>2]>>>24-8*(d%4)&255;b.push((f>>>4).toString(16));b.push((f&15).toString(16))}return b.join("")},parse:function(a){for(var c=a.length,b=[],d=0;d<c;d+=2)b[d>>>3]|=parseInt(a.substr(d,2),16)<<24-4*(d%8);return new n.init(b,c/2)}},g=b.Latin1={stringify:function(a){var c=a.words;a=a.sigBytes;for(var b=[],d=0;d<a;d++)b.push(String.fromCharCode(c[d>>>2]>>>24-8*(d%4)&255));return b.join("")},parse:function(a){for(var c=a.length,b=[],d=0;d<c;d++)b[d>>>2]|=(a.charCodeAt(d)&255)<<24-8*(d%4);return new n.init(b,c)}},r=b.Utf8={stringify:function(a){try{return decodeURIComponent(escape(g.stringify(a)))}catch(c){throw Error("Malformed UTF-8 data")}},parse:function(a){return g.parse(unescape(encodeURIComponent(a)))}},k=j.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new n.init;this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=r.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(a){var c=this._data,b=c.words,d=c.sigBytes,f=this.blockSize,h=d/(4*f),h=a?e.ceil(h):e.max((h|0)-this._minBufferSize,0);a=h*f;d=e.min(4*a,d);if(a){for(var g=0;g<a;g+=f)this._doProcessBlock(b,g);g=b.splice(0,a);c.sigBytes-=d}return new n.init(g,d)},clone:function(){var a=f.clone.call(this);a._data=this._data.clone();return a},_minBufferSize:0});j.Hasher=k.extend({cfg:f.extend(),init:function(a){this.cfg=this.cfg.extend(a);this.reset()},reset:function(){k.reset.call(this);this._doReset()},update:function(a){this._append(a);this._process();return this},finalize:function(a){a&&this._append(a);return this._doFinalize()},blockSize:16,_createHelper:function(a){return function(c,b){return new a.init(b).finalize(c)}},_createHmacHelper:function(a){return function(b,f){return new s.HMAC.init(a,f).finalize(b)}}});var s=p.algo={};return p}(Math);!function(){var e=CryptoJS,m=e.lib,p=m.WordArray,j=m.Hasher,l=[],m=e.algo.SHA1=j.extend({_doReset:function(){this._hash=new p.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(f,n){for(var b=this._hash.words,h=b[0],g=b[1],e=b[2],k=b[3],j=b[4],a=0;80>a;a++){if(16>a)l[a]=f[n+a]|0;else{var c=l[a-3]^l[a-8]^l[a-14]^l[a-16];l[a]=c<<1|c>>>31}c=(h<<5|h>>>27)+j+l[a];c=20>a?c+((g&e|~g&k)+1518500249):40>a?c+((g^e^k)+1859775393):60>a?c+((g&e|g&k|e&k)-1894007588):c+((g^e^k)-899497514);j=k;k=e;e=g<<30|g>>>2;g=h;h=c}b[0]=b[0]+h|0;b[1]=b[1]+g|0;b[2]=b[2]+e|0;b[3]=b[3]+k|0;b[4]=b[4]+j|0},_doFinalize:function(){var f=this._data,e=f.words,b=8*this._nDataBytes,h=8*f.sigBytes;e[h>>>5]|=128<<24-h%32;e[(h+64>>>9<<4)+14]=Math.floor(b/4294967296);e[(h+64>>>9<<4)+15]=b;f.sigBytes=4*e.length;this._process();return this._hash},clone:function(){var e=j.clone.call(this);e._hash=this._hash.clone();return e}});e.SHA1=j._createHelper(m);e.HmacSHA1=j._createHmacHelper(m)}();!function(){"use strict";function t(){}function r(t,n){for(var e=t.length;e--;)if(t[e].listener===n)return e;return-1}function n(e){return function(){return this[e].apply(this,arguments)}}var e=t.prototype,i=this,s=i.EventEmitter;e.getListeners=function(n){var r,e,t=this._getEvents();if("object"==typeof n){r={};for(e in t)t.hasOwnProperty(e)&&n.test(e)&&(r[e]=t[e])}else r=t[n]||(t[n]=[]);return r},e.flattenListeners=function(t){var e,n=[];for(e=0;e<t.length;e+=1)n.push(t[e].listener);return n},e.getListenersAsObject=function(n){var e,t=this.getListeners(n);return t instanceof Array&&(e={},e[n]=t),e||t},e.addListener=function(i,e){var t,n=this.getListenersAsObject(i),s="object"==typeof e;for(t in n)n.hasOwnProperty(t)&&-1===r(n[t],e)&&n[t].push(s?e:{listener:e,once:!1});return this},e.on=n("addListener"),e.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},e.once=n("addOnceListener"),e.defineEvent=function(e){return this.getListeners(e),this},e.defineEvents=function(t){for(var e=0;e<t.length;e+=1)this.defineEvent(t[e]);return this},e.removeListener=function(i,s){var n,e,t=this.getListenersAsObject(i);for(e in t)t.hasOwnProperty(e)&&(n=r(t[e],s),-1!==n&&t[e].splice(n,1));return this},e.off=n("removeListener"),e.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},e.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},e.manipulateListeners=function(r,t,i){var e,n,s=r?this.removeListener:this.addListener,o=r?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(e=i.length;e--;)s.call(this,t,i[e]);else for(e in t)t.hasOwnProperty(e)&&(n=t[e])&&("function"==typeof n?s.call(this,e,n):o.call(this,e,n));return this},e.removeEvent=function(n){var e,r=typeof n,t=this._getEvents();if("string"===r)delete t[n];else if("object"===r)for(e in t)t.hasOwnProperty(e)&&n.test(e)&&delete t[e];else delete this._events;return this},e.removeAllListeners=n("removeEvent"),e.emitEvent=function(r,o){var e,i,t,s,n=this.getListenersAsObject(r);for(t in n)if(n.hasOwnProperty(t))for(i=n[t].length;i--;)e=n[t][i],e.once===!0&&this.removeListener(r,e.listener),s=e.listener.apply(this,o||[]),s===this._getOnceReturnValue()&&this.removeListener(r,e.listener);return this},e.trigger=n("emitEvent"),e.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},e.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},e._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},e._getEvents=function(){return this._events||(this._events={})},t.noConflict=function(){return i.EventEmitter=s,t},"function"==typeof define&&define.amd?define(function(){return t}):"object"==typeof module&&module.exports?module.exports=t:this.EventEmitter=t}.call(this);BH.Templates.active_tags="<ul class='tags'>  {{#tags}}    <li>      <a href='#tags/{{.}}' data-tag='{{.}}' class='tag'>{{.}}</a>      {{#editable}}        <a href='#' data-tag='{{.}}' class='delete'></a>      {{/editable}}    </li>  {{/tags}}</ul>{{^tags}}  <p class='no_tags'>    No tags found. Add one!  </p>{{/tags}}";BH.Templates.app="<div class='frame'>  <div class='mainview view'></div>  <div class='navigation'>    <h1>      <a href='#/'>        {{i18n_history_title}}      </a>    </h1>    <div class='available_tags'></div>    <ul class='menu'>      <li>        <a class='tags' href='#tags'>          {{i18n_tags_link}}          <span class='new'>New!</span>          <span class='syncing'></span>        </a>      </li>    </ul>    <div class='menu menu_view disappearable'></div>    <ul class='menu disappearable'>      <li>        <a class='setting' href='#settings'>          {{i18n_settings_link}}        </a>      </li>    </ul>  </div></div><div id='coverup'></div>";BH.Templates.auth_error="<h1 class='title'>{{i18n_auth_error_title}}</h1><div class='content-area'>  <p>{{i18n_auth_error_description}}</div><div class='action-area'>  <a href='#' class='cancel'>{{i18n_prompt_cancel_button}}</a>  <div class='action-area-right'>    <div class='button-strip'>      <button class='login'>{{i18n_login_again_button}}</button>    </div>  </div></div>";BH.Templates.autocomplete_tags="<div class='autocomplete_shell'>  <div class='active_tags'></div>  <input autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' type='text' class='new_tag' placeholder='{{i18n_add_a_tag_placeholder}}'/></div><div class='suggestions'></div><div class='syncing'></div>";BH.Templates.available_tags="<ul class='tags'>  <li class='new_tag'>&#43; New tag</li>  {{#tags}}    <li data-tag='{{name}}' class='{{#tagged}}tagged{{/tagged}}'>      {{name}}    </li>  {{/tags}}</ul>";BH.Templates.connection_required="<h1 class='title'>{{i18n_connection_required_title}}</h1><div class='content-area'>  <div class='warning'>&#x26a0;</div>  {{i18n_connection_required_description}}</div><div class='action-area'>  <div class='action-area-right'>    <div class='button-strip'>      <button class='okay'>{{i18n_prompt_okay_button}}</button>    </div>  </div></div>";BH.Templates.connection_restored="<h1 class='title'>{{i18n_connection_restored_title}}</h1><div class='content-area'>  <span class='successful_sync'>&#x2713;</span>  {{i18n_connection_restored_description}}</div><div class='action-area'>  <div class='action-area-right'>    <div class='button-strip'>      <button class='okay'>{{i18n_prompt_okay_button}}</button>    </div>  </div></div>";BH.Templates.credits="<img class='logo' src='/images/medium_logo.png' /><h1 class='title'>{{i18n_credits_title}}</h1><div class='content-area'>  <div>{{{i18n_developed_by}}}</div>  <h3>Open source frameworks in use</h3>  <ul class='open_source'>    <li>      <a href='http://backbonejs.org/'>Backbone</a>    </li>    <li>      <a href='http://documentcloud.github.com/underscore/'>Underscore</a>    </li>    <li>      <a href='http://zeptojs.com/'>Zepto</a>    </li>    <li>      <a href='https://github.com/janl/mustache.js/'>Mustache.js</a>    </li>    <li>      <a href='http://momentjs.com/'>Moment.js</a>    </li>    <li>      <a href='https://github.com/roykolak/chrome-bootstrap'>Chrome Bootstrap</a>    </li>  </ul>  <h3>{{i18n_translators_heading}}</h3>  <div>    <ul class='translators'>      <li>        <a href='http://twitter.com/laucmar'>Laura Martnez</a>        <div class='language'>{{i18n_spanish}}</div>      </li>      <li>        <a href='http://gplus.to/dfakhriev'>Damir Fakhriev</a>        <div class='language'>{{i18n_russian}}</div>      </li>      <li>        <a href='https://plus.google.com/115314774787477379472'>Filipe Catalo</a>        <div class='language'>{{i18n_portuguese}}</div>      </li>      <li>        <a href='http://theopenspring.com'>Gianluca Sangiovanni</a>        <div class='language'>{{i18n_italian}}</div>      </li>      <li>        <a href='mailto:tebai.hamza@gmail.com'>Hamza Tebai</a>        <div class='language'>{{i18n_french}}</div>      </li>      <li>        <a href='http://about.me/henrikcederblad'>Henrik Cederblad</a>        <div class='language'>{{i18n_swedish}}</div>      </li>      <li>        <a href='https://plus.google.com/u/0/115959812130668207635/posts'>PBB</a>        <div class='language'>{{i18n_chinese_simplified}}</div>      </li>    </ul>    <ul class='translators'>      <li>        <a href='http://twitter.com/kurtextrem'>Jacob G</a>        <div class='language'>{{i18n_german}}</div>      </li>      <li>        <a href='http://www.jedlikowski.com'>Przemek Jedlikowski</a>        <div class='language'>{{i18n_polish}}</div>      </li>      <li>        <a href='https://twitter.com/yl_ksa'>Wael M. Hazzazi</a>        <div class='language'>{{i18n_arabic}}</div>      </li>      <li>        <a href='http://twitter.com/HowManyFiles'></a>        <div class='language'>{{i18n_japanese}}</div>      </li>      <li>        <a href='http://facebook.com/khaister'>Khai Nguyen</a>        <div class='language'>{{i18n_vietnamese}}</div>      </li>      <li>        Juanjo Teruel        <div class='language'>{{i18n_catalonian}}</div>      </li>    </ul>  </div>  <h4>{{i18n_translation_help_heading}}</h4>  <p style='width:auto'>{{{i18n_translation_instructions}}}</p></div><div class='action-area'>  <div class='action-area-right'>    <div class='button-strip'>      <button class='button close'>{{i18n_close_button}}</button>    </div>  </div></div>";
BH.Templates.day="<header>  <h1 class='title'>    {{{title}}}    <span class='sub_title'>{{formalDate}}</span>  </h1>  <div class='corner'>    <input class='search' placeholder='{{i18n_search_input_placeholder_text}}' tabindex='1' type='text' />  </div>  <div class='controls'>    <div class='spinner'></div>    <a class='text back_to_week' href='{{weekUrl}}'>      {{{i18n_back_to_week_link}}}    </a>    <div class='spacer'></div>    <button class='delete_day' disabled='disabled'>      {{i18n_delete_all_visits_for_filter_button}}    </button>  </div></header><div class='content'></div>";BH.Templates.day_results="<ol class='history'>  {{#history}}    <li class='interval' data-id='{{id}}'>      <header>        <h4 class='title'>{{time}}</h4>        <a class='delete_interval delete' href='#' title='{{i18n_prompt_delete_button}}'>          {{i18n_prompt_delete_button}}        </a>      </header>      <ol class='visits highlightable editable'>        {{#visits}}          {{#isGrouped}}            <li class='visit grouped_sites' draggable='true' data-domain='{{domain}}'>              {{^readOnly}}                <div class='drag_handle'>                  <div class='line'></div>                  <div class='line'></div>                  <div class='line'></div>                  <div class='line'></div>                  <div class='line'></div>                </div>              {{/readOnly}}              <a href='{{url}}' class='sites'>                <dl class='description' style='background-image: url(chrome://favicon/{{url}})'>                  <dt>                    <div class='active_tags'></div>                    {{domain}}                  </dt>                  <dd class='time'>{{time}}</dd>                  <dd class='toggle_grouping'>                    <span class='show_visits'>                      <span class='arrow arrow_collapse'></span>                      {{i18n_expand_button}}                    </span>                    <span class='hide_visits'>                      <span class='arrow arrow_expand'></span>                      {{i18n_collapse_button}}                    </span>                  </dd>                </dl>              </a>              <a class='search_domain action' href='#search/{{host}}'>{{i18n_search_by_domain}}</a>              <a class='delete_grouped_visit delete' href='#' title='{{i18n_prompt_delete_button}}'>{{i18n_prompt_delete_button}}</a>              <ol class='visits highlightable'>                {{#groupedVisits}}                  <li class='visit' draggable='true' data-url='{{url}}' data-title='{{title}}'>                    {{^readOnly}}                      <div class='drag_handle'>                        <div class='line'></div>                        <div class='line'></div>                        <div class='line'></div>                        <div class='line'></div>                        <div class='line'></div>                      </div>                    {{/readOnly}}                    <a href='{{url}}' class='site'>                      <dl class='description' style='background-image: url(chrome://favicon/{{url}})'>                        <dt>                          <div class='active_tags'></div>                          {{{title}}}                        </dt>                        <dd class='time'>{{time}}</dd>                        <dd class='location'>{{host}}{{path}}</dd>                      </dl>                    </a>                    <a class='search_domain action' href='#search/{{host}}'>{{i18n_search_by_domain}}</a>                    <a class='delete_visit delete' href='#' data-url='{{url}}' title='{{i18n_prompt_delete_button}}'>{{i18n_prompt_delete_button}}</a>                  </li>                {{/groupedVisits}}              </ol>            </li>          {{/isGrouped}}          {{^isGrouped}}            <li class='visit' draggable='true' data-url='{{url}}' data-title='{{title}}'>              {{^readOnly}}                <div class='drag_handle'>                  <div class='line'></div>                  <div class='line'></div>                  <div class='line'></div>                  <div class='line'></div>                  <div class='line'></div>                </div>              {{/readOnly}}              <a href='{{url}}' class='site'>                <dl class='description' style='background-image: url(chrome://favicon/{{url}})'>                  <dt>                    <div class='active_tags'></div>                    {{{title}}}                  </dt>                  <dd class='time'>{{time}}</dd>                  <dd class='location'>{{host}}{{path}}</dd>                </dl>              </a>              <a class='search_domain action' href='#search/{{host}}'>{{i18n_search_by_domain}}</a>              <a class='delete_visit delete' href='#' data-url='{{url}}' title='{{i18n_prompt_delete_button}}'>{{i18n_prompt_delete_button}}</a>            </li>          {{/isGrouped}}        {{/visits}}      </ol>    </li>  {{/history}}</ol>{{^history}}  <p>{{i18n_no_visits_found}}</p>{{/history}}";BH.Templates.how_to_tag="<h1 class='title'>{{i18n_how_to_tag_title}}</h1><div class='content-area'>  <iframe name='quickcast' src='http://quick.as/embed/majubd4' scrolling='no' frameborder='0' width='100%' allowfullscreen></iframe></div><div class='action-area'>  <div class='action-area-right'>    <div class='button-strip'>      <button class='done'>{{i18n_prompt_done_button}}</button>    </div>  </div></div>";BH.Templates.initial_syncing="<h1 class='title'>{{i18n_initial_syncing_title}}</h1><div class='content-area'>  <div class='syncing'>    <div class='spinner'></div>    <p>{{i18n_initial_syncing_description}}</p>  </div>  <div class='done_syncing' style='display: none;'>    <span class='successful_sync'>&#x2713;</span>    <p>{{{i18n_initial_syncing_done}}}</p>  </div></div><div class='action-area'>  <div class='action-area-right'>    <div class='button-strip'>      <button disabled class='continue'>{{i18n_continue_button}}</button>    </div>  </div></div>";BH.Templates.login_error="<h1 class='title'>{{i18n_login_error_title}}</h1><div class='content-area'>  <div class='warning'>&#x26a0;</div>  {{i18n_login_error_description}}</div><div class='action-area'>  <div class='action-area-right'>    <div class='button-strip'>      <button class='okay'>{{i18n_prompt_okay_button}}</button>    </div>  </div></div>";BH.Templates.mailing_list="<img class='logo' src='/images/medium_logo.png' /><h1 class='title'>{{i18n_mailing_list_title}}</h1><div class='content-area'>  <p>{{i18n_mailing_list_description}}</p>  <a href='http://mad.ly/signups/84938/join' target='_blank' id='join_mailing_list'>{{i18n_mailing_list_link}}</a>  <p><i>{{i18n_mailing_list_promise}}</i></p></div><div class='action-area'>  <a href='#'>{{i18n_leave_a_review}}</a>  <div class='action-area-right'>    <div class='button-strip'>      <button class='button close'>{{i18n_close_button}}</button>    </div>  </div></div>";BH.Templates.menu="<ul class='menu'>  {{#weeks}}    <li class='week' data-week-id='{{id}}'>      <a href='{{url}}'>        {{{shortTitle}}}      </a>    </li>  {{/weeks}}  <!--  <li class='all_weeks'>    <a href='#weeks'>      {{i18n_all_weeks_link}}    </a>  </li>  --></ul>";BH.Templates.modal="<div class='overlay transparent' id='overlay'>  <div class='page'></div></div>";BH.Templates.new_tag="<h1 class='title'>{{i18n_create_new_tag_title}}</h1><div class='content-area'>  <input class='new_tag' type='text' placeholder='{{i18n_new_tag_placeholder}}' /></div><div class='action-area'>  <div class='action-area-right'>    <div class='button-strip'>      <button class='cancel no'>{{i18n_prompt_cancel_button}}</button>      <button class='rename yes'>{{i18n_new_tag_button}}</button>    </div>  </div></div>";BH.Templates.prompt="<div class='spinner'></div><h1 class='title'>{{i18n_prompt_title}}</h1><div class='content-area'>{{{content}}}</div><div class='action-area'>  <div class='action-area-right'>    <div class='button-strip'>      <button class='no'>{{i18n_prompt_cancel_button}}</button>      <button class='yes'>{{i18n_prompt_delete_button}}</button>    </div>  </div></div>";BH.Templates.read_only_explanation="<h1 class='title'>{{i18n_read_only_explanation_title}}</h1><div class='content-area'>  {{i18n_read_only_explanation_description}}</div><div class='action-area'>  <div class='action-area-right'>    <div class='button-strip'>      <button class='okay'>{{i18n_prompt_okay_button}}</button>    </div>  </div></div>";BH.Templates.rename_tag="<h1 class='title'>{{i18n_rename_tag_title}}</h1><div class='content-area'>  <input class='new_tag' type='text' placeholder='{{i18n_new_tag_placeholder}}' /></div><div class='action-area'>  <div class='action-area-right'>    <div class='button-strip'>      <button class='cancel no'>{{i18n_prompt_cancel_button}}</button>      <button class='rename yes'>{{i18n_rename_tag_button}}</button>    </div>  </div></div>";BH.Templates.search="<header>  <h1>    <span class='title'>{{title}}</span>  </h1>  <div class='corner'>    <a href='#' class='delete'>cancel</a>    <input class='search' placeholder='{{i18n_search_input_placeholder_text}}' tabindex='1' type='text' />  </div>  <div class='controls'>    <div class='spinner'></div>    <div class='pagination' style='margin: 0; position: relative;'></div>    <div class='spacer'></div>    <button class='delete_all'>      {{i18n_delete_all_visits_for_search_button}}    </button>  </div></header><div class='fade'></div><div class='cached' style='display: none'>  Showing results from <span class='datetime'>DATE</span>.  <a class='fresh_search'>Freshen search</a></div><div class='content'></div>";BH.Templates.search_pagination="<ol class='pagination {{paginationClass}}'>  {{#pages}}    <li>      <a href='{{url}}' data-page='{{number}}' class='{{className}}'>{{number}}</a>    </li>  {{/pages}}</ol><div class='number_of_visits'>{{i18n_number_of_visits}}</div>";BH.Templates.search_results="<ol class='visits highlightable editable'>  {{#visits}}    <li class='visit visit_view searched' draggable='true' data-url='{{url}}' data-title='{{title}}'>      <div class='drag_handle'>        <div class='line'></div>        <div class='line'></div>        <div class='line'></div>        <div class='line'></div>        <div class='line'></div>      </div>      <a href='{{url}}' class='site'>        <dl class='description' style='background-image: url(chrome://favicon/{{url}})'>          <dt>            <div class='active_tags'></div>            {{{name}}}          </dt>          <dd class='location'>{{{location}}}</dd>          <dd>{{{time}}} | {{{extendedDate}}}</dd>        </dl>      </a>      <a class='delete_visit delete' href='#' data-url='{{url}}' title='{{i18n_prompt_delete_button}}'>{{i18n_prompt_delete_button}}</a>    </li>  {{/visits}}</ol>{{^visits}}  <p class='no_visits'>{{i18n_no_visits_found}}</p>{{/visits}}";BH.Templates.server_error="<h1 class='title'>{{i18n_server_error_title}}</h1><div class='content-area'>  <div class='warning'>&#x26a0;</div>  {{i18n_server_error_description}}</div><div class='action-area'>  <div class='action-area-right'>    <div class='button-strip'>      <button class='okay'>{{i18n_prompt_okay_button}}</button>    </div>  </div></div>";BH.Templates.settings="<header>  <h1>{{i18n_settings_title}}</h1></header><div class='content'>  <div class='settings'>    <section>    <h3>{{i18n_syncing_settings_title}}</h3>      <div class='logged_out'>        <p>{{{i18n_syncing_settings_login}}}</p>        <div class='login_spinner small_spinner'></div>      </div>      <div class='logged_in'>        <img class='avatar' src='{{avatar}}' />        <p class='name'></p>        <a style='margin-right: 5px;'href='#' class='logout'>Logout</a> |        <a style='margin-left: 5px;' href='http://www.better-history.com/me'>better-history.com/me</a>        <div>          <a href='#' class='manually_sync_local'>{{i18n_manually_sync_local_link}}</a>        </div>      </div>    </section>    <section>      <h3>{{i18n_clearing_history_section_title}}</h3>      <div>        <button class='clear_history'>{{i18n_clear_history_button}}</button>      </div>    </section>    <section>      <h3>{{i18n_general_section_title}}</h3>      <div class='row'>        <label>          <span class='select'>{{i18n_open_location}}</span>          <select id='open_location'>            {{#openLocations}}              <option value='{{value}}'>{{text}}</option>            {{/openLocations}}          </select>        </label>      </div>      <div class='row'>        <label>          <span class='select'>{{i18n_starting_week_day}}</span>          <select id='starting_week_day'>            {{#startingWeekDays}}              <option value='{{value}}'>{{text}}</option>            {{/startingWeekDays}}          </select>        </label>      </div>      <div class='row'>        <label>          <span class='select'>{{i18n_week_day_order}}</span>          <select id='week_day_order'>            {{#weekDayOrders}}              <option value='{{value}}'>{{text}}</option>            {{/weekDayOrders}}          </select>        </label>      </div>    </section>    <section>      <h3>{{i18n_visit_grouping_section_title}}</h3>      <div class='row'>        <label>          <span class='select'>{{i18n_group_visits_by_label}}</span>          <select id='time_grouping'>            {{#timeGroupings}}              <option value='{{value}}'>{{text}}</option>            {{/timeGroupings}}          </select>        </label>      </div>      <div class='checkbox'>        <label>          <input id='domain_grouping' type='checkbox' />          <span>{{i18n_group_visits_by_domain_label}}</span>        </label>      </div>    </section>    <section>      <h3>{{i18n_right_click_options_section_title}}</h3>      <div class='checkbox'>        <label>          <input id='search_by_selection' type='checkbox' />          <span>{{i18n_search_by_text_selection_label}}</span>        </label>      </div>      <div class='checkbox'>        <label>          <input id='search_by_domain' type='checkbox' />          <span>{{i18n_search_by_domain_label}}</span>        </label>      </div>    </section>    <section>      <h3>{{i18n_whats_new_section_title}}</h3>      <div>        <div class='row'>          <a class='modal_link credits' href='#settings/credits'>{{{i18n_credits_link}}}</a>        </div>        <div class='row'>          {{{i18n_permissions_details}}}        </div>      </div>    </section>    <section>      <h3>{{i18n_feedback_section_title}}</h3>      <div>        {{{i18n_suggestions_bugs_comments}}}        <br />        <a style='margin-top: 10px; display: block;' href='mailto:hello@better-history.com'>hello@better-history.com</a>      </div>    </section>    <section>      <h3>{{i18n_spread_the_word_section_title}}</h3>      <div>        <div class='row'>          <a href='http://mad.ly/signups/84938/join' target='_blank'>{{i18n_mailing_list_link}}</a>        </div>        <div class='row'>          <a href='https://chrome.google.com/webstore/detail/obciceimmggglbmelaidpjlmodcebijb/reviews'>{{i18n_leave_a_review}}</a>        </div>        <div class='row'>          <!-- Place this tag where you want the +1 button to render -->          <div class='g-plusone' data-annotation='inline' data-href='https://chrome.google.com/webstore/detail/obciceimmggglbmelaidpjlmodcebijb'></div>        </div>        <div class='row'>          <a class='twitter-follow-button' data-lang='{{i18n_twitter_language}}' data-show-count='false' data-width='150px' href='https://twitter.com/better_history'>Follow @better_history</a>          <a class='twitter-share-button' data-count='horizontal' data-lang='{{i18n_twitter_language}}' data-text='{{i18n_twitter_template}}' data-url='https://chrome.google.com/webstore/detail/obciceimmggglbmelaidpjlmodcebijb' data-via='Better_History' href='https://twitter.com/share'>Tweet</a>        </div>      </div>    </section>  </div></div>";BH.Templates.sign_up_info="<img class='logo' src='/images/medium_logo.png' /><h1 class='title'>{{i18n_sign_up_info_title}}</h1><div class='content-area'>  <p>{{i18n_sign_up_info_description}}</p>  {{{i18n_sign_up_info_bullets}}}  <p class='price'>{{i18n_sign_up_info_price}}</p></div><div class='action-area'>  <p class='question'>{{i18n_sign_up_info_question}}</p>  <a href='#' class='cancel'>{{i18n_prompt_cancel_button}}</a>  <div class='action-area-right'>    <div class='button-strip'>      <button class='continue yes'>{{i18n_continue_button}}</button>    </div>  </div></div>";BH.Templates.suggestions="<ul>  {{#tags}}    <li data-tag='{{.}}'>{{.}}</li>  {{/tags}}</ul>";BH.Templates.syncing_decision="<h1 class='title'>{{i18n_syncing_decision_title}}</h1><div class='content-area'>  <div class='decision'>    <p>{{{i18n_syncing_decision_description}}}</p>    <div class='decision_options'>      <button class='pull'>{{i18n_syncing_pull_button}}</button>      - or -      <button class='push'>{{i18n_syncing_push_button}}</button>    </div>  </div>  <div class='syncing' style='display: none;'>    <div class='spinner'></div>    <p>{{i18n_initial_syncing_description}}</p>  </div>  <div class='done_syncing' style='display: none;'>    <span class='successful_sync'>&#x2713;</span>    <p>{{{i18n_initial_syncing_done}}}</p>  </div></div><div class='action-area'>  <div class='action-area-right'>    <div class='button-strip'>      <button style='display: none' class='continue'>{{i18n_continue_button}}</button>    </div>  </div></div>";BH.Templates.tag="<header>  <h1>{{i18n_tag_title}}</h1>  <div class='corner'>    <input class='search' placeholder='{{i18n_search_input_placeholder_text}}' tabindex='1' type='text' />  </div>  <div class='controls'>    <a class='text back_to_tags' href='{{tagsUrl}}'>      {{{i18n_back_to_tags_link}}}    </a>    <div class='spacer'></div>    <div class='small_spinner'></div>    {{#readOnly}}      <a class='text read_only_explanation'>        {{i18n_read_only_explanation_link}}      </a>    {{/readOnly}}    {{^readOnly}}      <a class='text share'>        {{i18n_share_tag_link}}      </a>      <a class='text rename'>        {{i18n_rename_tag_link}}      </a>      <button class='delete_sites'>        {{i18n_delete_tag}}      </button>    {{/readOnly}}  </div></header><div class='content'></div>";BH.Templates.tagged_sites="<ul class='visits highlightable editable'>  {{#sites}}  <li class='visit tagged' draggable='true' data-url='{{url}}' data-title='{{title}}'>      {{^readOnly}}        <div class='drag_handle'>          <div class='line'></div>          <div class='line'></div>          <div class='line'></div>          <div class='line'></div>          <div class='line'></div>        </div>      {{/readOnly}}      <a href='{{url}}' class='site'>        <dl class='description' style='background-image: url(chrome://favicon/{{url}})'>          <dt>            <div class='active_tags'></div>            {{title}}          </dt>          <dd>{{url}}</dd>        </dl>      </a>      {{^readOnly}}        <a class='delete' href='{{url}}' title=''></a>      {{/readOnly}}    </li>  {{/sites}}</ul>{{^sites}}  <p class='no_results'>{{i18n_no_tagged_sites_found}}</p>{{/sites}}";BH.Templates.tagging="<div class='container'>  <div class='header' style='background-image: url(chrome://favicon/{{url}})'>    <h1 class='scroll'>{{title}}</h1>    <div class='url scroll'>{{url}}</div>  </div>  {{^readOnly}}    <p class='about_tags alert'>      <a href='#' class='delete dismiss_instructions'></a>      {{{i18n_about_tags_for_popup}}}    </p>    <div class='autocomplete'></div>  {{/readOnly}}  <p class='shortcut'>{{shortcut}}</p></div><ul class='links'>  <li style='position: relative'>    <a id='explore_tags' href='chrome://history/#tags'>      {{i18n_explore_tags_link}}    </a>    {{#loggedIn}}      <div class='syncing_badge'>sync <span class='inline-tag'>ON</span></div>    {{/loggedIn}}  </li>  <li>    <a id='search_domain' href='chrome://history/#search/{{domain}}'>      {{i18n_search_domain_history_link}}    </a>  </li>  <li>    <a id='view_history' href='chrome://history/#today'>      {{i18n_view_all_history_link}}    </a>  </li></div>";BH.Templates.tags="<header>  <h1>{{i18n_tags_title}}</h1>  <div class='corner'>    <input class='search' placeholder='{{i18n_search_input_placeholder_text}}' tabindex='1' type='text' />  </div>  <div class='controls'>    <span class='text sync_enabled' {{#loggedIn}} style='display: block;'{{/loggedIn}}>{{{i18n_sync_enabled}}}</span>    <span class='text tag_count' style='display: none'>{{i18n_number_of_tags}}</span>    <span class='text sync_promo' {{#loggedIn}} style='display: none;'{{/loggedIn}}>{{{i18n_sync_tags_link}}}</span>    <div class='login_spinner small_spinner'></div>    <div class='spacer'></div>    {{#readOnly}}      <a class='text read_only_explanation'>        {{i18n_read_only_explanation_link}}      </a>    {{/readOnly}}    {{^readOnly}}      <a class='text how_to_tag'>        {{i18n_how_to_tag}}      </a>      <button class='delete_all'>        {{i18n_delete_all_tags}}      </button>    {{/readOnly}}  </div></header><div class='content'></div>";BH.Templates.tags_list="<p class='alert about_tags'>  <a href='#' class='delete dismiss_instructions'></a>  <strong>{{i18n_about_tags_title}}</strong>  {{{i18n_about_tags_instructions}}}</p><ul class='tag_list'>  {{#tags}}    <li>      <a href='#tags/{{name}}'>        <h3 class='title'>{{name}}</h3>        <div class='details'>          <ul class='favicons'>            {{#sites}}            <li>              <div class='favicon' style='background-image: url(chrome://favicon/{{url}})'></div>            </li>            {{/sites}}          </ul>        </div>      </a>    </li>  {{/tags}}</ul>{{^tags}}  <p class='no_results'>{{i18n_no_tags_found}}</p>  <p class='extra_help'>{{{i18n_extra_tag_help}}}</p>{{/tags}}";BH.Templates.week="<header>  <h1>{{{title}}}</h1>  <div class='corner'>    <input class='search' placeholder='{{i18n_search_input_placeholder_text}}' tabindex='1' type='text' />  </div>  <div class='controls'>    <span class='text count'></span>    <div class='spinner'></div>    <div class='spacer'></div>    <button class='delete_all'>      {{i18n_delete_all_visits_for_filter_button}}    </button>  </div></header><div class='content'>  <ol class='days'>    {{#days}}      <li class='day {{#inFuture}}future{{/inFuture}}' data-day='{{day}}'>        <a href='{{url}}'>          <div class='label'>            <h3 class='title'>{{title}}</h3>            <div class='count'></div>          </div>          <div class='bar_container'>            <div class='bar'></div>          </div>        </a>      </li>    {{/days}}  </ol></div><div class='day_views'></div>";BH.Templates.weeks="<header>  <h1>{{i18n_all_weeks_title}}</h1>  <div class='corner'>    <input class='search' placeholder='{{i18n_search_input_placeholder_text}}' tabindex='1' type='text' />  </div>  <div class='controls'>    <span class='text count'></span>    <div class='spinner'></div>    <div class='spacer'></div>    <button class='delete_all'>      {{i18n_delete_all_weeks_button}}    </button>  </div></header><div class='content'></div>";BH.Templates.weeks_results="<ol class='all_weeks'>  {{#weeks}}    <li>    <a href='{{url}}'>        <h3>{{shortTitle}}</h3>        <div class='details'>          {{visitCount}} visits        </div>      </a>    </li>  {{/weeks}}</ol>";!function(){BH.Modules.I18n={t:function(key,replacements){var keys,lookup,_i,_len;if(replacements==null){replacements=[]}if(key instanceof Array){keys=key;lookup={};for(_i=0,_len=keys.length;_i<_len;_i++){key=keys[_i];lookup["i18n_"+key]=chrome.i18n.getMessage(key.toString())}return lookup}else{return chrome.i18n.getMessage(key,replacements)}}}}.call(this);!function(){BH.Modules.Url={urlFor:function(key,id,opts){var base,buildBase,route;base="chrome://history/";if(key==null){return base}buildBase=function(opts){if(opts!=null?opts.absolute:void 0){return base}else{return""}};route=function(){switch(key){case"search":return"#search/"+id;case"week":return"#weeks/"+id;case"day":return"#days/"+id;case"tag":return"#tags/"+id}}();return""+buildBase(opts)+route}}}.call(this);!function(){BH.Modules.Worker={worker:function(name,options,callback){var basePath,path,worker;basePath="scripts/workers";path=function(){switch(name){case"searchSanitizer":return""+basePath+"/search_sanitizer.js";case"rangeSanitizer":return""+basePath+"/range_sanitizer.js";case"domainGrouper":return""+basePath+"/domain_grouper.js";case"timeGrouper":return""+basePath+"/time_grouper.js";case"dayGrouper":return""+basePath+"/day_grouper.js";case"weekGrouper":return""+basePath+"/week_grouper.js"}}();worker=new Worker(path);worker.onmessage=function(e){if(e.data.log){return console.log(e.data.log)}else{callback(e.data);return worker.terminate()}};return worker.postMessage(options)}}}.call(this);!function(){BH.Trackers.ErrorTracker=function(){ErrorTracker.prototype.key="eb2245d5729a3c65d7e429f4e7690a62";ErrorTracker.prototype.version="2.4.0";ErrorTracker.prototype.environment="production";function ErrorTracker(tracker){this.tracker=tracker;this.tracker.setContext({version:this.version});this.tracker.configure({api_key:this.key,environment:this.environment,onerror:true})}ErrorTracker.prototype.report=function(e,data){if(data==null){data={}}return this.tracker.notify(e,{context:data})};return ErrorTracker}()}.call(this);!function(){BH.Trackers.AnalyticsTracker=function(){function AnalyticsTracker(){if(typeof _gaq==="undefined"||_gaq===null){throw"Analytics not set"}}AnalyticsTracker.prototype.trackEvent=function(params){params.unshift("_trackEvent");return this.track(params)};AnalyticsTracker.prototype.pageView=function(url){if(url.match(/search/)){url="search"}return this.track(["_trackPageview","/"+url])};AnalyticsTracker.prototype.track=function(params){return _gaq.push(params)};AnalyticsTracker.prototype.historyOpen=function(){return this.trackEvent(["History","Open"])};AnalyticsTracker.prototype.weekView=function(date,distanceFromCurrentWeek){return this.trackEvent(["Weeks","Click",date,distanceFromCurrentWeek])};AnalyticsTracker.prototype.visitDeletion=function(){return this.trackEvent(["Visit","Delete"])};AnalyticsTracker.prototype.groupedVisitsDeletion=function(){return this.trackEvent(["Grouped visits","Delete"])};AnalyticsTracker.prototype.timeIntervalDeletion=function(){return this.trackEvent(["Time interval","Delete"])};AnalyticsTracker.prototype.dayVisitsDeletion=function(){return this.trackEvent(["Day visits","Delete"])};AnalyticsTracker.prototype.weekVisitsDeletion=function(){return this.trackEvent(["Week visits","Delete"])};AnalyticsTracker.prototype.searchResultsDeletion=function(){return this.trackEvent(["Search results","Delete"])};AnalyticsTracker.prototype.paginationClick=function(){return this.trackEvent(["Pagination","Click"])};AnalyticsTracker.prototype.omniboxSearch=function(){return this.trackEvent(["Omnibox","Search"])};AnalyticsTracker.prototype.contextMenuClick=function(){return this.trackEvent(["Context menu","Click"])};AnalyticsTracker.prototype.selectionContextMenuClick=function(){return this.trackEvent(["Selection context menu","Click"])};AnalyticsTracker.prototype.syncStorageError=function(operation,msg){return this.trackEvent(["Storage Error",operation,"Sync",msg])};AnalyticsTracker.prototype.syncStorageAccess=function(operation){return this.trackEvent(["Storage Access",operation,"Sync"])};AnalyticsTracker.prototype.localStorageError=function(operation,msg){return this.trackEvent(["Storage Error",operation,"Local",msg])};AnalyticsTracker.prototype.mailingListPrompt=function(){return this.trackEvent(["Mailing List Prompt","Seen"])};AnalyticsTracker.prototype.popupVisible=function(){return this.trackEvent(["Popup","Seen"])};AnalyticsTracker.prototype.exploreTagsPopupClick=function(){return this.trackEvent(["Popup","Explore Tags Click"])};AnalyticsTracker.prototype.searchByDomainPopupClick=function(){return this.trackEvent(["Popup","Search by Domain Click"])};AnalyticsTracker.prototype.tagDetailsPopupClick=function(){return this.trackEvent(["Popup","Tag Details Click"])};AnalyticsTracker.prototype.viewAllHistoryPopupClick=function(){return this.trackEvent(["Popup","View all History Click"])};AnalyticsTracker.prototype.howToTagClick=function(){return this.trackEvent(["Tags","How to Tag Click"])};AnalyticsTracker.prototype.deleteAllTagsClick=function(){return this.trackEvent(["Tags","Delete all Click"])};AnalyticsTracker.prototype.siteTagDrag=function(){return this.trackEvent(["Tag","Site Drag"])};AnalyticsTracker.prototype.siteTagDrop=function(){return this.trackEvent(["Tag","Site Drop"])};AnalyticsTracker.prototype.renameTagClick=function(){return this.trackEvent(["Tag","Rename Click"])};AnalyticsTracker.prototype.deleteTagClick=function(){return this.trackEvent(["Tag","Delete Tag Click"])};AnalyticsTracker.prototype.tagAdded=function(){return this.trackEvent(["Tag","Added"])};AnalyticsTracker.prototype.tagRemoved=function(){return this.trackEvent(["Tag","Removed"])};AnalyticsTracker.prototype.tagRenamed=function(){return this.trackEvent(["Tag","Renamed"])};AnalyticsTracker.prototype.siteTagged=function(){return this.trackEvent(["Site","Tagged"])};AnalyticsTracker.prototype.siteUntagged=function(){return this.trackEvent(["Site","Untagged"])};AnalyticsTracker.prototype.shareClicked=function(){return this.trackEvent(["Tag","Shared"])};AnalyticsTracker.prototype.getStartedSyncingModalSeen=function(){return this.trackEvent(["Get Started Modal","Seen"])};AnalyticsTracker.prototype.getStartedSyncingContinueClicked=function(){return this.trackEvent(["Get Started Modal","Continue Click"])};AnalyticsTracker.prototype.getStartedSyncingCancelClicked=function(){return this.trackEvent(["Get Started Modal","Cancel Click"])};AnalyticsTracker.prototype.syncPurchaseSuccess=function(){return this.trackEvent(["Sync","Purchased","Success"])};AnalyticsTracker.prototype.syncPurchaseFailure=function(){return this.trackEvent(["Sync","Purchased","Failure"])};AnalyticsTracker.prototype.syncDecisionModalSeen=function(){return this.trackEvent(["Sync Decision Modal","Seen"])};AnalyticsTracker.prototype.syncAutomaticModalSeen=function(){return this.trackEvent(["Sync Automatic Modal","Seen"])};AnalyticsTracker.prototype.userLoggedIn=function(){return this.trackEvent(["User","Log In"])};AnalyticsTracker.prototype.userLoggedOut=function(){return this.trackEvent(["User","Log Out"])};AnalyticsTracker.prototype.userCreationFailure=function(){return this.trackEvent(["User","Creation","Failure"])};AnalyticsTracker.prototype.userCreationSuccess=function(){return this.trackEvent(["User","Creation","Success"])};AnalyticsTracker.prototype.userOAuthFailure=function(){return this.trackEvent(["User","OAuth","Failure"])};AnalyticsTracker.prototype.userOAuthSuccess=function(){return this.trackEvent(["User","OAuth","Success"])};AnalyticsTracker.prototype.ensureDatetimeOnTaggedSitesMigration=function(){return this.trackEvent(["Migration","ensure_datetime_on_tagged_sites"])};return AnalyticsTracker}()}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Lib.DateI18n=function(_super){__extends(DateI18n,_super);DateI18n.include(BH.Modules.I18n);function DateI18n(){this.moment=moment;this.chromeAPI=chrome}DateI18n.prototype.configure=function(){var _this=this;this.moment.lang(this.t("chrome_language"),{months:[this.t("january"),this.t("february"),this.t("march"),this.t("april"),this.t("may"),this.t("june"),this.t("july"),this.t("august"),this.t("september"),this.t("october"),this.t("november"),this.t("december")],weekdays:[this.t("sunday"),this.t("monday"),this.t("tuesday"),this.t("wednesday"),this.t("thursday"),this.t("friday"),this.t("saturday")],longDateFormat:{LT:this.t("local_time"),L:this.t("short_date"),LL:this.t("short_date_with_day"),LLL:this.t("formal_date")},meridiem:function(hour,minute,isLower){if(hour<12){return _this.t("morning")
}else if(hour>=12&&hour<16){return _this.t("afternoon")}else if(hour>=16){return _this.t("evening")}},ordinal:function(number){return _this.t("ordinal_"+number)}});return this.moment.lang(this.t("chrome_language"))};return DateI18n}(BH.Base)}.call(this);!function(){BH.Lib.Pagination={RESULTS_PER_PAGE:100,calculatePages:function(resultAmount){return Math.ceil(resultAmount/this.RESULTS_PER_PAGE)},calculateBounds:function(page){var end,start;start=page*this.RESULTS_PER_PAGE;end=page===0?this.RESULTS_PER_PAGE:page*this.RESULTS_PER_PAGE+this.RESULTS_PER_PAGE;return[start,end]}}}.call(this);!function(){var date,datetime,exampleTags;BH.Lib.ExampleTags=function(){function ExampleTags(){}ExampleTags.prototype.load=function(callback){var _this=this;if(callback==null){callback=function(){}}return persistence.tag()["import"](exampleTags,function(){if(typeof user!=="undefined"&&user!==null?user.isLoggedIn():void 0){return persistence.tag().fetchTags(function(tags,compiledTags){var translator;translator=new BH.Lib.SyncingTranslator;return translator.forServer(compiledTags,function(sites){persistence.remote().updateSites(sites);chrome.runtime.sendMessage({action:"calculate hash"});return callback()})})}else{return callback()}})};return ExampleTags}();date=(new Date).getTime();datetime=function(){return date+=1};exampleTags={tags:["games","places to travel","clothing","recipes","friends","funny videos","world news","productivity"],friends:[{title:"Facebook",url:"http://www.facebook.com",datetime:datetime()},{title:"Twitter",url:"https://twitter.com",datetime:datetime()},{title:"LinkedIn",url:"http://www.linkedin.com",datetime:datetime()},{title:"Reddit",url:"http://www.reddit.com",datetime:datetime()},{title:"Instagram",url:"http://www.instagram.com",datetime:datetime()},{title:"Pinterest",url:"http://www.pinterest.com",datetime:datetime()}],"funny videos":[{title:" Charlie bit my finger - again ! - YouTube",url:"http://www.youtube.com/watch?v=_OBlgSz8sSM",datetime:datetime()}],"world news":[{title:"Google News",url:"https://news.google.com/news?vanilla=1",datetime:datetime()},{title:"BBC - Homepage",url:"http://www.bbc.co.uk/",datetime:datetime()},{title:"Fact-Based, In-Depth News | Al Jazeera America",url:"http://america.aljazeera.com/",datetime:datetime()},{title:"Yahoo! News - Latest News & Headlines",url:"http://news.yahoo.com/",datetime:datetime()},{title:"World News",url:"http://www.reddit.com/r/worldnews/",datetime:datetime()},{title:"World News, Foreign Policy and International Affairs - HuffPost World",url:"http://www.huffingtonpost.com/world/",datetime:datetime()},{title:"World News | Reuters.com",url:"http://www.reuters.com/news/world",datetime:datetime()},{title:"World News and International Headlines : NPR",url:"http://www.npr.org/sections/world/",datetime:datetime()}],games:[{title:"Play Burrito Bison Revenge, a free online game on Kongregate",url:"http://www.kongregate.com/games/JuicyBeast/burrito-bison-revenge",datetime:datetime()},{title:"Play Red Remover, a free online game on Kongregate",url:"http://www.kongregate.com/games/TheGameHomepage/red-remover",datetime:datetime()},{title:"Monkey Quest - Free Online Strategy Games from AddictingGames",url:"http://www.addictinggames.com/strategy-games/monkey-quest-game.jsp?xid=ag_mq_featured_bananas-beware",datetime:datetime()},{title:"Plants vs Zombies - Game of The Year Online at Games.com: Play Free Online Games",url:"http://www.games.com/play/popcap-games/plants-vs-zombies-game-of-the-year",datetime:datetime()},{title:"Word Battle Online at Games.com: Play Free Online Games",url:"http://www.games.com/play/sia-fufla/word-battle",datetime:datetime()},{title:"Bush Whacker 2 Online at Games.com: Play Free Online Games",url:"http://www.games.com/play/djarts-games/bush-whacker-2",datetime:datetime()},{title:"Kingdom Rush Online at Games.com: Play Free Online Games",url:"http://www.games.com/play/armorgames/kingdom-rush",datetime:datetime()},{title:"8 Ball Pool Multiplayer - A free Sports Game",url:"http://www.miniclip.com/games/8-ball-pool-multiplayer/en/#t-h-h",datetime:datetime()},{title:"Soccer Stars - A free Sports Game",url:"http://www.miniclip.com/games/soccer-stars/en/#t-c-a",datetime:datetime()},{title:"Marble Lines | Play Online - Yahoo Games",url:"http://games.yahoo.com/game/marble-lines-flash.html",datetime:datetime()},{title:"Rockitty | Play Online - Yahoo Games",url:"http://games.yahoo.com/game/rockitty-flash.html",datetime:datetime()}],recipes:[{title:"Allrecipes - Recipes and cooking confidence for home cooks everywhere",url:"http://allrecipes.com/",datetime:datetime()},{title:"Epicurious.com: Recipes, Menus, Cooking Articles & Food Guides",url:"http://www.epicurious.com/",datetime:datetime()},{title:"foodgawker | feed your eyes",url:"http://foodgawker.com/",datetime:datetime()},{title:"Recipes, Party Food, Cooking Guides, Dinner Ideas, and Grocery Coupons - Delish.com",url:"http://www.delish.com/",datetime:datetime()},{title:"Quick Recipes & Easy Recipe Ideas - Tablespoon",url:"http://www.tablespoon.com/",datetime:datetime()},{title:"The Best Site For Recipes, Recommendations, Food And Cooking | Yummly",url:"http://www.yummly.com/",datetime:datetime()}],clothing:[{title:"Backpacks Made in USA, Gear Bags & Backpack Accessories | Topo Designs",url:"http://topodesigns.com/",datetime:datetime()},{title:"J.Crew : Cashmere Sweaters, Women's Clothing & Dresses, Men's & Kids' Clothing | JCrew.com",url:"http://www.jcrew.com/index.jsp",datetime:datetime()},{title:"Topshop USA - Womens Clothing - Womens Fashion - Topshop",url:"http://us.topshop.com/?geoip=home",datetime:datetime()},{title:"Clothes, Shoes, and Accessories for Women and Men | Free Shipping on $50 | Banana Republic",url:"http://bananarepublic.gap.com/",datetime:datetime()},{title:"American Apparel | Fashionable Basics. Sweatshop Free. Made in USA.",url:"http://www.americanapparel.net/",datetime:datetime()},{title:"Clothing  Shop For Clothes, Shipped FREE | Zappos.com",url:"http://www.zappos.com/clothing",datetime:datetime()},{title:"Forever 21 - Shop fashionable clothing for women, plus, girls, men",url:"http://www.forever21.com/Product/Main.aspx?br=f21",datetime:datetime()},{title:"OBEY CLOTHING",url:"http://www.obeyclothing.com/",datetime:datetime()},{title:"Victoria's Secret Online Clothing Store - Women's Clothing and Styles",url:"http://www.victoriassecret.com/clothing",datetime:datetime()},{title:"Amazon.com Clothing: Denim, Dresses, T-Shirts & more + Free Returns",url:"http://www.amazon.com/clothing-accessories-men-women-kids/b?ie=UTF8&node=1036592",datetime:datetime()},{title:"Urban Outfitters",url:"http://www.urbanoutfitters.com/urban/index.jsp",datetime:datetime()},{title:"H&M | H&M US",url:"http://www.hm.com/us/",datetime:datetime()},{title:"Macy's - Shop Fashion Clothing & Accessories - Official Site - Macys.com",url:"http://www.macys.com/",datetime:datetime()},{title:"Clothes For Women, Men, Kids and Baby | Free Shipping on $50 | Old Navy | Old Navy",url:"http://www.oldnavy.com/",datetime:datetime()}],"places to travel":[{title:"Grand Canyon National Park - Grand Canyon National Park",url:"http://www.nps.gov/grca/index.htm",datetime:datetime()},{title:"Great Wall of China - Wikipedia, the free encyclopedia",url:"http://en.wikipedia.org/wiki/Great_Wall_of_China",datetime:datetime()},{title:"Nile River (river, Africa) -- Encyclopedia Britannica",url:"http://www.britannica.com/EBchecked/topic/415347/Nile-River",datetime:datetime()},{title:"Travel Alaska - Official State of Alaska Travel &amp; Vacation Information",url:"http://www.travelalaska.com/",datetime:datetime()},{title:"The London Pass - London Sightseeing and Tourism for Less - London guide",url:"http://www.londonpass.com/",datetime:datetime()},{title:"10 Top Tourist Attractions in Germany | Touropia",url:"http://www.touropia.com/tourist-attractions-in-germany/",datetime:datetime()},{title:"France's Southern Vineyards : Wine : Travel Channel",url:"http://www.travelchannel.com/interests/wine/articles/frances-southern-vineyards",datetime:datetime()},{title:"Things to do in Cuba  275 Cuba Attractions - TripAdvisor",url:"http://www.tripadvisor.ca/Attractions-g147270-Activities-Cuba.html",datetime:datetime()},{title:"Hawaii Vacations | Hawaii Vacation Packages and Deals",url:"http://www.hawaii.com/",datetime:datetime()}],productivity:[{title:"Remember The Milk: Online to-do list and task management",url:"http://www.rememberthemilk.com/",datetime:datetime()},{title:"Evernote | Remember everything with Evernote, Skitch and our other great apps.",url:"http://evernote.com/",datetime:datetime()},{title:"Project management software, online collaboration: Basecamp",url:"https://basecamp.com/",datetime:datetime()},{title:"HipChat",url:"http://www.hipchat.com",datetime:datetime()},{title:"Skype - Free internet calls and cheap calls to phones online",url:"http://www.skype.com/en/",datetime:datetime()},{title:"Dropbox",url:"https://www.dropbox.com/",datetime:datetime()}]}}.call(this);!function(){BH.Lib.ImageData={base64:function(url,callback){var img,_this=this;img=new Image;img.src=url;return img.onload=function(){var canvas,ctx,dataURL;canvas=document.createElement("canvas");ctx=canvas.getContext("2d");ctx.drawImage(img,16,16);dataURL=canvas.toDataURL("image/png");return callback(dataURL)}}}}.call(this);!function(){BH.Lib.GoogleUserInfo=function(){function GoogleUserInfo(){}GoogleUserInfo.prototype.fetch=function(callbacks){return chrome.identity.getAuthToken({interactive:true},function(token){if(token!=null){return $.ajax({url:"https://www.googleapis.com/oauth2/v3/userinfo",dataType:"json",headers:{Authorization:"OAuth "+token},success:function(data){if(data.sub!=null){return callbacks.success(data)}else{return callbacks.error()}},error:function(data){if(callbacks.errors){return callbacks.error()}}})}else{$(".login_spinner").hide();return alert("Please sign into Chrome before continuing")}})};GoogleUserInfo.prototype.revoke=function(){return chrome.identity.getAuthToken(function(token){$.get("https://accounts.google.com/o/oauth2/revoke?token="+token);return chrome.identity.removeCachedAuthToken({token:token},function(){})})};return GoogleUserInfo}()}.call(this);!function(){var showLoginErrorView,showServerErrorView;showServerErrorView=function(){var serverErrorModal;serverErrorModal=new BH.Modals.ServerErrorModal;return serverErrorModal.open()};showLoginErrorView=function(){var loginErrorModal;loginErrorModal=new BH.Modals.LoginErrorModal;return loginErrorModal.open()};BH.Lib.UserProcessor=function(){function UserProcessor(){this.tracker=analyticsTracker}UserProcessor.prototype.start=function(){var connectionRequiredView,googleUserInfo,_this=this;if(!navigator.onLine){$(".login_spinner").hide();connectionRequiredView=new BH.Views.ConnectionRequiredView;return connectionRequiredView.open()}else{googleUserInfo=new BH.Lib.GoogleUserInfo;return googleUserInfo.fetch({success:function(userInfo){var sub;_this.tracker.userOAuthSuccess();sub=userInfo.sub;return $.ajax({url:"http://"+window.apiHost+"/user",data:{subId:userInfo.sub,email:userInfo.email,avatar:userInfo.picture,firstName:userInfo.given_name,lastName:userInfo.family_name},type:"POST",dataType:"json",success:function(data){if(data.purchased){return _this.loggedIn(data)}else{_this.tracker.userCreationSuccess();return $.post("http://"+window.apiHost+"/purchase/payment_token",{authId:data.authId},function(result){return google.payments.inapp.buy({parameters:{},jwt:result.jwt,success:function(){_this.loggedIn(data);return _this.tracker.syncPurchaseSuccess()},failure:function(){return this.tracker.syncPurchaseFailure()}})})}},error:function(){showLoginErrorView();_this.tracker.userCreationFailure();return $(".login_spinner").hide()}})},error:function(){showLoginErrorView();_this.tracker.userOAuthFailure();return $(".login_spinner").hide()}})}};UserProcessor.prototype.loggedIn=function(userData){var _this=this;this.tracker.userLoggedIn();return persistence.tag().fetchTags(function(tags,compiledTags){var syncingTranslator;if(tags.length>0){syncingTranslator=new BH.Lib.SyncingTranslator;return syncingTranslator.forServer(compiledTags,function(sites){var sitesHasher;sitesHasher=new BH.Lib.SitesHasher(CryptoJS.SHA1);sites=sitesHasher.generate(sites).toString();if(userData.sitesHash!=null){if(userData.sitesHash===sites){return _this.initialSync(null,userData)}else{return _this.syncDecision(userData)}}else{if(tags.length!==0){return _this.initialSync("push",userData)}else{return _this.initialSync("push",userData)}}})}else{return _this.initialSync("pull",userData)}})};UserProcessor.prototype.syncDecision=function(userData){var syncingDecisionModal,_this=this;syncingDecisionModal=new BH.Modals.SyncingDecisionModal({model:new Backbone.Model(userData)});syncingDecisionModal.open();syncingDecisionModal.on("decision",function(decision){if(decision==="push"){return _this.pushLocalTags(userData,function(){return syncingDecisionModal.doneSyncing()})}else{return _this.pullRemoteTags(userData,function(){return syncingDecisionModal.doneSyncing()})}});return syncingDecisionModal.on("syncingComplete",function(){return window.user.login(userData)})};UserProcessor.prototype.initialSync=function(direction,userData){var initialSyncingModal,_this=this;initialSyncingModal=new BH.Modals.InitialSyncingModal;initialSyncingModal.open();initialSyncingModal.on("open",function(){if(direction==="push"){return _this.pushLocalTags(userData,function(){return initialSyncingModal.doneSyncing()})}else if(direction==="pull"){return _this.pullRemoteTags(userData,function(){return initialSyncingModal.doneSyncing()})}else if(direction===null){return initialSyncingModal.doneSyncing()}});return initialSyncingModal.on("syncingComplete",function(){return window.user.login(userData)})};UserProcessor.prototype.pushLocalTags=function(userData,callback){return persistence.remote(userData.authId).deleteSites(function(){return persistence.tag().fetchTags(function(tags,compiledTags){var syncingTranslator;if(tags.length===0){return callback()}else{syncingTranslator=new BH.Lib.SyncingTranslator;return syncingTranslator.forServer(compiledTags,function(sites){return persistence.remote().updateSites(sites,function(){return setTimeout(function(){return callback()},2e3)})})}})})};UserProcessor.prototype.pullRemoteTags=function(userData,callback){return persistence.tag().removeAllTags(function(){return persistence.remote(userData.authId).getSites(function(sites){var data,syncingTranslator;syncingTranslator=new BH.Lib.SyncingTranslator;data=syncingTranslator.forLocal(sites);return persistence.tag()["import"](data,function(){return setTimeout(function(){return callback()},2e3)})})})};return UserProcessor}()}.call(this);!function(){BH.Lib.SyncingTranslator=function(){function SyncingTranslator(){}SyncingTranslator.prototype.forServer=function(compiledTags,callback,options){var foundIndex,index,requestImage,site,sites,storedSite,tag,_i,_j,_k,_l,_len,_len1,_len2,_len3,_ref,_results;if(options==null){options={}}sites=[];for(_i=0,_len=compiledTags.length;_i<_len;_i++){tag=compiledTags[_i];_ref=tag.sites;for(_j=0,_len1=_ref.length;_j<_len1;_j++){site=_ref[_j];if(site.url){foundIndex=null;for(index=_k=0,_len2=sites.length;_k<_len2;index=++_k){storedSite=sites[index];if(storedSite.url===site.url){foundIndex=index;break}}if(foundIndex!=null){sites[foundIndex].tags.push(tag.name)}else{site.tags=[tag.name];sites.push(site)}}}}if(!options.skipImages){index=1;requestImage=function(site){return BH.Lib.ImageData.base64("chrome://favicon/"+site.url,function(data){site.image=data;if(index===sites.length){return callback(sites)}else{return index++}})};_results=[];for(_l=0,_len3=sites.length;_l<_len3;_l++){site=sites[_l];_results.push(requestImage(site))}return _results}else{return callback(sites)}};SyncingTranslator.prototype.addImageToSites=function(sites,callback){var index,requestImage,site,_i,_len,_results;index=1;requestImage=function(site){return BH.Lib.ImageData.base64("chrome://favicon/"+site.url,function(data){site.image=data;if(index===sites.length){return callback(sites)}else{return index++}})};_results=[];for(_i=0,_len=sites.length;_i<_len;_i++){site=sites[_i];_results.push(requestImage(site))}return _results};SyncingTranslator.prototype.forLocal=function(sites){var data,site,tag,_i,_j,_k,_l,_len,_len1,_len2,_len3,_len4,_m,_ref,_ref1,_ref2;data={tags:[]};for(_i=0,_len=sites.length;_i<_len;_i++){site=sites[_i];_ref=site.tags;for(_j=0,_len1=_ref.length;_j<_len1;_j++){tag=_ref[_j];data.tags.push(tag)}}data.tags=_.uniq(data.tags);_ref1=data.tags;for(_k=0,_len2=_ref1.length;_k<_len2;_k++){tag=_ref1[_k];data[tag]=[]}for(_l=0,_len3=sites.length;_l<_len3;_l++){site=sites[_l];if(site.datetime==null){site.datetime=(new Date).getTime()}_ref2=site.tags;for(_m=0,_len4=_ref2.length;_m<_len4;_m++){tag=_ref2[_m];data[tag].push({url:site.url,title:site.title,datetime:site.datetime})}}return data};return SyncingTranslator}()}.call(this);!function(){var SitesHasher;SitesHasher=function(){function SitesHasher(shaFunction,scope){this.shaFunction=shaFunction;this.scope=scope!=null?scope:null;if(this.shaFunction==null){throw"Need a sha function"}}SitesHasher.prototype.generate=function(sites){var compiledString,data,site,stringifiedData,_i,_len;data=[];for(_i=0,_len=sites.length;_i<_len;_i++){site=sites[_i];if(site.tags.length>0){compiledString=""+site.url+": "+site.tags.sort().join(", ");data.push(compiledString)}}stringifiedData=data.sort().join("|");if(data.length===0){return""}else{return this.shaFunction.apply(this.scope,[stringifiedData])}};return SitesHasher}();if(typeof exports!=="undefined"){module.exports=SitesHasher}else{BH.Lib.SitesHasher=SitesHasher}}.call(this);!function(){BH.Lib.Syncer=function(){function Syncer(){}Syncer.prototype.updateIfNeeded=function(callback){if(callback==null){callback=function(){}}return persistence.remote().sitesHash(function(remoteData){return persistence.tag().getSitesHash(function(localData){if(remoteData.sitesHash!==localData.sitesHash){return persistence.remote().getSites(function(sites){var data,syncingTranslator;syncingTranslator=new BH.Lib.SyncingTranslator;data=syncingTranslator.forLocal(sites);return persistence.tag()["import"](data,function(){chrome.runtime.sendMessage({action:"calculate hash"});return callback()})})}})})};return Syncer}()}.call(this);!function(){BH.Lib.WeeksHistory=function(){function WeeksHistory(){this.history=new BH.Chrome.History}WeeksHistory.prototype.fetch=function(callback){var options,_this=this;if(callback==null){callback=function(){}}options={startTime:0,maxResults:0,endTime:(new Date).getTime(),text:""};return this.history.query(options,function(history){options={visits:history,config:{startingWeekDay:settings.get("startingWeekDay")}};return BH.Modules.Worker.worker("weekGrouper",options,function(history){return callback(history)})})};WeeksHistory.prototype.destroy=function(callback){var _this=this;if(callback==null){callback=function(){}}return this.history.deleteAll(function(){return callback()})};return WeeksHistory}()}.call(this);!function(){BH.Lib.WeekHistory=function(){function WeekHistory(date){date.setHours(0,0,0,0);this.startTime=date.getTime();date=new Date(date.getTime()+6*864e5);date.setHours(23,59,59,999);this.endTime=date.getTime();this.worker=BH.Modules.Worker.worker;this.history=new BH.Chrome.History}WeekHistory.prototype.fetch=function(callback){var options,_this=this;if(callback==null){callback=function(){}}options={startTime:this.startTime,endTime:this.endTime,text:"",maxResults:5e3};return this.history.query(options,function(results){options={options:options,results:results};return _this.worker("rangeSanitizer",options,function(sanitizedResults){return _this.worker("dayGrouper",{visits:sanitizedResults},function(history){return callback(history)})})})};WeekHistory.prototype.destroy=function(callback){var options,_this=this;if(callback==null){callback=function(){}}options={startTime:this.startTime,endTime:this.endTime};return this.history.deleteRange(options,function(){return callback()})};return WeekHistory}()}.call(this);!function(){var fillInVisit,getDomain,parse;BH.Lib.SearchHistory=function(){function SearchHistory(query){this.query=query;this.history=new BH.Chrome.History;this.worker=BH.Modules.Worker.worker}SearchHistory.prototype.fetch=function(callback){var options,_this=this;if(callback==null){callback=function(){}}options={text:"",startTime:0,maxResults:0};return chrome.storage.local.get("lastSearchCache",function(data){var cache;cache=data.lastSearchCache;if((cache!=null?cache.query:void 0)===_this.query){return callback(cache.results,new Date(cache.datetime))}else{return _this.history.query(options,function(history){options={options:{text:_this.query},results:history};return _this.worker("searchSanitizer",options,function(results){chrome.storage.local.set({lastSearchCache:{results:results,datetime:(new Date).getTime(),query:_this.query}});return callback(parse(results))})})}})};SearchHistory.prototype.expireCache=function(){return chrome.storage.local.remove("lastSearchCache")};SearchHistory.prototype.deleteUrl=function(url,callback){var _this=this;this.history.deleteUrl(url,function(){return callback()});return chrome.storage.local.get("lastSearchCache",function(data){var results;results=data.lastSearchCache.results;data.lastSearchCache.results=_.reject(results,function(visit){return visit.url===url});return chrome.storage.local.set(data)})};SearchHistory.prototype.destroy=function(callback){var _this=this;if(callback==null){callback=function(){}}return this.fetch(function(history){var i,visit,_i,_len,_results;_results=[];for(i=_i=0,_len=history.length;_i<_len;i=++_i){visit=history[i];_results.push(_this.history.deleteUrl(visit.url,function(){if(i===history.length){_this.expireCache();return callback()}}))}return _results})};return SearchHistory}();parse=function(visits){var i,visit,_i,_len,_results;_results=[];for(i=_i=0,_len=visits.length;_i<_len;i=++_i){visit=visits[i];_results.push(fillInVisit(visit))}return _results};fillInVisit=function(visit){visit.host=getDomain(visit.url);visit.location=visit.url;visit.path=visit.url.replace(visit.domain,"");if(visit.title===""){visit.title="(No Title)"}visit.name=visit.title;return visit};getDomain=function(url){var match;match=url.match(/\w+:\/\/(.*?)\//);if(match===null){return null}else{return match[0]}}}.call(this);!function(){var fillInGroupedVisit,fillInVisit,getDomain,parse;BH.Lib.DayHistory=function(){function DayHistory(date){date.setHours(0,0,0,0);this.startTime=date.getTime();date.setHours(23,59,59,999);this.endTime=date.getTime();this.history=new BH.Chrome.History;this.worker=BH.Modules.Worker.worker}DayHistory.prototype.fetch=function(callback){var options,_this=this;if(callback==null){callback=function(){}}options={startTime:this.startTime,endTime:this.endTime,text:"",maxResults:5e3};return this.history.query(options,function(results){options={options:options,results:results};return _this.worker("rangeSanitizer",options,function(sanitizedResults){options={visits:sanitizedResults,interval:settings.get("timeGrouping")};return _this.worker("timeGrouper",options,function(history){if(settings.get("domainGrouping")){options={intervals:history};return _this.worker("domainGrouper",options,function(history){return callback(parse(history))})}else{return callback(parse(history))}})})})};DayHistory.prototype.destroy=function(callback){var options,_this=this;if(callback==null){callback=function(){}}options={startTime:this.startTime,endTime:this.endTime};return this.history.deleteRange(options,function(){return callback()})};return DayHistory}();parse=function(intervals){var interval,item,out,visit,visits,_i,_j,_len,_len1,_ref;out=[];for(_i=0,_len=intervals.length;_i<_len;_i++){interval=intervals[_i];visits=[];_ref=interval.visits;for(_j=0,_len1=_ref.length;_j<_len1;_j++){visit=_ref[_j];item=_.isArray(visit)?fillInGroupedVisit(visit):fillInVisit(visit);visits.push(item)}out.push({id:interval.id,datetime:interval.datetime,visits:visits})}return out};getDomain=function(url){var match;match=url.match(/\w+:\/\/(.*?)\//);if(match===null){return null}else{return match[0]}};fillInVisit=function(visit){visit.domain=getDomain(visit.url);visit.host=getDomain(visit.url);visit.path=visit.url.replace(visit.domain,"");if(visit.title===""){visit.title="(No Title)"}return visit};fillInGroupedVisit=function(visits){var groupedVisit,visit;visits=function(){var _i,_len,_results;_results=[];for(_i=0,_len=visits.length;_i<_len;_i++){visit=visits[_i];_results.push(fillInVisit(visit))}return _results}();visit=visits[0];return groupedVisit={host:visit.domain,domain:visit.domain,url:visit.url,time:visits.time,isGrouped:true,visits:visits}}}.call(this);!function(){BH.Chrome.SyncStore=function(){function SyncStore(options){if(options==null){options={}}if(options.chrome==null){throw"Chrome API not set"}if(options.tracker==null){throw"Tracker not set"}this.chromeAPI=options.chrome;this.tracker=options.tracker}SyncStore.prototype.set=function(object,callback){var _this=this;if(callback==null){callback=function(){}}return this.chromeAPI.storage.sync.set(object,function(data){return _this.wrappedCallback("Set",data,callback)})};SyncStore.prototype.remove=function(key,callback){var _this=this;if(callback==null){callback=function(){}}return this.chromeAPI.storage.sync.remove(key,function(data){return _this.wrappedCallback("Remove",data,callback)})};SyncStore.prototype.get=function(key,callback){var _this=this;return this.chromeAPI.storage.sync.get(key,function(data){return _this.wrappedCallback("Get",data,callback)})};SyncStore.prototype.wrappedCallback=function(operation,data,callback){var message,_ref;if(data==null){data={}}if(this.chromeAPI.runtime.lastError!=null){message=(_ref=this.chromeAPI.runtime.lastError)!=null?_ref.message:void 0;this.tracker.syncStorageError(operation,message)}else{if(operation!=="Get"){this.tracker.syncStorageAccess(operation)}}return callback(data)};return SyncStore}()}.call(this);!function(){BH.Chrome.LocalStore=function(){function LocalStore(options){if(options==null){options={}}if(options.chrome==null){throw"Chrome API not set"}if(options.tracker==null){throw"Tracker not set"}this.chromeAPI=options.chrome;this.tracker=options.tracker}LocalStore.prototype.set=function(object,callback){var _this=this;if(callback==null){callback=function(){}}return this.chromeAPI.storage.local.set(object,function(data){return _this.wrappedCallback("Set",data,callback)})};LocalStore.prototype.remove=function(key,callback){var _this=this;if(callback==null){callback=function(){}}return this.chromeAPI.storage.local.remove(key,function(data){return _this.wrappedCallback("Remove",data,callback)})};LocalStore.prototype.clear=function(){return this.chromeAPI.storage.local.clear()};LocalStore.prototype.get=function(key,callback){var _this=this;return this.chromeAPI.storage.local.get(key,function(data){return _this.wrappedCallback("Get",data,callback)})};LocalStore.prototype.wrappedCallback=function(operation,data,callback){var message,_ref;if(this.chromeAPI.runtime.lastError!=null){message=(_ref=this.chromeAPI.runtime.lastError)!=null?_ref.message:void 0;this.tracker.localStorageError(operation,message)}return callback(data)};return LocalStore}()}.call(this);!function(){BH.Chrome.History=function(){function History(chromeAPI){this.chromeAPI=chromeAPI!=null?chromeAPI:chrome}History.prototype.query=function(options,callback){var _this=this;if(callback==null){callback=function(){}}return this.chromeAPI.history.search(options,function(visits){var visit,_i,_len;for(_i=0,_len=visits.length;_i<_len;_i++){visit=visits[_i];visit.date=new Date(visit.lastVisitTime);visit.extendedDate=moment(visit.date).format(_this.chromeAPI.i18n.getMessage("extended_formal_date"));visit.time=moment(visit.date).format(_this.chromeAPI.i18n.getMessage("local_time"))}return callback(visits)})};History.prototype.deleteAll=function(callback){if(callback==null){callback=function(){}}return this.chromeAPI.history.deleteAll(function(){return callback()})};History.prototype.deleteUrl=function(url,callback){if(callback==null){callback=function(){}}if(url==null){throw"Url needed"}return this.chromeAPI.history.deleteUrl({url:url},function(){return callback()})};History.prototype.deleteRange=function(range,callback){var _this=this;if(callback==null){callback=function(){}}if(range.startTime==null){throw"Start time needed"}if(range.endTime==null){throw"End time needed"}return this.chromeAPI.history.deleteRange(range,function(){return callback()})};return History}()}.call(this);!function(){BH.Persistence.Tag=function(){function Tag(options){if(options.localStore==null){throw"Localstore is not set"}this.localStore=options.localStore}Tag.prototype.setSitesHash=function(sitesHash){return this.localStore.set({sitesHash:sitesHash},function(){})};Tag.prototype.getSitesHash=function(callback){return this.localStore.get("sitesHash",function(data){return callback(data)})};Tag.prototype.getCompletedMigrations=function(callback){return this.localStore.get("completedMigrations",function(data){return callback(data.completedMigrations||[])})};Tag.prototype.markMigrationAsComplete=function(name,callback){var _this=this;return this.localStore.get("completedMigrations",function(data){data.completedMigrations||(data.completedMigrations=[]);data.completedMigrations.push(name);return _this.localStore.set(data,function(){return callback()})})};Tag.prototype.cached=function(callback){return this.localStore.get(null,function(data){return callback({siteTags:function(url){var matches,result,tag,_i,_len,_ref;matches=[];_ref=data.tags;for(_i=0,_len=_ref.length;_i<_len;_i++){tag=_ref[_i];result=_.where(data[tag],{url:url});if(result.length>0){matches.push(tag)}}return matches},sitesTags:function(urls){var matches,result,siteTags,tag,url,_i,_j,_len,_len1,_ref;siteTags=[];for(_i=0,_len=urls.length;_i<_len;_i++){url=urls[_i];matches=[];_ref=data.tags;for(_j=0,_len1=_ref.length;_j<_len1;_j++){tag=_ref[_j];result=_.where(data[tag],{url:url});if(result.length>0){matches.push(tag)}}siteTags.push(matches)}return _.intersection.apply(this,siteTags)}})})};Tag.prototype.fetchTags=function(callback){var _this=this;return this.localStore.get("tags",function(data){var tags;tags=data.tags||[];return _this.localStore.get(tags,function(data){var compiledTags,foundTags,sites,tag;foundTags=[];compiledTags=function(){var _results;_results=[];for(tag in data){sites=data[tag];_results.push({name:tag,sites:sites})}return _results}();return callback(tags,compiledTags)})})};Tag.prototype.fetchTagSites=function(name,callback){var _this=this;if(callback==null){callback=function(){}}return this.localStore.get(name,function(data){var site,sites;data[name]||(data[name]=[]);sites=function(){var _i,_len,_ref,_results;_ref=data[name];_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){site=_ref[_i];_results.push({title:site.title,url:site.url,datetime:site.datetime})}return _results}();return callback(sites)})};Tag.prototype.fetchSharedTag=function(name,callback){return this.localStore.get("sharedTags",function(data){data.sharedTags||(data.sharedTags={});return callback(data.sharedTags[name])})};Tag.prototype.fetchSiteTags=function(url,callback){var _this=this;if(callback==null){callback=function(){}}return this.localStore.get("tags",function(data){var tags;tags=data.tags||[];return _this.localStore.get(tags,function(data){var foundTags,site,sites,tag,_i,_len;foundTags=[];for(tag in data){sites=data[tag];for(_i=0,_len=sites.length;_i<_len;_i++){site=sites[_i];if(site.url===url){foundTags.push(tag)}}}return callback(foundTags)})})};Tag.prototype.shareTag=function(tag,url,callback){var _this=this;if(callback==null){callback=function(){}}return this.localStore.get("sharedTags",function(data){if(data.sharedTags==null){data={sharedTags:{}}}data.sharedTags[tag]=url;return _this.localStore.set(data,function(){return callback()})})};Tag.prototype.addSiteToTag=function(site,tag,callback){var operations,_this=this;
if(callback==null){callback=function(){}}operations={tagCreated:false};this.localStore.get("tags",function(data){if(data.tags==null){data={tags:[]}}if(data.tags.indexOf(tag)===-1){operations.tagCreated=true;data.tags.unshift(tag)}return _this.localStore.set(data,function(){return _this.localStore.get(tag,function(data){data[tag]||(data[tag]=[]);data[tag].push(site);return _this.localStore.set(data,function(){return callback(operations)})})})});return this.expireSharedTag(tag)};Tag.prototype.addSitesToTag=function(sites,tag,callback){var operations,_this=this;if(callback==null){callback=function(){}}operations={tagCreated:false};this.localStore.get("tags",function(data){if(data.tags==null){data={tags:[]}}if(data.tags.indexOf(tag)===-1){operations.tagCreated=true;data.tags.unshift(tag)}return _this.localStore.set(data,function(){return _this.localStore.get(tag,function(data){var site,_i,_len;for(_i=0,_len=sites.length;_i<_len;_i++){site=sites[_i];data[tag]||(data[tag]=[]);data[tag].push(site)}return _this.localStore.set(data,function(){return callback(operations)})})})});return this.expireSharedTag(tag)};Tag.prototype["import"]=function(data,callback){return this.localStore.set(data,callback)};Tag.prototype.clearAll=function(){return this.localStore.clear()};Tag.prototype.removeSiteFromTag=function(url,tag,callback){var _this=this;if(callback==null){callback=function(){}}this.localStore.get(tag,function(data){data[tag]||(data[tag]=[]);data[tag]=_.reject(data[tag],function(site){return url===site.url});return _this.localStore.set(data,function(){return callback(data[tag])})});return this.expireSharedTag(tag)};Tag.prototype.removeSitesFromTag=function(urls,tag,callback){var _this=this;if(callback==null){callback=function(){}}this.localStore.get(tag,function(data){data[tag]||(data[tag]=[]);data[tag]=_.reject(data[tag],function(site){return _.find(urls,function(url){return site.url===url})});return _this.localStore.set(data,function(){return callback(data[tag])})});return this.expireSharedTag(tag)};Tag.prototype.removeTag=function(tag,callback){var _this=this;if(callback==null){callback=function(){}}this.localStore.get("tags",function(data){data.tags||(data.tags=[]);data.tags=_.without(data.tags,tag);return _this.localStore.set(data,function(){return _this.localStore.remove(tag,function(){return callback()})})});return this.expireSharedTag(tag)};Tag.prototype.removeAllTags=function(callback){var _this=this;if(callback==null){callback=function(){}}this.localStore.get("tags",function(data){var tags;tags=data.tags||[];return _this.localStore.remove(tags,function(){return _this.localStore.set({tags:[]},function(){return callback()})})});return this.expireSharedTag()};Tag.prototype.renameTag=function(oldTag,newTag,callback){var _this=this;if(callback==null){callback=function(){}}this.localStore.get("tags",function(data){var newTagExists;data.tags||(data.tags=[]);if(data.tags.indexOf(newTag)!==-1){newTagExists=true}data.tags=_.without(data.tags,oldTag);if(newTagExists){data.tags=_.without(data.tags,newTag)}data.tags.unshift(newTag);return _this.localStore.set(data,function(){return _this.localStore.get(oldTag,function(data){var sites;sites=data[oldTag];if(newTagExists){return _this.localStore.get(newTag,function(data){return _this.localStore.remove(oldTag,function(){var site,_i,_len;for(_i=0,_len=sites.length;_i<_len;_i++){site=sites[_i];data[newTag].push(site)}return _this.localStore.set(data,function(){return callback()})})})}else{return _this.localStore.remove(oldTag,function(){data={};data[newTag]=sites;return _this.localStore.set(data,function(){return callback()})})}})})});return this.expireSharedTag(oldTag)};Tag.prototype.expireSharedTag=function(tag,callback){var _this=this;if(tag==null){tag=null}if(callback==null){callback=function(){}}return this.localStore.get("sharedTags",function(data){data.sharedTags||(data.sharedTags={});if(tag!=null){delete data.sharedTags[tag]}else{data.sharedTags={}}return _this.localStore.set(data,function(){return callback()})})};return Tag}()}.call(this);!function(){var error;error=function(data,type){return tagState.set({readOnly:true})};BH.Persistence.Remote=function(){function Remote(authId,ajax){this.authId=authId;this.ajax=ajax}Remote.prototype.host=function(){return"http://"+apiHost};Remote.prototype.updateAuthId=function(authId){return this.authId=authId};Remote.prototype.performRequest=function(options){var config,_this=this;if(options==null){options={}}if(!navigator.onLine){return error()}if(!options.disableSyncingFeedback){tagState.set({syncing:true})}config={url:this.host()+options.path,type:options.type,contentType:"application/json",dataType:options.dataType||"text",error:function(data,type){if(data.status===403){user.logout();return chrome.identity.getAuthToken(function(token){return chrome.identity.removeCachedAuthToken({token:token},function(){var authErrorModal;authErrorModal=new BH.Modals.AuthErrorModal;return authErrorModal.open()})})}else{error(data,type);if(options.error!=null){return options.error(data,type)}}},success:function(data){tagState.set({readOnly:false});if(options.success!=null){return options.success(data)}},complete:function(){setTimeout(function(){return tagState.set({syncing:false})},1e3);if(options.complete!=null){return options.complete()}}};if(options.authorization){config.headers={authorization:this.authId}}if(options.data!=null){config.data=JSON.stringify(options.data)}return this.ajax(config)};Remote.prototype.sitesHash=function(callback){return this.performRequest({path:"/user/sites/hash",type:"GET",dataType:"json",authorization:true,disableSyncingFeedback:true,success:callback})};Remote.prototype.share=function(tagData,callbacks){var params;params={path:"/share",data:tagData,type:"POST",dataType:"json",success:callbacks.success,error:callbacks.error,disableSyncingFeedback:true,authorization:false};if(user.isLoggedIn()){params.path="/user/share";params.authorization=true}return this.performRequest(params)};Remote.prototype.updateSite=function(site){return this.performRequest({path:"/user/site",type:"POST",data:site,authorization:true})};Remote.prototype.updateSites=function(sites,callback){if(callback==null){callback=function(){}}return this.performRequest({path:"/user/sites",type:"POST",data:sites,success:callback,authorization:true})};Remote.prototype.getSites=function(callback){return this.performRequest({path:"/user/sites",type:"GET",dataType:"json",success:callback,authorization:true})};Remote.prototype.renameTag=function(oldName,newName){return this.performRequest({path:"/user/tags/"+oldName.replace(/\s+/g,"-")+"/rename",type:"PUT",data:{name:newName},authorization:true})};Remote.prototype.deleteTag=function(name){return this.performRequest({path:"/user/tags/"+name.replace(/\s+/g,"-"),type:"DELETE",authorization:true})};Remote.prototype.deleteSites=function(callback){if(callback==null){callback=function(){}}return this.performRequest({path:"/user/sites",type:"DELETE",success:callback,authorization:true})};return Remote}()}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Modals.Base=function(_super){__extends(Base,_super);function Base(){return Base.__super__.constructor.apply(this,arguments)}Base.prototype.pulseClass="pulse";Base.prototype.generalEvents={"click .close-button":"close","click .overlay":"overlayClicked"};Base.prototype.attachGeneralEvents=function(){return _.extend(this.events,this.generalEvents)};Base.prototype.renderTemplate=function(json){var overlay;overlay=$(BH.Templates["modal"]);$(".page",overlay).append(Mustache.to_html(this.template,json));return overlay};Base.prototype.open=function(){var _this=this;$("body").append(this.render().el);this._globalBinds();$(window).trigger("resize");return setTimeout(function(){_this.$(".overlay").removeClass("transparent");return _this.trigger("open")},0)};Base.prototype.overlayClicked=function(){var _this=this;this.$(".page").addClass("pulse");return this.$(".page").on("webkitAnimationEnd",function(){return _this.$(".page").removeClass("pulse")})};Base.prototype.close=function(){var _this=this;this.$(".overlay").addClass("transparent");setTimeout(function(){_this.remove();return _this.trigger("close:removed")},1e3);this._globalUnbinds();return this.trigger("close")};Base.prototype._globalBinds=function(){$(window).resize(this._updateHeight);return $(window).keydown($.proxy(this._closeOnEscape,this))};Base.prototype._globalUnbinds=function(){$(window).unbind("resize");return $(document).unbind("keydown")};Base.prototype._updateHeight=function(){return this.$(".page").css({maxHeight:Math.min(.9*window.innerHeight,640)})};Base.prototype._closeOnEscape=function(e){if(e.keyCode===27){return this.close()}};return Base}(Backbone.View)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Modals.RenameTagModal=function(_super){__extends(RenameTagModal,_super);function RenameTagModal(){return RenameTagModal.__super__.constructor.apply(this,arguments)}RenameTagModal.include(BH.Modules.I18n);RenameTagModal.prototype.className="rename_tag_view";RenameTagModal.prototype.template=BH.Templates["rename_tag"];RenameTagModal.prototype.events={"click .cancel":"cancelClicked","click .rename":"renameClicked"};RenameTagModal.prototype.initialize=function(){this.chromeAPI=chrome;this.tracker=this.options.tracker;return this.attachGeneralEvents()};RenameTagModal.prototype.render=function(){this.$el.html(this.renderTemplate(this.getI18nValues()));return this};RenameTagModal.prototype.cancelClicked=function(ev){ev.preventDefault();return this.close()};RenameTagModal.prototype.renameClicked=function(ev){var tag,_this=this;ev.preventDefault();tag=this.$("input.new_tag").val();tag=tag.replace(/^\s\s*/,"").replace(/\s\s*$/,"");if(tag.length===0){return false}return this.model.renameTag(this.$("input.new_tag").val(),function(){_this.tracker.tagRenamed();return _this.close()})};RenameTagModal.prototype.getI18nValues=function(){var properties;properties=this.t(["rename_tag_button","prompt_cancel_button","new_tag_placeholder"]);properties["i18n_rename_tag_title"]=this.t("rename_tag_title",[this.model.get("name")]);return properties};return RenameTagModal}(BH.Modals.Base)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Modals.ReadOnlyExplanationModal=function(_super){__extends(ReadOnlyExplanationModal,_super);function ReadOnlyExplanationModal(){return ReadOnlyExplanationModal.__super__.constructor.apply(this,arguments)}ReadOnlyExplanationModal.include(BH.Modules.I18n);ReadOnlyExplanationModal.prototype.className="read_only_explanation_view";ReadOnlyExplanationModal.prototype.template=BH.Templates["read_only_explanation"];ReadOnlyExplanationModal.prototype.events={"click .okay":"okayClicked"};ReadOnlyExplanationModal.prototype.initialize=function(){this.chromeAPI=chrome;this.tracker=this.options.tracker;return this.attachGeneralEvents()};ReadOnlyExplanationModal.prototype.render=function(){this.$el.html(this.renderTemplate(this.getI18nValues()));return this};ReadOnlyExplanationModal.prototype.okayClicked=function(ev){ev.preventDefault();return this.close()};ReadOnlyExplanationModal.prototype.getI18nValues=function(){return this.t(["prompt_okay_button","read_only_explanation_title","read_only_explanation_description"])};return ReadOnlyExplanationModal}(BH.Modals.Base)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Modals.CreditsModal=function(_super){__extends(CreditsModal,_super);function CreditsModal(){return CreditsModal.__super__.constructor.apply(this,arguments)}CreditsModal.include(BH.Modules.I18n);CreditsModal.prototype.className="credits_view";CreditsModal.prototype.template=BH.Templates["credits"];CreditsModal.prototype.events={"click .close":"closeClicked"};CreditsModal.prototype.initialize=function(){this.chromeAPI=chrome;return this.attachGeneralEvents()};CreditsModal.prototype.render=function(){this.$el.html(this.renderTemplate(this.getI18nValues()));return this};CreditsModal.prototype.closeClicked=function(ev){ev.preventDefault();return this.close()};CreditsModal.prototype.openClicked=function(ev){ev.preventDefault();return this.open()};CreditsModal.prototype.getI18nValues=function(){var properties;properties=this.t(["credits_title","translators_heading","spanish","swedish","german","french","italian","hungarian","chinese_simplified","arabic","polish","portuguese","russian","slovak","catalonian","hindi","vietnamese","japanese","romanian","czech","dutch","latvian","turkish","translation_help_heading","close_button"]);properties["i18n_developed_by"]=this.t("developed_by",['<a href="http://automagical.posterous.com/">',"</a>","Roy Kolak"]);properties["i18n_translation_instructions"]=this.t("translation_instructions",["roy.kolak@gmail.com",'<a href="mailto:roy.kolak@gmail.com">',"</a>"]);return properties};return CreditsModal}(BH.Modals.Base)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Modals.MailingListModal=function(_super){__extends(MailingListModal,_super);function MailingListModal(){return MailingListModal.__super__.constructor.apply(this,arguments)}MailingListModal.include(BH.Modules.I18n);MailingListModal.prototype.className="mailing_list_view";MailingListModal.prototype.template=BH.Templates["mailing_list"];MailingListModal.prototype.events={"click .close":"closeClicked","click #join_mailing_list":"joinMailingListClicked"};MailingListModal.prototype.initialize=function(){this.chromeAPI=chrome;return this.attachGeneralEvents()};MailingListModal.prototype.render=function(){this.$el.html(this.renderTemplate(this.getI18nValues()));return this};MailingListModal.prototype.closeClicked=function(ev){ev.preventDefault();return this.close()};MailingListModal.prototype.joinMailingListClicked=function(){return this.close()};MailingListModal.prototype.getI18nValues=function(){return this.t(["close_button","mailing_list_title","mailing_list_description","mailing_list_link","mailing_list_promise","leave_a_review"])};return MailingListModal}(BH.Modals.Base)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Modals.HowToTagModal=function(_super){__extends(HowToTagModal,_super);function HowToTagModal(){return HowToTagModal.__super__.constructor.apply(this,arguments)}HowToTagModal.include(BH.Modules.I18n);HowToTagModal.prototype.className="how_to_tag_view";HowToTagModal.prototype.template=BH.Templates["how_to_tag"];HowToTagModal.prototype.events={"click .done":"doneClicked"};HowToTagModal.prototype.initialize=function(){this.chromeAPI=chrome;return this.attachGeneralEvents()};HowToTagModal.prototype.render=function(){this.$el.html(this.renderTemplate(this.getI18nValues()));this.on("open",function(){return!function(){var n;n=function(){var e,t,_i,_len,_results;n=document.getElementsByName("quickcast");_results=[];for(_i=0,_len=n.length;_i<_len;_i++){e=n[_i];t=e.offsetWidth;_results.push(e.height=t/.91+"px")}return _results};n();window.onresize=n;return window.addEventListener("message",function(n){if(n.data.indexOf("//quick.as/")!==-1){return window.location.href=n.data}},!1)}()},this);return this};HowToTagModal.prototype.doneClicked=function(ev){ev.preventDefault();return this.close()};HowToTagModal.prototype.getI18nValues=function(){return this.t(["how_to_tag_title","prompt_done_button"])};return HowToTagModal}(BH.Modals.Base)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Modals.NewTagModal=function(_super){__extends(NewTagModal,_super);function NewTagModal(){return NewTagModal.__super__.constructor.apply(this,arguments)}NewTagModal.include(BH.Modules.I18n);NewTagModal.prototype.className="new_tag_view";NewTagModal.prototype.template=BH.Templates["new_tag"];NewTagModal.prototype.events={"click .cancel":"cancelClicked","click .rename":"newTagClicked","keyup .new_tag":"newTagKeyup"};NewTagModal.prototype.initialize=function(){this.chromeAPI=chrome;this.tracker=this.options.tracker;return this.attachGeneralEvents()};NewTagModal.prototype.render=function(){this.$el.html(this.renderTemplate(this.getI18nValues()));return this};NewTagModal.prototype.cancelClicked=function(ev){ev.preventDefault();return this.close()};NewTagModal.prototype.newTagKeyup=function(){return this.$("input.new_tag").removeClass("error")};NewTagModal.prototype.newTagClicked=function(ev){var tag;ev.preventDefault();tag=this.$("input.new_tag").val();this.model.set({name:tag},{validate:true});if(this.model.validationError){return this.$("input.new_tag").addClass("error")}else{return this.close()}};NewTagModal.prototype.getI18nValues=function(){return this.t(["new_tag_button","prompt_cancel_button","new_tag_placeholder","create_new_tag_title"])};return NewTagModal}(BH.Modals.Base)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Modals.SignUpInfoModal=function(_super){__extends(SignUpInfoModal,_super);function SignUpInfoModal(){return SignUpInfoModal.__super__.constructor.apply(this,arguments)}SignUpInfoModal.include(BH.Modules.I18n);SignUpInfoModal.prototype.className="sign_up_info_view";SignUpInfoModal.prototype.template=BH.Templates["sign_up_info"];SignUpInfoModal.prototype.events={"click .continue":"continueClicked","click .cancel":"cancelClicked"};SignUpInfoModal.prototype.initialize=function(){this.chromeAPI=chrome;this.tracker=analyticsTracker;return this.attachGeneralEvents()};SignUpInfoModal.prototype.render=function(){var _this=this;this.$el.html(this.renderTemplate(this.getI18nValues()));$.ajax({url:"http://"+apiHost+"/purchase",contentType:"application/json",dataType:"json",success:function(data){if(data.open){}else{return _this.closeRegistration()}},error:function(){return _this.closeRegistration()}});this.tracker.getStartedSyncingModalSeen();return this};SignUpInfoModal.prototype.closeRegistration=function(){this.$(".continue").remove();this.$(".cancel").remove();this.$(".action-area").text(this.t("sign_up_temporarily_closed"));return this.$(".action-area").css({color:"red"})};SignUpInfoModal.prototype.cancelClicked=function(ev){ev.preventDefault();this.close();return this.tracker.getStartedSyncingCancelClicked()};SignUpInfoModal.prototype.continueClicked=function(ev){var userProcessor;ev.preventDefault();this.close();this.tracker.getStartedSyncingContinueClicked();userProcessor=new BH.Lib.UserProcessor;userProcessor.start();return $(".login_spinner").show()};SignUpInfoModal.prototype.getI18nValues=function(){var properties;properties=this.t(["prompt_cancel_button","continue_button","sign_up_info_title","sign_up_info_description","sign_up_info_price","sign_up_info_question"]);properties.i18n_sign_up_info_bullets=this.t("sign_up_info_bullets",["<li>","</li>",'<a href="http://better-history.com">',"</a>"]);return properties};return SignUpInfoModal}(BH.Modals.Base)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Modals.InitialSyncingModal=function(_super){__extends(InitialSyncingModal,_super);function InitialSyncingModal(){return InitialSyncingModal.__super__.constructor.apply(this,arguments)}InitialSyncingModal.include(BH.Modules.I18n);InitialSyncingModal.prototype.className="initial_syncing_view";InitialSyncingModal.prototype.template=BH.Templates["initial_syncing"];InitialSyncingModal.prototype.events={"click .continue":"continueClicked"};InitialSyncingModal.prototype.initialize=function(){this.chromeAPI=chrome;this.tracker=analyticsTracker;return this.attachGeneralEvents()};InitialSyncingModal.prototype.render=function(){this.$el.html(this.renderTemplate(this.getI18nValues()));this.tracker.syncAutomaticModalSeen();return this};InitialSyncingModal.prototype.continueClicked=function(ev){ev.preventDefault();this.close();return window.location.reload()};InitialSyncingModal.prototype.doneSyncing=function(){this.$(".continue").removeAttr("disabled");this.$(".syncing").hide();this.$(".done_syncing").show();this.$(".website_plug").show();this.$(".title").remove();this.$(".content-area").css({marginTop:26});return this.trigger("syncingComplete")};InitialSyncingModal.prototype.getI18nValues=function(){var properties;properties=this.t(["initial_syncing_title","continue_button","initial_syncing_description"]);properties.i18n_initial_syncing_done=this.t("initial_syncing_done",['<a href="http://www.better-history.com/me">',"</a>"]);return properties};return InitialSyncingModal}(BH.Modals.Base)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Modals.SyncingDecisionModal=function(_super){__extends(SyncingDecisionModal,_super);function SyncingDecisionModal(){return SyncingDecisionModal.__super__.constructor.apply(this,arguments)}SyncingDecisionModal.include(BH.Modules.I18n);SyncingDecisionModal.prototype.className="syncing_decision_view";SyncingDecisionModal.prototype.template=BH.Templates["syncing_decision"];SyncingDecisionModal.prototype.events={"click .push":"pushClicked","click .pull":"pullClicked","click .continue":"continueClicked"};SyncingDecisionModal.prototype.initialize=function(){this.chromeAPI=chrome;this.tracker=analyticsTracker;return this.attachGeneralEvents()};SyncingDecisionModal.prototype.render=function(){this.$el.html(this.renderTemplate(this.getI18nValues()));this.tracker.syncDecisionModalSeen();return this};SyncingDecisionModal.prototype.pushClicked=function(ev){ev.preventDefault();this.trigger("decision","push");return this.syncing()};SyncingDecisionModal.prototype.pullClicked=function(ev){ev.preventDefault();this.trigger("decision","pull");return this.syncing()};SyncingDecisionModal.prototype.continueClicked=function(ev){ev.preventDefault();this.close();return window.location.reload()};SyncingDecisionModal.prototype.syncing=function(){this.$(".decision").hide();return this.$(".syncing").show()};SyncingDecisionModal.prototype.doneSyncing=function(){this.$(".continue").removeAttr("disabled");this.$(".syncing").hide();this.$(".done_syncing").show();this.$(".website_plug").show();this.$(".continue").show();this.$(".title").remove();this.$(".content-area").css({marginTop:26});return this.trigger("syncingComplete")};SyncingDecisionModal.prototype.getI18nValues=function(){var properties;properties=this.t(["syncing_decision_title","syncing_push_button","syncing_pull_button","continue_button","initial_syncing_description"]);properties.i18n_syncing_decision_description=this.t("syncing_decision_description",[this.model.get("numberOfSites"),"<strong>","</strong>"]);properties.i18n_initial_syncing_done=this.t("initial_syncing_done",['<a href="http://www.better-history.com/me">',"</a>"]);return properties};return SyncingDecisionModal}(BH.Modals.Base)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Modals.AuthErrorModal=function(_super){__extends(AuthErrorModal,_super);function AuthErrorModal(){return AuthErrorModal.__super__.constructor.apply(this,arguments)}AuthErrorModal.include(BH.Modules.I18n);AuthErrorModal.prototype.className="auth_error_view";AuthErrorModal.prototype.template=BH.Templates["auth_error"];AuthErrorModal.prototype.events={"click .cancel":"cancelClicked","click .login":"loginClicked"};AuthErrorModal.prototype.initialize=function(){this.chromeAPI=chrome;this.tracker=this.options.tracker;return this.attachGeneralEvents()};AuthErrorModal.prototype.render=function(){this.$el.html(this.renderTemplate(this.getI18nValues()));return this};AuthErrorModal.prototype.cancelClicked=function(ev){ev.preventDefault();this.close();return user.logout()};AuthErrorModal.prototype.loginClicked=function(ev){var userProcessor;ev.preventDefault();this.close();user.logout();userProcessor=new BH.Lib.UserProcessor;return userProcessor.start()};AuthErrorModal.prototype.getI18nValues=function(){return this.t(["login_again_button","prompt_cancel_button","auth_error_title","auth_error_description"])};return AuthErrorModal}(BH.Modals.Base)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Modals.ServerErrorModal=function(_super){__extends(ServerErrorModal,_super);function ServerErrorModal(){return ServerErrorModal.__super__.constructor.apply(this,arguments)}ServerErrorModal.include(BH.Modules.I18n);ServerErrorModal.prototype.className="server_error_view";ServerErrorModal.prototype.template=BH.Templates["server_error"];ServerErrorModal.prototype.events={"click .okay":"okayClicked"};ServerErrorModal.prototype.initialize=function(){this.chromeAPI=chrome;this.tracker=this.options.tracker;return this.attachGeneralEvents()};ServerErrorModal.prototype.render=function(){this.$el.html(this.renderTemplate(this.getI18nValues()));return this};ServerErrorModal.prototype.okayClicked=function(ev){ev.preventDefault();return this.close()};ServerErrorModal.prototype.getI18nValues=function(){return this.t(["prompt_okay_button","server_error_title","server_error_description"])};return ServerErrorModal}(BH.Modals.Base)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Modals.ConnectionRequiredModal=function(_super){__extends(ConnectionRequiredModal,_super);function ConnectionRequiredModal(){return ConnectionRequiredModal.__super__.constructor.apply(this,arguments)}ConnectionRequiredModal.include(BH.Modules.I18n);ConnectionRequiredModal.prototype.className="connection_required_view";ConnectionRequiredModal.prototype.template=BH.Templates["connection_required"];ConnectionRequiredModal.prototype.events={"click .okay":"okayClicked"};ConnectionRequiredModal.prototype.initialize=function(){this.chromeAPI=chrome;this.tracker=this.options.tracker;return this.attachGeneralEvents()};ConnectionRequiredModal.prototype.render=function(){this.$el.html(this.renderTemplate(this.getI18nValues()));return this};ConnectionRequiredModal.prototype.okayClicked=function(ev){ev.preventDefault();return this.close()};ConnectionRequiredModal.prototype.getI18nValues=function(){return this.t(["prompt_okay_button","connection_required_title","connection_required_description"])};return ConnectionRequiredModal}(BH.Modals.Base)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Modals.LoginErrorModal=function(_super){__extends(LoginErrorModal,_super);function LoginErrorModal(){return LoginErrorModal.__super__.constructor.apply(this,arguments)}LoginErrorModal.include(BH.Modules.I18n);LoginErrorModal.prototype.className="login_error_view";LoginErrorModal.prototype.template=BH.Templates["login_error"];LoginErrorModal.prototype.events={"click .okay":"okayClicked"};LoginErrorModal.prototype.initialize=function(){this.chromeAPI=chrome;this.tracker=this.options.tracker;return this.attachGeneralEvents()};LoginErrorModal.prototype.render=function(){this.$el.html(this.renderTemplate(this.getI18nValues()));return this};LoginErrorModal.prototype.okayClicked=function(ev){ev.preventDefault();return this.close()};LoginErrorModal.prototype.getI18nValues=function(){return this.t(["prompt_okay_button","login_error_title","login_error_description"])};return LoginErrorModal}(BH.Modals.Base)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Views.MainView=function(_super){__extends(MainView,_super);function MainView(){return MainView.__super__.constructor.apply(this,arguments)}MainView.prototype.select=function(){var cleanTitle,element,_this=this;$(".mainview > *").removeClass("selected");$(".mainview > *").css({display:"block"});setTimeout(function(){_this.$el.addClass("selected");return $(".mainview > *:not(.selected)").css({display:"none"})},0);if(this.pageTitle){element=$("<div/>");cleanTitle=$(element).html(this.pageTitle()).text();document.title=""+cleanTitle+" - Better History"}this.trigger("selected");return this};MainView.prototype.onSearchTyped=function(ev){var term;term=this.trimedSearchTerm();if(ev.keyCode===13&&term!==""){return router.navigate("search/"+term,true)}};MainView.prototype.onSearchBlurred=function(){return this.$(".search").val(this.trimedSearchTerm())};MainView.prototype.trimedSearchTerm=function(){return $.trim(this.$(".search").val())};MainView.prototype.assignTabIndices=function(selector){$("*").removeAttr("tabindex");this.$("input.search").attr("tabindex",1);this.$(selector).each(function(i){return $(this).attr("tabindex",i+2)});return this.$(".search").focus()};return MainView}(Backbone.View)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;
child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Views.AppView=function(_super){__extends(AppView,_super);function AppView(){return AppView.__super__.constructor.apply(this,arguments)}AppView.include(BH.Modules.I18n);AppView.prototype.className="app_view";AppView.prototype.template=BH.Templates["app"];AppView.prototype.initialize=function(){this.chromeAPI=chrome;this.settings=this.options.settings;this.collection.reload(this.settings.get("startingWeekDay"));this.options.state.on("change",this.onStateChanged,this);this.settings.on("change:startingWeekDay",this.onStartingWeekDayChanged,this);this.settings.on("change:weekDayOrder",this.onWeekDayOrderChanged,this);this.collection.on("reloaded",this.onWeeksReloaded,this);return this.cache=new BH.Views.Cache(this.options)};AppView.prototype.render=function(){var html;html=Mustache.to_html(this.template,this.getI18nValues());this.$el.html(html);this.renderMenu();return this};AppView.prototype.renderMenu=function(){var menuView;menuView=new BH.Views.MenuView({el:".menu_view",collection:this.collection});return menuView.render()};AppView.prototype.onStateChanged=function(){return this.options.state.save()};AppView.prototype.onStartingWeekDayChanged=function(){return this.reloadWeeks()};AppView.prototype.onWeeksReloaded=function(){return this.renderMenu()};AppView.prototype.onWeekDayOrderChanged=function(){this.reloadWeeks();return this.cache.expire()};AppView.prototype.reloadWeeks=function(){this.collection.reset();return this.collection.reload(this.settings.get("startingWeekDay"))};AppView.prototype.loadTags=function(){this.updateMenuSelection();this.$(".menu .tags").parent().addClass("selected");return this.cache.tagsView()};AppView.prototype.loadTag=function(id){this.updateMenuSelection();this.$(".menu .tags").parent().addClass("selected");return this.cache.tagView(id)};AppView.prototype.loadWeeks=function(){this.$(".menu .all_weeks").parent().addClass("selected");return this.cache.weeksView()};AppView.prototype.loadWeek=function(id){this.updateMenuSelection(id);return this.cache.weekView(id)};AppView.prototype.loadDay=function(id){var startingWeekDay,weekId;startingWeekDay=this.settings.get("startingWeekDay");weekId=moment(id).past(startingWeekDay,0).id();this.updateMenuSelection(weekId);return this.cache.dayView(id)};AppView.prototype.loadSettings=function(){this.updateMenuSelection();this.$(".menu .setting").parent().addClass("selected");return this.cache.settingsView()};AppView.prototype.loadSearch=function(options){if(options==null){options={}}this.updateMenuSelection();return this.cache.searchView(options)};AppView.prototype.updateMenuSelection=function(id){this.$(".menu > *").removeClass("selected");if(id!=null){return this.$("[data-week-id='"+id+"']").addClass("selected")}};AppView.prototype.getI18nValues=function(){return this.t(["history_title","settings_link","tags_link"])};return AppView}(Backbone.View)}.call(this);!function(){BH.Views.Cache=function(){function Cache(options){this.options=options;this.settings=this.options.settings;this.state=this.options.state;this.expire()}Cache.prototype.expire=function(){return this.cache={weeks:{},days:{},tags:{}}};Cache.prototype.tagsView=function(){var tags;if(!this.cache.allTags){tags=new BH.Collections.Tags([]);this.cache.allTags=new BH.Views.TagsView({collection:tags,state:this.state});this.insert(this.cache.allTags.render().el)}return this.cache.allTags};Cache.prototype.tagView=function(id){var tag;if(!this.cache.tags[id]){tag=new BH.Models.Tag({name:id});this.cache.tags[id]=new BH.Views.TagView({name:id,model:tag,state:this.state});this.insert(this.cache.tags[id].render().el)}return this.cache.tags[id]};Cache.prototype.weeksView=function(){if(this.cache.allWeeks){return this.cache.allWeeks}this.cache.allWeeks=new BH.Views.WeeksView({collection:new Backbone.Collection});this.insert(this.cache.allWeeks.render().el);return this.cache.allWeeks};Cache.prototype.weekView=function(id){if(this.cache.weeks[id]){return this.cache.weeks[id]}this.cache.weeks[id]=new BH.Views.WeekView({model:new Backbone.Model({id:id,date:new Date(id)}),collection:new Backbone.Collection});this.insert(this.cache.weeks[id].render().el);return this.cache.weeks[id]};Cache.prototype.dayView=function(id){if(this.cache.days[id]){return this.cache.days[id]}this.cache.days[id]=new BH.Views.DayView({model:new Backbone.Model({id:id,date:new Date(id)}),collection:new Backbone.Collection});this.insert(this.cache.days[id].render().el);return this.cache.days[id]};Cache.prototype.searchView=function(options){if(this.cache.search||options.expired===true){return this.cache.search}this.cache.search=new BH.Views.SearchView({model:new Backbone.Model,collection:new Backbone.Collection});this.insert(this.cache.search.render().el);return this.cache.search};Cache.prototype.settingsView=function(){if(!this.cache.settings){this.cache.settings=new BH.Views.SettingsView({model:this.settings,state:this.state});this.insert(this.cache.settings.render().el)}return this.cache.settings};Cache.prototype.insert=function(html){return $(".mainview").append(html)};return Cache}()}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Views.DayResultsView=function(_super){__extends(DayResultsView,_super);function DayResultsView(){return DayResultsView.__super__.constructor.apply(this,arguments)}DayResultsView.include(BH.Modules.I18n);DayResultsView.prototype.template=BH.Templates["day_results"];DayResultsView.prototype.events={"click .delete_visit":"deleteVisitClicked","click .delete_grouped_visit":"deleteGroupedVisitClicked","click .delete_interval":"deleteIntervalClicked","click .show_visits":"toggleGroupedVisitsClicked","click .hide_visits":"toggleGroupedVisitsClicked","click .visit > a":"visitClicked"};DayResultsView.prototype.initialize=function(){return this.chromeAPI=chrome};DayResultsView.prototype.render=function(){var html,presenter,properties;presenter=new BH.Presenters.DayHistoryPresenter(this.collection.toJSON());properties=_.extend(this.getI18nValues(),{history:presenter.history(),readOnly:state.get("readOnly")});html=Mustache.to_html(this.template,properties);this.$el.html(html);return this};DayResultsView.prototype.insertTags=function(){return persistence.tag().cached(function(operations){var _this=this;$(".site").each(function(){var $el,activeTagsView,tags;$el=$(this);tags=operations.siteTags($el.attr("href"));if(tags.length>0){activeTagsView=new BH.Views.ActiveTagsView({model:new BH.Models.Site({tags:tags}),editable:false});return $el.find(".active_tags").html(activeTagsView.render().el)}});return $(".grouped_sites").each(function(i,siteEl){var $el,activeTagsView,sharedTags,urls;$el=$(siteEl);urls=[];$el.find("a.site").each(function(){return urls.push($(this).attr("href"))});sharedTags=operations.sitesTags(urls);activeTagsView=new BH.Views.ActiveTagsView({model:new BH.Models.Site({tags:sharedTags}),editable:false});return $el.find(".active_tags").eq(0).html(activeTagsView.render().el)})})};DayResultsView.prototype.attachDragging=function(){var dragAndTagView;dragAndTagView=new BH.Views.DragAndTagView({collection:this.collection});dragAndTagView.render();dragAndTagView.on("site:change",function(site,$el){var activeTagsView;activeTagsView=new BH.Views.ActiveTagsView({model:new BH.Models.Site(site),editable:false});return $el.find(".active_tags").html(activeTagsView.render().el)});return dragAndTagView.on("sites:change",function(site,$el){var $activeTags,activeTagsView;activeTagsView=new BH.Views.ActiveTagsView({model:new BH.Models.Site(site),editable:false});$activeTags=$el.children(".sites").find(".active_tags");return $activeTags.html(activeTagsView.render().el)})};DayResultsView.prototype.visitClicked=function(ev){if($(ev.target).hasClass("search_domain")){ev.preventDefault();return router.navigate($(ev.target).attr("href"),{trigger:true})}};DayResultsView.prototype.deleteVisitClicked=function(ev){var $el;ev.preventDefault();$el=$(ev.currentTarget);analyticsTracker.visitDeletion();return(new BH.Chrome.History).deleteUrl($el.data("url"),function(){return $el.parent(".visit").remove()})};DayResultsView.prototype.deleteGroupedVisitClicked=function(ev){ev.preventDefault();ev.stopPropagation();analyticsTracker.groupedVisitsDeletion();$(ev.currentTarget).siblings(".visits").children().each(function(i,visit){return $(visit).find(".delete_visit").trigger("click")});return $(ev.currentTarget).parents(".visit").remove()};DayResultsView.prototype.deleteIntervalClicked=function(ev){var visitElements;ev.preventDefault();analyticsTracker.timeIntervalDeletion();visitElements=$(ev.currentTarget).parents(".interval").children(".visits").children();return $(visitElements).each(function(i,visit){return setTimeout(function(){return $(visit).children(".delete").trigger("click")},i*10)})};DayResultsView.prototype.toggleGroupedVisitsClicked=function(ev){ev.preventDefault();return $(ev.currentTarget).parents(".visit").toggleClass("expanded")};DayResultsView.prototype.getI18nValues=function(){return this.t(["prompt_delete_button","delete_time_interval_button","no_visits_found","expand_button","collapse_button","search_by_domain"])};return DayResultsView}(Backbone.View)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Views.DayView=function(_super){__extends(DayView,_super);function DayView(){return DayView.__super__.constructor.apply(this,arguments)}DayView.include(BH.Modules.I18n);DayView.prototype.template=BH.Templates["day"];DayView.prototype.className="day_view with_controls";DayView.prototype.events={"click .delete_day":"onDeleteAllClicked","click .back_to_week":"onBackToWeekClicked","keyup .search":"onSearchTyped","blur .search":"onSearchBlurred"};DayView.prototype.initialize=function(){return this.collection.bind("reset",this.onHistoryLoaded,this)};DayView.prototype.render=function(){var html,presenter,properties;presenter=new BH.Presenters.DayPresenter(this.model.toJSON());properties=_.extend(this.getI18nValues(),presenter.dayInfo());html=Mustache.to_html(this.template,properties);this.$el.html(html);return this};DayView.prototype.onHistoryLoaded=function(){this.renderHistory();this.assignTabIndices(".interval > .visits > .visit > a:first-child");return this.updateDeleteButton()};DayView.prototype.onDeleteAllClicked=function(ev){return this.promptToDeleteAllVisits()};DayView.prototype.onBackToWeekClicked=function(){return this.$(".content").html("")};DayView.prototype.pageTitle=function(){var presenter;presenter=new BH.Presenters.DayPresenter(this.model.toJSON());return presenter.dayInfo().formalDate};DayView.prototype.renderHistory=function(){this.dayResultsView=new BH.Views.DayResultsView({collection:this.collection});this.$(".content").html(this.dayResultsView.render().el);this.dayResultsView.insertTags();this.dayResultsView.attachDragging();this.$(".spinner").hide();return this.$(".back_to_week").css({opacity:1})};DayView.prototype.updateDeleteButton=function(){var deleteButton;deleteButton=this.$("button");if(this.collection.length===0){return deleteButton.attr("disabled","disabled")}else{return deleteButton.removeAttr("disabled")}};DayView.prototype.updateUrl=function(){return router.navigate(BH.Lib.Url.week(this.options.weekModel.id))};DayView.prototype.promptToDeleteAllVisits=function(){var presenter,promptMessage;presenter=new BH.Presenters.DayPresenter(this.model.toJSON());promptMessage=this.t("confirm_delete_all_visits",[presenter.dayInfo().formalDate]);this.promptView=BH.Views.CreatePrompt(promptMessage);this.promptView.open();return this.promptView.model.on("change",this.promptAction,this)};DayView.prototype.promptAction=function(prompt){if(prompt.get("action")){analyticsTracker.dayVisitsDeletion();return new BH.Lib.DayHistory(this.model.get("date")).destroy(function(){return window.location.reload()})}else{return this.promptView.close()}};DayView.prototype.getI18nValues=function(){var properties;properties=this.t(["collapse_button","expand_button","delete_all_visits_for_filter_button","no_visits_found","search_input_placeholder_text"]);properties["i18n_back_to_week_link"]=this.t("back_to_week_link",[this.t("back_arrow")]);return properties};return DayView}(BH.Views.MainView)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Views.MainView=function(_super){__extends(MainView,_super);function MainView(){return MainView.__super__.constructor.apply(this,arguments)}MainView.prototype.select=function(){var cleanTitle,element,_this=this;$(".mainview > *").removeClass("selected");$(".mainview > *").css({display:"block"});setTimeout(function(){_this.$el.addClass("selected");return $(".mainview > *:not(.selected)").css({display:"none"})},0);if(this.pageTitle){element=$("<div/>");cleanTitle=$(element).html(this.pageTitle()).text();document.title=""+cleanTitle+" - Better History"}this.trigger("selected");return this};MainView.prototype.onSearchTyped=function(ev){var term;term=this.trimedSearchTerm();if(ev.keyCode===13&&term!==""){return router.navigate("search/"+term,true)}};MainView.prototype.onSearchBlurred=function(){return this.$(".search").val(this.trimedSearchTerm())};MainView.prototype.trimedSearchTerm=function(){return $.trim(this.$(".search").val())};MainView.prototype.assignTabIndices=function(selector){$("*").removeAttr("tabindex");this.$("input.search").attr("tabindex",1);this.$(selector).each(function(i){return $(this).attr("tabindex",i+2)});return this.$(".search").focus()};return MainView}(Backbone.View)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Views.MenuView=function(_super){__extends(MenuView,_super);function MenuView(){return MenuView.__super__.constructor.apply(this,arguments)}MenuView.include(BH.Modules.I18n);MenuView.prototype.template=BH.Templates["menu"];MenuView.prototype.events={"click .menu > *":"weekClicked"};MenuView.prototype.initialize=function(){return this.chromeAPI=chrome};MenuView.prototype.render=function(){var html,presenter,properties;presenter=new BH.Presenters.WeeksPresenter(this.collection);properties=_.extend({},this.getI18nValues(),presenter.weeks());html=Mustache.to_html(this.template,properties);return this.$el.html(html)};MenuView.prototype.weekClicked=function(ev){var $el;this.$(".menu > *").removeClass("selected");$el=$(ev.currentTarget);$el.addClass("selected");return analyticsTracker.weekView($el.data("week-id"),$el.index())};MenuView.prototype.getI18nValues=function(){return this.t(["all_weeks_link"])};return MenuView}(Backbone.View)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Views.ModalView=function(_super){__extends(ModalView,_super);function ModalView(){return ModalView.__super__.constructor.apply(this,arguments)}ModalView.prototype.pulseClass="pulse";ModalView.prototype.generalEvents={"click .close-button":"close","click .overlay":"overlayClicked"};ModalView.prototype.attachGeneralEvents=function(){return _.extend(this.events,this.generalEvents)};ModalView.prototype.renderTemplate=function(json){var overlay;overlay=$(BH.Templates["modal"]);$(".page",overlay).append(Mustache.to_html(this.template,json));return overlay};ModalView.prototype.open=function(){var _this=this;$("body").append(this.render().el);this._globalBinds();$(window).trigger("resize");return setTimeout(function(){_this.$(".overlay").removeClass("transparent");return _this.trigger("open")},0)};ModalView.prototype.overlayClicked=function(){var _this=this;this.$(".page").addClass("pulse");return this.$(".page").on("webkitAnimationEnd",function(){return _this.$(".page").removeClass("pulse")})};ModalView.prototype.close=function(){var _this=this;this.$(".overlay").addClass("transparent");setTimeout(function(){_this.remove();return _this.trigger("close:removed")},1e3);this._globalUnbinds();return this.trigger("close")};ModalView.prototype._globalBinds=function(){$(window).resize(this._updateHeight);return $(window).keydown($.proxy(this._closeOnEscape,this))};ModalView.prototype._globalUnbinds=function(){$(window).unbind("resize");return $(document).unbind("keydown")};ModalView.prototype._updateHeight=function(){return this.$(".page").css({maxHeight:Math.min(.9*window.innerHeight,640)})};ModalView.prototype._closeOnEscape=function(e){if(e.keyCode===27){return this.close()}};return ModalView}(Backbone.View)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Views.PromptView=function(_super){__extends(PromptView,_super);function PromptView(){return PromptView.__super__.constructor.apply(this,arguments)}PromptView.include(BH.Modules.I18n);PromptView.prototype.className="prompt_view";PromptView.prototype.template=BH.Templates["prompt"];PromptView.prototype.events={"click .no":"clickedNo","click .yes":"clickedYes"};PromptView.prototype.initialize=function(){this.chromeAPI=chrome;return this.attachGeneralEvents()};PromptView.prototype.render=function(){this.$el.html(this.renderTemplate(_.extend(this.getI18nValues(),this.model.toJSON())));return this};PromptView.prototype.clickedNo=function(ev){ev.preventDefault();return this.model.set({action:false})};PromptView.prototype.clickedYes=function(ev){ev.preventDefault();this.spin();return this.model.set({action:true})};PromptView.prototype.spin=function(){return this.$el.addClass("loading")};PromptView.prototype.getI18nValues=function(){return this.t(["prompt_delete_button","prompt_cancel_button","prompt_title"])};return PromptView}(BH.Views.ModalView);BH.Views.CreatePrompt=function(content){var view;view=new BH.Views.PromptView({model:new Backbone.Model({content:content})});$("body").append(view.render().el);return view}}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Views.SearchResultsView=function(_super){__extends(SearchResultsView,_super);function SearchResultsView(){return SearchResultsView.__super__.constructor.apply(this,arguments)}SearchResultsView.include(BH.Modules.I18n);SearchResultsView.prototype.template=BH.Templates["search_results"];SearchResultsView.prototype.events={"click .delete_visit":"deleteClicked"};SearchResultsView.prototype.render=function(){var end,html,presenter,properties,start,_ref;_ref=BH.Lib.Pagination.calculateBounds(this.options.page),start=_ref[0],end=_ref[1];presenter=new BH.Presenters.SearchHistoryPresenter(this.collection.toJSON(),this.options.query);properties=_.extend(this.getI18nValues(),{visits:presenter.history(start,end)});html=Mustache.to_html(this.template,properties);this.$el.html(html);return this};SearchResultsView.prototype.insertTags=function(){return persistence.tag().cached(function(operations){return $(".site").each(function(){var $el,activeTagsView,tags;$el=$(this);tags=operations.siteTags($el.attr("href"));activeTagsView=new BH.Views.ActiveTagsView({model:new BH.Models.Site({tags:tags}),editable:false});return $el.find(".active_tags").html(activeTagsView.render().el)})})};SearchResultsView.prototype.attachDragging=function(){var dragAndTagView;dragAndTagView=new BH.Views.DragAndTagView({model:this.model});dragAndTagView.render();return dragAndTagView.on("site:change",function(site,$el){var activeTagsView;activeTagsView=new BH.Views.ActiveTagsView({model:new BH.Models.Site(site),editable:false});return $el.find(".active_tags").html(activeTagsView.render().el)})};SearchResultsView.prototype.deleteClicked=function(ev){var $el,url,_this=this;ev.preventDefault();$el=$(ev.currentTarget);url=$el.data("url");return(new BH.Lib.SearchHistory).deleteUrl(url,function(){$el.parents(".visit").remove();return _this.collection.remove(_this.collection.where({url:url}))})};SearchResultsView.prototype.getI18nValues=function(){return this.t(["no_visits_found"])};return SearchResultsView}(Backbone.View)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Views.SearchPaginationView=function(_super){__extends(SearchPaginationView,_super);function SearchPaginationView(){return SearchPaginationView.__super__.constructor.apply(this,arguments)}SearchPaginationView.include(BH.Modules.I18n);SearchPaginationView.include(BH.Modules.Url);SearchPaginationView.prototype.className="search_pagination_view";SearchPaginationView.prototype.template=BH.Templates["search_pagination"];SearchPaginationView.prototype.initialize=function(){this.chromeAPI=chrome;this.query=this.options.query;this.pages=BH.Lib.Pagination.calculatePages(this.collection.length);this.collection.on("remove",this.onVisitRemove,this);if(this.model.get("page")>this.pages){return this.model.set({page:1})}};SearchPaginationView.prototype.events={"click .pagination a":"onPageClicked"};SearchPaginationView.prototype.render=function(){var html,i,properties;this.pages=BH.Lib.Pagination.calculatePages(this.collection.length);properties={paginationClass:this.pages===1?"hidden":""};properties.pages=function(){var _i,_ref,_results;_results=[];for(i=_i=1,_ref=this.pages;_i<=_ref;i=_i+=1){_results.push({url:""+this.urlFor("search",this.query)+"/p"+i,className:i===this.model.get("page")?"selected":"",number:i})}return _results}.call(this);properties=_.extend(this.getI18nValues(),properties);html=Mustache.to_html(this.template,properties);return this.$el.html(html)};SearchPaginationView.prototype.onVisitRemove=function(){var copy;if(this.collection.length%100===0){return this.render()}else{copy=this.t("number_of_visits",[this.collection.length]);return this.$(".number_of_visits").text(copy)}};SearchPaginationView.prototype.onPageClicked=function(ev){var $el;$el=$(ev.currentTarget);analyticsTracker.paginationClick();router.navigate($el.attr("href"));this.$("a").removeClass("selected");$el.addClass("selected");return this.model.set({page:$el.data("page")})};SearchPaginationView.prototype.getI18nValues=function(){var properties;properties=[];properties["i18n_number_of_visits"]=this.t("number_of_visits",[this.collection.length]);return properties};return SearchPaginationView}(BH.Views.MainView)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Views.SearchView=function(_super){__extends(SearchView,_super);function SearchView(){return SearchView.__super__.constructor.apply(this,arguments)}SearchView.include(BH.Modules.I18n);SearchView.include(BH.Modules.Url);SearchView.prototype.className="search_view with_controls";SearchView.prototype.template=BH.Templates["search"];SearchView.prototype.events={"click .delete_all":"clickedDeleteAll","click .corner .delete":"clickedCancelSearch","click .fresh_search":"clickedFreshSearch","keyup .search":"onSearchTyped","blur .search":"onSearchBlurred"};SearchView.prototype.initialize=function(){this.collection.on("reset",this.onHistoryChanged,this);this.model.on("change:query",this.onQueryChanged,this);this.model.on("change:cacheDatetime",this.onCacheChanged,this);this.page=new Backbone.Model({page:1});return this.page.on("change:page",this.renderSearchResults,this)};SearchView.prototype.render=function(){var html,presenter,properties,_this=this;presenter=new BH.Presenters.SearchPresenter(this.model.toJSON());properties=_.extend(this.getI18nValues(),presenter.searchInfo());html=Mustache.to_html(this.template,properties);this.$el.append(html);if(this.model.get("query")===""){this.$el.addClass("loaded");this.$(".title").text(this.t("search_title"));this.$(".number_of_results").text("");setTimeout(function(){return _this.assignTabIndices(".visit a:first-child")},0)}this.updateDeleteButton();return this};SearchView.prototype.pageTitle=function(){return this.t("searching_title")};SearchView.prototype.onHistoryChanged=function(){this.renderVisits();this.assignTabIndices(".visit a:first-child");return this.updateDeleteButton()};SearchView.prototype.onCacheChanged=function(){var date,datetime,time;if(this.model.get("cacheDatetime")){datetime=moment(this.model.get("cacheDatetime"));date=datetime.format(this.t("extended_formal_date"));time=datetime.format(this.t("local_time"));this.$(".cached .datetime").text(""+time+" "+date);return this.$(".cached").show()}else{return this.$(".cached").hide()}};SearchView.prototype.onQueryChanged=function(){this.updateQueryReferences();$(".pagination").html("");if(this.model.get("query")!==""){this.$(".corner").addClass("cancelable");return this.$(".cached").hide()}};SearchView.prototype.onPageClicked=function(ev){var $el;ev.preventDefault();$el=$(ev.currentTarget);$(".pagination a").removeClass("selected");$el.addClass("selected");return this.renderSearchResults()};SearchView.prototype.clickedFreshSearch=function(ev){ev.preventDefault();(new BH.Lib.SearchHistory).expireCache();return window.location.reload()};SearchView.prototype.updateQueryReferences=function(){var page,presenter,properties;presenter=new BH.Presenters.SearchPresenter(this.model.toJSON());properties=presenter.searchInfo();this.$el.removeClass("loaded");this.$(".title").text(properties.title);this.$(".content").html("");page=this.page.get("page")!==1?"/p"+this.page.get("page"):"";return router.navigate(this.urlFor("search",properties.query)+page)};SearchView.prototype.renderVisits=function(){var searchPaginationView;this.$el.addClass("loaded");this.$(".search").focus();searchPaginationView=new BH.Views.SearchPaginationView({collection:this.collection,query:this.model.get("query"),el:$(".pagination"),model:this.page});searchPaginationView.render();return this.renderSearchResults()};SearchView.prototype.renderSearchResults=function(){if(this.searchResultsView){this.searchResultsView.undelegateEvents()}this.searchResultsView=new BH.Views.SearchResultsView({query:this.model.get("query"),collection:this.collection,el:this.$el.children(".content"),page:this.page.get("page")-1});this.searchResultsView.render();this.searchResultsView.insertTags();return this.searchResultsView.attachDragging()};SearchView.prototype.updateDeleteButton=function(){var deleteButton;deleteButton=this.$(".delete_all");if(this.collection.length===0||this.model.get("query")===""){return deleteButton.attr("disabled","disabled")}else{return deleteButton.removeAttr("disabled")}};SearchView.prototype.clickedCancelSearch=function(ev){ev.preventDefault();return router.navigate("search",{trigger:true})};SearchView.prototype.clickedDeleteAll=function(ev){ev.preventDefault();if($(ev.target).parent().attr("disabled")!=="disabled"){this.promptView=BH.Views.CreatePrompt(this.t("confirm_delete_all_search_results"));this.promptView.open();return this.promptView.model.on("change",this.deleteAction,this)}};SearchView.prototype.deleteAction=function(prompt){var _this=this;if(prompt.get("action")){analyticsTracker.searchResultsDeletion();return new BH.Lib.SearchHistory(this.model.get("query")).destroy(function(){_this.collection.reset([]);_this.model.unset("cacheDatetime");return _this.promptView.close()})}else{return this.promptView.close()}};SearchView.prototype.getI18nValues=function(){return this.t(["search_time_frame","search_input_placeholder_text","delete_all_visits_for_search_button","no_visits_found"])};return SearchView}(BH.Views.MainView)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Views.SettingsView=function(_super){__extends(SettingsView,_super);function SettingsView(){return SettingsView.__super__.constructor.apply(this,arguments)}SettingsView.include(BH.Modules.I18n);SettingsView.prototype.className="settings_view";SettingsView.prototype.template=BH.Templates["settings"];SettingsView.prototype.events={"click .clear_history":"clickedClearHistory","click .credits":"clickedCredits","click #sign_up":"clickedSignUp","click #sign_in":"clickedSignIn","change #time_grouping":"changedTimeGrouping","change #time_format":"changedTimeFormat","change #open_location":"changedOpenLocation","change #starting_week_day":"changedStartingWeekDay","change #week_day_order":"changedWeekDayOrder","click #domain_grouping":"clickedDomainGrouping","click #search_by_domain":"clickedSearchByDomain","click #search_by_selection":"clickedSearchBySelection","click .manually_sync_local":"clickedManuallySyncLocal","click .logout":"clickedLogout"};SettingsView.prototype.initialize=function(){var _this=this;this.chromeAPI=chrome;this.tracker=analyticsTracker;this.model.off("change");this.model.on("change",function(){return _this.model.save()},this.model);this.model.on("change:openLocation",this.options.state.updateRoute,this.options.state);this.model.on("change:startingWeekDay",this.options.state.updateRoute,this.options.state);window.user.on("login",this.onUserLogIn,this);window.user.on("logout",this.onUserLogout,this);return this.on("selected",this.activateSocialLinks,this)};SettingsView.prototype.pageTitle=function(){return this.t("settings_title")};SettingsView.prototype.onUserLogIn=function(){this.$(".logged_out").hide();this.$(".avatar").attr("src",user.get("avatar"));this.$(".name").text(""+user.get("firstName")+" "+user.get("lastName"));this.$(".logged_in").show();return this.$(".login_spinner").hide()};SettingsView.prototype.onUserLogout=function(){this.$(".logged_out").show();this.$(".logged_in").hide();return this.$(".login_spinner").hide()};SettingsView.prototype.clickedLogout=function(ev){ev.preventDefault();return user.logout()};SettingsView.prototype.clickedManuallySyncLocal=function(ev){var initialSyncingModal,_this=this;ev.preventDefault();initialSyncingModal=new BH.Modals.InitialSyncingModal;initialSyncingModal.open();return initialSyncingModal.on("open",function(){return persistence.remote().deleteSites(function(){return persistence.tag().fetchTags(function(tags,compiledTags){var syncingTranslator;if(tags.length===0){return initialSyncingModal.doneSyncing()}else{syncingTranslator=new BH.Lib.SyncingTranslator;return syncingTranslator.forServer(compiledTags,function(sites){return persistence.remote().updateSites(sites,function(){return setTimeout(function(){return initialSyncingModal.doneSyncing()
},2e3)})})}})})})};SettingsView.prototype.activateSocialLinks=function(){!function(d,s,id){js;var fjs,js;fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";return fjs.parentNode.insertBefore(js,fjs)}}(document,"script","twitter-wjs");window.___gcfg={lang:this.t("google_plus_language")};return function(){var po,s;po=document.createElement("script");po.type="text/javascript";po.async=true;po.src="https://apis.google.com/js/plusone.js";s=document.getElementsByTagName("script")[0];return s.parentNode.insertBefore(po,s)}()};SettingsView.prototype.render=function(){var html,presenter,properties,_this=this;presenter=new BH.Presenters.SettingsPresenter(this.model);properties=_.extend({},this.getI18nValues(),presenter.settings());html=Mustache.to_html(this.template,properties);this.$el.append(html);this.populateFields();setTimeout(function(){if(user.get("authId")){return _this.onUserLogIn()}},500);return this};SettingsView.prototype.populateFields=function(){this.$("#open_location").val(this.model.get("openLocation"));this.$("#starting_week_day").val(this.model.get("startingWeekDay"));this.$("#week_day_order").val(this.model.get("weekDayOrder"));this.$("#time_grouping").val(this.model.get("timeGrouping"));this.$("#time_format").val(this.model.get("timeFormat"));this.$("#domain_grouping").prop("checked",this.model.get("domainGrouping"));this.$("#search_by_domain").prop("checked",this.model.get("searchByDomain"));return this.$("#search_by_selection").prop("checked",this.model.get("searchBySelection"))};SettingsView.prototype.clickedSignUp=function(ev){var signUpInfoModal;ev.preventDefault();signUpInfoModal=new BH.Modals.SignUpInfoModal;return signUpInfoModal.open()};SettingsView.prototype.clickedSignIn=function(ev){var userProcessor;ev.preventDefault();this.$(".login_spinner").show();userProcessor=new BH.Lib.UserProcessor;return userProcessor.start()};SettingsView.prototype.changedTimeGrouping=function(ev){return this.model.set({timeGrouping:$(ev.currentTarget).val()})};SettingsView.prototype.changedTimeFormat=function(ev){return this.model.set({timeFormat:$(ev.currentTarget).val()})};SettingsView.prototype.changedOpenLocation=function(ev){return this.model.set({openLocation:$(ev.currentTarget).val()})};SettingsView.prototype.changedStartingWeekDay=function(ev){return this.model.set({startingWeekDay:$(ev.currentTarget).val()})};SettingsView.prototype.changedWeekDayOrder=function(ev){return this.model.set({weekDayOrder:$(ev.currentTarget).val()})};SettingsView.prototype.clickedDomainGrouping=function(ev){return this.model.set({domainGrouping:$(ev.currentTarget).is(":checked")})};SettingsView.prototype.clickedSearchByDomain=function(ev){var backgroundPage,method;this.model.set({searchByDomain:$(ev.currentTarget).is(":checked")});backgroundPage=this.chromeAPI.extension.getBackgroundPage();method=this.model.get("searchByDomain")?"create":"remove";return backgroundPage.pageContextMenu[method]()};SettingsView.prototype.clickedSearchBySelection=function(ev){var backgroundPage,method;this.model.set({searchBySelection:$(ev.currentTarget).prop("checked")});backgroundPage=this.chromeAPI.extension.getBackgroundPage();method=this.model.get("searchBySelection")?"create":"remove";return backgroundPage.selectionContextMenu[method]()};SettingsView.prototype.clickedClearHistory=function(ev){ev.preventDefault();return this.chromeAPI.tabs.create({url:"chrome://settings/clearBrowserData"})};SettingsView.prototype.clickedCredits=function(ev){var creditsModal;ev.preventDefault();creditsModal=new BH.Modals.CreditsModal;$("body").append(creditsModal.render().el);return creditsModal.open()};SettingsView.prototype.getI18nValues=function(){var properties;properties=this.t(["settings_title","clearing_history_section_title","clear_history_button","visit_grouping_section_title","group_visits_by_label","time_format_label","group_visits_by_domain_label","right_click_options_section_title","search_by_text_selection_label","search_by_domain_label","whats_new_section_title","feedback_section_title","spread_the_word_section_title","leave_a_review","twitter_template","twitter_language","open_location","starting_week_day","week_day_order","general_section_title","mailing_list_link","syncing_settings_title","manually_sync_local_link"]);properties["i18n_syncing_settings_login"]=this.t("syncing_settings_login",['<a style="text-decoration: underline;" href="#" id="sign_up">',"</a>",'<a style="text-decoration: underline;" href="#" id="sign_in">',"</a>"]);properties["i18n_credits_link"]=this.t("credits_link",["<strong>","</strong>"]);properties["i18n_permissions_details"]=this.t("permissions_details",['<a href="http://www.better-history.com/permissions">',"</a>"]);properties["i18n_suggestions_bugs_comments"]=this.t("suggestions_bugs_comments",['<a href="http://twitter.com/Better_History">',"</a>"]);return properties};return SettingsView}(BH.Views.MainView)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Views.VisitView=function(_super){__extends(VisitView,_super);function VisitView(){return VisitView.__super__.constructor.apply(this,arguments)}VisitView.include(BH.Modules.I18n);VisitView.prototype.className="visit_view";VisitView.prototype.template=BH.Templates["visit"];VisitView.prototype.events={"click .delete_visit":"deleteClicked"};VisitView.prototype.render=function(){var html,properties;properties=_.extend(this.getI18nValues(),this.model.toTemplate());html=Mustache.to_html(this.template,properties);this.$el.html(html);return this};VisitView.prototype.deleteClicked=function(ev){var _this=this;ev.preventDefault();return this.model.destroy({success:function(){var method;method=_this._isGroupedAndEmpty()?"_removeGroup":"_remove";return _this[method]()}})};VisitView.prototype._remove=function(){return this.$el.slideUp("fast",function(){return $el.remove()})};VisitView.prototype._removeGroup=function(){return $(this._getGroup()).slideUp("fast",function(){return $el.remove()})};VisitView.prototype._isGroupedAndEmpty=function(){if(this.$el.parents(".expanded").children().length===1){return true}else{return false}};VisitView.prototype._getGroup=function(){return this.$el.parents(".grouped_visits_view")};VisitView.prototype.getI18nValues=function(){return this.t(["prompt_delete_button"])};return VisitView}(Backbone.View)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Views.WeekView=function(_super){__extends(WeekView,_super);function WeekView(){return WeekView.__super__.constructor.apply(this,arguments)}WeekView.include(BH.Modules.I18n);WeekView.prototype.template=BH.Templates["week"];WeekView.prototype.className="week_view with_controls";WeekView.prototype.events={"click .delete_all":"onDeleteAllClicked","keyup .search":"onSearchTyped","blur .search":"onSearchBlurred"};WeekView.prototype.initialize=function(){return this.collection.bind("reset",this.onHistoryLoaded,this)};WeekView.prototype.render=function(){var html,presenter,properties;presenter=new BH.Presenters.WeekPresenter(this.model.toJSON());properties=_.extend(this.getI18nValues(),presenter.inflatedWeek());html=Mustache.to_html(this.template,properties);this.$el.html(html);return this};WeekView.prototype.onHistoryLoaded=function(){return this.renderHistory()};WeekView.prototype.onDeleteAllClicked=function(){return this.promptToDeleteAllVisits()};WeekView.prototype.pageTitle=function(){var presenter;presenter=new BH.Presenters.WeekPresenter(this.model.toJSON());return presenter.inflatedWeek().title};WeekView.prototype.renderHistory=function(){var container,day,history,presenter,_i,_len,_ref;presenter=new BH.Presenters.WeekHistoryPresenter(this.collection.toJSON());history=presenter.history();_ref=history.days;for(_i=0,_len=_ref.length;_i<_len;_i++){day=_ref[_i];container=this.$("[data-day="+day.day+"]");container.find(".label .count").html(this.t("number_of_visits",[day.count]));container.find(".bar").css({width:day.percentage})}this.$(".controls .count").html(this.t("number_of_visits",[history.total]));this.assignTabIndices(".day a");return this.$el.addClass("loaded")};WeekView.prototype.promptToDeleteAllVisits=function(){var presenter,promptMessage;presenter=new BH.Presenters.WeekPresenter(this.model.toJSON());promptMessage=this.t("confirm_delete_all_visits",[presenter.inflatedWeek().title]);this.promptView=BH.Views.CreatePrompt(promptMessage);this.promptView.open();return this.promptView.model.on("change",this.promptAction,this)};WeekView.prototype.promptAction=function(prompt){var _this=this;if(prompt.get("action")){analyticsTracker.weekVisitsDeletion();return new BH.Lib.WeekHistory(this.model.get("date")).destroy(function(){_this.promptView.close();return window.location.reload()})}else{return this.promptView.close()}};WeekView.prototype.getI18nValues=function(){return this.t(["delete_all_visits_for_filter_button","no_visits_found","search_input_placeholder_text"])};return WeekView}(BH.Views.MainView)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Views.WeeksView=function(_super){__extends(WeeksView,_super);function WeeksView(){return WeeksView.__super__.constructor.apply(this,arguments)}WeeksView.include(BH.Modules.I18n);WeeksView.include(BH.Modules.Worker);WeeksView.prototype.template=BH.Templates["weeks"];WeeksView.prototype.className="week_view with_controls";WeeksView.prototype.events={"click .delete_all":"onDeleteAllClicked","keyup .search":"onSearchTyped","blur .search":"onSearchBlurred"};WeeksView.prototype.initialize=function(){this.chromeAPI=chrome;return this.collection.on("reset",this.renderHistory,this)};WeeksView.prototype.render=function(){var html,properties;properties=_.extend(this.getI18nValues());html=Mustache.to_html(this.template,properties);this.$el.html(html);return this};WeeksView.prototype.onHistoryLoaded=function(){return this.renderHistory()};WeeksView.prototype.renderHistory=function(){var presenter,weeksResultsView;weeksResultsView=new BH.Views.WeeksResultsView({collection:this.collection});this.$(".content",this.$el).html(weeksResultsView.render().el);presenter=new BH.Presenters.AllWeeksPresenter(this.collection);this.$(".spinner").hide();this.$(".text.count").text(""+presenter.totalVisits()+" visits");return this.$(".text.count").css({opacity:1})};WeeksView.prototype.onDeleteAllClicked=function(){return this.promptToDeleteAllVisits()};WeeksView.prototype.pageTitle=function(){return this.t("all_weeks_title")};WeeksView.prototype.promptToDeleteAllVisits=function(){var promptMessage;promptMessage=this.t("confirm_delete_all_weeks");this.promptView=BH.Views.CreatePrompt(promptMessage);this.promptView.open();return this.promptView.model.on("change",this.promptAction,this)};WeeksView.prototype.promptAction=function(prompt){var _this=this;if(prompt.get("action")){analyticsTracker.weekVisitsDeletion();return(new BH.Chrome.WeeksHistory).destroy(function(){_this.promptView.close();return _this.collection.reset()})}else{return this.promptView.close()}};WeeksView.prototype.getI18nValues=function(){return this.t(["all_weeks_title","delete_all_weeks_button","no_visits_found","search_input_placeholder_text"])};return WeeksView}(BH.Views.MainView)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Views.WeeksResultsView=function(_super){__extends(WeeksResultsView,_super);function WeeksResultsView(){return WeeksResultsView.__super__.constructor.apply(this,arguments)}WeeksResultsView.include(BH.Modules.I18n);WeeksResultsView.prototype.template=BH.Templates["weeks_results"];WeeksResultsView.prototype.className="weeks_results_view";WeeksResultsView.prototype.render=function(){var html,presenter;presenter=new BH.Presenters.AllWeeksPresenter(this.collection);html=Mustache.to_html(this.template,presenter.allWeeks());this.$el.html(html);return this};return WeeksResultsView}(Backbone.View)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Views.TagsView=function(_super){__extends(TagsView,_super);function TagsView(){return TagsView.__super__.constructor.apply(this,arguments)}TagsView.include(BH.Modules.I18n);TagsView.prototype.className="tags_view with_controls";TagsView.prototype.template=BH.Templates["tags"];TagsView.prototype.events={"click .delete_all":"onDeleteTagsClicked","click .how_to_tag":"onHowToTagClicked","click .load_example_tags":"onLoadExampleTagsClicked","click .dismiss_instructions":"onDismissInstructionsClicked","click #sign_up":"onBuyTagSyncingClicked","click #sign_in":"onSignInClicked","click .read_only_explanation":"onReadOnlyExplanationClicked","keyup .search":"onSearchTyped","blur .search":"onSearchBlurred"};TagsView.prototype.initialize=function(){this.chromeAPI=chrome;this.tracker=analyticsTracker;this.collection.on("reset",this.onTagsLoaded,this);user.on("login",this.onLoggedIn,this);user.on("logout",this.onLoggedOut,this);tagState.on("change:readOnly",this.onReadOnlyChange,this);return tagState.on("synced",this.onSynced,this)};TagsView.prototype.pageTitle=function(){return this.t("tags_title")};TagsView.prototype.render=function(){var html,properties;properties=_.extend(this.getI18nValues(),{loggedIn:user.isLoggedIn()},tagState.toJSON());html=Mustache.to_html(this.template,properties);this.$el.append(html);return this};TagsView.prototype.onReadOnlyChange=function(){this.$el.html("");this.render();return this.collection.fetch()};TagsView.prototype.onSynced=function(){this.$el.html("");this.render();return this.collection.fetch()};TagsView.prototype.onReadOnlyExplanationClicked=function(ev){var readOnlyExplanationModal;ev.preventDefault();readOnlyExplanationModal=new BH.Modals.ReadOnlyExplanationModal;return readOnlyExplanationModal.open()};TagsView.prototype.onBuyTagSyncingClicked=function(ev){var signUpInfoModal;ev.preventDefault();signUpInfoModal=new BH.Modals.SignUpInfoModal;return signUpInfoModal.open()};TagsView.prototype.onTagsLoaded=function(){var tag_count;tag_count=this.t("number_of_tags",[this.collection.length]);this.$(".tag_count").text(tag_count);return this.renderTags()};TagsView.prototype.onLoggedIn=function(){this.$(".sync_promo").hide();this.$(".sync_enabled").show();return this.$(".login_spinner").hide()};TagsView.prototype.onLoggedOut=function(){this.$(".sync_promo").show();return this.$(".sync_enabled").hide()};TagsView.prototype.onLoadExampleTagsClicked=function(ev){var exampleTags,_this=this;ev.preventDefault();exampleTags=new BH.Lib.ExampleTags;return exampleTags.load(function(){return _this.collection.fetch()})};TagsView.prototype.renderTags=function(){if(this.tagsListView){this.tagsListView.remove()}this.tagsListView=new BH.Views.TagsListView({collection:this.collection});this.$(".content").html(this.tagsListView.render().el);if(user.get("authId")){return this.onLoggedIn()}};TagsView.prototype.onDismissInstructionsClicked=function(ev){ev.preventDefault();syncStore.set({tagInstructionsDismissed:true});return $(".about_tags").hide()};TagsView.prototype.onSignInClicked=function(ev){var userProcessor;ev.preventDefault();userProcessor=new BH.Lib.UserProcessor;userProcessor.start();return this.$(".login_spinner").show()};TagsView.prototype.onHowToTagClicked=function(ev){var howToTagModal;ev.preventDefault();howToTagModal=new BH.Modals.HowToTagModal;return howToTagModal.open()};TagsView.prototype.onDeleteTagsClicked=function(ev){this.tracker.deleteAllTagsClick();return this.promptToDeleteTags()};TagsView.prototype.promptToDeleteTags=function(){var promptMessage;promptMessage=this.t("confirm_delete_all_tags");this.promptView=BH.Views.CreatePrompt(promptMessage);this.promptView.open();return this.promptView.model.on("change",this.promptAction,this)};TagsView.prototype.promptAction=function(prompt){var _this=this;if(prompt.get("action")){this.collection.destroy(function(){_this.collection.fetch();if(user.isLoggedIn()){return persistence.remote().deleteSites()}});return this.promptView.close()}else{return this.promptView.close()}};TagsView.prototype.getI18nValues=function(){var properties;properties=this.t(["tags_title","search_input_placeholder_text","delete_all_tags","how_to_tag","read_only_explanation_link"]);properties.i18n_sync_tags_link=this.t("sync_tags_link",['<a style="text-decoration: underline;" href="#" id="sign_up">',"</a>",'<a style="text-decoration: underline;" href="#" id="sign_in">',"</a>"]);properties.i18n_sync_enabled=this.t("sync_enabled",['<span class="inline-tag">',"</span>"]);return properties};return TagsView}(BH.Views.MainView)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Views.TagsListView=function(_super){__extends(TagsListView,_super);function TagsListView(){return TagsListView.__super__.constructor.apply(this,arguments)}TagsListView.include(BH.Modules.I18n);TagsListView.prototype.className="tags_list_view";TagsListView.prototype.template=BH.Templates["tags_list"];TagsListView.prototype.initialize=function(){return this.chromeAPI=chrome};TagsListView.prototype.render=function(){var html,presenter,properties;presenter=new BH.Presenters.TagsPresenter(this.collection);properties=_.extend({tags:presenter.tagsSummary()},this.getI18nValues());html=Mustache.to_html(this.template,properties);this.$el.html(html);return this};TagsListView.prototype.getI18nValues=function(){var properties;properties=this.t(["no_tags_found","about_tags_title"]);properties.i18n_about_tags_instructions=this.t("about_tags_instructions",['<a href="#" class="how_to_tag">',"</a>",'<a href="http://mad.ly/signups/84938/join">',"</a>"]);properties.i18n_extra_tag_help=this.t("extra_tag_help",['<a href="#" class="how_to_tag">',"</a>",'<a href="#" class="load_example_tags">',"</a>"]);return properties};return TagsListView}(BH.Views.MainView)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Views.TagView=function(_super){__extends(TagView,_super);function TagView(){return TagView.__super__.constructor.apply(this,arguments)}TagView.include(BH.Modules.I18n);TagView.include(BH.Modules.Url);TagView.prototype.className="tag_view with_controls";TagView.prototype.template=BH.Templates["tag"];TagView.prototype.events={"click .delete_sites":"onDeleteSitesClicked","click .rename":"onRenameClicked","click .share":"onShareClicked","click .read_only_explanation":"onReadOnlyExplanationClicked","keyup .search":"onSearchTyped","blur .search":"onSearchBlurred"};TagView.prototype.initialize=function(){this.chromeAPI=chrome;this.tracker=analyticsTracker;this.model.on("change",this.onSitesLoaded,this);this.model.on("change:name",this.onNameChange,this);tagState.on("change:readOnly",this.onReadOnlyChange,this);return tagState.on("synced",this.onSynced,this)};TagView.prototype.pageTitle=function(){return this.t("tag_title",[this.options.name])};TagView.prototype.render=function(){var html,properties;properties=_.extend(this.getI18nValues(),{tagsUrl:"#tags"},tagState.toJSON());html=Mustache.to_html(this.template,properties);this.$el.append(html);return this};TagView.prototype.onReadOnlyChange=function(){this.$el.html("");this.render();return this.model.fetch()};TagView.prototype.onSynced=function(){this.$el.html("");this.render();return this.model.fetch()};TagView.prototype.onSitesLoaded=function(){return this.renderTaggedSites()};TagView.prototype.onNameChange=function(){return router.navigate(this.urlFor("tag",this.model.get("name")),{trigger:true})};TagView.prototype.renderTaggedSites=function(){if(this.taggedSitesView){this.taggedSitesView.remove()}this.taggedSitesView=new BH.Views.TaggedSitesView({model:this.model});this.$(".content").html(this.taggedSitesView.render().el);this.taggedSitesView.attachDragging();return this.taggedSitesView.insertTags()};TagView.prototype.onReadOnlyExplanationClicked=function(ev){var readOnlyExplanationModal;ev.preventDefault();readOnlyExplanationModal=new BH.Modals.ReadOnlyExplanationModal;return readOnlyExplanationModal.open()};TagView.prototype.onDeleteSitesClicked=function(ev){this.tracker.deleteTagClick();return this.promptToDeleteAllSites()};TagView.prototype.onRenameClicked=function(ev){var renameTagModal;ev.preventDefault();this.tracker.renameTagClick();renameTagModal=new BH.Modals.RenameTagModal({model:this.model,tracker:this.tracker});$("body").append(renameTagModal.render().el);renameTagModal.open();return $(".new_tag").focus()};TagView.prototype.onShareClicked=function(ev){var $smallSpinner,url,_this=this;ev.preventDefault();this.tracker.shareClicked();if(this.model.get("url")){url=encodeURIComponent(this.model.get("url"));return this.chromeAPI.tabs.create({url:"http://"+window.siteHost+"/from_ext/"+url})}else{$smallSpinner=this.$(".small_spinner");if(!$smallSpinner.hasClass("show")){$smallSpinner.addClass("show");return this.model.share({success:function(data){$smallSpinner.removeClass("show");url=encodeURIComponent(data.url);_this.chromeAPI.tabs.create({url:"http://"+window.siteHost+"/from_ext/"+url});return _this.model.set({url:data.url})},error:function(){$smallSpinner.removeClass("show");return alert("There was an error. Please try again later")}})}}};TagView.prototype.promptToDeleteAllSites=function(){var promptMessage;promptMessage=this.t("confirm_delete_tag",[this.options.name]);this.promptView=BH.Views.CreatePrompt(promptMessage);this.promptView.open();return this.promptView.model.on("change",this.promptAction,this)};TagView.prototype.promptAction=function(prompt){var tagName,_this=this;if(prompt.get("action")){tagName=this.model.get("name");this.model.destroy(function(){});this.promptView.close();this.tracker.tagRemoved();if(user.isLoggedIn()){persistence.remote().deleteTag(tagName)}return router.navigate("#tags",{trigger:true})}else{return this.promptView.close()}};TagView.prototype.getI18nValues=function(){var name,properties;name=this.options.name.charAt(0).toUpperCase()+this.options.name.slice(1);properties=this.t(["delete_tag","search_input_placeholder_text","rename_tag_link","share_tag_link","read_only_explanation_link"]);properties["i18n_tag_title"]=this.t("tag_title",[name]);properties["i18n_back_to_tags_link"]=this.t("back_to_tags_link",[this.t("back_arrow")]);return properties};return TagView}(BH.Views.MainView)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Views.TaggedSitesView=function(_super){__extends(TaggedSitesView,_super);function TaggedSitesView(){return TaggedSitesView.__super__.constructor.apply(this,arguments)}TaggedSitesView.include(BH.Modules.I18n);TaggedSitesView.prototype.className="tagged_sites";TaggedSitesView.prototype.template=BH.Templates["tagged_sites"];TaggedSitesView.prototype.events={"click .delete":"deleteClicked"};TaggedSitesView.prototype.initialize=function(){return this.chromeAPI=chrome};TaggedSitesView.prototype.render=function(){var html,presenter,properties;presenter=new BH.Presenters.TagPresenter(this.model);properties=_.extend(presenter.sites(),this.getI18nValues(),tagState.toJSON());html=Mustache.to_html(this.template,properties);this.$el.html(html);return this};TaggedSitesView.prototype.insertTags=function(){var currentTag;currentTag=this.model.get("name");return persistence.tag().cached(function(operations){return $(".site").each(function(){var $el,activeTagsView,tags;$el=$(this);tags=operations.siteTags($el.attr("href"));if(tags.length>0){activeTagsView=new BH.Views.ActiveTagsView({model:new BH.Models.Site({tags:_.without(tags,currentTag)}),editable:false});return $el.find(".active_tags").html(activeTagsView.render().el)}})})};TaggedSitesView.prototype.attachDragging=function(){var dragAndTagView;dragAndTagView=new BH.Views.DragAndTagView({model:this.model,excludeTag:true});dragAndTagView.render();return dragAndTagView.on("site:change",function(site){var $el,activeTagsView;$el=$(".visit[data-url='"+site.url+"']");if(site.tags.indexOf(this.model.get("name"))===-1){return $el.remove()}else{site.tags=_.without(site.tags,this.model.get("name"));activeTagsView=new BH.Views.ActiveTagsView({model:new BH.Models.Site(site),editable:false});return $el.find(".active_tags").html(activeTagsView.render().el)}})};TaggedSitesView.prototype.deleteClicked=function(ev){var $el;ev.preventDefault();$el=$(ev.currentTarget);this.model.removeSite($el.attr("href"));this.model.unset("url");return $el.parents(".visit").remove()};TaggedSitesView.prototype.getI18nValues=function(){return this.t(["no_tagged_sites_found"])};return TaggedSitesView}(BH.Views.MainView)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Views.DragAndTagView=function(_super){__extends(DragAndTagView,_super);function DragAndTagView(){return DragAndTagView.__super__.constructor.apply(this,arguments)}DragAndTagView.include(BH.Modules.I18n);DragAndTagView.prototype.initialize=function(){this.tracker=analyticsTracker;this.chromeAPI=chrome;return this.excludeTag=this.options.excludeTag};DragAndTagView.prototype.render=function(){var handleDragEnd,handleDragStart,_this=this;handleDragStart=function(ev){var $el,availableTagsView,collection,data,summaryEl;ev.stopPropagation();$el=$(ev.currentTarget);$el.addClass("dragging");$(".navigation").addClass("dropzone");data={sites:[]};if($el.find("ol.visits").length>0){$el.find("ol.visits .visit").each(function(){return data.sites.push({url:$(this).data("url"),title:$(this).data("title"),datetime:(new Date).getTime()})})}else{data.sites.push({url:$el.data("url"),title:$el.data("title"),datetime:(new Date).getTime(),partOfGroup:$el.parents(".grouped_sites").length>0?true:void 0})}_this.tracker.siteTagDrag();if(!(summaryEl=document.getElementsByClassName("drag_ghost")[0])){summaryEl=document.createElement("div");summaryEl.className="drag_ghost";$("body").append(summaryEl)}summaryEl.innerHTML=_this.t("number_of_visits",[data.sites.length]);ev.dataTransfer.setDragImage(summaryEl,-15,-10);ev.dataTransfer.setData("application/json",JSON.stringify(data));collection=new BH.Collections.Tags([]);availableTagsView=new BH.Views.AvailableTagsView({collection:collection,draggedSites:data.sites,el:".available_tags"});availableTagsView.on("site:untagged site:tagged",function(site){var $visit;if($el.find("ol.visits").length>0){$visit=$el.find("[data-url='"+site.url+"']")}return _this.trigger("site:change",site,$visit||$el)});availableTagsView.on("sites:untagged sites:tagged",function(site){var $visit;if($el.parents(".grouped_sites").length>0){$visit=$el.parents(".grouped_sites")}return _this.trigger("sites:change",site,$visit||$el)});return collection.fetch()};handleDragEnd=function(ev){var $el;$el=$(ev.currentTarget);$el.removeClass("dragging");return $(".navigation").removeClass("dropzone")};return $(".visit").each(function(i,visit){visit.addEventListener("dragstart",handleDragStart,false);return visit.addEventListener("dragend",handleDragEnd,false)})};return DragAndTagView}(Backbone.View)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Views.ActiveTagsView=function(_super){__extends(ActiveTagsView,_super);function ActiveTagsView(){return ActiveTagsView.__super__.constructor.apply(this,arguments)}ActiveTagsView.include(BH.Modules.I18n);ActiveTagsView.prototype.template=BH.Templates["active_tags"];ActiveTagsView.prototype.className="active_tags_view";ActiveTagsView.prototype.events={"click .delete":"deleteTagClicked","click .tag":"tagClicked"};ActiveTagsView.prototype.initialize=function(){this.chromeAPI=chrome;this.tracker=this.options.tracker;this.editable=this.options.editable||false;return this.inBrowserAction=this.options.inBrowserAction||false};ActiveTagsView.prototype.render=function(){var html,properties;properties={tags:this.model.tags(),editable:this.editable};html=Mustache.to_html(this.template,properties);this.$el.html(html);return this};ActiveTagsView.prototype.deleteTagClicked=function(ev){var tag;ev.preventDefault();tag=$(ev.currentTarget).data("tag");this.model.removeTag(tag);return this.tracker.siteUntagged()};ActiveTagsView.prototype.tagClicked=function(ev){var tag;if(this.inBrowserAction!=null){ev.preventDefault();tag=$(ev.currentTarget).data("tag");return this.chromeAPI.tabs.create({url:"chrome://history#tags/"+tag})}};return ActiveTagsView}(BH.Views.MainView)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Views.AvailableTagsView=function(_super){__extends(AvailableTagsView,_super);function AvailableTagsView(){return AvailableTagsView.__super__.constructor.apply(this,arguments)}AvailableTagsView.include(BH.Modules.I18n);AvailableTagsView.prototype.template=BH.Templates["available_tags"];AvailableTagsView.prototype.initialize=function(){this.tracker=analyticsTracker;this.draggedSites=this.options.draggedSites;return this.collection.on("reset",this.render,this)};AvailableTagsView.prototype.render=function(){var html,presenter,tags,_this=this;presenter=new BH.Presenters.TagsPresenter(this.collection);tags=presenter.selectedAndUnselectedTagsforSites(this.draggedSites);html=Mustache.to_html(this.template,{tags:tags});this.$el.html(html);$(".available_tags li").each(function(i,tag){tag.addEventListener("dragenter",function(ev){return $(ev.currentTarget).addClass("over")},false);tag.addEventListener("dragleave",function(ev){return $(ev.currentTarget).removeClass("over")},false);tag.addEventListener("dragover",function(ev){ev.preventDefault();return ev.dataTransfer.effect="move"},false);return tag.addEventListener("drop",function(ev){var $el,collection,draggedData;
$el=$(ev.currentTarget);ev.stopPropagation();_this.tracker.siteTagDrop();draggedData=ev.dataTransfer.getData("application/json");collection=_this.inflateDraggedData(draggedData);collection.fetch();collection.on("reset:allTags",function(){var tagName;if($el.hasClass("new_tag")){_this.renderNewTagView(collection)}else{tagName=$el.data("tag")}if($el.hasClass("tagged")){return _this.untagSites(tagName,collection)}else{return _this.tagSites(tagName,collection)}});return false},false)});return this};AvailableTagsView.prototype.renderNewTagView=function(collection){var newTagModal,_this=this;newTagModal=new BH.Modals.NewTagModal({model:new BH.Models.Tag,tracker:this.tracker});$("body").append(newTagModal.render().el);newTagModal.open();$(".new_tag").focus();return newTagModal.model.on("change:name",function(){return _this.tagSites(newTagModal.model.get("name"),collection)})};AvailableTagsView.prototype.untagSites=function(tag,collection){var _this=this;return collection.removeTag(tag,function(){var site,_i,_len,_ref;_ref=collection.toJSON();for(_i=0,_len=_ref.length;_i<_len;_i++){site=_ref[_i];_this.tracker.siteUntagged();_this.trigger("site:untagged",site)}if(collection.length>1||collection.at(0).get("partOfGroup")){return _this.trigger("sites:untagged",{domain:collection.at(0).get("url").match(/\w+:\/\/(.*?)\//)[0],tags:_.intersection.apply(_,collection.pluck("tags"))})}})};AvailableTagsView.prototype.tagSites=function(tag,collection){var _this=this;return collection.addTag(tag,function(result,operations){var site,_i,_len,_ref;_ref=collection.toJSON();for(_i=0,_len=_ref.length;_i<_len;_i++){site=_ref[_i];_this.tracker.siteTagged();_this.trigger("site:tagged",site)}if(collection.length>1||collection.at(0).get("partOfGroup")){_this.trigger("sites:tagged",{domain:collection.at(0).get("url").match(/\w+:\/\/(.*?)\//)[0],tags:_.intersection.apply(_,collection.pluck("tags"))})}if(operations.tagCreated){return _this.tracker.tagAdded()}})};AvailableTagsView.prototype.inflateDraggedData=function(data){var sites;sites=JSON.parse(data).sites;return new BH.Collections.Sites(sites,{chrome:chrome})};return AvailableTagsView}(Backbone.View)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Models.History=function(_super){__extends(History,_super);function History(){return History.__super__.constructor.apply(this,arguments)}History.prototype.defaults={history:[]};History.prototype.isNew=function(){return false};History.prototype.isEmpty=function(){return this.get("history").length===0};return History}(Backbone.Model)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Models.History=function(_super){__extends(History,_super);function History(){return History.__super__.constructor.apply(this,arguments)}History.prototype.defaults={history:[]};History.prototype.isNew=function(){return false};History.prototype.isEmpty=function(){return this.get("history").length===0};return History}(Backbone.Model)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Models.Prompt=function(_super){__extends(Prompt,_super);function Prompt(){return Prompt.__super__.constructor.apply(this,arguments)}return Prompt}(Backbone.Model)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Models.Search=function(_super){__extends(Search,_super);function Search(){return Search.__super__.constructor.apply(this,arguments)}Search.prototype.defaults=function(){return{query:""}};Search.prototype.validQuery=function(){return this.get("query")!==""};Search.prototype.parseAndSet=function(data){var visit,visits,_i,_len;visits=new BH.Collections.Visits;for(_i=0,_len=data.length;_i<_len;_i++){visit=data[_i];visits.add(new BH.Models.Visit(visit))}return this.set({history:visits})};return Search}(Backbone.Model)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Models.Settings=function(_super){__extends(Settings,_super);function Settings(){return Settings.__super__.constructor.apply(this,arguments)}Settings.prototype.storeName="settings";Settings.prototype.defaults=function(){return{timeGrouping:15,domainGrouping:true,searchByDomain:true,searchBySelection:true,openLocation:"last_visit",startingWeekDay:"Monday",weekDayOrder:"ascending"}};return Settings}(Backbone.Model)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Models.State=function(_super){__extends(State,_super);function State(){return State.__super__.constructor.apply(this,arguments)}State.include(BH.Modules.I18n);State.include(BH.Modules.Url);State.prototype.storeName="state";State.prototype.initialize=function(attrs,options){var weekId;this.chromeAPI=chrome;this.settings=options.settings;if(typeof moment!=="undefined"&&moment!==null){weekId=this.startingWeekDate().id();return this.set({route:this.urlFor("week",weekId)})}};State.prototype.updateRoute=function(){var route,weekId;if(this.settings.get("openLocation")==="current_day"){route=this.urlFor("day",moment(new Date).id())}else if(this.settings.get("openLocation")==="current_week"){weekId=this.startingWeekDate().id();route=this.urlFor("week",weekId)}if(route!=null){this.set({route:route})}return this.save()};State.prototype.startingWeekDate=function(){return moment(new Date).past(this.settings.get("startingWeekDay"),0)};return State}(Backbone.Model)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Models.Tag=function(_super){__extends(Tag,_super);function Tag(){return Tag.__super__.constructor.apply(this,arguments)}Tag.prototype.initialize=function(){return this.on("sync",this.sync)};Tag.prototype.validate=function(attrs,options){var name;name=attrs.name.replace(/^\s\s*/,"").replace(/\s\s*$/,"");if(name.length===0){return"tag is empty"}if(name.match(/[\"\'\~\,\.\|\(\)\{\}\[\]\;\:\<\>\^\*\%\^]/)){return"tag contains special characters"}};Tag.prototype.fetch=function(callback){var _this=this;if(callback==null){callback=function(){}}return persistence.tag().fetchTagSites(this.get("name"),function(sites){return persistence.tag().fetchSharedTag(_this.get("name"),function(url){_this.set({sites:sites,url:url});return callback()})})};Tag.prototype.destroy=function(callback){var _this=this;if(callback==null){callback=function(){}}return persistence.tag().removeTag(this.get("name"),function(){_this.trigger("sync",{operation:"destroy"});_this.set({sites:[]});chrome.runtime.sendMessage({action:"calculate hash"});return callback()})};Tag.prototype.removeSite=function(url,callback){var _this=this;if(callback==null){callback=function(){}}return persistence.tag().removeSiteFromTag(url,this.get("name"),function(sites){_this.trigger("sync",{operation:"modify",site:_.where(_this.get("sites"),{url:url})[0]});_this.set({sites:sites});chrome.runtime.sendMessage({action:"calculate hash"});return callback()})};Tag.prototype.renameTag=function(name,callback){var _this=this;if(callback==null){callback=function(){}}return persistence.tag().renameTag(this.get("name"),name,function(){_this.trigger("sync",{operation:"rename",newName:name,oldName:_this.get("name")});_this.set({name:name});chrome.runtime.sendMessage({action:"calculate hash"});return callback()})};Tag.prototype.share=function(callbacks){var index,json,_this=this;index=1;json=this.toJSON();return _.each(json.sites,function(site,i){return BH.Lib.ImageData.base64("chrome://favicon/"+site.url,function(data){json.sites[i].image=data;if(index!==json.sites.length){return index++}else{return persistence.remote().share(json,{success:function(data){persistence.tag().shareTag(_this.get("name"),data.url);return callbacks.success(data)},error:function(){return callbacks.error()}})}})})};Tag.prototype.sync=function(options){var site;if(user.isLoggedIn()){switch(options.operation){case"destroy":return persistence.remote().deleteTag(this.get("name"));case"rename":return persistence.remote().renameTag(options.oldName,options.newName);case"modify":site=options.site;return persistence.tag().fetchSiteTags(site.url,function(tags){site.tags=tags;return persistence.remote().updateSite(site)})}}};return Tag}(Backbone.Model)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Models.Site=function(_super){__extends(Site,_super);function Site(){return Site.__super__.constructor.apply(this,arguments)}Site.prototype.fetch=function(callback){var _this=this;if(callback==null){callback=function(){}}return persistence.tag().fetchSiteTags(this.get("url"),function(tags){_this.set({tags:tags});_this.trigger("reset:tags");return callback()})};Site.prototype.tags=function(){return this.get("tags")};Site.prototype.addTag=function(tag,callback){var newTags,site,_this=this;if(callback==null){callback=function(){}}tag=tag.replace(/^\s\s*/,"").replace(/\s\s*$/,"");if(tag.length===0||tag.match(/[\"\'\~\,\.\|\(\)\{\}\[\]\;\:\<\>\^\*\%\^]/)||this.get("tags").indexOf(tag)!==-1){callback(false,null);return}newTags=_.clone(this.get("tags"));newTags.push(tag);this.set({tags:newTags,datetime:(new Date).getTime()});site={url:this.get("url"),title:this.get("title"),datetime:this.get("datetime")};return persistence.tag().addSiteToTag(site,tag,function(operations){chrome.runtime.sendMessage({action:"calculate hash"});_this.sync();return callback(true,operations)})};Site.prototype.sync=function(){var _this=this;if(user.isLoggedIn()){return BH.Lib.ImageData.base64("chrome://favicon/"+this.get("url"),function(data){return persistence.remote().updateSite({url:_this.get("url"),title:_this.get("title"),datetime:_this.get("datetime"),tags:_this.get("tags"),image:data})})}};Site.prototype.removeTag=function(tag){var newTags,_this=this;if(this.get("tags").indexOf(tag)===-1){return false}newTags=_.clone(this.get("tags"));this.set({tags:_.without(newTags,tag),datetime:(new Date).getTime()});return persistence.tag().removeSiteFromTag(this.get("url"),tag,function(){chrome.runtime.sendMessage({action:"calculate hash"});return _this.sync()})};return Site}(Backbone.Model)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Models.User=function(_super){__extends(User,_super);function User(){return User.__super__.constructor.apply(this,arguments)}User.prototype.storeName="user";User.prototype.initialize=function(){this.chromeAPI=chrome;return this.loggedIn=false};User.prototype.fetch=function(){var _this=this;return this.chromeAPI.storage.sync.get("user",function(data){var _ref;if(((_ref=data.user)!=null?_ref.authId:void 0)!=null){return _this.login(data.user)}})};User.prototype.save=function(){return this.chromeAPI.storage.sync.set({user:this.toJSON()})};User.prototype.login=function(data){this.set(data);this.save();this.trigger("login");return this.loggedIn=true};User.prototype.logout=function(){this.clear({silent:true});this.save();this.trigger("logout");return this.loggedIn=false};User.prototype.isLoggedIn=function(){return this.loggedIn};return User}(Backbone.Model)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Collections.Weeks=function(_super){__extends(Weeks,_super);function Weeks(){return Weeks.__super__.constructor.apply(this,arguments)}Weeks.prototype.reload=function(startingDay){var date,i,_i,_len,_ref;this.reset();_ref=_.range(10);for(_i=0,_len=_ref.length;_i<_len;_i++){i=_ref[_i];date=moment(new Date).past(startingDay,i);this.add({id:date.format("M-D-YY"),date:date})}return this.trigger("reloaded")};return Weeks}(Backbone.Collection)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Collections.Tags=function(_super){__extends(Tags,_super);function Tags(){return Tags.__super__.constructor.apply(this,arguments)}Tags.prototype.model=BH.Models.Tag;Tags.prototype.initialize=function(){if(user.isLoggedIn()){return this.on("sync",this.sync)}};Tags.prototype.fetch=function(callback){var _this=this;if(callback==null){callback=function(){}}return persistence.tag().fetchTags(function(tags,compiledTags){_this.tagOrder=tags;_this.reset(compiledTags);return callback()})};Tags.prototype.destroy=function(callback){var _this=this;if(callback==null){callback=function(){}}return persistence.tag().removeAllTags(function(){chrome.runtime.sendMessage({action:"calculate hash"});callback();return _this.trigger("sync",{operation:"destroy"})})};Tags.prototype.sync=function(options){switch(options.operations){case"destroy":return persistence.remote().deleteSites()}};return Tags}(Backbone.Collection)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Collections.Sites=function(_super){__extends(Sites,_super);function Sites(){return Sites.__super__.constructor.apply(this,arguments)}Sites.prototype.model=BH.Models.Site;Sites.prototype.fetch=function(){var callback,index,_this=this;index=1;callback=function(){if(index===_this.length){return _this.trigger("reset:allTags")}else{return index++}};return this.each(function(model){return model.fetch(callback)})};Sites.prototype.sharedTags=function(){return _.intersection.apply(this,this.pluck("tags"))};Sites.prototype.tags=function(){return this.sharedTags()};Sites.prototype.addTag=function(tag,callback){var sites,_this=this;if(callback==null){callback=function(){}}tag=tag.replace(/^\s\s*/,"").replace(/\s\s*$/,"");if(tag.length===0||tag.match(/[\"\'\~\,\.\|\(\)\{\}\[\]\;\:\<\>\^\*\%\^]/)){callback(false,null);return}sites=[];this.each(function(model){var newTags;if(model.get("tags").indexOf(tag)===-1){newTags=_.clone(model.get("tags"));newTags.push(tag);model.set({tags:newTags});return sites.push({url:model.get("url"),title:model.get("title"),datetime:model.get("datetime")||(new Date).getTime()})}});return persistence.tag().addSitesToTag(sites,tag,function(operations){var translator;if(user.isLoggedIn()){translator=new BH.Lib.SyncingTranslator;translator.addImageToSites(_this.toJSON(),function(compiledSites){return persistence.remote().updateSites(compiledSites)})}chrome.runtime.sendMessage({action:"calculate hash"});_this.trigger("change:allTags");return callback(true,operations)})};Sites.prototype.removeTag=function(tag,callback){var sites,_this=this;if(callback==null){callback=function(){}}tag=tag.replace(/^\s\s*/,"").replace(/\s\s*$/,"");if(tag.length===0){return false}sites=[];this.each(function(model){var newTags;if(model.get("tags").indexOf(tag)!==-1){newTags=_.clone(model.get("tags"));model.set({tags:_.without(newTags,tag)});return sites.push(model.get("url"))}});return persistence.tag().removeSitesFromTag(sites,tag,function(){var translator;if(user.isLoggedIn()){translator=new BH.Lib.SyncingTranslator;translator.addImageToSites(_this.toJSON(),function(compiledSites){return persistence.remote().updateSites(compiledSites)})}chrome.runtime.sendMessage({action:"calculate hash"});_this.trigger("change:allTags");return callback()})};return Sites}(Backbone.Collection)}.call(this);!function(){BH.Presenters.Base=function(){function Base(){}Base.prototype.chromeAPI=chrome;Base.prototype.t=function(key,replacements){var keys,lookup,_i,_len;if(replacements==null){replacements=[]}if(key instanceof Array){keys=key;lookup={};for(_i=0,_len=keys.length;_i<_len;_i++){key=keys[_i];lookup["i18n_"+key]=this.chromeAPI.i18n.getMessage(key.toString())}return lookup}else{return this.chromeAPI.i18n.getMessage(key,replacements)}};return Base}()}.call(this);!function(){BH.Presenters.TagPresenter=function(){function TagPresenter(model){this.model=model}TagPresenter.prototype.sites=function(){var sites;sites=this.model.get("sites").sort(function(a,b){return b.datetime-a.datetime});return{sites:sites}};return TagPresenter}()}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Views.DayResultsView=function(_super){__extends(DayResultsView,_super);function DayResultsView(){return DayResultsView.__super__.constructor.apply(this,arguments)}DayResultsView.include(BH.Modules.I18n);DayResultsView.prototype.template=BH.Templates["day_results"];DayResultsView.prototype.events={"click .delete_visit":"deleteVisitClicked","click .delete_grouped_visit":"deleteGroupedVisitClicked","click .delete_interval":"deleteIntervalClicked","click .show_visits":"toggleGroupedVisitsClicked","click .hide_visits":"toggleGroupedVisitsClicked","click .visit > a":"visitClicked"};DayResultsView.prototype.initialize=function(){return this.chromeAPI=chrome};DayResultsView.prototype.render=function(){var html,presenter,properties;presenter=new BH.Presenters.DayHistoryPresenter(this.collection.toJSON());properties=_.extend(this.getI18nValues(),{history:presenter.history(),readOnly:state.get("readOnly")});html=Mustache.to_html(this.template,properties);this.$el.html(html);return this};DayResultsView.prototype.insertTags=function(){return persistence.tag().cached(function(operations){var _this=this;$(".site").each(function(){var $el,activeTagsView,tags;$el=$(this);tags=operations.siteTags($el.attr("href"));if(tags.length>0){activeTagsView=new BH.Views.ActiveTagsView({model:new BH.Models.Site({tags:tags}),editable:false});return $el.find(".active_tags").html(activeTagsView.render().el)}});return $(".grouped_sites").each(function(i,siteEl){var $el,activeTagsView,sharedTags,urls;$el=$(siteEl);urls=[];$el.find("a.site").each(function(){return urls.push($(this).attr("href"))});sharedTags=operations.sitesTags(urls);activeTagsView=new BH.Views.ActiveTagsView({model:new BH.Models.Site({tags:sharedTags}),editable:false});return $el.find(".active_tags").eq(0).html(activeTagsView.render().el)})})};DayResultsView.prototype.attachDragging=function(){var dragAndTagView;dragAndTagView=new BH.Views.DragAndTagView({collection:this.collection});dragAndTagView.render();dragAndTagView.on("site:change",function(site,$el){var activeTagsView;activeTagsView=new BH.Views.ActiveTagsView({model:new BH.Models.Site(site),editable:false});return $el.find(".active_tags").html(activeTagsView.render().el)});return dragAndTagView.on("sites:change",function(site,$el){var $activeTags,activeTagsView;activeTagsView=new BH.Views.ActiveTagsView({model:new BH.Models.Site(site),editable:false});$activeTags=$el.children(".sites").find(".active_tags");return $activeTags.html(activeTagsView.render().el)})};DayResultsView.prototype.visitClicked=function(ev){if($(ev.target).hasClass("search_domain")){ev.preventDefault();return router.navigate($(ev.target).attr("href"),{trigger:true})}};DayResultsView.prototype.deleteVisitClicked=function(ev){var $el;ev.preventDefault();$el=$(ev.currentTarget);analyticsTracker.visitDeletion();return(new BH.Chrome.History).deleteUrl($el.data("url"),function(){return $el.parent(".visit").remove()})};DayResultsView.prototype.deleteGroupedVisitClicked=function(ev){ev.preventDefault();ev.stopPropagation();analyticsTracker.groupedVisitsDeletion();$(ev.currentTarget).siblings(".visits").children().each(function(i,visit){return $(visit).find(".delete_visit").trigger("click")});return $(ev.currentTarget).parents(".visit").remove()};DayResultsView.prototype.deleteIntervalClicked=function(ev){var visitElements;ev.preventDefault();analyticsTracker.timeIntervalDeletion();visitElements=$(ev.currentTarget).parents(".interval").children(".visits").children();return $(visitElements).each(function(i,visit){return setTimeout(function(){return $(visit).children(".delete").trigger("click")},i*10)})};DayResultsView.prototype.toggleGroupedVisitsClicked=function(ev){ev.preventDefault();return $(ev.currentTarget).parents(".visit").toggleClass("expanded")};DayResultsView.prototype.getI18nValues=function(){return this.t(["prompt_delete_button","delete_time_interval_button","no_visits_found","expand_button","collapse_button","search_by_domain"])};return DayResultsView}(Backbone.View)}.call(this);!function(){BH.Presenters.TagsPresenter=function(){function TagsPresenter(collection){this.collection=collection}TagsPresenter.prototype.tagsSummary=function(){var model,orderedSites,out,tag,_i,_len,_ref;out=[];_ref=this.collection.tagOrder;for(_i=0,_len=_ref.length;_i<_len;_i++){tag=_ref[_i];model=this.collection.findWhere({name:tag});if(model!=null){orderedSites=model.get("sites").sort(function(a,b){return b.datetime-a.datetime});out.push({name:model.get("name"),count:model.get("sites").length,sites:orderedSites.slice(0,10)})}}return out};TagsPresenter.prototype.selectedAndUnselectedTagsforSites=function(sites){var commonTags,model,result,site,tag,_i,_j,_k,_len,_len1,_len2,_ref,_ref1,_results;_ref=this.collection.tagOrder;for(_i=0,_len=_ref.length;_i<_len;_i++){tag=_ref[_i];model=this.collection.findWhere({name:tag});for(_j=0,_len1=sites.length;_j<_len1;_j++){site=sites[_j];result=_.find(model.get("sites"),function(taggedSite){return taggedSite.url===site.url});if(result!=null){if(!site.tags){site.tags=[]}site.tags.push(model.get("name"))}}}commonTags=_.intersection.apply(_,_.pluck(sites,"tags"));_ref1=this.collection.tagOrder;_results=[];for(_k=0,_len2=_ref1.length;_k<_len2;_k++){tag=_ref1[_k];model=this.collection.findWhere({name:tag});_results.push({name:model.get("name"),tagged:commonTags.indexOf(model.get("name"))!==-1})}return _results};return TagsPresenter}()}.call(this);!function(){BH.Presenters.SitesPresenter=function(){function SitesPresenter(collection){this.collection=collection}SitesPresenter.prototype.sitesWithSharedTags=function(){return{sites:this.collection.toJSON()}};return SitesPresenter}()}.call(this);!function(){var startingWeekDate;BH.Presenters.DayPresenter=function(){function DayPresenter(day){this.day=day}DayPresenter.prototype.dayInfo=function(){var date,properties,weekId;date=moment(this.day.date);weekId=startingWeekDate(date).id();properties={title:date.format("dddd"),formalDate:date.format("LLL"),weekUrl:"#weeks/"+weekId};return _.extend(properties,this.day)};return DayPresenter}();startingWeekDate=function(date){return moment(date).past(settings.get("startingWeekDay"),0)}}.call(this);!function(){var inflateDays,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Presenters.WeekPresenter=function(_super){__extends(WeekPresenter,_super);function WeekPresenter(week){this.week=week}WeekPresenter.prototype.inflatedWeek=function(){var copy,day,days,out;copy={shortTitle:moment(this.week.date).format("L"),url:"#weeks/"+this.week.id,title:this.t("date_week_label",[moment(this.week.date).format("LL")])};days=function(){var _i,_len,_ref,_results;_ref=inflateDays(this.week.date);_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){day=_ref[_i];_results.push(out={day:moment(day.id()).lang("en").format("dddd"),title:day.format("dddd"),inFuture:moment()<day,url:"#days/"+day.id()})}return _results}.call(this);return _.extend(copy,this.week,{days:days})};return WeekPresenter}(BH.Presenters.Base);inflateDays=function(date){var days,i;days=function(){var _i,_results;_results=[];for(i=_i=0;_i<=6;i=++_i){_results.push(moment(new Date(date)).add("days",i))}return _results}();if(settings.get("weekDayOrder")==="descending"){days.reverse()}return days}}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Presenters.WeeksPresenter=function(_super){__extends(WeeksPresenter,_super);function WeeksPresenter(collection){this.collection=collection}WeeksPresenter.prototype.weeks=function(){var model,out,weeks;weeks=function(){var _i,_len,_ref,_results;_ref=this.collection.models;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){model=_ref[_i];_results.push(out={id:model.id,url:"#weeks/"+model.id,shortTitle:model.get("date").format("L")})}return _results}.call(this);return{weeks:weeks}};return WeeksPresenter}(BH.Presenters.Base)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Presenters.SearchPresenter=function(_super){__extends(SearchPresenter,_super);function SearchPresenter(search){this.search=search}SearchPresenter.prototype.searchInfo=function(){var i,joined,term,_i,_len,_ref;this.terms=[];if(this.search.query!=null){this.terms=this.search.query.split(" ")}joined=this.t("searching_title")+" ";_ref=this.terms;for(i=_i=0,_len=_ref.length;_i<_len;i=++_i){term=_ref[i];joined+='"'+term+'"';if(i!==this.terms.length-1){joined+=" "+this.t("and")+" "}}return _.extend(this.search,{title:joined})};return SearchPresenter}(BH.Presenters.Base)}.call(this);!function(){var visitData,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Presenters.DayHistoryPresenter=function(_super){__extends(DayHistoryPresenter,_super);function DayHistoryPresenter(intervals){this.intervals=intervals}DayHistoryPresenter.prototype.history=function(){var groupedVisit,groupedVisits,interval,out,preppedInterval,visit,_i,_j,_len,_len1,_ref,_ref1;out=[];_ref=this.intervals;for(_i=0,_len=_ref.length;_i<_len;_i++){interval=_ref[_i];preppedInterval={amount:this.t("number_of_visits",[interval.visits.length.toString(),'<span class="amount">',"</span>"]),time:moment(interval.datetime).format("LT"),id:interval.id,visits:[]};_ref1=interval.visits;for(_j=0,_len1=_ref1.length;_j<_len1;_j++){visit=_ref1[_j];if(visit.isGrouped){groupedVisits=function(){var _k,_len2,_ref2,_results;_ref2=visit.visits;_results=[];for(_k=0,_len2=_ref2.length;_k<_len2;_k++){groupedVisit=_ref2[_k];_results.push(visitData(groupedVisit))}return _results}();preppedInterval.visits.push(_.extend(visit,{groupedVisits:groupedVisits}))}else{preppedInterval.visits.push(visitData(visit))}}out.push(preppedInterval)}return out};return DayHistoryPresenter}(BH.Presenters.Base);visitData=function(visit){return _.extend(visit,{isGrouped:false})}}.call(this);!function(){var wrapMatchInProperty,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Presenters.SearchHistoryPresenter=function(_super){__extends(SearchHistoryPresenter,_super);function SearchHistoryPresenter(visits,query){this.visits=visits;this.query=query}SearchHistoryPresenter.prototype.history=function(start,end){var i,out,_i;out=[];if(start!=null&&end!=null){for(i=_i=start;start<=end?_i<end:_i>end;i=start<=end?++_i:--_i){if(this.visits[i]!=null){out.push(this.markMatches(this.visits[i]))}}}return out};SearchHistoryPresenter.prototype.markMatches=function(visit){var regExp,term,_i,_len,_ref;_ref=this.query.split(" ");for(_i=0,_len=_ref.length;_i<_len;_i++){term=_ref[_i];regExp=new RegExp(term,"i");visit.name=wrapMatchInProperty(regExp,visit.name);visit.location=wrapMatchInProperty(regExp,visit.location);visit.time=wrapMatchInProperty(regExp,visit.time);visit.extendedDate=wrapMatchInProperty(regExp,visit.extendedDate)}return visit};return SearchHistoryPresenter}(BH.Presenters.Base);wrapMatchInProperty=function(regExp,property){var match;if(!property){return}match=property.match(regExp);if(match){return property.replace(regExp,'<span class="match">'+match+"</span>")}else{return property}}}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Presenters.WeekHistoryPresenter=function(_super){__extends(WeekHistoryPresenter,_super);function WeekHistoryPresenter(days){this.days=days}WeekHistoryPresenter.prototype.history=function(){var day,dayVisitPercentage,out,_this=this;dayVisitPercentage=function(day){var largest;largest=Math.max.apply(Math,_this.dayVisits())||0;if(largest===0){return 0}return day.visits.length/largest*100};return{total:this.totalVisits(),days:function(){var _i,_len,_ref,_results;_ref=this.days;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){day=_ref[_i];_results.push(out={count:day.visits.length,day:day.name,percentage:""+dayVisitPercentage(day)+"%"})}return _results}.call(this)}};WeekHistoryPresenter.prototype.dayVisits=function(){var day,_i,_len,_ref,_results;_ref=this.days;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){day=_ref[_i];_results.push(day.visits.length)}return _results};WeekHistoryPresenter.prototype.totalVisits=function(){if(this.dayVisits().length===0){return 0
}return this.dayVisits().reduce(function(sum,num){return sum+num})};return WeekHistoryPresenter}(BH.Presenters.Base)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Presenters.SettingsPresenter=function(_super){__extends(SettingsPresenter,_super);function SettingsPresenter(model){this.model=model}SettingsPresenter.prototype.settings=function(){var properties,_this=this;properties={startingWeekDays:[],openLocations:[],timeGroupings:[],weekDayOrders:[],searchBySelection:this.model.get("searchBySelection"),searchByDomain:this.model.get("searchByDomain"),domainGrouping:this.model.get("domainGrouping")};_(["monday","tuesday","wednesday","thursday","friday","saturday","sunday"]).each(function(day){return properties.startingWeekDays.push({text:_this.t(day),value:day})});_(["last_visit","current_day","current_week"]).each(function(location){return properties.openLocations.push({text:_this.t(location),value:location})});_(["descending","ascending"]).each(function(order){return properties.weekDayOrders.push({text:_this.t(order),value:order})});_([15,30,60]).each(function(timeGrouping){return properties.timeGroupings.push({text:_this.t(""+timeGrouping+"_minutes_option"),value:timeGrouping})});return properties};return SettingsPresenter}(BH.Presenters.Base)}.call(this);!function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Presenters.AllWeeksPresenter=function(_super){__extends(AllWeeksPresenter,_super);function AllWeeksPresenter(collection){this.collection=collection}AllWeeksPresenter.prototype.allWeeks=function(){var model,out,weeks;weeks=function(){var _i,_len,_ref,_results;_ref=this.collection.models;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){model=_ref[_i];_results.push(out={shortTitle:moment(model.get("date")).format("L"),visitCount:model.get("visits").length,url:"#weeks/"+moment(model.get("date")).id()})}return _results}.call(this);return{weeks:weeks}};AllWeeksPresenter.prototype.totalVisits=function(){var model,out,_i,_len,_ref;out=0;_ref=this.collection.models;for(_i=0,_len=_ref.length;_i<_len;_i++){model=_ref[_i];out+=model.get("visits").length}return out};return AllWeeksPresenter}(BH.Presenters.Base)}.call(this);!function(){var delay,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};BH.Router=function(_super){__extends(Router,_super);function Router(){return Router.__super__.constructor.apply(this,arguments)}Router.prototype.routes={"":"reset",tags:"tags","tags/:id":"tag",weeks:"weeks","weeks/:id":"week","days/:id":"day",settings:"settings","search/*query(/p:page)":"search",search:"search",today:"today"};Router.prototype.initialize=function(options){var settings,tracker,_this=this;settings=options.settings;tracker=options.tracker;this.state=options.state;this.app=new BH.Views.AppView({el:$(".app"),collection:new BH.Collections.Weeks,settings:settings,state:this.state});this.app.render();this.on("route",function(route){tracker.pageView(Backbone.history.getFragment());window.scroll(0,0);if(settings.get("openLocation")==="last_visit"){return _this.state.set({route:location.hash})}});if(location.hash===""){return this.reset}};Router.prototype.reset=function(){return this.navigate(this.state.get("route"),{trigger:true})};Router.prototype.tags=function(){var view;view=this.app.loadTags();view.select();return delay(function(){return view.collection.fetch()})};Router.prototype.tag=function(id){var view;view=this.app.loadTag(id);view.select();return delay(function(){return view.model.fetch()})};Router.prototype.weeks=function(){var view;view=this.app.loadWeeks();view.select();return delay(function(){return(new BH.Lib.WeeksHistory).fetch(function(history){return view.collection.reset(history)})})};Router.prototype.week=function(id){var view;view=this.app.loadWeek(id);view.select();return delay(function(){return new BH.Lib.WeekHistory(new Date(id)).fetch(function(history){return view.collection.reset(history)})})};Router.prototype.day=function(id){var view;view=this.app.loadDay(id);view.select();return delay(function(){return new BH.Lib.DayHistory(new Date(id)).fetch(function(history){return view.collection.reset(history)})})};Router.prototype.today=function(){var view;view=this.app.loadDay(moment(new Date).id());view.select();return delay(function(){return new BH.Lib.DayHistory(new Date(id).fetch(function(history){return view.model.parseAndSet(history)}))})};Router.prototype.settings=function(){var view;view=this.app.loadSettings();return view.select()};Router.prototype.search=function(query,page){var view;if(query==null){query=""}view=this.app.loadSearch(query===""||page?{expired:true}:void 0);if(page!=null){view.page.set({page:parseInt(page,10)},{silent:true})}view.model.set({query:decodeURIComponent(query)});view.select();return delay(function(){if(query!==""){return new BH.Lib.SearchHistory(query).fetch(function(history,cacheDatetime){if(cacheDatetime==null){cacheDatetime=null}view.collection.reset(history);if(cacheDatetime!=null){return view.model.set({cacheDatetime:cacheDatetime})}else{return view.model.unset("cacheDatetime")}})}})};return Router}(Backbone.Router);delay=function(callback){return setTimeout(function(){return callback()},250)}}.call(this);!function(){BH.Init.TagFeature=function(){function TagFeature(options){this.syncStore=options.syncStore}TagFeature.prototype.announce=function(callback){if(callback==null){callback=function(){}}return this.syncStore.get("tagInstructionsDismissed",function(data){var tagInstructionsDismissed;tagInstructionsDismissed=data.tagInstructionsDismissed||false;if(!tagInstructionsDismissed){return callback()}})};TagFeature.prototype.prepopulate=function(callback){var _this=this;return this.syncStore.get("tagInstructionsDismissed",function(data){var tagInstructionsDismissed;tagInstructionsDismissed=data.tagInstructionsDismissed||false;return persistence.tag().fetchTags(function(tags){if(!tagInstructionsDismissed&&tags.length===0){return callback()}})})};return TagFeature}()}.call(this);!function(){BH.Init.MailingList=function(){function MailingList(options){this.syncStore=options.syncStore}MailingList.prototype.prompt=function(callback){var _this=this;return this.syncStore.get(["mailingListPromptTimer","mailingListPromptSeen"],function(data){var mailingListPromptSeen,mailingListPromptTimer;mailingListPromptTimer=data.mailingListPromptTimer||5;mailingListPromptSeen=data.mailingListPromptSeen;if(mailingListPromptSeen==null){if(mailingListPromptTimer===1){callback();_this.syncStore.remove("mailingListPromptTimer");return _this.syncStore.set({mailingListPromptSeen:true})}else{return _this.syncStore.set({mailingListPromptTimer:mailingListPromptTimer-1})}}})};return MailingList}()}.call(this);!function(){BH.Init.Persistence=function(){function Persistence(config){this.config=config!=null?config:{}}Persistence.prototype.tag=function(){if(this.config.localStore==null){throw"localStore requied"}return this.tagPersistence||(this.tagPersistence=new BH.Persistence.Tag({localStore:this.config.localStore}))};Persistence.prototype.remote=function(authId){if(this.config.ajax==null){throw"Ajax requied"}if(this.config.state==null){throw"State required"}authId=authId||(typeof user!=="undefined"&&user!==null?user.get("authId"):void 0);this.remotePersistence||(this.remotePersistence=new BH.Persistence.Remote(authId,this.config.ajax,this.config.state));if(authId!=null){this.remotePersistence.updateAuthId(authId)}return this.remotePersistence};return Persistence}()}.call(this);!function(){var load;window.apiHost="api.better-history.com";window.siteHost="www.better-history.com";window.env="prod";if(env==="prod"){window.errorTracker=new BH.Trackers.ErrorTracker(Honeybadger)}window.analyticsTracker=new BH.Trackers.AnalyticsTracker(_gaq);load=function(){var mailingList,tagFeature,_this=this;analyticsTracker.historyOpen();window.syncStore=new BH.Chrome.SyncStore({chrome:chrome,tracker:analyticsTracker});syncStore.get("authId",function(data){if(data==null){data={}}if(data.authId!=null){return $("body").addClass("logged_in")}});(new BH.Lib.DateI18n).configure();window.tagState=new Backbone.Model({readOnly:false,syncing:false});tagState.on("change:syncing",function(){if(tagState.get("syncing")===true){return $("body").addClass("syncing")}else{return $("body").removeClass("syncing")}});window.user=new BH.Models.User({});window.user.fetch();window.user.on("change",function(){if(this.get("authId")){return this.trigger("login")}});window.user.on("logout",function(){var googleUserInfo;googleUserInfo=new BH.Lib.GoogleUserInfo;return googleUserInfo.revoke()});window.user.on("login",function(){var syncer;syncer=new BH.Lib.Syncer;return syncer.updateIfNeeded(function(){return tagState.trigger("synced")})});window.settings=new BH.Models.Settings({});window.state=new BH.Models.State({},{settings:settings});window.persistence=new BH.Init.Persistence({localStore:new BH.Chrome.LocalStore({chrome:chrome,tracker:analyticsTracker}),syncStore:new BH.Chrome.SyncStore({chrome:chrome,tracker:analyticsTracker}),ajax:$.ajax,state:state});settings.fetch({success:function(){return state.fetch({success:function(){state.updateRoute();window.router=new BH.Router({settings:settings,state:state,tracker:analyticsTracker});return Backbone.history.start()}})}});mailingList=new BH.Init.MailingList({syncStore:syncStore});mailingList.prompt(function(){(new BH.Modals.MailingListModal).open();return analyticsTracker.mailingListPrompt()});tagFeature=new BH.Init.TagFeature({syncStore:syncStore});return tagFeature.announce(function(){return $("body").addClass("new_tags")})};if(env==="prod"){try{load()}catch(e){errorTracker.report(e)}}else{load()}}.call(this);