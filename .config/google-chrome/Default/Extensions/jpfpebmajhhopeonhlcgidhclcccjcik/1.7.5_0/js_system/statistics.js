var numRequestsOutstanding=0;var trends={historyItems:0,byUrl:{},byDomain:{},topUrls:{}};var sortByCount=function(d,c){return c.count-d.count};function getHistory(){chrome.history.search({text:"",maxResults:10000,startTime:0},function(d){for(var c=0;c<d.length;++c){var b=d[c].url;if(b.indexOf("http")==-1){continue}var e=getHostname(b);var a=function(f,g){return function(h){processVisits(f,g,h)}};chrome.history.getVisits({url:b},a(b,e));numRequestsOutstanding++}if(!numRequestsOutstanding){onAllVisitsProcessed()}})}var processVisits=function(a,c,d){for(var b=0,e=d.length;b<e;++b){trends.visitItems++;hasMatch=1;if(!trends.byUrl[a]){trends.byUrl[a]=0}trends.byUrl[a]++;if(c){if(!trends.byDomain[c]){trends.byDomain[c]=0}trends.byDomain[c]++}}if(!--numRequestsOutstanding){onAllVisitsProcessed()}return};var onAllVisitsProcessed=function(){urlArray=[];for(var b in trends.byDomain){urlArray.push({url:b,count:trends.byDomain[b]})}urlArray.sort(sortByCount);trends.topUrls=urlArray;var d=16;var e=0;var c=[];var h=[];var g=[];if(d>trends.topUrls.length){d=trends.topUrls.length}var j=d;for(value in trends.topUrls){j--;if(j<0){continue}e+=parseInt(trends.topUrls[value].count)}var j=d;for(value in trends.topUrls){j--;if(j<0){continue}var i=trends.topUrls[value].url;c.push(Math.ceil(trends.topUrls[value].count/e*100));h.push(i+" ("+trends.topUrls[value].count+" "+i18n("visits")+" - "+Math.round(trends.topUrls[value].count/e*100)+"%)")}var a="http://chart.googleapis.com/chart?cht=p&chco=DE3450,0F9BEA,83DB31,D1E039,CCCCCC&chs=920x320&chd=t:"+c.join(",")+"&chl="+h.join("|");a=encodeURI(a);$("#chart_browser").html("");var f=$("<img/>").attr("src",a).appendTo("#chart_browser")};function getUsage(a){speeddial.storage.getAllItems(function(b,c){var g=[];var f=[];var e=0;chart=[];for(var d=0;d<c.rows.length;d++){if(a=="morning"){if(c.rows.item(d).visits_morning>0){chart.push([c.rows.item(d).title,c.rows.item(d).visits_morning]);e+=c.rows.item(d).visits_morning}}else{if(a=="afternoon"){if(c.rows.item(d).visits_afternoon>0){chart.push([c.rows.item(d).title,c.rows.item(d).visits_afternoon]);e+=c.rows.item(d).visits_afternoon}}else{if(a=="evening"){if(c.rows.item(d).visits_evening>0){chart.push([c.rows.item(d).title,c.rows.item(d).visits_evening]);e+=c.rows.item(d).visits_evening}}else{if(a=="night"){if(c.rows.item(d).visits_night>0){chart.push([c.rows.item(d).title,c.rows.item(d).visits_night]);e+=c.rows.item(d).visits_night}}else{if(c.rows.item(d).visits>0){chart.push([c.rows.item(d).title,c.rows.item(d).visits]);e+=c.rows.item(d).visits}}}}}}if(e>1){chart.sort(function(k,i){return i[1]-k[1]});if(chart.length>16){max=16}else{max=chart.length}for(var d=0;d<max;d++){if(chart[d][1]>0){g.push(Math.ceil(chart[d][1]/e*100));f.push(chart[d][0].substring(0,32)+" ... ("+chart[d][1]+" "+i18n("visits")+" - "+Math.ceil(chart[d][1]/e*100)+"%)")}}var j="http://chart.googleapis.com/chart?cht=p&chco=1FA7D3,D31252,ED4815,D1E039,CCCCCC&chs=920x320&chd=t:"+g.join(",")+"&chl="+f.join("|");$("#chart_speeddial").html("");var h=$("<img/>").attr("src",j).appendTo("#chart_speeddial")}else{$("#chart_speeddial").html("<center>No data</center>")}})}$(function(){speeddial.storage.open();speeddial.storage.createTable();getHistory();getUsage(null)});$(function(){$("#statistics_overall").click(function(){getUsage(null)});$("#statistics_morning").click(function(){getUsage("morning")});$("#statistics_afternoon").click(function(){getUsage("afternoon")});$("#statistics_evening").click(function(){getUsage("evening")});$("#statistics_night").click(function(){getUsage("night")})});$(function(){var a=Math.floor(Math.random()*11);if(a%2==0){$("#support").addClass("cake");var b=true}});function i18n(a){return chrome.i18n.getMessage(a)}$(function(){$(".click-open-extension-page").click(function(){top.location.href=chrome.extension.getURL($(this).data("url"))});$("*[i18n]").each(function(){if(i18n($(this).attr("i18n"))){$(this).html(i18n($(this).attr("i18n")))}})});speeddial.storage.analytics("statistics");