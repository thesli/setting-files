$(document).ready(function(){setBlockRules();setEvents()});var forceHideOperations=false;var newRowVisible=false;updateCallback=function(){location.reload(true);return;setBlockRules();setEvents()};function setEvents(){$("#submitButton").button();$("#addRule").button();$("#addRule").unbind().click(function(){showNewEmptyRule()});$(".cmd_delete").unbind().click(function(){if(!preferences.showAlerts||confirm(_getMessage("Alert_deleteRule")+"?")){hideEditCommands();var a=$(".active").attr("index");forceHideOperations=true;$(".operations:visible").clearQueue();$(".operations:visible").fadeOut();$(".active").fadeOut(function(){forceHideOperations=false;if(newRowVisible){showNewEmptyRule()}deleteBlockRule(a);if(data.filters.length==0){var b=$("#no_rules").clone().removeClass("template");$(".table").append(b);return}else{$("#no_rules1").detach()}location.reload(true);return})}});$(".cmd_accept").unbind().click(function(){submitRule()});$(".cmd_cancel").unbind().click(function(){hideEditCommands()});$(".data_row").unbind().mouseover(function(){$(".active").removeClass("active");$(this).addClass("active");$(".operations").clearQueue();$(".operations:hidden").animate({top:$(this).position().top,left:$(this).position().left+5,},0,function(){$(".operations:hidden").show("slide",200)});$(".operations").animate({top:$(this).position().top,left:$(this).position().left+5,},250)})}function setBlockRules(){$(".table_row:not(.header, .template, #line_template)",".table").detach();if(data.filters.length==0){var h=$("#no_rules").clone().removeClass("template").attr("id","#no_rules1");$(".table").append(h);return}else{$("#no_rules1").detach()}for(var b=0;b<data.filters.length;b++){try{var c=data.filters[b];var f=(c.domain!=undefined)?c.domain:"any";var a=(c.name!=undefined)?c.name:"any";var d=(c.value!=undefined)?c.value:"any";addBlockLine(f,a,d,b)}catch(g){console.error(g.message)}}}function addBlockLine(e,c,d,b){var a=$("#line_template").clone();$(".domain_field",a).empty().text(e);$(".name_field",a).empty().text(c);$(".value_field",a).empty().text(d);a.attr("id","rule_n_"+b);a.attr("index",b);a.css("display","");$(".table").append(a)}function hideEditCommands(){newRowVisible=false;$(".new_rule_operations").fadeOut();$(".new_row:not(.template)").fadeOut().detach()}function showNewEmptyRule(){if($(".new_row:not(.template)").size()>0){$(".new_rule_operations").css("top",$(".new_row:not(.template)").position().top+"px");$(".new_rule_operations").css("left",$(".new_row:not(.template)").position().left+"px");return}newRowVisible=true;var a=$(".new_row.template").clone().removeClass("template");$(".table").append(a);$(".new_rule_operations").css("top",a.position().top+"px");$(".new_rule_operations").css("left",a.position().left+"px");a.hide();a.fadeIn();$(".new_rule_operations").fadeIn();a.keyup(function(b){if(b.keyCode==27){$(".cmd_cancel").trigger("click")}if(b.keyCode==13){$(".cmd_accept").trigger("click")}})}function submitRule(){var d=$(".new_rule_domain",".new_row:not(.template)").val();d=(d=="any"||d=="")?undefined:d;var a=$(".new_rule_name",".new_row:not(.template)").val();a=(a=="any"||a=="")?undefined:a;var c=$(".new_rule_value",".new_row:not(.template)").val();c=(c=="any"||c=="")?undefined:c;var b={};b.name=a;b.domain=d;b.value=c;if(a==undefined&&d==undefined&&c==undefined){return}addBlockRule(b);hideEditCommands();location.reload(true)};