
<script>
var lastTime = new Date().getTime();
var isInManage = false;
var delayTime = 500;
function add(tab) {
    var action_url = localStorage.instapaper;
    chrome.tabs.update(tab.id, {url: action_url});
}
function manage() {
    chrome.tabs.create({url:"http://www.instapaper.com/u"});
}
chrome.browserAction.onClicked.addListener(function(tab) {
    var currentTime = new Date().getTime();
    // alert("click");
    if (currentTime - lastTime > delayTime) {
        // alert("add");
        // set manage flag
        isInManage = false;
        setTimeout(function() {
            // check if is in manage now
            if (isInManage) return;
            add(tab);
        }, 500);
    } else {
        // alert("manage");
        // set manage flag
        isInManage = true;
        manage();
    }
    // update time
    lastTime = currentTime;
});
chrome.extension.onRequest.addListener(
    function(request, sender, sendResponse) {
    if (request.command == "add") {
        chrome.tabs.getSelected(null, add);
    } else if (request.command == "manage") {
        manage();
    }
    sendResponse({}); // snub them.
});
</script>
