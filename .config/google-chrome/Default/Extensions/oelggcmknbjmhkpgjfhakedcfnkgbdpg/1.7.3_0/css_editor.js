/*jslint browser: true, maxerr: 50, indent: 2 */
var LiveCSSEditor=function(e){"use strict";function s(e){var t=e.target,n=t.selectionStart,i=t.selectionEnd,s,o,u;if(e.ctrlKey||e.metaKey)return;e.keyCode===9?(e.preventDefault(),n!==i&&t.value.slice(n,i).indexOf("n")!==-1?(s=t.value.slice(0,n),o=t.value.slice(n,i).replace(/\n/g,"\n"+r),u=t.value.slice(i,t.value.length),t.value=s.concat(r).concat(o).concat(u),t.selectionStart=n+r.length,t.selectionEnd=i+r.length):(t.value=t.value.slice(0,n).concat(r).concat(t.value.slice(n,t.value.length)),n===i?t.selectionStart=t.selectionEnd=n+r.length:(t.selectionStart=n+r.length,t.selectionEnd=i+r.length))):e.keyCode===8&&t.value.slice(n-r.length,n)===r?(e.preventDefault(),t.value=t.value.slice(0,n-r.length).concat(t.value.slice(n,t.value.length)),t.selectionStart=t.selectionEnd=n-r.length):e.keyCode===46&&t.value.slice(i,i+r.length)===r?(e.preventDefault(),t.value=t.value.slice(0,n).concat(t.value.slice(n+r.length,t.value.length)),t.selectionStart=t.selectionEnd=n):e.keyCode===37&&t.value.slice(n-r.length,n)===r?(e.preventDefault(),e.shiftKey?t.selectionStart=n-r.length:t.selectionStart=t.selectionEnd=n-r.length):e.keyCode===39&&t.value.slice(n,n+r.length)===r&&(e.preventDefault(),e.shiftKey?t.selectionEnd=i+r.length:t.selectionStart=t.selectionEnd=i+r.length)}function o(e){return document.getElementById("LiveCSSEditor-"+e)}function u(t){return e.save===!0?window.localStorage.getItem("livecsseditor-"+t+"-"+i):!1}function a(t,n){return e.save===!0?(window.localStorage.setItem("livecsseditor-"+t+"-"+i,n),!0):!1}function f(){var e=o("panel"),t;e.className.indexOf("bottom")===-1?(e.className+=" bottom",t="bottom"):(e.className=e.className.replace(" bottom",""),t="top"),a("position",t)}function l(){var e=o("panel"),t;e.className.indexOf("right")===-1?(t="right",e.className=e.className.replace("left","right")):(t="left",e.className=e.className.replace("right","left")),a("positionLR",t)}function c(){var e=o("code");return e.style.width="",e.style.height="",a("boxsize",null),!0}function h(){var t=o("PageCSS");e.modify||t.parentElement.removeChild(t)}function p(){var t=o("panel"),r=o("code");if(e.save!==!0&&e.warn===!0&&r.value!==""&&!confirm(chrome.i18n.getMessage("warningOnClose")))return;a("boxsize",r.style.width+","+r.style.height),clearInterval(n),h(),t.parentElement.removeChild(t)}function d(){var e=o("bot"),t=o("close"),n=o("code"),r=o("reset"),i=o("leftright");e.onclick=f,t.onclick=p,n.onkeydown=s,i.onclick=l,r.onclick=c}function v(){var e=document.createElement("div"),t=u("boxsize")&&u("boxsize").split(","),n;e.setAttribute("id","LiveCSSEditor-panel"),e.className="right",e.innerHTML='<div id="LiveCSSEditor-actions"><div id="LiveCSSEditor-close">Close</div><div id="LiveCSSEditor-bot">Bottom</div><div id="LiveCSSEditor-leftright">Left / Right</div><div id="LiveCSSEditor-reset">Reset</div></div><div id="LiveCSSEditor-pad"><div id="LiveCSSEditor-label">'+chrome.i18n.getMessage("editorTitle")+'</div><textarea id="LiveCSSEditor-code"></textarea></div>',document.body.appendChild(e),n=o("code"),u("position")==="bottom"&&f(),u("positionLR")==="left"&&l(),t&&(n.style.width=t[0],n.style.height=t[1]),d(),n.focus()}function m(){if(document.getElementById("LiveCSSEditor-PageCSS"))return;var e=document.getElementsByTagName("head")[0],t=document.createElement("style");t.id="LiveCSSEditor-PageCSS",t.setAttribute("type","text/css"),e.appendChild(t)}function g(e){var n=o("PageCSS");e=e||"",n.innerHTML=e,t=e,a("cache",e)}function y(){var e=o("code");if(e){if(t===e.value)return!1;g(e.value)}else clearInterval(n)}function b(){n=setInterval(y,1e3)}function w(){var e,t;m(),v(),t=u("cache"),t&&(e=o("code"),e.value=t),g(t),b()}e=e||{warn:!0,save:!0,modify:!0};var t="",n=null,r="  ",i=document.location;o("panel")?p():w()};