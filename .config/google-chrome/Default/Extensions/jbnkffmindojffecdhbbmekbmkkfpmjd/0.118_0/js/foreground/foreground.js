define("foreground/model/foregroundViewManager",[],function(){"use strict";var e=Backbone.Model.extend({defaults:function(){return{views:[]}},initialize:function(){$(window).unload(function(){this.allViewsStopListening()}.bind(this))},allViewsStopListening:function(){_.each(this.get("views"),function(e){e.stopListening()})},subscribe:function(e){var t=this.get("views"),i=t.indexOf(e);-1===i&&t.push(e)},unsubscribe:function(e){var t=this.get("views"),i=t.indexOf(e);i>-1&&t.splice(i,1)}});return new e}),define("foreground/model/settings",[],function(){"use strict";return chrome.extension.getBackgroundPage().Settings}),define("foreground/view/genericForegroundView",["foreground/model/foregroundViewManager","foreground/model/settings"],function(e,t){"use strict";var i=function(t){e.subscribe(this),Backbone.View.apply(this,[t])};return _.extend(i.prototype,Backbone.View.prototype,{initializeTooltips:function(){t.get("showTooltips")&&setTimeout(function(){var e=this.$el.find("[title]");e.filter(function(){var e=!1;return($(this).hasClass("playlistTitle")||$(this).hasClass("title")||$(this).hasClass("item-title"))&&(e=this.offsetWidth===this.scrollWidth),e}).attr("title",""),e.qtip({position:{viewport:$(window),my:"top center",at:"bottom center"},style:{classes:"qtip-light qtip-shadow"}})}.bind(this))}}),i.extend=Backbone.View.extend,i}),define("text",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),define("text!template/genericPrompt.html",[],function(){return'<div class="panel">\r\n    <div class="header">\r\n        \r\n        <span class="title">\r\n            <%= promptTitle %>\r\n        </span>\r\n        \r\n        <button class="button-icon remove">\r\n            <i class="fa fa-times"></i>\r\n        </button>\r\n\r\n    </div>\r\n    <div class="divider"></div>\r\n    <div class="content">\r\n        \r\n    </div>\r\n    <span class="bottom-right">\r\n                        \r\n        <button class="ok button-label button-color">\r\n            <%= okButtonText %>\r\n        </button>\r\n        \r\n    </span>\r\n</div>'}),define("foreground/view/prompt/genericPromptView",["foreground/view/genericForegroundView","text!template/genericPrompt.html"],function(e,t){"use strict";var i=e.extend({className:"modalOverlay prompt",template:_.template(t),events:{click:"hideIfClickOutsidePanel","click .remove":"fadeOutAndHide","click .ok":"doOk","keydown .submittable":"doOkOnEnter"},panel:null,okButtonText:chrome.i18n.getMessage("ok"),okButton:null,showCancelButton:!0,render:function(){return this.$el.html(this.template({"chrome.i18n":chrome.i18n,promptTitle:this.title,okButtonText:this.okButtonText})),this.$el.find(".content").append(this.model.render().el),this.panel=this.$el.children(".panel"),this.okButton=this.$el.find("button.ok"),this},initialize:function(e){this.title=e.title||this.title,this.okButtonText=e.okButtonText||this.okButtonText,this.showCancelButton=e.showCancelButton||this.showCancelButton,this.$el.addClass(this.model.className+"Prompt")},fadeInAndShow:function(){$("body").append(this.render().el),this.$el.data("background",this.$el.css("background")).transition({background:"rgba(0, 0, 0, 0.5)"},"snap");var e=(this.$el.parent().height()-this.panel.height())/2;this.panel.transition({y:e,opacity:1},"snap")},fadeOutAndHide:function(){this.$el.transition({background:this.$el.data("background")},function(){this.remove()}.bind(this)),this.panel.transition({y:0,opacity:0})},hideIfClickOutsidePanel:function(e){e.target==e.currentTarget&&this.fadeOutAndHide()},doOkOnEnter:function(e){13===e.which&&this.doOk()},doOk:function(){var e=_.isFunction(this.model.validate)?this.model.validate():!0;e&&(_.isFunction(this.model.doOk)&&this.model.doOk(),this.fadeOutAndHide())}});return i}),define("text!template/reload.html",[],function(){return"<%= chrome.i18n.getMessage('streamusIsTakingALongTimeToLoadReloadingMayHelp') %>"}),define("foreground/view/reloadView",["foreground/view/genericForegroundView","text!template/reload.html"],function(e,t){"use strict";var i=e.extend({className:"reload",template:_.template(t),render:function(){return this.$el.html(this.template({"chrome.i18n":chrome.i18n})),this},doOk:function(){chrome.runtime.reload()}});return i}),define("foreground/model/contextMenuItem",[],function(){"use strict";var e=Backbone.Model.extend({defaults:function(){return{text:"",disabled:!1,title:"",onClick:null}}});return e}),define("foreground/collection/contextMenuItems",["foreground/model/contextMenuItem"],function(e){"use strict";var t=Backbone.Collection.extend({model:e});return t}),define("foreground/model/contextMenuGroup",["foreground/collection/contextMenuItems"],function(e){"use strict";var t=Backbone.Model.extend({defaults:function(){return{items:new e}},initialize:function(){var t=this.get("items");t instanceof Backbone.Collection||(t=new e(t),this.set("items",t,{silent:!0}))}});return t}),define("foreground/collection/contextMenuGroups",["foreground/model/contextMenuGroup"],function(e){"use strict";var t=Backbone.Collection.extend({model:e});return new t}),define("text!template/contextMenu.html",[],function(){return'<% contextMenuGroups.each(function(group){ %>\r\n    <ul id="<%= group.cid %>">\r\n        <% group.get(\'items\').each(function(item){ %>\r\n            <li <% if( item.get(\'disabled\') ) { %> disabled="disabled" <% } %>>\r\n                <a id="<%= item.cid %>" title="<%= item.get(\'title\') %>" <% if( item.get(\'disabled\') ) { %> disabled="disabled" <% } %> class="clickable">\r\n                    <%= item.get(\'text\') %>\r\n                </a>\r\n            </li>\r\n        <% }); %>\r\n    </ul>\r\n<% }); %>'}),define("foreground/view/contextMenuView",["foreground/view/genericForegroundView","foreground/collection/contextMenuGroups","text!template/contextMenu.html"],function(e,t,i){"use strict";var n=e.extend({template:_.template(i),events:{"click li":"onItemClick"},attributes:{id:"contextMenu"},render:function(){this.$el.html(this.template({contextMenuGroups:t}));var e=this.top,i=e+this.$el.height()>this.$el.parent().height();i&&(e-=this.$el.height());var n=this.left,s=n+this.$el.width()>this.$el.parent().width();return s&&(n-=this.$el.width()),this.initializeTooltips(),this.$el.offset({top:e,left:n}),this},initialize:function(){this.listenTo(t,"reset add remove",this.render)},show:function(e){if(void 0===e.top||void 0===e.left)throw"ContextMenu must be shown with top/left coordinates.";this.top=e.top,this.left=e.left,this.render()},onItemClick:function(e){var i=$(e.currentTarget);if("disabled"===i.attr("disabled"))return!1;var n=i.find("a").attr("id"),s=i.closest("ul").attr("id"),o=t.find(function(e){return e.cid==s}),r=o.get("items").find(function(e){return e.cid==n});r.get("onClick")()}});return n}),define("foreground/foreground",["foreground/model/foregroundViewManager","foreground/view/prompt/genericPromptView","foreground/view/reloadView","foreground/view/contextMenuView","foreground/collection/contextMenuGroups"],function(e,t,i,n,s){"use strict";var o=Backbone.Marionette.ItemView.extend({el:$("body"),contextMenuView:new n,reloadPromptView:null,showReloadPromptTimeout:null,events:{contextmenu:"tryResetContextMenu",click:"tryResetContextMenu"},backgroundPlayer:chrome.extension.getBackgroundPage().YouTubePlayer,initialize:function(){if(e.subscribe(this),this.$el.append(this.contextMenuView.render().el),null==this.backgroundPlayer)var t=setInterval(function(){this.backgroundPlayer=chrome.extension.getBackgroundPage().YouTubePlayer,null!=this.backgroundPlayer&&(clearInterval(t),this.waitForBackgroundPlayerReady())}.bind(this),100);else this.waitForBackgroundPlayerReady()},startShowReloadPromptTimer:function(){this.showReloadPromptTimeout=setTimeout(function(){this.reloadPromptView=new t({title:chrome.i18n.getMessage("reloadStreamus"),okButtonText:chrome.i18n.getMessage("reload"),showCancelButton:!1,model:new i}),this.reloadPromptView.fadeInAndShow()}.bind(this),5e3)},tryResetContextMenu:function(e){e.isDefaultPrevented()?this.contextMenuView.show({top:e.pageY,left:e.pageX+1}):s.reset()},waitForBackgroundPlayerReady:function(){this.backgroundPlayer.get("ready")?this.loadBackgroundDependentContent():(this.listenToOnce(this.backgroundPlayer,"change:ready",function(e,t){t&&this.loadBackgroundDependentContent()}),this.startShowReloadPromptTimer())},loadBackgroundDependentContent:function(){this.$el.removeClass("loading"),clearTimeout(this.showReloadPromptTimeout),null!==this.reloadPromptView&&this.reloadPromptView.remove(),require(["foreground/view/backgroundDependentForegroundView"])}});return new o}),define("foreground/model/playlistsArea",[],function(){"use strict";var e=Backbone.Model.extend({defaults:function(){return{playlists:null}}});return e}),define("text!template/playlistsArea.html",[],function(){return'<div class="panel">\r\n\r\n    <div class="header">\r\n\r\n        <button class="button-icon hide enabled" title="<%= closeMenu %>">\r\n            <i class="fa fa-reorder"></i>\r\n        </button>\r\n\r\n        <span class="title">\r\n            <img src="http://streamus.com/img/logo.png" alt="Streamus Logo">\r\n        </span>\r\n        \r\n        <button class="button-icon settings" title="<%= settings %>">\r\n            <i class="fa fa-cogs"></i>\r\n        </button>\r\n\r\n    </div>\r\n    <div class="left-top-divider"></div>\r\n    <div class="list">\r\n        \r\n        <h3>\r\n            <%= playlists %><i class="fa fa-caret-down" data-expanded="true"></i>\r\n        </h3>\r\n        \r\n        <ul id="playlists">\r\n        </ul>\r\n\r\n    </div>\r\n    <div class="context-buttons">\r\n\r\n        <div class="right-group">\r\n\r\n            <button class="button-icon button-small add" title="<%= createPlaylist %>">\r\n                <i class="fa fa-plus"></i>\r\n            </button>\r\n\r\n            <button class="button-icon button-small edit" title="<%= editPlaylist %>">\r\n                <i class="fa fa-pencil"></i>\r\n            </button>\r\n\r\n        </div>\r\n\r\n    </div>\r\n\r\n</div>'}),define("text!template/settings.html",[],function(){return"<div class=\"topic\">\r\n    <%= chrome.i18n.getMessage('general') %>\r\n</div>\r\n<div class=\"category\">\r\n\r\n    <ul>\r\n        <li>\r\n            <label id=\"suggestedQualitySelectLabel\" for=\"suggestedQualitySelect\">\r\n                <%= chrome.i18n.getMessage('videoQuality') %>\r\n            </label>\r\n            \r\n            <select id=\"suggestedQualitySelect\" name=\"suggestedQualitySelect\">\r\n            \r\n                <option value=\"highres\" <%= suggestedQuality === 'highres' ? 'selected' : '' %>>\r\n                    <%= chrome.i18n.getMessage('highest') %>\r\n                </option>\r\n\r\n                <option value=\"default\" <%= suggestedQuality === 'default' ? 'selected' : '' %>>\r\n                    <%= chrome.i18n.getMessage('auto') %>\r\n                </option>\r\n\r\n                <option value=\"small\" <%= suggestedQuality === 'small' ? 'selected' : '' %>>\r\n                    <%= chrome.i18n.getMessage('lowest') %>\r\n                </option>\r\n\r\n            </select>\r\n        </li>\r\n        <li>\r\n            <input type=\"checkbox\" id=\"showTooltips\" <%= showTooltips ? 'checked' : '' %>>\r\n            <label for=\"showTooltips\">\r\n                <%= chrome.i18n.getMessage('showTooltips') %>\r\n            </label>\r\n        </li>\r\n        <li>\r\n            <input type=\"checkbox\" id=\"alwaysOpenToSearch\" <%= alwaysOpenToSearch ? 'checked' : '' %> >\r\n            <label for=\"alwaysOpenToSearch\">\r\n                <%= chrome.i18n.getMessage('alwaysOpenToSearch') %>\r\n            </label>\r\n        </li>\r\n    </ul>\r\n\r\n</div>\r\n\r\n<div class=\"remindersLabel topic\">\r\n    <%= chrome.i18n.getMessage('reminders') %>\r\n</div>\r\n<div class=\"category\">\r\n    <ul>\r\n        <li>\r\n            <input type=\"checkbox\" id=\"remindClearStream\" <%= remindClearStream ? 'checked' : '' %>>\r\n            <label for=\"remindClearStream\">\r\n                <%= chrome.i18n.getMessage('remindClearStream') %>\r\n            </label>\r\n        </li>\r\n        <li>\r\n            <input type=\"checkbox\" id=\"remindDeletePlaylist\" <%= remindDeletePlaylist ? 'checked' : '' %>>\r\n            <label for=\"remindDeletePlaylist\">\r\n                <%= chrome.i18n.getMessage('remindDeletePlaylist') %>\r\n            </label>\r\n        </li>\r\n    </ul>\r\n</div>"}),define("foreground/model/player",[],function(){"use strict";return chrome.extension.getBackgroundPage().YouTubePlayer}),define("common/view/settingsView",["foreground/view/genericForegroundView","foreground/model/foregroundViewManager","text!template/settings.html","foreground/model/player","foreground/model/settings"],function(e,t,i,n,s){"use strict";var o=Backbone.Marionette.ItemView.extend({className:"settings",template:_.template(i),model:s,ui:{suggestedQualitySelect:"#suggestedQualitySelect",showTooltipsCheckbox:"#showTooltips",remindClearStreamCheckbox:"#remindClearStream",remindDeletePlaylistCheckbox:"#remindDeletePlaylist",alwaysOpenToSearchCheckbox:"#alwaysOpenToSearch"},templateHelpers:{"chrome.i18n":chrome.i18n},initialize:function(){t.subscribe(this)},doOk:function(){var e=this.ui.suggestedQualitySelect.val();s.set("suggestedQuality",e),n.setSuggestedQuality(e);var t=this.ui.remindClearStreamCheckbox.is(":checked");s.set("remindClearStream",t);var i=this.ui.remindDeletePlaylistCheckbox.is(":checked");s.set("remindDeletePlaylist",i);var o=this.ui.showTooltipsCheckbox.is(":checked");s.set("showTooltips",o),$("[title]").qtip("disable",!o);var r=this.ui.alwaysOpenToSearchCheckbox.is(":checked");s.set("alwaysOpenToSearch",r)}});return o}),define("text!template/createPlaylist.html",[],function(){return'<ul class="options">\r\n    <li>\r\n                \r\n        <span class="inputUnderlineWrapper">\r\n            <input id="playlistTitleInput" type="text" class="playlistTitle submittable" placeholder="<%= chrome.i18n.getMessage(\'required\') %>: <%= chrome.i18n.getMessage(\'title\').toLowerCase() %>" value="<%= chrome.i18n.getMessage(\'playlist\') %> <%= playlistCount %>" maxlength="255">\r\n            <div class="underline"></div>   \r\n        </span>\r\n\r\n    </li>\r\n    <li>\r\n        <span class="inputUnderlineWrapper">\r\n            <input id="youTubeSourceInput" type="text" class="youTubeSource submittable" placeholder="<%= chrome.i18n.getMessage(\'optional\') %>: <%= chrome.i18n.getMessage(\'playlist\').toLowerCase() %> / <%= chrome.i18n.getMessage(\'channel\').toLowerCase() %> <%= chrome.i18n.getMessage(\'url\') %>">\r\n            <div class="underline"></div>   \r\n        </span>\r\n    </li>\r\n</ul>'}),define("foreground/collection/streamItems",[],function(){"use strict";return chrome.extension.getBackgroundPage().StreamItems}),define("foreground/collection/playlists",[],function(){"use strict";return chrome.extension.getBackgroundPage().Playlists}),define("enum/dataSourceType",{None:-1,Unknown:0,YouTubePlaylist:1,YouTubeChannel:2,SharedPlaylist:3,UserInput:4,YouTubeFavorites:5,YouTubeAutoGenerated:6,YouTubeVideo:7}),define("common/model/utility",[],function(){"use strict";var e=Backbone.Model.extend({prettyPrintTime:function(e){isNaN(e)&&(e=0);var t=Math.floor(e/3600),i=e%3600,n=Math.floor(i/60);i%=60,10>n&&(n="0"+n),10>i&&(i="0"+i);var s=n+":"+i;return t>0&&(s=t+":"+s),s},iso8061DurationToSeconds:function(e){var t=e.match(/(\d+)H/),i=parseInt(t?t[1]:0),n=e.match(/(\d+)M/),s=parseInt(n?n[1]:0),o=e.match(/(\d+)S/),r=parseInt(o?o[1]:0),l=r+60*s+3600*i;return l},cleanseVideoTitle:function(e){return e=$.trim(e),e=e.replace(/\s*\*+\s?\S+\s?\*+$/,""),e=e.replace(/\s*\[[^\]]+\]$/,""),e=e.replace(/\s*\([^\)]*version\)$/i,""),e=e.replace(/\s*\.(avi|wmv|mpg|mpeg|flv)$/i,""),e=e.replace(/\s*(of+icial\s*)?(music\s*)?video/i,""),e=e.replace(/\s*(ALBUM TRACK\s*)?(album track\s*)/i,""),e=e.replace(/\s*\(\s*of+icial\s*\)/i,""),e=e.replace(/\s*\(\s*[0-9]{4}\s*\)/i,""),e=e.replace(/\s+\(\s*(HD|HQ)\s*\)$/,""),e=e.replace(/\s+(HD|HQ)\s*$/,""),e=e.replace(/\s*video\s*clip/i,""),e=e.replace(/\s+\(?live\)?$/i,""),e=e.replace(/\(\s*\)/,""),e=e.replace(/\(.*lyrics?\)/i,""),e=e.replace(/\s*with\s+lyrics?\s*$/i,""),e=e.replace(/^(|.*\s)"(.*)"(\s.*|)$/,"$2"),e=e.replace(/^(|.*\s)'(.*)'(\s.*|)$/,"$2"),e=e.replace(/^[\/\s,:;~-\s"]+/,""),e=e.replace(/[\/\s,:;~-\s"\s!]+$/,"")},getLevenshteinDistance:function(e,t){var i=[],n=e.length,s=t.length;if(0===n)return s;if(0===s)return n;for(var o=n;o>=0;o--)i[o]=[];for(var r=n;r>=0;r--)i[r][0]=r;for(var l=s;l>=0;l--)i[0][l]=l;for(var a=1;n>=a;a++)for(var d=e.charAt(a-1),u=1;s>=u;u++){if(a==u&&i[a][u]>4)return n;var c=t.charAt(u-1),h=d==c?0:1,g=i[a-1][u]+1,m=i[a][u-1]+1,p=i[a-1][u-1]+h;g>m&&(g=m),g>p&&(g=p),i[a][u]=g,a>1&&u>1&&d==t.charAt(u-2)&&e.charAt(a-2)==c&&(i[a][u]=Math.min(i[a][u],i[a-2][u-2]+h))}return i[n][s]},escapeRegExp:function(e){var t=e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");return t}});return new e}),define("common/model/youTubeV2API",["enum/dataSourceType","common/model/utility"],function(e,t){"use strict";var i=Backbone.Model.extend({defaults:function(){var e="author,title,media:group(yt:videoid,yt:duration),yt:accessControl,yt:hd";return{videoInformationFields:e,videoListInformationFields:"entry("+e+")"}},sendV2ApiRequest:function(e){return""===$.trim(e.url)&&(console.error("URL expected"),e.error&&e.error("URL expected"),e.complete&&e.complete()),$.ajax({url:e.url,data:$.extend({},e.data,{v:2,alt:"json",strict:!0}),headers:{"X-GData-Key":"key=AI39si7voIBGFYe-bcndXXe8kex6-N_OSzM5iMuWCdPCSnZxLB_qIEnQ-HMijHrwN1Y9sFINBi_frhjzVVrYunHH8l77wfbLCA"},success:function(){e.success(arguments[0]),e.complete&&e.complete()},error:function(t){"abort"!==t.statusText&&console.error(t.statusText),e.error&&e.error(t),e.complete&&e.complete()}})},search:function(e){return this.sendV2ApiRequest({url:"https://gdata.youtube.com/feeds/api/videos",data:{category:"Music",time:"all_time","max-results":e.maxResults||50,"start-index":1,format:5,q:e.text,fields:this.get("videoListInformationFields")},success:function(t){e.success(t.feed.entry||[])},error:e.error,complete:e.complete})},findPlayableByTitle:function(e){var i=$.trim(e.title||"");return""===i?(e.error&&e.error("No title provided"),null):this.search({text:i,success:function(n){n.sort(function(e,n){return t.getLevenshteinDistance(e.title.$t,i)-t.getLevenshteinDistance(n.title.$t,i)});var s=n.length>0?n[0]:null;e.success(s)},error:e.error})},searchPlaylist:function(e){return this.sendV2ApiRequest({url:"https://gdata.youtube.com/feeds/api/playlists/snippets",data:{"max-results":e.maxResults||50,"start-index":1,q:e.text},success:function(t){e.success(t.feed.entry||[])}})},getChannelName:function(e){return this.sendV2ApiRequest({url:"https://gdata.youtube.com/feeds/api/users/"+e.channelId,success:function(t){e.success(t.entry.author[0].name.$t)},error:e.error})},getPlaylistTitle:function(e){return this.sendV2ApiRequest({url:"https://gdata.youtube.com/feeds/api/playlists/"+e.playlistId,data:{fields:"title"},success:function(t){e.success(t.feed.title.$t)},error:e.error})},getVideoInformation:function(e){return this.sendV2ApiRequest({url:"https://gdata.youtube.com/feeds/api/videos/"+e.videoId,data:{format:5,fields:this.get("videoInformationFields")},success:function(t){var i=this.validateEntry(t.entry);i?e.success(t.entry):this.findPlayableByTitle({title:t.entry.title.$t,success:e.success,error:e.error})}.bind(this),error:function(){this.findPlayableByTitle({title:e.videoTitle,success:e.success,error:e.error})}.bind(this),complete:e.complete})},getDataSourceResults:function(e,t,i){if(e.isV3())throw"YouTubeV2 API getDataSourceResults cannot handle a V3 dataSource";var n=50,s=1+n*t;return this.sendV2ApiRequest({url:e.get("url"),data:{"max-results":n,"start-index":s},success:function(e){var n=_.filter(e.feed.entry,function(e){return void 0!==e.media$group.yt$duration});i&&i({iteration:t,results:n})},error:function(){i&&i({iteration:t,results:[]})}})},validateEntry:function(e){var t=e.yt$accessControl,i=_.find(t,function(e){return"embed"===e.action}),n="allowed"===i.permission;return n}});return new i}),define("common/model/dataSource",["enum/dataSourceType","common/model/youTubeV2API"],function(e,t){"use strict";var i=Backbone.Model.extend({defaults:{type:e.None,parseVideo:!0,sourceId:"",url:"",title:""},initialize:function(e){if(e&&e.urlToParse){var t=this.parseUrlForDataSourceInformation(e.urlToParse);this.set("type",t.dataSourceType),this.set("sourceId",t.dataSourceId),delete e.urlToParse}this.setUrl(),this.on("change:type",this.setUrl)},setUrl:function(){var t="https://gdata.youtube.com/feeds/api/";switch(this.get("type")){case e.YouTubeChannel:t+="users/"+this.get("sourceId")+"/uploads";break;case e.YouTubeFavorites:t+="users/"+this.get("sourceId")+"/favorites";break;case e.YouTubePlaylist:t+="playlists/"+this.get("sourceId");break;default:t=""}this.set("url",t)},isV3:function(){var t=this.get("type");return t===e.YouTubeAutoGenerated},needsLoading:function(){var t=this.get("type");return t===e.YouTubeChannel||t===e.YouTubePlaylist||t===e.YouTubeFavorites||t===e.YouTubeAutoGenerated},parseUrlForDataSourceInformation:function(t){var i=e.None,n="";if(this.get("parseVideo")){var s=this.parseYouTubeVideoIdFromUrl(t);s&&(n=s,i=e.YouTubeVideo)}if(i===e.None){var o=[{identifiers:["list=PL","p=PL","list=RD","p=RD"],dataSourceType:e.YouTubePlaylist},{identifiers:["list=FL","p=FL"],dataSourceType:e.YouTubeFavorites},{identifiers:["list=AL","p=AL"],dataSourceType:e.YouTubeAutoGenerated},{identifiers:["/user/","/channel/","list=UU","p=UU"],dataSourceType:e.YouTubeChannel},{identifiers:["streamus:"],dataSourceType:e.SharedPlaylist}],r=function(e,t){var i=e.split(t),n="";if(i.length>1){n=e.split(t)[1];var s=n.indexOf("&");-1!==s&&(n=n.substring(0,s)),"list=AL"===t||"p=AL"===t?n="AL"+n:("list=RD"===t||"p=RD"===t)&&(n="RD"+n)}return n};_.each(o,function(e){var s=_.find(e.identifiers,function(e){var i=r(t,e);return""!==i});void 0!==s&&(n=r(t,s),i=e.dataSourceType)})}return{dataSourceType:i,dataSourceId:n}},parseYouTubeVideoIdFromUrl:function(e){var t=null,i=e.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|watch\?.*?\&v=)([^#\&\?]*).*/);return i&&11===i[2].length&&(t=i[2]),t},getTitle:function(i){if(i=$.extend({},{success:function(){},error:function(){},notifyOnError:!0},i),""!==this.get("title"))return i.success(this.get("title")),void 0;var n=this;switch(this.get("type")){case e.YouTubePlaylist:t.getPlaylistTitle({playlistId:this.get("sourceId"),success:function(e){n.set("title",e),i.success(e)},error:i.error});break;case e.YouTubeFavorites:case e.YouTubeChannel:t.getChannelName({channelId:this.get("sourceId"),success:function(e){n.set("title",e),i.success(e)},error:i.error});break;case e.YouTubeAutoGenerated:break;default:i.notifyOnError&&console.error("Unhandled dataSource type:",this.get("type")),i.error()}}});return i}),define("foreground/view/createPlaylistView",["foreground/view/genericForegroundView","text!template/createPlaylist.html","foreground/collection/streamItems","foreground/collection/playlists","common/model/dataSource","enum/dataSourceType"],function(e,t,i,n,s,o){"use strict";var r=e.extend({className:"createPlaylist",template:_.template(t),playlistTitleInput:null,youTubeSourceInput:null,events:{"input input.youTubeSource":"processInput","input input.playlistTitle":"validateTitle"},render:function(){return this.$el.html(this.template({"chrome.i18n":chrome.i18n,playlistCount:n.length})),this.playlistTitleInput=this.$el.find("input.playlistTitle"),this.youTubeSourceInput=this.$el.find("input.youTubeSource"),this.youTubeSourceInput.data("datasource",new s({type:o.None})),setTimeout(function(){this.playlistTitleInput.focus().val(this.playlistTitleInput.val())}.bind(this)),this},validateTitle:function(){var e=$.trim(this.playlistTitleInput.val());this.playlistTitleInput.toggleClass("invalid",""===e)},processInput:_.debounce(function(){var e=this;setTimeout(function(){var t=$.trim(e.youTubeSourceInput.val());if(e.youTubeSourceInput.removeData("datasource").removeClass("valid invalid"),""!==t){var i=new s({urlToParse:t,parseVideo:!1});e.youTubeSourceInput.data("datasource",i),i.getTitle({success:function(t){e.playlistTitleInput.val(t),e.validateTitle(),e.youTubeSourceInput.addClass("valid")},error:function(){var t=e.playlistTitleInput.val();console.log("original value:",t),e.playlistTitleInput.data("original-value",t).val(chrome.i18n.getMessage("errorRetrievingTitle")),e.youTubeSourceInput.addClass("invalid")}})}else e.youTubeSourceInput.removeClass("invalid valid"),e.playlistTitleInput.val(e.playlistTitleInput.data("original-value"))})},100),validate:function(){var e=0===this.$el.find(".submittable.invalid").length;return e},doOk:function(){var e=this.youTubeSourceInput.data("datasource"),t=$.trim(this.playlistTitleInput.val());console.log("Data source and playlistName:",e,t),e.get("type")===o.None||e.get("type")===o.Unknown?this.model&&0!==this.model.length?n.addPlaylistWithVideos(t,this.model):n.addEmptyPlaylist(t):n.addPlaylistByDataSource(t,e)}});return r}),define("foreground/view/prompt/createPlaylistPromptView",["foreground/view/prompt/genericPromptView","foreground/view/createPlaylistView"],function(e,t){"use strict";var i=e.extend({title:chrome.i18n.getMessage("createPlaylist"),okButtonText:chrome.i18n.getMessage("create"),model:new t});return i}),define("text!template/editPlaylist.html",[],function(){return'<ul class="options">\r\n    <li>\r\n        <span class="inputUnderlineWrapper">\r\n            <input id="playlistTitleInput" type="text" class="playlistTitle submittable" placeholder="<%= chrome.i18n.getMessage(\'required\') %>: <%= chrome.i18n.getMessage(\'title\').toLowerCase() %>" value="<%= title %>">\r\n            <div class="underline"></div>   \r\n        </span>\r\n    </li>\r\n</ul>'}),define("foreground/view/editPlaylistView",["foreground/view/genericForegroundView","text!template/editPlaylist.html"],function(e,t){"use strict";var i=e.extend({className:"editPlaylist",template:_.template(t),playlistTitleInput:null,events:{"input input.playlistTitle":"validateTitle"},render:function(){return this.$el.html(this.template({"chrome.i18n":chrome.i18n,title:this.model.get("title")})),this.playlistTitleInput=this.$el.find('input[type="text"]'),setTimeout(function(){this.playlistTitleInput.focus().val(this.playlistTitleInput.val())}.bind(this)),this},validateTitle:function(){var e=$.trim(this.playlistTitleInput.val());this.playlistTitleInput.toggleClass("invalid",""===e)},validate:function(){var e=0===this.$el.find(".submittable.invalid").length;return e},doOk:function(){var e=$.trim(this.playlistTitleInput.val());this.model.set("title",e)}});return i}),define("foreground/view/prompt/editPlaylistPromptView",["foreground/view/prompt/genericPromptView","foreground/view/editPlaylistView","foreground/model/settings"],function(e,t){"use strict";var i=e.extend({title:chrome.i18n.getMessage("editPlaylist"),okButtonText:chrome.i18n.getMessage("update"),model:null,initialize:function(i){this.model=new t({model:i.playlist}),e.prototype.initialize.call(this,arguments)}});return i}),define("text!template/deletePlaylistButton.html",[],function(){return'<i class="fa fa-trash-o"></i>'}),define("text!template/deletePlaylist.html",[],function(){return'<%= chrome.i18n.getMessage(\'areYouSureYouWantToDeletePlaylist\') %> <strong><%= title %></strong>?\r\n        \r\n<div class="reminder">\r\n    <input type="checkbox" id="remindDeletePlaylist">\r\n	<label for="remindDeletePlaylist"><%= chrome.i18n.getMessage(\'dontRemindMeAgain\') %></label>\r\n</div>'}),define("foreground/view/deletePlaylistView",["foreground/view/genericForegroundView","text!template/deletePlaylist.html","foreground/model/settings"],function(e,t,i){"use strict";var n=e.extend({className:"deletePlaylist",template:_.template(t),reminderCheckbox:null,render:function(){return this.$el.html(this.template({"chrome.i18n":chrome.i18n,title:this.model.get("title")})),this},doOk:function(){var e=!this.$el.find("input#remindDeletePlaylist").is(":checked");i.set("remindDeletePlaylist",e),this.model.destroy()}});return n}),define("foreground/view/prompt/deletePlaylistPromptView",["foreground/view/prompt/genericPromptView","foreground/view/deletePlaylistView","foreground/model/settings"],function(e,t,i){"use strict";var n=e.extend({title:chrome.i18n.getMessage("deletePlaylist"),okButtonText:chrome.i18n.getMessage("delete"),model:null,initialize:function(i){this.model=new t({model:i.playlist}),e.prototype.initialize.call(this,arguments)},fadeInAndShow:function(){var t=i.get("remindDeletePlaylist");return t?e.prototype.fadeInAndShow.call(this,arguments):(this.model.model.destroy(),void 0)}});return n}),define("foreground/view/playlistsArea/deletePlaylistButtonView",["foreground/view/genericForegroundView","foreground/model/foregroundViewManager","text!template/deletePlaylistButton.html","foreground/collection/playlists","foreground/view/prompt/deletePlaylistPromptView"],function(e,t,i,n,s){"use strict";var o=Backbone.Marionette.ItemView.extend({tagName:"button",className:"button-icon button-small delete",template:_.template(i),enabledTitle:chrome.i18n.getMessage("deletePlaylist"),disabledTitle:chrome.i18n.getMessage("cantDeleteLastPlaylist"),events:{click:"showDeleteSelectedPlaylistPrompt"},onRender:function(){var e=n.canDelete();return e?this.$el.attr("title",this.enabledTitle).removeClass("disabled"):this.$el.attr("title",this.disabledTitle).addClass("disabled"),this},initialize:function(){this.listenTo(n,"add remove reset",this.render),t.subscribe(this)},showDeleteSelectedPlaylistPrompt:function(){var e=n.canDelete();if(e){var t=n.getActivePlaylist(),i=0===t.get("items").length;if(i)t.destroy();else{var o=new s({playlist:t});o.fadeInAndShow()}}}});return o}),define("text!template/playlist.html",[],function(){return'<i class="fa fa-list fa-fw"></i>\r\n<div class="spinner spinner-small"></div>\r\n\r\n<span class="title" title="<%= title %>">\r\n    <%= title %>\r\n</span>\r\n<input type="text" value="<%= title %>" class="editableTitle hidden" maxlength="255"/>\r\n\r\n<span class="count"><%= items.length %></span>'}),define("enum/listItemType",{None:-1,PlaylistItem:0,StreamItem:1,VideoSearchResult:2,Playlist:3}),define("foreground/view/playlistsArea/playlistView",["foreground/view/genericForegroundView","foreground/model/foregroundViewManager","text!template/playlist.html","foreground/collection/contextMenuGroups","foreground/view/prompt/deletePlaylistPromptView","foreground/view/prompt/editPlaylistPromptView","foreground/collection/playlists","foreground/collection/streamItems","enum/listItemType"],function(e,t,i,n,s,o,r,l,a){"use strict";var d=Backbone.Marionette.ItemView.extend({tagName:"li",className:"listItem playlist",template:_.template(i),attributes:function(){return{"data-id":this.model.get("id"),"data-type":a.Playlist}},events:{"blur @ui.editableTitle":"saveAndStopEdit",click:"select",contextmenu:"showContextMenu","dblclick @ui.readonlyTitle":"startEdit","keyup @ui.editableTitle":"saveAndStopEditOnEnter"},modelEvents:{"change:title":"render","change:dataSourceLoaded":"toggleLoadingClass","change:active":"stopEditingOnInactive toggleSelectedClass"},ui:{itemCount:".count",editableTitle:"input.editableTitle",readonlyTitle:"span.title"},onRender:function(){this.toggleLoadingClass(),this.toggleSelectedClass(),e.prototype.initializeTooltips.call(this)},initialize:function(){this.listenTo(this.model.get("items"),"add remove",this.updateItemCount),t.subscribe(this)},stopEditingOnInactive:function(e,t){t||this.saveAndStopEdit()},toggleLoadingClass:function(){var e=this.model.has("dataSource")&&!this.model.get("dataSourceLoaded");this.$el.toggleClass("loading",e)},toggleSelectedClass:function(){var e=this.model.get("active");this.$el.toggleClass("selected",e)
},updateItemCount:function(){var e=this.model.get("items").length;this.ui.itemCount.text(e)},select:function(){this.model.set("active",!0)},showContextMenu:function(e){e.preventDefault(),n.reset();var t=0===this.model.get("items").length,i=1===r.length,a=this;n.add({items:[{disabled:t,title:t?chrome.i18n.getMessage("playlistEmpty"):"",text:chrome.i18n.getMessage("copyUrl"),onClick:function(){a.model.getShareCode(function(e){var t=e.get("shortId"),i=e.get("urlFriendlyEntityTitle"),n="http://share.streamus.com/playlist/"+t+"/"+i;chrome.extension.sendMessage({method:"copy",text:n})})}},{text:chrome.i18n.getMessage("delete"),disabled:i,title:i?chrome.i18n.getMessage("cantDeleteLastPlaylist"):"",onClick:function(){if(0===a.model.get("items").length)a.model.destroy();else{var e=new s({playlist:a.model});e.fadeInAndShow()}}},{text:chrome.i18n.getMessage("enqueue"),disabled:t,title:t?chrome.i18n.getMessage("playlistEmpty"):"",onClick:function(){l.addByPlaylistItems(a.model.get("items"),!1)}},{text:chrome.i18n.getMessage("edit"),onClick:function(){var e=new o({playlist:this.model});e.fadeInAndShow()}}]})},startEdit:function(){this.ui.editableTitle.show().focus().val(this.ui.editableTitle.val()),this.ui.readonlyTitle.hide()},saveAndStopEditOnEnter:function(e){13===e.which&&this.saveAndStopEdit()},saveAndStopEdit:function(){var e=$.trim(this.ui.editableTitle.val());""!==e&&this.model.set("title",e),this.ui.editableTitle.hide(),this.ui.readonlyTitle.show()}});return d}),define("foreground/model/user",[],function(){"use strict";return chrome.extension.getBackgroundPage().User}),define("foreground/view/playlistsArea/playlistsAreaView",["foreground/view/genericForegroundView","foreground/model/foregroundViewManager","text!template/playlistsArea.html","common/view/settingsView","foreground/view/prompt/genericPromptView","foreground/view/prompt/createPlaylistPromptView","foreground/view/createPlaylistView","foreground/view/prompt/editPlaylistPromptView","foreground/view/playlistsArea/deletePlaylistButtonView","foreground/collection/playlists","foreground/view/playlistsArea/playlistView","enum/listItemType","foreground/model/user"],function(e,t,i,n,s,o,r,l,a,d,u,c,h){"use strict";var g=Backbone.Marionette.CompositeView.extend({id:"playlistsArea",template:_.template(i),itemView:u,itemViewContainer:"#playlists",events:{click:"hideIfClickOutsidePanel","click .hide":"destroyModel","click h3":"togglePlaylistsVisibility","click .settings":"showSettingsPrompt","click .add":"showCreatePlaylistPrompt","click .edit":"showEditSelectedPlaylistPrompt"},ui:{panel:".panel",playlists:"ul#playlists",contextButtons:".context-buttons"},templateHelpers:{closeMenu:chrome.i18n.getMessage("closeMenu"),settings:chrome.i18n.getMessage("settings"),playlists:chrome.i18n.getMessage("playlists"),createPlaylist:chrome.i18n.getMessage("createPlaylist"),editPlaylist:chrome.i18n.getMessage("editPlaylist")},modelEvents:{destroy:"hide"},onRender:function(){this.$el.find(".right-group").append((new a).render().el),this.ui.playlists.sortable({axis:"y",placeholder:"sortable-placeholder listItem",update:function(e,t){var i=t.item.data("type");if(i===c.Playlist){var n=t.item.data("id"),s=t.item.index(),o=this.collection.get(n),r=this.collection.indexOf(o);s>r&&(s+=1),this.collection.moveToIndex(n,s)}}.bind(this)}),this.toggleContextButtons(),e.prototype.initializeTooltips.call(this)},initialize:function(){t.subscribe(this),this.listenTo(h,"change:loaded",this.toggleContextButtons)},show:function(){this.$el.data("background",this.$el.css("background")).transition({background:"rgba(0, 0, 0, 0.5)"},"snap"),this.ui.panel.transition({x:this.ui.panel.width()},300,"snap")},destroyModel:function(){this.model.destroy()},hideIfClickOutsidePanel:function(e){e.target==e.currentTarget&&this.model.destroy()},hide:function(){this.$el.transition({background:this.$el.data("background")},function(){this.remove()}.bind(this)),this.ui.panel.transition({x:-20},300)},togglePlaylistsVisibility:function(e){var t=$(e.currentTarget).find("i"),i=t.data("expanded");i&&t.data("expanded",!1),t.transitionStop().transition({rotate:i?-90:0},200),i?this.collapsePlaylistCollection():this.expandPlaylistCollection(function(){t.data("expanded",!0)})},arePlaylistsOverflowing:function(){var e=this.ui.playlists.height();0===e&&(e=this.ui.playlists.data("oldheight"));var t=!1,i=this.collection.length;if(i>0){var n=this.ui.playlists.find("li").height(),s=e/n;t=i>s}return t},collapsePlaylistCollection:function(){var e=this.arePlaylistsOverflowing();e||this.ui.playlists.css("overflow-y","hidden");var t=this.ui.playlists.height(),i=$.trim(this.ui.playlists[0].style.height);(""===i||"auto"===i)&&this.ui.playlists.height(t),this.ui.playlists.data("oldheight",t),this.ui.playlists.transitionStop().transition({height:0,opacity:0},200,function(){this.ui.playlists.hide(),e||this.ui.playlists.css("overflow-y","auto")}.bind(this))},expandPlaylistCollection:function(e){var t=this.arePlaylistsOverflowing();t||this.ui.playlists.css("overflow-y","hidden"),this.ui.playlists.show().transitionStop().transition({height:this.ui.playlists.data("oldheight"),opacity:1},200,function(){t||this.ui.playlists.css("overflow-y","auto"),e()}.bind(this))},showSettingsPrompt:function(){var e=new s({title:chrome.i18n.getMessage("settings"),okButtonText:chrome.i18n.getMessage("save"),model:new n});e.fadeInAndShow()},showCreatePlaylistPrompt:function(){var e=new o;e.fadeInAndShow()},showEditSelectedPlaylistPrompt:function(){var e=new l({playlist:d.getActivePlaylist()});e.fadeInAndShow()},toggleContextButtons:function(){this.ui.contextButtons.toggle(h.get("loaded"))}});return g}),define("text!template/activePlaylistArea.html",[],function(){return'<div class="left-top-bar">\r\n    <button class="button-icon show" title="<%= openMenu %>">\r\n        <i class="fa fa-reorder"></i>\r\n    </button>\r\n\r\n    <div class="playlistTitle" title="<%= playlistTitle %>">\r\n        <%= playlistTitle %>\r\n    </div>\r\n    \r\n    <button class="button-icon" id="showVideoSearch" title="<%= showVideoSearch %>">\r\n        <i class="fa fa-search"></i>\r\n    </button>\r\n</div>\r\n\r\n<div class="left-top-divider"></div>\r\n\r\n<div class="big-text-wrapper">\r\n    \r\n    <div class="big-text playlistEmpty">\r\n        <div class="big-text-header">\r\n            <%= playlistEmpty %>\r\n        </div>\r\n        <%= wouldYouLikeTo %> <span id="videoSearchLink" class="searchLink clickable lowercase"><%= searchForVideos %></span>?\r\n    </div>\r\n    \r\n    <div class="big-text signingIn">\r\n        <div class="big-text-header"><%= signingIn %>...</div>\r\n        <div class="spinner spinner-medium"></div>\r\n    </div>\r\n    \r\n    <div class="big-text signIn">\r\n        <div class="big-text-header searchLink clickable"><%= signInMessage %></div>\r\n    </div>\r\n    \r\n    <div class="big-text signInFailed">\r\n        <div class="big-text-header"><%= signInFailedMessage %></div>\r\n        <%= pleaseWaitMessage %> <span id="signInRetryTimer"><%= signInRetryTimer %></span>\r\n    </div>\r\n\r\n    <div id="activePlaylistItems" class="left-list droppable-list">\r\n    </div>\r\n</div>\r\n\r\n<div class="left-bottom-menubar">\r\n    <div class="playlist-details lowercase" title="<%= playlistDisplayInfo %>">\r\n        <%= playlistDisplayInfo %>\r\n    </div>\r\n    <div class="playlist-actions">\r\n\r\n        <button class="button-label addAll" title="<%= enqueueAll %>">\r\n            <i class="fa fa-plus"></i><%= enqueueAll %>\r\n        </button>\r\n        \r\n        <button class="button-label playAll" title="<%= playAll %>">\r\n            <i class="fa fa-play"></i><%= playAll %>\r\n        </button>\r\n    </div>\r\n</div>'}),define("text!template/playlistItem.html",[],function(){return'<!-- Render non-lazily if view is set to instant -->\r\n<!--<% if( instant ) { %>\r\n    <img class="item-thumb" src="http://img.youtube.com/vi/<%= video.get(\'id\') %>/default.jpg" />\r\n<% } else { %>\r\n    <img class="item-thumb" data-original="http://img.youtube.com/vi/<%= video.get(\'id\') %>/default.jpg" />\r\n<% } %>-->\r\n\r\n    <img class="item-thumb" src="http://img.youtube.com/vi/<%= video.get(\'id\') %>/default.jpg" />\r\n\r\n<span class="item-title" title="<%= title %>"><%= title %></span>\r\n\r\n<span class="item-details">\r\n    <% if( video.get(\'highDefinition\') ) { %>\r\n        <%= hdMessage %> · \r\n    <% } %>\r\n    <span class="item-duration">\r\n        <%= video.get(\'prettyDuration\') %>	\r\n    </span>\r\n</span>\r\n\r\n<span class="hover-actions">\r\n    <button class="button-icon playInStream" title="<%= playMessage %>">\r\n        <i class="fa fa-play"></i>\r\n    </button>\r\n    \r\n    <button class="button-icon addToStream" title="<%= enqueueMessage %>">\r\n        <i class="fa fa-plus"></i>\r\n    </button>\r\n    \r\n    <button class="button-icon delete" title="<%= deleteMessage %>">\r\n        <i class="fa fa-trash-o"></i>\r\n    </button>\r\n</span>'}),define("foreground/view/activePlaylistArea/playlistItemView",["foreground/model/foregroundViewManager","text!template/playlistItem.html","foreground/collection/contextMenuGroups","foreground/collection/streamItems","enum/listItemType"],function(e,t,i,n,s){"use strict";var o=Backbone.Marionette.ItemView.extend({className:"listItem playlistItem multiSelectItem",template:_.template(t),attributes:function(){return{"data-id":this.model.get("id"),"data-type":s.PlaylistItem}},instant:!1,events:{"click button.addToStream":"addToStream","click button.delete":"doDelete","click button.playInStream":"playInStream",dblclick:"playInStream","dblclick button.addToStream":"addToStream","dblclick button.playInStream":"playInStream"},ui:{imageThumbnail:"img.item-thumb"},triggers:{contextmenu:{event:"showContextMenu",preventDefault:!0}},templateHelpers:function(){return{instant:this.instant,hdMessage:chrome.i18n.getMessage("hd"),playMessage:chrome.i18n.getMessage("play"),enqueueMessage:chrome.i18n.getMessage("enqueue"),deleteMessage:chrome.i18n.getMessage("delete")}},onRender:function(){this.setHighlight()},modelEvents:{destroy:"remove","change:selected":"setHighlight"},initialize:function(t){this.instant=t&&t.instant||this.instant,console.log("Instant and options:",this.instant,t),console.trace(),e.subscribe(this)},setHighlight:function(){this.$el.toggleClass("selected",this.model.get("selected"))},doDelete:function(){return this.model.destroy(),!1},showContextMenu:function(){var e=this;i.reset(),i.add({items:[{text:chrome.i18n.getMessage("copyUrl"),onClick:function(){chrome.extension.sendMessage({method:"copy",text:e.model.get("video").get("url")})}},{text:chrome.i18n.getMessage("copyTitleAndUrl"),onClick:function(){chrome.extension.sendMessage({method:"copy",text:'"'+e.model.get("title")+'" - '+e.model.get("video").get("url")})}},{text:chrome.i18n.getMessage("deleteVideo"),onClick:function(){e.model.destroy()}},{text:chrome.i18n.getMessage("enqueue"),onClick:function(){var t=e.model.get("video");n.addByVideo(t)}},{text:chrome.i18n.getMessage("play"),onClick:function(){var t=e.model.get("video");n.addByVideo(t,!0)}},{text:chrome.i18n.getMessage("watchOnYouTube"),onClick:function(){chrome.tabs.create({url:e.model.get("video").get("url")})}}]})},playInStream:_.debounce(function(){return n.addByPlaylistItem(this.model,!0),!1},100,!0),addToStream:_.debounce(function(){return n.addByPlaylistItem(this.model,!1),!1},100,!0)});return o}),define("text!template/streamItem.html",[],function(){return'<% if( instant ) { %>\r\n    <img class="item-thumb" src="http://img.youtube.com/vi/<%= video.get(\'id\') %>/default.jpg" />\r\n<% } else { %>\r\n    <img class="item-thumb" data-original="http://img.youtube.com/vi/<%= video.get(\'id\') %>/default.jpg" />\r\n<% } %>\r\n\r\n<span class="item-title" title="<%= title %>">\r\n    <%= title %>\r\n</span>\r\n\r\n<span class="item-details">\r\n    <% if( video.get(\'highDefinition\') ) { %>\r\n        <%= chrome.i18n.getMessage(\'hd\') %> · \r\n    <% } %>\r\n    <span class="item-duration">\r\n        <%= video.get(\'prettyDuration\') %>\r\n    </span>\r\n</span>\r\n\r\n<span class="hover-actions">\r\n    <button class="button-icon playInStream" title="<%= chrome.i18n.getMessage(\'play\') %>">\r\n        <i class="fa fa-play"></i>\r\n    </button>\r\n    \r\n    <button class="button-icon delete" title="<%= chrome.i18n.getMessage(\'delete\') %>">\r\n        <i class="fa fa-trash-o"></i>\r\n    </button>\r\n</span>'}),define("foreground/model/buttons/playPauseButton",[],function(){"use strict";return chrome.extension.getBackgroundPage().PlayPauseButton}),define("foreground/view/rightPane/stream/streamItemView",["foreground/model/foregroundViewManager","foreground/view/genericForegroundView","foreground/collection/contextMenuGroups","common/model/utility","foreground/collection/streamItems","text!template/streamItem.html","foreground/collection/playlists","foreground/model/buttons/playPauseButton","foreground/model/player","enum/listItemType","foreground/model/user"],function(e,t,i,n,s,o,r,l,a,d,u){"use strict";var c=Backbone.Marionette.ItemView.extend({className:"listItem streamItem",template:_.template(o),instant:!1,attributes:function(){return{"data-id":this.model.get("id"),"data-type":d.StreamItem}},events:{click:"select","click @ui.deleteButton":"doDelete","click button.playInStream":"play",contextmenu:"showContextMenu",dblclick:"togglePlayingState","dblclick button.playInStream":"play"},ui:{imageThumbnail:"img.item-thumb",deleteButton:"button.delete"},templateHelpers:function(){return{"chrome.i18n":chrome.i18n,instant:this.instant}},modelEvents:{"change:selected":"toggleSelected",destroy:"remove"},onRender:function(){this.$el.toggleClass("selected",this.model.get("selected")),t.prototype.initializeTooltips.call(this)},initialize:function(t){this.instant=t&&void 0!==t.instant?t.instant:this.instant,e.subscribe(this)},select:function(){this.model.set("selected",!0)},togglePlayingState:function(){l.tryTogglePlayerState()},doDelete:function(){return this.ui.deleteButton.qtip("api").destroy(!0),this.model.destroy(),!1},toggleSelected:function(){this.$el.toggleClass("selected",this.model.get("selected"))},showContextMenu:function(e){e.preventDefault();var t=this;i.reset();var n=u.get("loaded"),o=r.getActivePlaylist(),l=!1;n&&(l=o.get("items").videoAlreadyExists(t.model.get("video")));var a="";n&&l?a=chrome.i18n.getMessage("duplicatesNotAllowed"):n||(a=chrome.i18n.getMessage("cantSaveNotSignedIn")),i.add({items:[{text:chrome.i18n.getMessage("save"),title:a,disabled:!n||l,onClick:function(){o.addByVideo(t.model.get("video"))}},{text:chrome.i18n.getMessage("copyUrl"),onClick:function(){chrome.extension.sendMessage({method:"copy",text:t.model.get("video").get("url")})}},{text:chrome.i18n.getMessage("copyTitleAndUrl"),onClick:function(){chrome.extension.sendMessage({method:"copy",text:'"'+t.model.get("title")+'" - '+t.model.get("video").get("url")})}},{text:chrome.i18n.getMessage("delete"),onClick:function(){t.model.destroy()}},{text:chrome.i18n.getMessage("banUntilClear"),disabled:s.getRelatedVideos().length<5,onClick:function(){s.ban(t.model),t.model.destroy()}},{text:chrome.i18n.getMessage("watchOnYouTube"),onClick:function(){chrome.tabs.create({url:t.model.get("video").get("url")})}}]})},play:_.debounce(function(){return this.model.get("selected")?a.play():(a.playOnceVideoChanges(),this.select()),!1},100,!0)});return c}),define("text!template/videoSearchResult.html",[],function(){return'<!-- Render non-lazily if view is set to instant -->\r\n<!--<% if( instant ) { %>\r\n    <img class="item-thumb" src="http://img.youtube.com/vi/<%= video.get(\'id\') %>/default.jpg" />\r\n<% } else { %>\r\n    <img class="item-thumb" data-original="http://img.youtube.com/vi/<%= video.get(\'id\') %>/default.jpg" />\r\n<% } %>-->\r\n<img class="item-thumb" src="http://img.youtube.com/vi/<%= video.get(\'id\') %>/default.jpg" />\r\n<span class="item-title" title="<%= video.get(\'title\') %>"><%= video.get(\'title\') %></span>\r\n\r\n<span class="item-details">\r\n    <% if( video.get(\'highDefinition\') ) { %>\r\n        <%= hdMessage %> · \r\n    <% } %>\r\n    <span class="item-duration">\r\n        <%= video.get(\'prettyDuration\') %>	\r\n    </span>\r\n</span>\r\n\r\n<span class="hover-actions">\r\n    <button class="button-icon playInStream" title="<%= playMessage %>">\r\n        <i class="fa fa-play"></i>\r\n    </button>\r\n    \r\n    <button class="button-icon addToStream" title="<%= enqueueMessage %>">\r\n        <i class="fa fa-plus"></i>\r\n    </button>\r\n    \r\n    <button class="button-icon save <%= userLoaded ? \'\' : \'disabled\' %>" title="<%= userLoaded ? saveMessage : cantSaveNotSignedInMessage %>">\r\n        <i class="fa fa-save"></i>\r\n    </button>\r\n</span>'}),define("text!template/saveVideos.html",[],function(){return'<select class="submittable" placeholder="<%= chrome.i18n.getMessage(\'typeToCreateOrFilterPlaylists\') %>...">\r\n\r\n</select>'}),define("foreground/view/saveVideosView",["foreground/view/genericForegroundView","text!template/saveVideos.html","foreground/collection/playlists"],function(e,t,i){"use strict";var n=e.extend({className:"saveVideos",template:_.template(t),creating:!1,render:function(){var e=this;this.$el.html(this.template({"chrome.i18n":chrome.i18n}));var t=i.map(function(e){return{id:e.get("id"),title:e.get("title"),displayInfo:e.get("displayInfo")}});this.playlistSelect=this.$el.find("select.submittable");var n=i.getActivePlaylist().get("id");return this.playlistSelect.selectize({persist:!1,maxItems:1,mode:"multi",valueField:"id",labelField:"title",searchField:["title"],options:t,plugins:["remove_button"],render:{item:function(e,t){return'<div><span class="title">'+t(e.title)+"</span>"+"</div>"},option:function(e,t){var i=e.id===n?"selected":"",s='<div class="'+i+'">';return s+='<span class="label">'+t(e.title)+"</span>",s+='<span class="caption">'+t(e.displayInfo)+"</span>",s+="</div>"}},create:function(t){var i=!1,n=$.trim(t);return""!==n&&(i={id:_.uniqueId("newPlaylist_"),title:n}),e.creating=!0,e.trigger("change:creating",e.creating),i},onDelete:function(){e.creating=!1,e.trigger("change:creating",e.creating)}}),this},validate:function(){var e=this.playlistSelect.val(),t=null!==e&&e.length>0;return t},doOk:function(){var e=this.playlistSelect.val();if(this.creating){var t=this.$el.find(".selectize-input").find("span.title").text();i.addPlaylistWithVideos(t,this.model)}else{var n=i.get(e);n.addByVideos(this.model)}}});return n}),define("foreground/view/prompt/saveVideosPromptView",["foreground/view/prompt/genericPromptView","foreground/view/saveVideosView"],function(e,t){"use strict";var i=e.extend({title:"",okButtonText:chrome.i18n.getMessage("save"),model:null,initialize:function(i){this.model=new t({model:i.videos}),this.title=1===i.videos.length?chrome.i18n.getMessage("saveVideo"):chrome.i18n.getMessage("saveVideos"),this.listenTo(this.model,"change:creating",function(e){e?this.okButton.text(chrome.i18n.getMessage("createPlaylist")):this.okButton.text(chrome.i18n.getMessage("save"))}),e.prototype.initialize.call(this,arguments)}});return i}),define("foreground/view/videoSearch/videoSearchResultView",["foreground/view/genericForegroundView","foreground/model/foregroundViewManager","text!template/videoSearchResult.html","foreground/collection/contextMenuGroups","foreground/collection/streamItems","foreground/view/prompt/saveVideosPromptView","enum/listItemType","foreground/model/user"],function(e,t,i,n,s,o,r,l){"use strict";var a=Backbone.Marionette.ItemView.extend({className:"listItem videoSearchResult multiSelectItem",template:_.template(i),attributes:function(){return{"data-id":this.model.get("id"),"data-type":r.VideoSearchResult}},events:{"click button.playInStream":"playInStream","click button.addToStream":"addToStream","click @ui.saveButton":"saveToPlaylist",contextmenu:"showContextMenu",dblclick:"playInStream","dblclick button.playInStream":"playInStream","dblclick button.save":"saveToPlaylist","dblclick button.addToStream":"addToStream"},ui:{imageThumbnail:"img.item-thumb",saveButton:"button.save"},templateHelpers:function(){return{hdMessage:chrome.i18n.getMessage("hd"),playMessage:chrome.i18n.getMessage("play"),enqueueMessage:chrome.i18n.getMessage("enqueue"),saveMessage:chrome.i18n.getMessage("save"),userLoaded:l.get("loaded"),cantSaveNotSignedInMessage:chrome.i18n.getMessage("cantSaveNotSignedIn"),instant:this.instant}},modelEvents:{"change:selected":"setHighlight",destroy:"remove"},onRender:function(){this.setHighlight(),e.prototype.initializeTooltips.call(this)},initialize:function(e){this.instant=e&&void 0!==e.instant?e.instant:this.instant},setHighlight:function(){this.$el.toggleClass("selected",this.model.get("selected"))},playInStream:_.debounce(function(){var e=this.model.get("video");return s.addByVideo(e,!0),!1},100,!0),addToStream:_.debounce(function(){var e=this.model.get("video");return s.addByVideo(e,!1),!1},100,!0),saveToPlaylist:_.debounce(function(){if(!this.ui.saveButton.hasClass("disabled")){var e=this.model.get("video"),t=new o({videos:[e]});t.fadeInAndShow()}return!1},100,!0),showContextMenu:function(e){e.preventDefault(),n.reset();var t=this.model.get("video");n.add({items:[{text:chrome.i18n.getMessage("play"),onClick:function(){s.addByVideo(t,!0)}},{text:chrome.i18n.getMessage("enqueue"),onClick:function(){s.addByVideo(t,!1)}},{text:chrome.i18n.getMessage("copyUrl"),onClick:function(){chrome.extension.sendMessage({method:"copy",text:t.get("url")})}},{text:chrome.i18n.getMessage("copyTitleAndUrl"),onClick:function(){chrome.extension.sendMessage({method:"copy",text:'"'+t.get("title")+'" - '+t.get("url")})}},{text:chrome.i18n.getMessage("watchOnYouTube"),onClick:function(){chrome.tabs.create({url:t.get("url")})}}]})}});return a}),define("foreground/view/multiSelectCompositeView",["foreground/view/genericForegroundView","foreground/view/activePlaylistArea/playlistItemView","foreground/view/rightPane/stream/streamItemView","foreground/view/videoSearch/videoSearchResultView","enum/listItemType","foreground/collection/streamItems"],function(e,t,i,n,s,o){"use strict";var r=Backbone.Marionette.CompositeView.extend({isFullyVisible:!1,events:{"click .listItem":"setSelectedOnClick"},onRender:function(){var e=this;return this.$el.find(this.itemViewContainer).sortable({connectWith:".droppable-list",cursorAt:{right:35,bottom:40},delay:100,placeholder:"sortable-placeholder listItem hiddenUntilChange",helper:function(o,r){var l,a={model:e.collection.get(r.data("id")),instant:!0},d=r.data("type");switch(d){case s.PlaylistItem:l=new t(a);break;case s.StreamItem:l=new i(a);break;case s.VideoSearchResult:l=new n(a);break;default:throw"Unhandled ListItemType: "+d}return this.copyHelper=l.render().$el.insertAfter(r),this.copyHelper.addClass("copyHelper"),this.backCopyHelper=r.prev(),this.backCopyHelper.addClass("copyHelper"),$(this).data("copied",!1),$("<span>",{"class":"selectedModelsLength"})},change:function(){$(".hiddenUntilChange").removeClass("hiddenUntilChange")},start:function(t,i){var n=e.collection.get(i.item.data("id"));e.doSetSelected({modelToSelect:n,drag:!0}),this.selectedItems=e.$el.find(".selected"),this.selectedItems.css({opacity:".5"}),i.helper.text(e.collection.selected().length),i.item.data("sortableItem").scrollParent=i.placeholder.parent(),i.item.data("sortableItem").overflowOffset=i.placeholder.parent().offset()},stop:function(t,i){this.backCopyHelper.removeClass("copyHelper");var n=$(this).data("copied");if(n)this.copyHelper.removeClass("copyHelper");else{this.copyHelper.remove();var o=i.item.data("type");o===s.PlaylistItem&&e.collection.moveToIndex(i.item.data("id"),i.item.index())}this.selectedItems.css({opacity:"1"}),this.copyHelper=null,this.backCopyHelper=null,this.selectedItems=null;var r=i.item.data("type")===s.VideoSearchResult;return n||!r},tolerance:"pointer",receive:function(t,i){if(_.isUndefined(e.collection))return i.item.remove(),i.sender.data("copied",!0),void 0;var n=i.item.data("type");if(n===s.StreamItem){var r=i.item.data("id"),l=o.get(r);i.item.removeClass("selected");var a=e.collection.videoAlreadyExists(l.get("video"));if(a)i.item.remove();else{e.collection.addByVideoAtIndex(l.get("video"),i.item.index(),function(){i.item.remove()});var d=$(".playlistEmpty");d.length>0&&d.addClass("hidden")}}i.sender.data("copied",!0)},over:function(e,t){t.item.data("sortableItem").scrollParent=t.placeholder.parent(),t.item.data("sortableItem").overflowOffset=t.placeholder.parent().offset()}}),this},setSelectedOnClick:function(e){var t=$(e.currentTarget).data("id"),i=this.collection.get(t);this.doSetSelected({shiftKey:e.shiftKey,ctrlKey:e.ctrlKey,modelToSelect:i})},doSetSelected:function(e){var t=e.modelToSelect,i=e.shiftKey||!1,n=e.ctrlKey||!1,s=e.drag||!1,o=t.get("selected");if(t.set("selected",n&&o?!1:!0),i){var r=0,l=this.collection.indexOf(t);this.collection.selected().length>1&&(r=this.collection.indexOf(this.collection.firstSelected())),this.collection.each(function(e,t){var i=l>=t&&t>=r,n=t>=l&&r>=t;e.set("selected",n||i)})}else n?t.set("firstSelected",!0):s&&o||this.collection.deselectAllExcept(t.cid)},appendHtml:function(e,t,i){var n=e.itemViewContainer?e.$(e.itemViewContainer):e.$el,s=n.children();s.size()<=i?n.append(t.el):s.eq(i).before(t.el)}});return r}),define("foreground/view/activePlaylistArea/activePlaylistAreaView",["foreground/view/genericForegroundView","foreground/model/foregroundViewManager","text!template/activePlaylistArea.html","foreground/view/multiSelectCompositeView","foreground/collection/contextMenuGroups","foreground/view/activePlaylistArea/playlistItemView","foreground/model/user","foreground/collection/streamItems"],function(e,t,i,n,s,o,r,l){"use strict";var a=n.extend({id:"activePlaylistArea",className:"left-pane",template:_.template(i),itemView:o,itemViewContainer:"#activePlaylistItems",isFullyVisible:!0,ui:{playlistDetails:".playlist-details",playlistTitle:".playlistTitle",playlistEmptyMessage:"div.playlistEmpty",signingInMessage:"div.signingIn",signInPrompt:"div.signIn",signInFailedMessage:"div.signInFailed",bottomMenubar:".left-bottom-menubar",multiSelectItemContainer:"#activePlaylistItems",signInRetryTimer:"#signInRetryTimer"},events:_.extend({},n.prototype.events,{"input @ui.searchInput":"showVideoSuggestions","click button#hideVideoSearch":"destroyModel","click button.addAll":"addAllToStream","click button.playAll":"playAllInStream","click @ui.signInPrompt":"signIn"}),templateHelpers:function(){return{openMenu:chrome.i18n.getMessage("openMenu"),showVideoSearch:chrome.i18n.getMessage("showVideoSearch"),searchForVideos:chrome.i18n.getMessage("searchForVideos"),playlistEmpty:chrome.i18n.getMessage("playlistEmpty"),wouldYouLikeTo:chrome.i18n.getMessage("wouldYouLikeTo"),signingIn:chrome.i18n.getMessage("signingIn"),signInMessage:chrome.i18n.getMessage("signIn"),enqueueAll:chrome.i18n.getMessage("enqueueAll"),playAll:chrome.i18n.getMessage("playAll"),signInFailedMessage:chrome.i18n.getMessage("signInFailed"),pleaseWaitMessage:chrome.i18n.getMessage("pleaseWait"),signInRetryTimer:r.get("signInRetryTimer"),playlistTitle:this.model?this.model.get("title"):"",playlistDisplayInfo:this.model?this.model.get("displayInfo"):""}},modelEvents:{"change:displayInfo":"updatePlaylistDetails","change:title":"updatePlaylistTitle"},collectionEvents:{"add remove reset":function(){this.toggleBigText(),this.toggleBottomMenubar()}},onAfterItemAdded:function(e){this.isFullyVisible&&e.ui.imageThumbnail.lazyload({container:this.ui.streamItems,threshold:250})},onShow:function(){setTimeout(function(){$(this.children.map(function(e){return e.ui.imageThumbnail.toArray()})).lazyload({container:this.ui.streamItems,threshold:250}),this.isFullyVisible=!0}.bind(this))},onRender:function(){e.prototype.initializeTooltips.call(this),this.toggleBigText(),this.toggleBottomMenubar(),n.prototype.onRender.call(this,arguments)},initialize:function(){t.subscribe(this),this.listenTo(r,"change:loaded change:signingIn change:signInFailed",this.toggleBigText),this.listenTo(r,"change:signInRetryTimer",this.updateSignInRetryTimer)},updateSignInRetryTimer:function(){this.ui.signInRetryTimer.text(r.get("signInRetryTimer"))},updatePlaylistDetails:function(){this.ui.playlistDetails.text(this.model.get("displayInfo"))},updatePlaylistTitle:function(){var e=this.model.get("title");this.ui.playlistTitle.text(e),this.ui.playlistTitle.qtip("option","content.text",e)},toggleBigText:function(){var e=r.get("loaded"),t=r.get("signingIn"),i=r.get("signInFailed");console.log("loaded, signingin, failed",e,t,i),this.ui.signInFailedMessage.toggleClass("hidden",!i),this.ui.signingInMessage.toggleClass("hidden",e&&!t),this.ui.signInPrompt.toggleClass("hidden",e||t),this.ui.playlistEmptyMessage.toggleClass("hidden",!e||this.collection.length>0)},toggleBottomMenubar:function(){var e=!_.isUndefined(this.collection);if(e){var t=0===this.collection.length;t?this.ui.bottomMenubar.hide():this.ui.bottomMenubar.show()}else this.ui.bottomMenubar.hide()},showContextMenu:function(e){if(e.preventDefault(),e.target===e.currentTarget||$(e.target).hasClass("big-text")||$(e.target).hasClass("i-4x")){s.reset();var t=_.isUndefined(this.collection)||0===this.collection.length;s.add({items:[{text:chrome.i18n.getMessage("enqueuePlaylist"),disabled:t,title:t?chrome.i18n.getMessage("playlistEmpty"):"",onClick:function(){l.addByPlaylistItems(this.model,!1)}.bind(this)},{text:chrome.i18n.getMessage("playPlaylist"),disabled:t,title:t?chrome.i18n.getMessage("playlistEmpty"):"",onClick:function(){l.addByPlaylistItems(this.model,!0)}.bind(this)}]})}},addAllToStream:function(){l.addByPlaylistItems(this.model.get("items"),!1)},playAllInStream:function(){l.addByPlaylistItems(this.model.get("items"),!0)},signIn:function(){r.signIn()}});return a}),define("text!template/videoSearch.html",[],function(){return'<div class="left-top-bar">\r\n    <div class="searchBar">\r\n        <input placeholder="<%= searchMessage %>..." type="text" value="<%= searchQuery %>">\r\n        <div class="underline"></div>\r\n    </div>\r\n    \r\n    <button class="button-icon remove" id="hideVideoSearch" title="<%= hideVideoSearchMessage %>">\r\n        <i class="fa fa-times"></i>\r\n    </button>\r\n</div>\r\n\r\n<div class="left-top-divider"></div>\r\n\r\n<div class="big-text-wrapper">\r\n    \r\n    <div class="big-text instructions">\r\n        <div class="big-text-header"><%= startTypingMessage %></div>\r\n        <%= resultsWillAppearAsYouSearchMessage %>.\r\n    </div>\r\n\r\n    <div class="big-text searching hidden">\r\n        <div class="big-text-header"><%= searchingMessage %>...</div>\r\n        <div class="spinner spinner-medium"></div>\r\n    </div>\r\n\r\n    <div class="big-text noResults hidden">\r\n        <div class="big-text-header"><%= noResultsFoundMessage %></div>\r\n        <%= sorryAboutThatMessage %>. <%= trySearchingForSomethingElseMessage %>.\r\n    </div>\r\n    \r\n    <div id="videoSearchResults" class="left-list"></div>\r\n</div>\r\n\r\n<div class="left-bottom-menubar">\r\n    <div class="playlist-actions">\r\n        <button id="playSelected" class="button-label" title="<%= playSelectedMessage %>">\r\n            <i class="fa fa-play"></i>\r\n            <%= playSelectedMessage %>\r\n        </button>\r\n        <button id="saveSelected" class="button-label" title="<%= saveSelectedMessage %>">\r\n            <i class="fa fa-save"></i>\r\n            <%= saveSelectedMessage %>\r\n        </button>\r\n    </div>\r\n</div>'}),define("foreground/view/videoSearch/videoSearchView",["foreground/view/genericForegroundView","foreground/view/multiSelectCompositeView","foreground/model/foregroundViewManager","text!template/videoSearch.html","foreground/view/videoSearch/videoSearchResultView","foreground/collection/contextMenuGroups","foreground/view/prompt/saveVideosPromptView","foreground/model/user","foreground/collection/streamItems"],function(e,t,i,n,s,o,r,l,a){"use strict";
var d=t.extend({id:"videoSearch",className:"left-pane",template:_.template(n),itemViewContainer:"#videoSearchResults",isFullyVisible:!0,itemView:s,ui:{bottomMenubar:".left-bottom-menubar",searchInput:".searchBar input",searchingMessage:"div.searching",instructions:"div.instructions",noResultsMessage:"div.noResults",bigTextWrapper:"div.big-text-wrapper",multiSelectItemContainer:"#videoSearchResults",saveSelectedButton:"button#saveSelected"},events:_.extend({},t.prototype.events,{"input @ui.searchInput":"search","click button#hideVideoSearch":"hide","contextmenu @ui.multiSelectItemContainer":"showContextMenu","click button#playSelected":"playSelected","click @ui.saveSelectedButton":"showSaveSelectedPrompt"}),templateHelpers:function(){return{saveSelectedMessage:chrome.i18n.getMessage("saveSelected"),playSelectedMessage:chrome.i18n.getMessage("playSelected"),searchMessage:chrome.i18n.getMessage("search"),hideVideoSearchMessage:chrome.i18n.getMessage("hideVideoSearch"),startTypingMessage:chrome.i18n.getMessage("startTyping"),resultsWillAppearAsYouSearchMessage:chrome.i18n.getMessage("resultsWillAppearAsYouSearch"),searchingMessage:chrome.i18n.getMessage("searching"),noResultsFoundMessage:chrome.i18n.getMessage("noResultsFound"),sorryAboutThatMessage:chrome.i18n.getMessage("sorryAboutThat"),trySearchingForSomethingElseMessage:chrome.i18n.getMessage("trySearchingForSomethingElse"),cantSaveNotSignedInMessage:chrome.i18n.getMessage("cantSaveNotSignedIn")}},modelEvents:{"change:searchJqXhr change:searchQuery change:typing":"toggleBigText"},collectionEvents:{reset:"toggleBigText","change:selected":"toggleBottomMenubar"},onAfterItemAdded:function(e){this.isFullyVisible&&e.ui.imageThumbnail.lazyload({container:this.ui.streamItems,threshold:250})},onRender:function(){console.log("onRender being called"),this.toggleBigText(),this.toggleBottomMenubar(),this.toggleSaveSelected(),e.prototype.initializeTooltips.call(this),t.prototype.onRender.apply(this,arguments)},initialize:function(){$(window).on("unload.videoSearch",this.onClose.bind(this)),i.subscribe(this),this.listenTo(l,"change:loaded",this.toggleSaveSelected)},onShow:function(){chrome.extension.getBackgroundPage().stopClearResultsTimer(),this.ui.searchInput.focus().val(this.ui.searchInput.val());var e=this.model.get("doSnapAnimation")?void 0:0;this.$el.transition({x:this.$el.width()},e,"snap",function(){$(this.children.map(function(e){return e.ui.imageThumbnail.toArray()})).lazyload({container:this.ui.streamItems,threshold:250}),this.isFullyVisible=!0}.bind(this))},onClose:function(){$(window).off("unload.videoSearch"),i.unsubscribe(this),this.model.saveSearchQuery(),this.startClearResultsTimeout()},hide:function(){this.$el.transition({x:-20},function(){this.model.destroy()}.bind(this))},startClearResultsTimeout:function(){chrome.extension.getBackgroundPage().startClearResultsTimer()},search:function(){var e=$.trim(this.ui.searchInput.val());this.model.search(e)},toggleSaveSelected:function(){var e=l.get("loaded");this.ui.saveSelectedButton.toggleClass("disabled",!e);var t=this.templateHelpers();console.log("userLoaded and templateHelpers",e,t),this.ui.saveSelectedButton.attr("title",e?t.saveSelectedMessage:t.cantSaveNotSignedInMessage)},toggleBottomMenubar:function(){0===this.collection.selected().length?(this.ui.bottomMenubar.hide(),this.ui.bigTextWrapper.addClass("extended")):(this.ui.bottomMenubar.show(),this.ui.bigTextWrapper.removeClass("extended"))},toggleBigText:function(){var e=null===this.model.get("searchJqXhr")&&!this.model.get("typing");console.log("This.ui.searchingMessage:",this.ui.searchingMessage),this.ui.searchingMessage.toggleClass("hidden",e);var t=this.collection.length>0,i=this.model.get("searchQuery").length>0;this.ui.instructions.toggleClass("hidden",t||i);var n=e&&i&&!t;this.ui.noResultsMessage.toggleClass("hidden",!n)},showContextMenu:function(e){console.log("Showing context menu"),(e.target===e.currentTarget||$(e.target).hasClass("big-text")||$(e.target).hasClass("i-4x"))&&o.reset();var t=this.collection.getSelectedVideos();o.add({items:[{text:chrome.i18n.getMessage("playSelected")+" ("+t.length+")",disabled:0===t.length,onClick:function(){a.addByVideos(t,!0)}},{text:chrome.i18n.getMessage("enqueueSelected")+" ("+t.length+")",disabled:0===t.length,onClick:function(){a.addByVideos(t,!1)}}]})},playSelected:function(){a.addByVideos(this.collection.getSelectedVideos(),!0)},showSaveSelectedPrompt:function(){var e=this.ui.saveSelectedButton.hasClass("disabled");if(!e){var t=new r({videos:this.collection.getSelectedVideos()});t.fadeInAndShow()}return!e},shake:function(){this.$el.effect("shake")}});return d}),define("foreground/collection/videoSearchResults",[],function(){"use strict";return chrome.extension.getBackgroundPage().VideoSearchResults}),define("foreground/model/videoSearch",["foreground/collection/videoSearchResults","foreground/model/settings","enum/dataSourceType","common/model/youTubeV2API","common/model/utility","common/model/dataSource"],function(e,t,i,n,s,o){"use strict";var r=Backbone.Model.extend({defaults:function(){return{searchQuery:t.get("searchQuery"),doSnapAnimation:!0,isFullyVisible:!1,searchJqXhr:null,playlist:null,typing:!1}},initialize:function(){var t=this.get("searchQuery");""!==t&&0===e.length&&(console.log("searching"),this.search(t))},saveSearchQuery:function(){t.set("searchQuery",this.get("searchQuery"))},search:function(t){this.set("searchQuery",t);var i=this.get("searchJqXhr");return i&&i.abort(),""===$.trim(t)?(e.setFromVideoInformationList([]),void 0):(this.set("typing",!0),this.doDebounceSearch(t),void 0)},onSearchComplete:function(){this.set("searchJqXhr",null)},doDebounceSearch:_.debounce(function(t){var s,r=this,l=new o({urlToParse:t});s=l.get("type")===i.YouTubeVideo?n.getVideoInformation({videoId:l.get("sourceId"),success:function(t){e.setFromVideoInformation(t)},complete:this.onSearchComplete.bind(this)}):n.search({text:t,success:function(i){t===r.get("searchQuery")&&e.setFromVideoInformationList(i)},complete:this.onSearchComplete.bind(this)}),this.set("searchJqXhr",s),this.set("typing",!1)},350)});return r}),define("text!template/rightPane.html",[],function(){return'<div class="top-bar">\r\n    \r\n    <div class="center-group">\r\n    </div>\r\n    <div class="right-group">\r\n\r\n    </div>\r\n</div>\r\n\r\n<div id="stream">\r\n    \r\n</div>\r\n\r\n'}),define("text!template/stream.html",[],function(){return'<div class="big-text-wrapper">\r\n    \r\n    <div class="big-text streamEmpty">\r\n        <div class="big-text-header"><%= chrome.i18n.getMessage(\'streamEmpty\') %></div>\r\n        \r\n        <%= chrome.i18n.getMessage(\'whyNotAddAVideoFromAPlaylistOr\') %> <span id="videoSearchLink" class="searchLink clickable lowercase"><%= chrome.i18n.getMessage(\'searchForVideos\') %></span>?\r\n    </div>\r\n    \r\n    <div id="streamItems" class="left-list droppable-list"></div>\r\n</div>\r\n\r\n<div class="context-buttons">\r\n    \r\n    <div class="left-group">\r\n        <div id="shuffleButtonView" class="view-placeholder"></div>\r\n        <div id="repeatButtonView" class="view-placeholder"></div>\r\n        <div id="radioButtonView" class="view-placeholder"></div>\r\n    </div>\r\n    \r\n    <div class="right-group">\r\n        \r\n        <button id="saveStream" class="button-icon button-small save <%= userLoaded ? \'\' : \'disabled\' %>" title="<%= userLoaded ? saveStreamMessage : cantSaveNotSignedInMessage %>">\r\n            <i class="fa fa-save"></i>\r\n        </button>\r\n\r\n        <button id="clearStream" class="button-icon button-small clear" title="<%= chrome.i18n.getMessage(\'clearStream\') %>" >\r\n            <i class="fa fa-trash-o"></i>\r\n        </button>\r\n    </div>\r\n\r\n</div>'}),define("enum/repeatButtonState",{Disabled:0,RepeatVideo:1,RepeatStream:2}),define("text!template/repeatButton.html",[],function(){return'<% if(state === RepeatButtonState.RepeatStream) { %>\r\n    <i class="fa fa-repeat repeatStream"></i>\r\n<% } else if( state === RepeatButtonState.RepeatVideo) { %>\r\n    <i class="fa fa-repeat repeatVideo"></i>\r\n<% } else { %>\r\n    <i class="fa fa-repeat"></i>\r\n<% } %>'}),define("foreground/view/rightPane/stream/repeatButtonView",["foreground/view/genericForegroundView","enum/repeatButtonState","text!template/repeatButton.html"],function(e,t,i){"use strict";var n=e.extend({tagName:"button",className:"button-icon button-small",template:_.template(i),events:{click:"toggleRepeat"},model:chrome.extension.getBackgroundPage().RepeatButton,disabledTitle:chrome.i18n.getMessage("repeatDisabled"),repeatVideoTitle:chrome.i18n.getMessage("repeatVideo"),repeatStreamTitle:chrome.i18n.getMessage("repeatStream"),render:function(){this.$el.html(this.template(_.extend(this.model.toJSON(),{RepeatButtonState:t})));var e=this.model.get("state");switch(this.$el.toggleClass("enabled",e!==t.Disabled),e){case t.Disabled:this.$el.attr("title",this.disabledTitle);break;case t.RepeatVideo:this.$el.attr("title",this.repeatVideoTitle);break;case t.RepeatStream:this.$el.attr("title",this.repeatStreamTitle);break;default:console.error("Unhandled repeatButtonState:",e)}return this},initialize:function(){this.listenTo(this.model,"change:state",this.render)},toggleRepeat:function(){this.model.toggleRepeat()}});return n}),define("text!template/shuffleButton.html",[],function(){return'<i class="fa fa-random"></i>'}),define("foreground/view/rightPane/stream/shuffleButtonView",["foreground/view/genericForegroundView","text!template/shuffleButton.html"],function(e,t){"use strict";var i=e.extend({tagName:"button",className:"button-icon button-small",template:_.template(t),events:{click:"toggleShuffle"},model:chrome.extension.getBackgroundPage().ShuffleButton,enabledTitle:chrome.i18n.getMessage("shuffleEnabled"),disabledTitle:chrome.i18n.getMessage("shuffleDisabled"),render:function(){this.$el.html(this.template(this.model.toJSON()));var e=this.model.get("enabled");return this.$el.toggleClass("enabled",e),e?this.$el.attr("title",this.enabledTitle):this.$el.attr("title",this.disabledTitle),this},initialize:function(){this.listenTo(this.model,"change:enabled",this.render)},toggleShuffle:function(){this.model.toggleEnabled()}});return i}),define("text!template/radioButton.html",[],function(){return'<i class="fa fa-rss"></i>'}),define("foreground/view/rightPane/stream/radioButtonView",["foreground/view/genericForegroundView","text!template/radioButton.html"],function(e,t){"use strict";var i=e.extend({tagName:"button",className:"button-icon button-small",template:_.template(t),model:chrome.extension.getBackgroundPage().RadioButton,events:{click:"toggleRadio"},enabledTitle:chrome.i18n.getMessage("radioEnabled"),disabledTitle:chrome.i18n.getMessage("radioDisabled"),render:function(){this.$el.html(this.template(this.model.toJSON()));var e=this.model.get("enabled");return this.$el.toggleClass("enabled",e),e?this.$el.attr("title",this.enabledTitle):this.$el.attr("title",this.disabledTitle),this},initialize:function(){this.listenTo(this.model,"change:enabled",this.render)},toggleRadio:function(){this.model.toggleRadio()}});return i}),define("text!template/clearStream.html",[],function(){return'<%= chrome.i18n.getMessage(\'areYouSureYouWantToClearYourStream\') %>\r\n\r\n<div class="reminder">\r\n    <input type="checkbox" id="remindClearStream">\r\n	<label for="remindClearStream"><%= chrome.i18n.getMessage(\'dontRemindMeAgain\') %></label>\r\n</div>\r\n'}),define("foreground/view/clearStreamView",["foreground/view/genericForegroundView","text!template/clearStream.html","foreground/model/settings","foreground/collection/streamItems"],function(e,t,i,n){"use strict";var s=e.extend({className:"clearStream",template:_.template(t),render:function(){return this.$el.html(this.template({"chrome.i18n":chrome.i18n})),this},doOk:function(){var e=!this.$el.find("input#remindClearStream").is(":checked");i.set("remindClearStream",e),n.clear()}});return s}),define("foreground/model/streamAction",["foreground/model/settings","foreground/collection/streamItems","foreground/view/prompt/genericPromptView","foreground/view/clearStreamView","foreground/view/saveVideosView"],function(e,t,i,n,s){var o=Backbone.Model.extend({clearStream:function(){if(t.length>0){var s=e.get("remindClearStream");if(s){var o=new i({title:chrome.i18n.getMessage("areYouSure"),model:new n});o.fadeInAndShow()}else t.clear()}},saveStream:function(){if(t.length>0){var e=t.pluck("video"),n=new i({title:1===t.length?chrome.i18n.getMessage("saveVideo"):chrome.i18n.getMessage("saveVideos"),okButtonText:chrome.i18n.getMessage("save"),model:new s({model:e})});n.listenTo(n.model,"change:creating",function(e){e?this.okButton.text(chrome.i18n.getMessage("createPlaylist")):this.okButton.text(chrome.i18n.getMessage("save"))}),n.fadeInAndShow()}}});return new o}),define("foreground/mixin/unwrappedRegionMixin",{open:function(e){console.log("Show is going"),e.$el.children().clone(!0).appendTo(this.$el)}}),define("foreground/view/rightPane/stream/streamView",["foreground/view/genericForegroundView","foreground/model/foregroundViewManager","text!template/stream.html","foreground/view/rightPane/stream/repeatButtonView","foreground/view/rightPane/stream/shuffleButtonView","foreground/view/rightPane/stream/radioButtonView","foreground/collection/contextMenuGroups","enum/listItemType","foreground/model/streamAction","foreground/view/rightPane/stream/streamItemView","foreground/collection/playlists","foreground/collection/videoSearchResults","foreground/mixin/unwrappedRegionMixin","foreground/model/user"],function(e,t,i,n,s,o,r,l,a,d,u,c,h,g){"use strict";var m=Backbone.Marionette.CompositeView.extend({template:_.template(i),itemViewContainer:"#streamItems",itemView:d,isFullyVisible:!1,events:{"contextmenu @ui.streamItems":"showContextMenu","click button#clearStream":"clear","click button#saveStream:not(.disabled)":"save","scroll @ui.streamItems":"loadVisible"},triggers:{"contextmenu @ui.streamItems":{event:"showContextMenu",preventDefault:!0}},ui:{streamEmptyMessage:".streamEmpty",contextButtons:".context-buttons",streamItems:"#streamItems"},templateHelpers:function(){return{saveStreamMessage:chrome.i18n.getMessage("saveStream"),cantSaveNotSignedInMessage:chrome.i18n.getMessage("cantSaveNotSignedIn"),userLoaded:g.get("loaded")}},onAfterItemAdded:function(e){this.isFullyVisible&&e.ui.imageThumbnail.lazyload({container:this.ui.streamItems,threshold:250})},onShow:function(){setTimeout(function(){$(this.children.map(function(e){return e.ui.imageThumbnail.toArray()})).lazyload({container:this.ui.streamItems,threshold:250}),this.isFullyVisible=!0}.bind(this))},onRender:function(){this.$el.find("#shuffleButtonView").replaceWith((new s).render().el),this.$el.find("#repeatButtonView").replaceWith((new n).render().el),this.$el.find("#radioButtonView").replaceWith((new o).render().el),this.toggleBigText(),this.toggleContextButtons(),this.collection.selected().length>0&&(this.$el.find(".listItem.selected").scrollIntoView(!1),this.$el.trigger("scroll"));var e=this;this.$el.find(this.itemViewContainer).sortable({connectWith:".droppable-list",cursorAt:{right:35,bottom:40},placeholder:"sortable-placeholder listItem hiddenUntilChange",helper:function(t,i){var n=new d({model:e.collection.get(i.data("id")),instant:!0});return this.copyHelper=n.render().$el.insertAfter(i),this.copyHelper.css({opacity:".5"}).addClass("copyHelper"),this.backCopyHelper=i.prev(),this.backCopyHelper.addClass("copyHelper"),$(this).data("copied",!1),$("<span>",{"class":"selectedModelsLength",text:"1"})},change:function(){$(".hiddenUntilChange").removeClass("hiddenUntilChange")},start:function(t,i){var n=u.getActivePlaylist();if(_.isUndefined(n))i.placeholder.addClass("noPlaylist");else{var s=i.item.data("id"),o=e.collection.get(s),r=n.get("items").videoAlreadyExists(o.get("video"));i.placeholder.toggleClass("noDrop",r)}i.item.data("sortableItem").scrollParent=i.placeholder.parent(),i.item.data("sortableItem").overflowOffset=i.placeholder.parent().offset()},stop:function(){this.backCopyHelper.removeClass("copyHelper");var e=$(this).data("copied");e?this.copyHelper.css({opacity:1}).removeClass("copyHelper"):this.copyHelper.remove(),this.copyHelper=null,this.backCopyHelper=null},tolerance:"pointer",receive:function(t,i){var n=i.item.data("type");if(n===l.PlaylistItem){var s=u.getActivePlaylist().get("items"),o=s.selected();e.collection.addByDraggedPlaylistItems(o,i.item.index()),s.deselectAll()}else if(n===l.VideoSearchResult){var r=c.selected();e.collection.addByDraggedVideoSearchResults(r,i.item.index()),c.deselectAll()}return i.item.remove(),i.sender.data("copied",!0),!1},update:function(t,i){var n=i.item.data("type");if(n===l.StreamItem){var s=parseInt(i.item.parent().children(".listItem").index(i.item)),o=i.item.data("id"),r=e.collection.indexOf(e.collection.get(o));e.collection.models.splice(s,0,e.collection.models.splice(r,1)[0]),e.collection.trigger("sort")}},over:function(e,t){t.item.data("sortableItem").scrollParent=t.placeholder.parent(),t.item.data("sortableItem").overflowOffset=t.placeholder.parent().offset()}})},collectionEvents:{"add remove reset":function(){this.toggleBigText(),this.toggleContextButtons(),this.$el.trigger("scroll")},"change:selected":function(){var e=this.$el.find(".listItem.selected");1===e.length&&e.scrollIntoView(!0),this.$el.trigger("scroll")}},initialize:function(){t.subscribe(this)},toggleBigText:function(){this.ui.streamEmptyMessage.toggleClass("hidden",this.collection.length>0)},toggleContextButtons:function(){this.ui.contextButtons.toggle(this.collection.length>0)},showContextMenu:function(e){e.preventDefault(),e.target===e.currentTarget&&r.reset();var t=0===this.collection.length;r.add({items:[{text:chrome.i18n.getMessage("clearStream"),title:t?chrome.i18n.getMessage("streamEmpty"):"",disabled:t,onClick:function(){a.clearStream()}},{text:chrome.i18n.getMessage("saveStream"),title:t?chrome.i18n.getMessage("streamEmpty"):"",disabled:t,onClick:function(){a.saveStream()}}]})},appendHtml:function(e,t,i){var n=e.itemViewContainer?e.$(e.itemViewContainer):e.$el,s=n.children();s.size()<=i?n.append(t.el):s.eq(i).before(t.el)},clear:function(){a.clearStream()},save:function(){a.saveStream()}});return _.extend(m,h),m}),define("enum/playerState",{Unstarted:-1,Ended:0,Playing:1,Paused:2,Buffering:3,VideoCued:5}),define("text!template/playPauseButton.html",[],function(){return'<% if(playerState === PlayerState.Buffering) { %>\r\n    <div class="spinner spinner-small"></div>\r\n<% } else if(playerState === PlayerState.Playing) { %>\r\n    <i class="fa fa-pause fa-lg"></i>\r\n<% } else { %>\r\n    <i class="fa fa-play fa-lg"></i>\r\n<% } %>'}),define("foreground/view/rightPane/playPauseButtonView",["foreground/view/genericForegroundView","foreground/model/player","enum/playerState","text!template/playPauseButton.html"],function(e,t,i,n){"use strict";var s=e.extend({tagName:"button",className:"button-icon",template:_.template(n),model:chrome.extension.getBackgroundPage().PlayPauseButton,events:{click:"tryTogglePlayerState"},render:function(){this.$el.html(this.template(_.extend(this.model.toJSON(),{PlayerState:i,playerState:t.get("state")})));var e=this.model.get("enabled");return this.$el.toggleClass("disabled",!e),this},initialize:function(){this.listenTo(this.model,"change:enabled",this.render),this.listenTo(t,"change:state",this.render),this.render()},tryTogglePlayerState:function(){this.model.tryTogglePlayerState()}});return s}),define("text!template/previousButton.html",[],function(){return'<i class="fa fa-backward fa-lg"></i>'}),define("foreground/view/rightPane/previousButtonView",["foreground/view/genericForegroundView","text!template/previousButton.html"],function(e,t){"use strict";var i=e.extend({tagName:"button",className:"button-icon",template:_.template(t),model:chrome.extension.getBackgroundPage().PreviousButton,events:{click:"tryDoTimeBasedPrevious"},render:function(){this.$el.html(this.template(this.model.toJSON()));var e=this.model.get("enabled");return this.$el.toggleClass("disabled",!e),this},initialize:function(){this.listenTo(this.model,"change:enabled",this.render)},tryDoTimeBasedPrevious:function(){this.model.tryDoTimeBasedPrevious()}});return i}),define("text!template/nextButton.html",[],function(){return'<i class="fa fa-forward fa-lg"></i>'}),define("foreground/view/rightPane/nextButtonView",["foreground/view/genericForegroundView","text!template/nextButton.html"],function(e,t){"use strict";var i=e.extend({tagName:"button",className:"button-icon",model:chrome.extension.getBackgroundPage().NextButton,template:_.template(t),events:{click:"trySelectNextVideo"},render:function(){this.$el.html(this.template(this.model.toJSON()));var e=this.model.get("enabled");return this.$el.toggleClass("disabled",!e),this},initialize:function(){this.listenTo(this.model,"change:enabled",this.render)},trySelectNextVideo:function(){this.model.trySelectNextVideo()}});return i}),define("text!template/volumeControl.html",[],function(){return'<button class="mute button-icon<%= muted ? \' muted\' : \'\' %>">\r\n    \r\n</button>\r\n\r\n<div class="volume-slider">\r\n    \r\n    <div class="progress" style="height: <%= volume %>%">\r\n        \r\n    </div>\r\n\r\n    <input class="volumeRange" type="range" value="<%= volume %>">\r\n</div>'}),define("foreground/view/rightPane/volumeControlView",["foreground/view/genericForegroundView","text!template/volumeControl.html","foreground/model/player"],function(e,t,i){"use strict";var n=e.extend({className:"volumeControl",template:_.template(t),events:{"change input.volumeRange":"setVolume","click button.mute":"toggleMute",mousewheel:"scrollVolume"},rendered:!1,volumeSlider:null,progress:null,volumeRange:null,muteButton:null,render:function(){var e=i.get("volume"),t=i.get("muted");this.$el.html(this.template({"chrome.i18n":chrome.i18n,volume:e,muted:t})),this.volumeSlider=this.$el.children(".volume-slider"),this.progress=this.volumeSlider.children(".progress"),this.volumeRange=this.volumeSlider.children("input.volumeRange"),this.muteButton=this.$el.children("button.mute");var n=this.getVolumeIcon(e);return this.muteButton.html(n),this.rendered=!0,this},initialize:function(){this.listenTo(i,"change:muted",this.toggleMutedClass),this.listenTo(i,"change:volume",this.updateProgressAndVolumeIcon);var e={sensitivity:2,interval:5500},t=this;this.$el.hoverIntent(function(){$(this).data("oldheight",$(this).height()).transition({height:150},250,"snap"),t.volumeSlider.transition({opacity:1},250,"snap")},function(){$(this).transition({height:$(this).data("oldheight")},250),t.volumeSlider.transition({opacity:0},250)},e)},setVolume:function(){var e=parseInt(this.volumeRange.val());i.set("volume",e)},updateProgressAndVolumeIcon:function(){if(this.rendered){var e=parseInt(i.get("volume"));this.volumeRange.val(e),this.progress.height(e+"%");var t=this.getVolumeIcon(e);this.muteButton.html(t)}},getVolumeIcon:function(e){var t="off";e>50?t="up":e>0&&(t="down");var i=$("<i>",{"class":"fa fa-volume-"+t});return i},scrollVolume:function(e){var t=e.originalEvent.wheelDeltaY/120,n=parseInt(this.volumeRange.val())+3*t;n>100&&(n=100),0>n&&(n=0),i.set("volume",n)},toggleMute:function(){var e=i.get("muted");i.set("muted",!e)},toggleMutedClass:function(){if(this.rendered){var e=i.get("muted");this.muteButton.toggleClass("muted",e)}}});return n}),define("text!template/timeProgressArea.html",[],function(){return'<div class="time-slider">\r\n    <!--TODO: is this style property necessary? and default value on input?-->\r\n    <div class="progress" style="width: 33%"></div>\r\n    <input class="timeRange" type="range" value="33">\r\n</div>\r\n\r\n<span class="time-elapsed" title="<%= chrome.i18n.getMessage(\'elapsedTime\') %>"></span>\r\n<span class="duration" title="<%= chrome.i18n.getMessage(\'totalTime\') %>"></span>'}),define("foreground/view/rightPane/timeProgressAreaView",["foreground/view/genericForegroundView","text!template/timeProgressArea.html","foreground/collection/streamItems","foreground/model/player","common/model/utility","enum/playerState","foreground/model/settings"],function(e,t,i,n,s,o,r){"use strict";var l=e.extend({template:_.template(t),className:"timeProgressArea",events:{"change input.timeRange:not(.disabled)":"updateProgress","mousewheel input.timeRange:not(.disabled)":"mousewheelUpdateProgress","mousedown input.timeRange:not(.disabled)":"startSeeking","mouseup input.timeRange:not(.disabled)":"seekToTime","click .time-elapsed":"toggleShowTimeRemaining"},progress:null,timeRange:null,timeElapsedLabel:null,durationLabel:null,autoUpdate:!0,render:function(){return this.$el.html(this.template({"chrome.i18n":chrome.i18n})),this.progress=this.$el.find(".time-slider .progress"),this.timeRange=this.$el.find(".time-slider input.timeRange"),this.timeElapsedLabel=this.$el.find(".time-elapsed"),this.durationLabel=this.$el.find(".duration"),0===i.length&&this.timeRange.toggleClass("disabled",!0),this.setTotalTime(this.getCurrentVideoDuration()),this.setCurrentTime(n.get("currentTime")),this},initialize:function(){this.listenTo(i,"remove reset",this.clearOnEmpty),this.listenTo(i,"add",this.enable),this.listenTo(i,"change:selected",this.restart),this.listenTo(n,"change:currentTime",this.updateCurrentTime),this.listenTo(n,"change:state",this.stopSeeking)},mousewheelUpdateProgress:function(e){var t=e.originalEvent.wheelDeltaY/120,i=parseInt(this.timeRange.val());this.setCurrentTime(i+t),n.seekTo(i+t)},startSeeking:function(e){1===e.which&&(this.autoUpdate=!1)},stopSeeking:function(){var e=n.get("state");(e==o.Playing||e==o.Paused)&&(this.autoUpdate=!0)},seekToTime:function(e){if(1===e.which){var t=parseInt(this.timeRange.val());n.seekTo(t)}},toggleShowTimeRemaining:function(){var e=r.get("showTimeRemaining");r.set("showTimeRemaining",!e),e?this.timeElapsedLabel.attr("title",chrome.i18n.getMessage("elapsedTime")):this.timeElapsedLabel.attr("title",chrome.i18n.getMessage("timeRemaining")),this.timeElapsedLabel.toggleClass("timeRemaining",!e),this.updateProgress()},enable:function(){this.timeRange.toggleClass("disabled",!1)},clearOnEmpty:function(){0===i.length&&this.clear()},clear:function(){this.setCurrentTime(0),this.setTotalTime(0),this.timeRange.toggleClass("disabled",!0)},restart:function(){this.autoUpdate=!1,this.setCurrentTime(0),this.setTotalTime(this.getCurrentVideoDuration()),this.autoUpdate=!0},setCurrentTime:function(e){this.timeRange.val(e),this.updateProgress()},setTotalTime:function(e){this.timeRange.prop("max",e),this.updateProgress()},updateCurrentTime:function(){this.autoUpdate&&this.setCurrentTime(n.get("currentTime"))},updateProgress:function(){var e=parseInt(this.timeRange.val()),t=parseInt(this.timeRange.prop("max")),i=0===t?0:100*e/t;if(0>i||i>100)throw"Wow this really should not have been "+i;if(this.progress.width(i+"%"),r.get("showTimeRemaining")){var n=t-e;this.timeElapsedLabel.text(s.prettyPrintTime(n))}else this.timeElapsedLabel.text(s.prettyPrintTime(e));this.durationLabel.text(s.prettyPrintTime(t))},getCurrentVideoDuration:function(){var e=0;if(i.length>0){var t=i.getSelectedItem();e=t.get("video").get("duration")}return e}});return l}),define("foreground/model/buttons/videoDisplayButton",[],function(){"use strict";return chrome.extension.getBackgroundPage().VideoDisplayButton}),define("text!template/videoDisplayButton.html",[],function(){return'<i class="fa fa-film"></i>'}),define("foreground/view/rightPane/videoDisplayButtonView",["foreground/view/genericForegroundView","foreground/model/buttons/videoDisplayButton","text!template/videoDisplayButton.html"],function(e,t,i){"use strict";var n=e.extend({tagName:"button",className:"button-icon videoDisplay",template:_.template(i),model:t,events:{click:"toggleVideoDisplay"},enabledTitle:chrome.i18n.getMessage("hideVideo"),disabledTitle:chrome.i18n.getMessage("showVideo"),render:function(){return this.$el.html(this.template()),this.subRender(),this.$el.hide(),this},initialize:function(){this.listenTo(this.model,"change:enabled change:disabled",this.subRender)},toggleVideoDisplay:function(){this.$el.hasClass("disabled")||this.model.toggleEnabled()},subRender:function(){var e=this.model.get("disabled");this.$el.toggleClass("disabled",e);var t=this.model.get("enabled");t?this.$el.attr("title",this.enabledTitle):this.$el.attr("title",this.disabledTitle)}});return n}),define("foreground/view/rightPane/rightPaneView",["foreground/view/genericForegroundView","foreground/model/foregroundViewManager","text!template/rightPane.html","foreground/view/rightPane/stream/streamView","foreground/view/rightPane/playPauseButtonView","foreground/view/rightPane/previousButtonView","foreground/view/rightPane/nextButtonView","foreground/view/rightPane/volumeControlView","foreground/view/rightPane/timeProgressAreaView","foreground/view/rightPane/videoDisplayButtonView","foreground/collection/streamItems"],function(e,t,i,n,s,o,r,l,a,d,u){"use strict";var c=Backbone.Marionette.Layout.extend({className:"right-pane",template:_.template(i),regions:{stream:{selector:"#stream"}},playPauseButtonView:null,previousButtonView:null,nextButtonView:null,volumeControlView:null,timeProgressAreaView:null,videoDisplayButtonView:null,onRender:function(){var t=this.$el.children(".top-bar");t.after(this.timeProgressAreaView.render().el);var i=t.children(".center-group");i.before(this.volumeControlView.render().el),i.append(this.previousButtonView.render().el),i.append(this.playPauseButtonView.render().el),i.append(this.nextButtonView.render().el);var s=t.children(".right-group");s.append(this.videoDisplayButtonView.render().el),this.stream.show(new n({collection:u})),e.prototype.initializeTooltips.call(this)},initialize:function(){this.playPauseButtonView=new s,this.previousButtonView=new o,this.nextButtonView=new r,this.volumeControlView=new l,this.timeProgressAreaView=new a,this.videoDisplayButtonView=new d,t.subscribe(this)}});return c}),define("text!template/videoDisplay.html",[],function(){return'<div class="panel">\r\n    \r\n    <div class="top-bar">\r\n        <div class="left-side">\r\n            <span class="videoTitle">\r\n                <%= title %>\r\n            </span>\r\n            \r\n            <div id="timeProgressAreaView" class="view-placeholder"></div>\r\n        </div>\r\n        <div class="right-side">\r\n            \r\n            <div id="volumeControlView" class="view-placeholder"></div>\r\n\r\n            <div class="center-group">\r\n                <div id="previousButtonView" class="view-placeholder"></div>\r\n                <div id="playPauseButtonView" class="view-placeholder"></div>\r\n                <div id="nextButtonView" class="view-placeholder"></div>\r\n            </div>\r\n\r\n            <div class="right-group">\r\n                <button class="button-icon remove enabled">\r\n                    <i class="fa fa-film"></i>\r\n                </button>\r\n            </div>\r\n\r\n        </div>\r\n\r\n    </div>\r\n    \r\n\r\n</div>'}),define("common/view/videoView",["foreground/view/genericForegroundView","foreground/collection/streamItems","foreground/model/player","enum/playerState","foreground/collection/contextMenuGroups","foreground/model/buttons/playPauseButton"],function(e,t,i,n,s,o){"use strict";var r=e.extend({tagName:"canvas",events:{click:"togglePlayerState",dblclick:"goFullScreen"},attributes:{height:360,width:640},animationFrameRequestId:null,context:null,port:null,streamingImage:new Image(640,360),defaultImage:null,defaultImageLoaded:!1,render:function(){var e=t.length>0;if(this.$el.toggleClass("clickable",e),e){var s=i.get("state");s==n.Playing?this.connectPortDrawContinously():(this.disconnectPort(),i.get("currentTime")>0?this.connectPortDrawFrame():null!==this.defaultImage?this.defaultImageLoaded?this.context.drawImage(this.defaultImage,0,0,this.el.width,this.el.height):this.defaultImage.onload=function(){this.context.drawImage(this.defaultImage,0,0,this.el.width,this.el.height)
}.bind(this):this.drawBlankImage())}else this.drawBlankImage();return this},initialize:function(){this.context=this.el.getContext("2d"),$(window).unload(this.disconnectPort.bind(this)),this.setDefaultImage(),this.listenTo(i,"change:loadedVideoId",this.setDefaultImage),this.listenTo(i,"change:state",this.render),this.listenTo(t,"add remove reset change:selected",this.render)},connectPortDrawContinously:function(){this.connectPort(),this.port.onMessage.addListener(this.drawImageFromDataURL.bind(this))},connectPortDrawFrame:function(){this.connectPort(),this.port.onMessage.addListener(function(e){this.drawImageFromDataURL(e),this.disconnectPort()}.bind(this))},connectPort:function(){null===this.port?this.port=chrome.runtime.connect({name:"videoViewPort"}):console.error("Port already connected.")},disconnectPort:function(){null!==this.port?(this.port.disconnect(),this.port=null):console.error("Port already disconnected.")},drawImageFromDataURL:function(e){this.streamingImage.src=e,this.context.drawImage(this.streamingImage,0,0)},setDefaultImage:function(){this.defaultImageLoaded=!1;var e=i.get("loadedVideoId");""===e?this.defaultImage=null:(this.defaultImage=new Image(640,360),this.defaultImage.src="http://i2.ytimg.com/vi/"+e+"/mqdefault.jpg",this.defaultImage.onload=function(){this.defaultImageLoaded=!0})},drawBlankImage:function(){this.context.rect(0,0,this.el.width,this.el.height),this.context.fillStyle="black",this.context.fill()},togglePlayerState:function(){o.tryTogglePlayerState()},goFullScreen:function(){window.screenTop||window.screenY?chrome.windows.create({url:"fullscreen.html",type:"popup",focused:!0},function(e){chrome.windows.update(e.id,{state:"fullscreen"})}):chrome.windows.getAll(function(e){var t=_.findWhere(e,{state:"fullscreen"});chrome.windows.remove(t.id)})},showContextMenu:function(e){e.preventDefault(),window.screenTop||window.screenY?s.add({items:[{text:chrome.i18n.getMessage("fullScreen"),onClick:function(){chrome.windows.create({url:"fullscreen.html",type:"popup",focused:!0},function(e){chrome.windows.update(e.id,{state:"fullscreen"})})}}]}):s.add({items:[{text:chrome.i18n.getMessage("exitFullScreen"),onClick:function(){chrome.windows.getAll(function(e){var t=_.findWhere(e,{state:"fullscreen"});chrome.windows.remove(t.id)})}}]})}});return r}),define("common/view/videoDisplayView",["foreground/view/genericForegroundView","foreground/collection/streamItems","foreground/model/player","enum/playerState","foreground/collection/contextMenuGroups","text!template/videoDisplay.html","common/view/videoView","foreground/model/buttons/videoDisplayButton","foreground/view/rightPane/playPauseButtonView","foreground/view/rightPane/previousButtonView","foreground/view/rightPane/nextButtonView","foreground/view/rightPane/volumeControlView","foreground/view/rightPane/timeProgressAreaView"],function(e,t,i,n,s,o,r,l,a,d,u,c,h){"use strict";var g=e.extend({attributes:{id:"videoDisplay"},template:_.template(o),panel:null,videoView:null,playPauseButtonView:null,previousButtonView:null,nextButtonView:null,volumeControlView:null,timeProgressAreaView:null,events:{"click .remove":"toggleVideoDisplay"},render:function(){return this.$el.html(this.template({"chrome.i18n":chrome.i18n,title:t.getSelectedItem().get("title")})),this.panel=this.$el.find(".panel"),this.panel.append(this.videoView.render().el),this.$el.find("#timeProgressAreaView").replaceWith(this.timeProgressAreaView.render().el),this.$el.find("#volumeControlView").replaceWith(this.volumeControlView.render().el),this.$el.find("#previousButtonView").replaceWith(this.previousButtonView.render().el),this.$el.find("#playPauseButtonView").replaceWith(this.playPauseButtonView.render().el),this.$el.find("#nextButtonView").replaceWith(this.nextButtonView.render().el),this.title=this.$el.find(".title"),this},initialize:function(){this.videoView=new r,this.listenTo(l,"change:enabled",this.hideOnDisabled),this.listenTo(t,"change:selected",this.updateTitle),this.playPauseButtonView=new a,this.previousButtonView=new d,this.nextButtonView=new u,this.volumeControlView=new c,this.timeProgressAreaView=new h},toggleVideoDisplay:function(){l.toggleEnabled()},hideOnDisabled:function(){var e=l.get("enabled");e||this.hide()},show:function(e){this.$el.data("background",this.$el.css("background")).transition({background:"rgba(0, 0, 0, 0.5)"},e?0:void 0,"snap"),this.panel.transition({x:this.$el.width()},e?0:void 0,"snap")},hide:function(){this.$el.transition({background:this.$el.data("background")},function(){this.remove(),this.videoView.disconnectPort(),this.videoView.remove()}.bind(this)),this.panel.transition({x:-20})},updateTitle:function(){this.title.text(t.getSelectedItem().get("title"))}});return g}),define("enum/youTubePlayerError",{None:-1,InvalidParameter:2,VideoNotFound:100,NoPlayEmbedded:101,NoPlayEmbedded2:150}),define("text!template/notification.html",[],function(){return"<%= text %>"}),define("foreground/view/notificationView",["foreground/view/genericForegroundView","text!template/notification.html"],function(e,t){"use strict";var i=e.extend({className:"notification",template:_.template(t),text:"",render:function(){return this.$el.html(this.template({text:this.text})),this},initialize:function(e){if(this.text=e.text,""===$.trim(this.text))throw"NotificationView expects to be initialized with text"}});return i}),define("foreground/view/backgroundDependentForegroundView",["foreground/model/foregroundViewManager","foreground/view/prompt/genericPromptView","foreground/model/playlistsArea","foreground/view/playlistsArea/playlistsAreaView","foreground/view/activePlaylistArea/activePlaylistAreaView","foreground/view/videoSearch/videoSearchView","foreground/model/videoSearch","foreground/collection/videoSearchResults","foreground/view/rightPane/rightPaneView","common/view/videoDisplayView","foreground/collection/playlists","enum/youTubePlayerError","foreground/view/notificationView","foreground/model/player","foreground/model/buttons/videoDisplayButton","foreground/model/settings","foreground/model/user"],function(e,t,i,n,s,o,r,l,a,d,u,c,h,g,m,p,f){var v=Backbone.Marionette.Layout.extend({el:$("body"),playlistsAreaView:null,activePlaylistAreaView:null,videoDisplayView:null,rightPaneView:null,events:{click:"onClickDeselectCollections","click button#showVideoSearch":"onClickShowVideoSearch","click #activePlaylistArea button.show":"showPlaylistsArea","click #videoSearchLink":"onClickShowVideoSearch"},regions:{leftBasePane:"#left-base-pane",leftCoveringPane:"#left-covering-pane"},initialize:function(){this.rightPaneView=new a,this.$el.append(this.rightPaneView.render().el),this.showActivePlaylistArea(),p.get("alwaysOpenToSearch")&&this.showVideoSearch(!1),m.get("enabled")&&this.showVideoDisplay(!0),this.listenTo(u,"change:active",this.showActivePlaylistArea),this.listenTo(g,"error",this.showYouTubeError),this.listenTo(m,"change:enabled",this.toggleVideoDisplay),$(window).unload(this.deselectCollections.bind(this)),e.subscribe(this)},toggleVideoDisplay:function(e,t){t?this.showVideoDisplay(!1):this.videoDisplayView=null},onClickDeselectCollections:function(e){var t=$(e.target).hasClass("multiSelectItem"),i=$(e.target).closest(".multiSelectItem").length>0;t||i||this.deselectCollections()},deselectCollections:function(){f.get("loaded")&&u.getActivePlaylist().get("items").deselectAll(),l.deselectAll()},showPlaylistsArea:function(){if(null===this.playlistsAreaView){var e=new i({playlists:u});this.playlistsAreaView=new n({model:e,collection:u}),this.$el.append(this.playlistsAreaView.render().el),this.playlistsAreaView.show(),this.listenToOnce(e,"destroy",function(){this.playlistsAreaView=null})}},onClickShowVideoSearch:function(){this.showVideoSearch(!0)},showVideoDisplay:function(e){null===this.videoDisplayView&&(this.videoDisplayView=new d,this.$el.append(this.videoDisplayView.render().el),this.videoDisplayView.show(e))},showActivePlaylistArea:function(){var e=u.getActivePlaylist();this.leftBasePane.show(new s({model:e,collection:e?e.get("items"):void 0}))},showVideoSearch:_.throttle(function(e){if(_.isUndefined(this.leftCoveringPane.currentView)){var t=new r({playlist:u.getActivePlaylist(),doSnapAnimation:e});this.leftCoveringPane.show(new o({collection:l,model:t})),this.listenToOnce(t,"destroy",function(){this.leftCoveringPane.close()})}else this.leftCoveringPane.currentView.shake()},400),showYouTubeError:function(e){var i=chrome.i18n.getMessage("errorEncountered");switch(e){case c.InvalidParameter:i=chrome.i18n.getMessage("youTubePlayerErrorInvalidParameter");break;case c.VideoNotFound:i=chrome.i18n.getMessage("youTubePlayerErrorVideoNotFound");break;case c.NoPlayEmbedded:case c.NoPlayEmbedded2:i=chrome.i18n.getMessage("youTubePlayerErrorNoPlayEmbedded")}var n=new t({title:chrome.i18n.getMessage("errorEncountered"),model:new h({text:i})});n.fadeInAndShow()}});return new v});