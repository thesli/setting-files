define("foreground/model/foregroundViewManager",[],function(){"use strict";var e=Backbone.Model.extend({defaults:function(){return{views:[]}},initialize:function(){$(window).unload(function(){this.allViewsStopListening()}.bind(this))},allViewsStopListening:function(){_.each(this.get("views"),function(e){e.stopListening()})}});return new e}),define("foreground/model/settings",[],function(){"use strict";return chrome.extension.getBackgroundPage().Settings}),define("foreground/view/genericForegroundView",["foreground/model/foregroundViewManager","foreground/model/settings"],function(e,t){"use strict";var i=function(t){e.get("views").push(this),Backbone.View.apply(this,[t])};return _.extend(i.prototype,Backbone.View.prototype,{initializeTooltips:function(){t.get("showTooltips")&&setTimeout(function(){var e=this.$el.find("[title]");e.filter(function(){var e=!1;return($(this).hasClass("playlistTitle")||$(this).hasClass("title")||$(this).hasClass("item-title"))&&(e=this.offsetWidth===this.scrollWidth),e}).attr("title",""),e.qtip({position:{viewport:$(window),my:"top center",at:"bottom center"},style:{classes:"qtip-light qtip-shadow"}})}.bind(this))}}),i.extend=Backbone.View.extend,i}),define("text",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),define("text!template/genericPrompt.html",[],function(){return'<div class="panel">\r\n    <div class="header">\r\n        \r\n        <span class="title">\r\n            <%= promptTitle %>\r\n        </span>\r\n        \r\n        <button class="button-icon remove">\r\n            <i class="fa fa-times"></i>\r\n        </button>\r\n\r\n    </div>\r\n    <div class="divider"></div>\r\n    <div class="content">\r\n        \r\n    </div>\r\n    <span class="bottom-right">\r\n                        \r\n        <button class="ok button-label button-color">\r\n            <%= okButtonText %>\r\n        </button>\r\n        \r\n    </span>\r\n</div>'}),define("foreground/view/prompt/genericPromptView",["foreground/view/genericForegroundView","text!template/genericPrompt.html"],function(e,t){"use strict";var i=e.extend({className:"modalOverlay prompt",template:_.template(t),events:{click:"hideIfClickOutsidePanel","click .remove":"fadeOutAndHide","click .ok":"doOk","keydown .submittable":"doOkOnEnter"},panel:null,okButtonText:chrome.i18n.getMessage("ok"),okButton:null,showCancelButton:!0,render:function(){return this.$el.html(this.template({"chrome.i18n":chrome.i18n,promptTitle:this.title,okButtonText:this.okButtonText})),this.$el.find(".content").append(this.model.render().el),this.panel=this.$el.children(".panel"),this.okButton=this.$el.find("button.ok"),this},initialize:function(e){this.title=e.title||this.title,this.okButtonText=e.okButtonText||this.okButtonText,this.showCancelButton=e.showCancelButton||this.showCancelButton,this.$el.addClass(this.model.className+"Prompt")},fadeInAndShow:function(){$("body").append(this.render().el),this.$el.data("background",this.$el.css("background")).transition({background:"rgba(0, 0, 0, 0.5)"},"snap");var e=(this.$el.parent().height()-this.panel.height())/2;this.panel.transition({y:e,opacity:1},"snap")},fadeOutAndHide:function(){this.$el.transition({background:this.$el.data("background")},function(){this.remove()}.bind(this)),this.panel.transition({y:0,opacity:0})},hideIfClickOutsidePanel:function(e){e.target==e.currentTarget&&this.fadeOutAndHide()},doOkOnEnter:function(e){13===e.which&&this.doOk()},doOk:function(){var e=_.isFunction(this.model.validate)?this.model.validate():!0;e&&(_.isFunction(this.model.doOk)&&this.model.doOk(),this.fadeOutAndHide())}});return i}),define("text!template/reload.html",[],function(){return"<%= chrome.i18n.getMessage('streamusIsTakingALongTimeToLoadReloadingMayHelp') %>"}),define("foreground/view/reloadView",["foreground/view/genericForegroundView","text!template/reload.html"],function(e,t){"use strict";var i=e.extend({className:"reload",template:_.template(t),render:function(){return this.$el.html(this.template({"chrome.i18n":chrome.i18n})),this},doOk:function(){chrome.runtime.reload()}});return i}),define("foreground/model/contextMenuItem",[],function(){"use strict";var e=Backbone.Model.extend({defaults:function(){return{text:"",disabled:!1,title:"",onClick:null}}});return e}),define("foreground/collection/contextMenuItems",["foreground/model/contextMenuItem"],function(e){"use strict";var t=Backbone.Collection.extend({model:e});return t}),define("foreground/model/contextMenuGroup",["foreground/collection/contextMenuItems"],function(e){"use strict";var t=Backbone.Model.extend({defaults:function(){return{items:new e}},initialize:function(){var t=this.get("items");t instanceof Backbone.Collection||(t=new e(t),this.set("items",t,{silent:!0}))}});return t}),define("foreground/collection/contextMenuGroups",["foreground/model/contextMenuGroup"],function(e){"use strict";var t=Backbone.Collection.extend({model:e});return new t}),define("text!template/contextMenu.html",[],function(){return'<% contextMenuGroups.each(function(group){ %>\r\n    <ul id="<%= group.cid %>">\r\n        <% group.get(\'items\').each(function(item){ %>\r\n            <li <% if( item.get(\'disabled\') ) { %> disabled="disabled" <% } %>>\r\n                <a id="<%= item.cid %>" title="<%= item.get(\'title\') %>" <% if( item.get(\'disabled\') ) { %> disabled="disabled" <% } %> class="clickable">\r\n                    <%= item.get(\'text\') %>\r\n                </a>\r\n            </li>\r\n        <% }); %>\r\n    </ul>\r\n<% }); %>'}),define("foreground/view/contextMenuView",["foreground/view/genericForegroundView","foreground/collection/contextMenuGroups","text!template/contextMenu.html"],function(e,t,i){"use strict";var n=e.extend({template:_.template(i),events:{"click li":"onItemClick"},attributes:{id:"contextMenu"},render:function(){this.$el.html(this.template({contextMenuGroups:t}));var e=this.top,i=e+this.$el.height()>this.$el.parent().height();i&&(e-=this.$el.height());var n=this.left,r=n+this.$el.width()>this.$el.parent().width();return r&&(n-=this.$el.width()),this.initializeTooltips(),this.$el.offset({top:e,left:n}),this},initialize:function(){this.listenTo(t,"reset add remove",this.render)},show:function(e){if(void 0===e.top||void 0===e.left)throw"ContextMenu must be shown with top/left coordinates.";this.top=e.top,this.left=e.left,this.render()},onItemClick:function(e){var i=$(e.currentTarget);if("disabled"===i.attr("disabled"))return!1;var n=i.find("a").attr("id"),r=i.closest("ul").attr("id"),o=t.find(function(e){return e.cid==r}),l=o.get("items").find(function(e){return e.cid==n});l.get("onClick")()}});return n}),define("foreground/foreground",["foreground/view/genericForegroundView","foreground/view/prompt/genericPromptView","foreground/view/reloadView","foreground/view/contextMenuView","foreground/collection/contextMenuGroups"],function(e,t,i,n,r){"use strict";var o=e.extend({el:$("body"),contextMenuView:new n,reloadPromptView:null,showReloadPromptTimeout:null,backgroundPlayer:chrome.extension.getBackgroundPage().YouTubePlayer,backgroundUser:chrome.extension.getBackgroundPage().User,initialize:function(){var e=this;if(this.$el.append(this.contextMenuView.render().el),this.showReloadPromptTimeout=setTimeout(function(){this.reloadPromptView=new t({title:chrome.i18n.getMessage("reloadStreamus"),okButtonText:chrome.i18n.getMessage("reload"),showCancelButton:!1,model:new i}),this.reloadPromptView.fadeInAndShow()}.bind(this),5e3),null==this.backgroundPlayer||null==this.backgroundUser)var n=setInterval(function(){e.backgroundPlayer=chrome.extension.getBackgroundPage().YouTubePlayer,e.backgroundUser=chrome.extension.getBackgroundPage().User,null!=e.backgroundPlayer&&null!=e.backgroundUser&&(clearInterval(n),e.waitForBackgroundUserLoaded())},100);else this.waitForBackgroundUserLoaded();this.$el.on("click contextmenu",function(t){var i=t.isDefaultPrevented();i?e.contextMenuView.show({top:t.pageY,left:t.pageX+1}):r.reset()})},waitForBackgroundUserLoaded:function(){this.backgroundUser.get("loaded")?this.waitForBackgroundPlayerReady():this.listenToOnce(this.backgroundUser,"change:loaded",function(e,t){t&&this.waitForBackgroundPlayerReady()})},waitForBackgroundPlayerReady:function(){this.backgroundPlayer.get("ready")?this.loadBackgroundDependentContent():this.listenToOnce(this.backgroundPlayer,"change:ready",function(e,t){t&&this.loadBackgroundDependentContent()})},loadBackgroundDependentContent:function(){this.$el.removeClass("loading"),clearTimeout(this.showReloadPromptTimeout),null!==this.reloadPromptView&&this.reloadPromptView.remove(),require(["foreground/view/backgroundDependentForegroundView"])}});return new o}),define("foreground/model/activeFolderArea",[],function(){"use strict";var e=Backbone.Model.extend({defaults:function(){return{folder:null}}});return e}),define("common/model/utility",[],function(){"use strict";var e=Backbone.Model.extend({prettyPrintTime:function(e){isNaN(e)&&(e=0);var t=Math.floor(e/3600),i=e%3600,n=Math.floor(i/60);i%=60,10>n&&(n="0"+n),10>i&&(i="0"+i);var r=n+":"+i;return t>0&&(r=t+":"+r),r},iso8061DurationToSeconds:function(e){var t=e.match(/(\d+)H/),i=parseInt(t?t[1]:0),n=e.match(/(\d+)M/),r=parseInt(n?n[1]:0),o=e.match(/(\d+)S/),l=parseInt(o?o[1]:0),s=l+60*r+3600*i;return s},cleanseVideoTitle:function(e){return e=$.trim(e),e=e.replace(/\s*\*+\s?\S+\s?\*+$/,""),e=e.replace(/\s*\[[^\]]+\]$/,""),e=e.replace(/\s*\([^\)]*version\)$/i,""),e=e.replace(/\s*\.(avi|wmv|mpg|mpeg|flv)$/i,""),e=e.replace(/\s*(of+icial\s*)?(music\s*)?video/i,""),e=e.replace(/\s*(ALBUM TRACK\s*)?(album track\s*)/i,""),e=e.replace(/\s*\(\s*of+icial\s*\)/i,""),e=e.replace(/\s*\(\s*[0-9]{4}\s*\)/i,""),e=e.replace(/\s+\(\s*(HD|HQ)\s*\)$/,""),e=e.replace(/\s+(HD|HQ)\s*$/,""),e=e.replace(/\s*video\s*clip/i,""),e=e.replace(/\s+\(?live\)?$/i,""),e=e.replace(/\(\s*\)/,""),e=e.replace(/\(.*lyrics?\)/i,""),e=e.replace(/\s*with\s+lyrics?\s*$/i,""),e=e.replace(/^(|.*\s)"(.*)"(\s.*|)$/,"$2"),e=e.replace(/^(|.*\s)'(.*)'(\s.*|)$/,"$2"),e=e.replace(/^[\/\s,:;~-\s"]+/,""),e=e.replace(/[\/\s,:;~-\s"\s!]+$/,"")},getLevenshteinDistance:function(e,t){var i=[],n=e.length,r=t.length;if(0===n)return r;if(0===r)return n;for(var o=n;o>=0;o--)i[o]=[];for(var l=n;l>=0;l--)i[l][0]=l;for(var s=r;s>=0;s--)i[0][s]=s;for(var a=1;n>=a;a++)for(var d=e.charAt(a-1),u=1;r>=u;u++){if(a==u&&i[a][u]>4)return n;var c=t.charAt(u-1),h=d==c?0:1,m=i[a-1][u]+1,g=i[a][u-1]+1,p=i[a-1][u-1]+h;m>g&&(m=g),m>p&&(m=p),i[a][u]=m,a>1&&u>1&&d==t.charAt(u-2)&&e.charAt(a-2)==c&&(i[a][u]=Math.min(i[a][u],i[a-2][u-2]+h))}return i[n][r]},escapeRegExp:function(e){var t=e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");return t}});return new e}),define("foreground/collection/streamItems",[],function(){"use strict";return chrome.extension.getBackgroundPage().StreamItems}),define("text!template/playlist.html",[],function(){return'<i class="fa fa-list fa-fw"></i>\r\n<div class="spinner spinner-small"></div>\r\n\r\n<span class="title" title="<%= title %>">\r\n    <%= title %>\r\n</span>\r\n<input type="text" value="<%= title %>" class="editableTitle hidden" maxlength="255"/>\r\n\r\n<span class="count"><%= items.length %></span>'}),define("text!template/deletePlaylist.html",[],function(){return'<%= chrome.i18n.getMessage(\'areYouSureYouWantToDeletePlaylist\') %> <strong><%= title %></strong>?\r\n        \r\n<div class="reminder">\r\n    <input type="checkbox" id="remindDeletePlaylist">\r\n	<label for="remindDeletePlaylist"><%= chrome.i18n.getMessage(\'dontRemindMeAgain\') %></label>\r\n</div>'}),define("foreground/view/deletePlaylistView",["foreground/view/genericForegroundView","text!template/deletePlaylist.html","foreground/model/settings"],function(e,t,i){"use strict";var n=e.extend({className:"deletePlaylist",template:_.template(t),reminderCheckbox:null,render:function(){return this.$el.html(this.template({"chrome.i18n":chrome.i18n,title:this.model.get("title")})),this},doOk:function(){var e=!this.$el.find("input#remindDeletePlaylist").is(":checked");i.set("remindDeletePlaylist",e),this.model.destroy()}});return n}),define("foreground/view/prompt/deletePlaylistPromptView",["foreground/view/prompt/genericPromptView","foreground/view/deletePlaylistView","foreground/model/settings"],function(e,t,i){"use strict";var n=e.extend({title:chrome.i18n.getMessage("deletePlaylist"),okButtonText:chrome.i18n.getMessage("delete"),model:null,initialize:function(i){this.model=new t({model:i.playlist}),e.prototype.initialize.call(this,arguments)},fadeInAndShow:function(){var t=i.get("remindDeletePlaylist");return t?e.prototype.fadeInAndShow.call(this,arguments):(this.model.model.destroy(),void 0)}});return n}),define("text!template/editPlaylist.html",[],function(){return'<ul class="options">\r\n    <li>\r\n        <span class="inputUnderlineWrapper">\r\n            <input id="playlistTitleInput" type="text" class="playlistTitle submittable" placeholder="<%= chrome.i18n.getMessage(\'required\') %>: <%= chrome.i18n.getMessage(\'title\').toLowerCase() %>" value="<%= title %>">\r\n            <div class="underline"></div>   \r\n        </span>\r\n    </li>\r\n</ul>'}),define("foreground/view/editPlaylistView",["foreground/view/genericForegroundView","text!template/editPlaylist.html"],function(e,t){"use strict";var i=e.extend({className:"editPlaylist",template:_.template(t),playlistTitleInput:null,events:{"input input.playlistTitle":"validateTitle"},render:function(){return this.$el.html(this.template({"chrome.i18n":chrome.i18n,title:this.model.get("title")})),this.playlistTitleInput=this.$el.find('input[type="text"]'),setTimeout(function(){this.playlistTitleInput.focus().val(this.playlistTitleInput.val())}.bind(this)),this},validateTitle:function(){var e=$.trim(this.playlistTitleInput.val());this.playlistTitleInput.toggleClass("invalid",""===e)},validate:function(){var e=0===this.$el.find(".submittable.invalid").length;return e},doOk:function(){var e=$.trim(this.playlistTitleInput.val());this.model.set("title",e)}});return i}),define("foreground/view/prompt/editPlaylistPromptView",["foreground/view/prompt/genericPromptView","foreground/view/editPlaylistView","foreground/model/settings"],function(e,t){"use strict";var i=e.extend({title:chrome.i18n.getMessage("editPlaylist"),okButtonText:chrome.i18n.getMessage("update"),model:null,initialize:function(i){this.model=new t({model:i.playlist}),e.prototype.initialize.call(this,arguments)}});return i}),define("foreground/collection/folders",[],function(){"use strict";return chrome.extension.getBackgroundPage().Folders}),define("enum/listItemType",{None:-1,PlaylistItem:0,StreamItem:1,VideoSearchResult:2,Playlist:3}),define("foreground/view/activeFolderArea/playlistView",["foreground/view/genericForegroundView","foreground/model/foregroundViewManager","text!template/playlist.html","foreground/collection/contextMenuGroups","foreground/view/prompt/deletePlaylistPromptView","foreground/view/prompt/editPlaylistPromptView","foreground/collection/folders","foreground/collection/streamItems","enum/listItemType"],function(e,t,i,n,r,o,l,s,a){"use strict";var d=Backbone.Marionette.ItemView.extend({tagName:"li",className:"listItem playlist",template:_.template(i),attributes:function(){return{"data-id":this.model.get("id"),"data-type":a.Playlist}},events:{"blur @ui.editableTitle":"saveAndStopEdit",click:"select",contextmenu:"showContextMenu","dblclick @ui.readonlyTitle":"startEdit","keyup @ui.editableTitle":"saveAndStopEditOnEnter"},modelEvents:{"change:title":"render","change:dataSourceLoaded":"toggleLoadingClass","change:active":"stopEditingOnInactive toggleSelectedClass"},ui:{itemCount:".count",editableTitle:"input.editableTitle",readonlyTitle:"span.title"},onRender:function(){this.toggleLoadingClass(),this.toggleSelectedClass(),e.prototype.initializeTooltips.call(this)},initialize:function(){this.listenTo(this.model.get("items"),"add remove",this.updateItemCount),t.get("views").push(this)},stopEditingOnInactive:function(e,t){t||this.saveAndStopEdit()},toggleLoadingClass:function(){var e=this.model.has("dataSource")&&!this.model.get("dataSourceLoaded");this.$el.toggleClass("loading",e)},toggleSelectedClass:function(){var e=this.model.get("active");this.$el.toggleClass("selected",e)},updateItemCount:function(){var e=this.model.get("items").length;this.ui.itemCount.text(e)},select:function(){this.model.set("active",!0)},showContextMenu:function(e){e.preventDefault(),n.reset();var t=0===this.model.get("items").length,i=1===l.get(this.model.get("folderId")).get("playlists").length,a=this;n.add({items:[{disabled:t,title:t?chrome.i18n.getMessage("playlistEmpty"):"",text:chrome.i18n.getMessage("copyUrl"),onClick:function(){t||a.model.getShareCode(function(e){var t=e.get("shortId"),i=e.get("urlFriendlyEntityTitle"),n="http://share.streamus.com/playlist/"+t+"/"+i;chrome.extension.sendMessage({method:"copy",text:n})})}},{text:chrome.i18n.getMessage("delete"),disabled:i,title:i?chrome.i18n.getMessage("cantDeleteLastPlaylist"):"",onClick:function(){if(!i)if(0===a.model.get("items").length)a.model.destroy();else{var e=new r({playlist:a.model});e.fadeInAndShow()}}},{text:chrome.i18n.getMessage("enqueue"),disabled:t,title:t?chrome.i18n.getMessage("playlistEmpty"):"",onClick:function(){t||s.addByPlaylistItems(a.model.get("items"),!1)}},{text:chrome.i18n.getMessage("edit"),onClick:function(){var e=new o({playlist:this.model});e.fadeInAndShow()}}]})},startEdit:function(){this.ui.editableTitle.show().focus().val(this.ui.editableTitle.val()),this.ui.readonlyTitle.hide()},saveAndStopEditOnEnter:function(e){13===e.which&&this.saveAndStopEdit()},saveAndStopEdit:function(){var e=$.trim(this.ui.editableTitle.val());""!==e&&this.model.set("title",e),this.ui.editableTitle.hide(),this.ui.readonlyTitle.show()}});return d}),define("text!template/createPlaylist.html",[],function(){return'<ul class="options">\r\n    <li>\r\n                \r\n        <span class="inputUnderlineWrapper">\r\n            <input id="playlistTitleInput" type="text" class="playlistTitle submittable" placeholder="<%= chrome.i18n.getMessage(\'required\') %>: <%= chrome.i18n.getMessage(\'title\').toLowerCase() %>" value="<%= chrome.i18n.getMessage(\'playlist\') %> <%= playlistCount %>" maxlength="255">\r\n            <div class="underline"></div>   \r\n        </span>\r\n\r\n    </li>\r\n    <li>\r\n        <span class="inputUnderlineWrapper">\r\n            <input id="youTubeSourceInput" type="text" class="youTubeSource submittable" placeholder="<%= chrome.i18n.getMessage(\'optional\') %>: <%= chrome.i18n.getMessage(\'playlist\').toLowerCase() %> / <%= chrome.i18n.getMessage(\'channel\').toLowerCase() %> <%= chrome.i18n.getMessage(\'url\') %>">\r\n            <div class="underline"></div>   \r\n        </span>\r\n    </li>\r\n</ul>'}),define("enum/dataSourceType",{None:-1,Unknown:0,YouTubePlaylist:1,YouTubeChannel:2,SharedPlaylist:3,UserInput:4,YouTubeFavorites:5,YouTubeAutoGenerated:6,YouTubeVideo:7}),define("common/model/youTubeV2API",["enum/dataSourceType","common/model/utility"],function(e,t){"use strict";var i=Backbone.Model.extend({defaults:function(){var e="author,title,media:group(yt:videoid,yt:duration),yt:accessControl,yt:hd";return{videoInformationFields:e,videoListInformationFields:"entry("+e+")"}},sendV2ApiRequest:function(e){return""===$.trim(e.url)&&(console.error("URL expected"),e.error&&e.error("URL expected"),e.complete&&e.complete()),$.ajax({url:e.url,data:$.extend({},e.data,{v:2,alt:"json",strict:!0}),headers:{"X-GData-Key":"key=AI39si7voIBGFYe-bcndXXe8kex6-N_OSzM5iMuWCdPCSnZxLB_qIEnQ-HMijHrwN1Y9sFINBi_frhjzVVrYunHH8l77wfbLCA"},success:function(){e.success(arguments[0]),e.complete&&e.complete()},error:function(t){"abort"!==t.statusText&&console.error(t.statusText),e.error&&e.error(t),e.complete&&e.complete()}})},search:function(e){return this.sendV2ApiRequest({url:"https://gdata.youtube.com/feeds/api/videos",data:{category:"Music",time:"all_time","max-results":e.maxResults||50,"start-index":1,format:5,q:e.text,fields:this.get("videoListInformationFields")},success:function(t){e.success(t.feed.entry||[])},error:e.error,complete:e.complete})},findPlayableByTitle:function(e){var i=$.trim(e.title||"");return""===i?(e.error&&e.error("No title provided"),null):this.search({text:i,success:function(n){n.sort(function(e,n){return t.getLevenshteinDistance(e.title.$t,i)-t.getLevenshteinDistance(n.title.$t,i)});var r=n.length>0?n[0]:null;e.success(r)},error:e.error})},searchPlaylist:function(e){return this.sendV2ApiRequest({url:"https://gdata.youtube.com/feeds/api/playlists/snippets",data:{"max-results":e.maxResults||50,"start-index":1,q:e.text},success:function(t){e.success(t.feed.entry||[])}})},getChannelName:function(e){return this.sendV2ApiRequest({url:"https://gdata.youtube.com/feeds/api/users/"+e.channelId,success:function(t){e.success(t.entry.author[0].name.$t)},error:e.error})},getPlaylistTitle:function(e){return this.sendV2ApiRequest({url:"https://gdata.youtube.com/feeds/api/playlists/"+e.playlistId,data:{fields:"title"},success:function(t){e.success(t.feed.title.$t)},error:e.error})},getVideoInformation:function(e){return this.sendV2ApiRequest({url:"https://gdata.youtube.com/feeds/api/videos/"+e.videoId,data:{format:5,fields:this.get("videoInformationFields")},success:function(t){var i=this.validateEntry(t.entry);i?e.success(t.entry):this.findPlayableByTitle({title:t.entry.title.$t,success:e.success,error:e.error})}.bind(this),error:function(){this.findPlayableByTitle({title:e.videoTitle,success:e.success,error:e.error})}.bind(this),complete:e.complete})},getDataSourceResults:function(e,t,i){if(e.isV3())throw"YouTubeV2 API getDataSourceResults cannot handle a V3 dataSource";var n=50,r=1+n*t;return this.sendV2ApiRequest({url:e.get("url"),data:{"max-results":n,"start-index":r},success:function(e){var n=_.filter(e.feed.entry,function(e){return void 0!==e.media$group.yt$duration});i&&i({iteration:t,results:n})},error:function(){i&&i({iteration:t,results:[]})}})},validateEntry:function(e){var t=e.yt$accessControl,i=_.find(t,function(e){return"embed"===e.action}),n="allowed"===i.permission;return n}});return new i}),define("common/model/dataSource",["enum/dataSourceType","common/model/youTubeV2API"],function(e,t){"use strict";var i=Backbone.Model.extend({defaults:{type:e.None,sourceId:"",url:"",title:""},initialize:function(e){if(e&&e.urlToParse){var t=this.parseUrlForDataSourceInformation(e.urlToParse);this.set("type",t.dataSourceType),this.set("sourceId",t.dataSourceId),delete e.urlToParse}this.setUrl(),this.on("change:type",this.setUrl)},setUrl:function(){var t="https://gdata.youtube.com/feeds/api/";switch(this.get("type")){case e.YouTubeChannel:t+="users/"+this.get("sourceId")+"/uploads";break;case e.YouTubeFavorites:t+="users/"+this.get("sourceId")+"/favorites";break;case e.YouTubePlaylist:t+="playlists/"+this.get("sourceId");break;default:t=""}this.set("url",t)},isV3:function(){var t=this.get("type");return t===e.YouTubeAutoGenerated},needsLoading:function(){var t=this.get("type");return t===e.YouTubeChannel||t===e.YouTubePlaylist||t===e.YouTubeFavorites||t===e.YouTubeAutoGenerated},parseUrlForDataSourceInformation:function(t){var i=e.None,n="",r=this.parseYouTubeVideoIdFromUrl(t);if(r&&(n=r,i=e.YouTubeVideo),i===e.None){var o=[{identifiers:["list=PL","p=PL","list=RD","p=RD"],dataSourceType:e.YouTubePlaylist},{identifiers:["list=FL","p=FL"],dataSourceType:e.YouTubeFavorites},{identifiers:["list=AL","p=AL"],dataSourceType:e.YouTubeAutoGenerated},{identifiers:["/user/","/channel/","list=UU","p=UU"],dataSourceType:e.YouTubeChannel},{identifiers:["streamus:"],dataSourceType:e.SharedPlaylist}],l=function(e,t){var i=e.split(t),n="";if(i.length>1){n=e.split(t)[1];var r=n.indexOf("&");-1!==r&&(n=n.substring(0,r)),"list=AL"===t||"p=AL"===t?n="AL"+n:("list=RD"===t||"p=RD"===t)&&(n="RD"+n)}return n};_.each(o,function(e){var r=_.find(e.identifiers,function(e){var i=l(t,e);return""!==i});void 0!==r&&(n=l(t,r),i=e.dataSourceType)})}return{dataSourceType:i,dataSourceId:n}},parseYouTubeVideoIdFromUrl:function(e){var t=null,i=e.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|watch\?.*?\&v=)([^#\&\?]*).*/);return i&&11===i[2].length&&(t=i[2]),t},getTitle:function(i){if(i=$.extend({},{success:function(){},error:function(){},notifyOnError:!0},i),""!==this.get("title"))return i.success(this.get("title")),void 0;var n=this;switch(this.get("type")){case e.YouTubePlaylist:t.getPlaylistTitle({playlistId:this.get("sourceId"),success:function(e){n.set("title",e),i.success(e)},error:i.error});break;case e.YouTubeFavorites:case e.YouTubeChannel:t.getChannelName({channelId:this.get("sourceId"),success:function(e){n.set("title",e),i.success(e)},error:i.error});break;case e.YouTubeAutoGenerated:break;default:i.notifyOnError&&console.error("Unhandled dataSource type:",this.get("type")),i.error()}}});return i}),define("foreground/view/createPlaylistView",["foreground/view/genericForegroundView","text!template/createPlaylist.html","foreground/collection/streamItems","foreground/collection/folders","common/model/dataSource","enum/dataSourceType"],function(e,t,i,n,r,o){"use strict";var l=e.extend({className:"createPlaylist",template:_.template(t),playlistTitleInput:null,youTubeSourceInput:null,events:{"input input.youTubeSource":"processInput","input input.playlistTitle":"validateTitle"},render:function(){return this.$el.html(this.template({"chrome.i18n":chrome.i18n,playlistCount:n.getActiveFolder().get("playlists").length})),this.playlistTitleInput=this.$el.find("input.playlistTitle"),this.youTubeSourceInput=this.$el.find("input.youTubeSource"),this.youTubeSourceInput.data("datasource",new r({type:o.None})),setTimeout(function(){this.playlistTitleInput.focus().val(this.playlistTitleInput.val())}.bind(this)),this},validateTitle:function(){var e=$.trim(this.playlistTitleInput.val());this.playlistTitleInput.toggleClass("invalid",""===e)},processInput:_.throttle(function(){var e=this;setTimeout(function(){var t=$.trim(e.youTubeSourceInput.val());if(e.youTubeSourceInput.removeData("datasource").removeClass("valid invalid"),""!==t){var i=new r({urlToParse:t});e.youTubeSourceInput.data("datasource",i),i.getTitle({success:function(t){e.playlistTitleInput.val(t),e.validateTitle(),e.youTubeSourceInput.addClass("valid")},error:function(){e.playlistTitleInput.val(chrome.i18n.getMessage("errorRetrievingTitle")),e.youTubeSourceInput.addClass("invalid")}})}})},100),validate:function(){var e=0===this.$el.find(".submittable.invalid").length;return e},doOk:function(){var e=n.getActiveFolder(),t=this.youTubeSourceInput.data("datasource"),i=$.trim(this.playlistTitleInput.val());t.get("type")===o.None||t.get("type")===o.Unknown?this.model&&0!==this.model.length?e.addPlaylistWithVideos(i,this.model):e.addEmptyPlaylist(i):e.addPlaylistByDataSource(i,t)}});return l}),define("foreground/view/prompt/createPlaylistPromptView",["foreground/view/prompt/genericPromptView","foreground/view/createPlaylistView"],function(e,t){"use strict";var i=e.extend({title:chrome.i18n.getMessage("createPlaylist"),okButtonText:chrome.i18n.getMessage("create"),model:new t});return i}),define("foreground/view/activeFolderArea/playlistCollectionView",["foreground/view/genericForegroundView","foreground/model/foregroundViewManager","foreground/collection/contextMenuGroups","common/model/utility","foreground/collection/streamItems","foreground/view/activeFolderArea/playlistView","foreground/view/prompt/createPlaylistPromptView","enum/listItemType"],function(e,t,i,n,r,o,l,s){"use strict";var a=Backbone.Marionette.CollectionView.extend({tagName:"ul",id:"activeFolder",itemView:o,onRender:function(){var e=this;this.$el.sortable({axis:"y",placeholder:"sortable-placeholder listItem",update:function(t,i){var n=i.item.data("type");if(n===s.Playlist){var r=i.item.data("id"),o=i.item.index(),l=e.collection.get(r),a=e.collection.indexOf(l);o>a&&(o+=1),e.collection.moveToIndex(r,o)}}})},initialize:function(){t.get("views").push(this)},getIsOverflowing:function(){var e=this.$el.height();0===e&&(e=this.$el.data("oldheight"));var t=!1,i=this.collection.length;if(i>0){var n=this.$el.find("li").height(),r=e/n;t=i>r}return t},collapse:function(){var e=this.getIsOverflowing();e||this.$el.css("overflow-y","hidden");var t=this.$el.height(),i=$.trim(this.$el[0].style.height);(""===i||"auto"===i)&&this.$el.height(t),this.$el.data("oldheight",t),this.$el.transitionStop().transition({height:0,opacity:0},200,function(){this.$el.hide(),e||this.$el.css("overflow-y","auto")}.bind(this))},expand:function(e){var t=this.getIsOverflowing();t||this.$el.css("overflow-y","hidden"),this.$el.show().transitionStop().transition({height:this.$el.data("oldheight"),opacity:1},200,function(){t||this.$el.css("overflow-y","auto"),e()}.bind(this))}});return a}),define("text!template/activeFolderArea.html",[],function(){return'<div class="panel">\r\n    \r\n    <div class="header">\r\n\r\n        <button class="button-icon hide enabled" title="<%= chrome.i18n.getMessage(\'closeMenu\') %>">\r\n            <i class="fa fa-reorder"></i>\r\n        </button>\r\n\r\n        <span class="title">\r\n            <img src="http://streamus.com/img/logo.png" alt="Streamus Logo">\r\n        </span>\r\n        \r\n        <button class="button-icon settings" title="<%= chrome.i18n.getMessage(\'settings\') %>">\r\n            <i class="fa fa-cogs"></i>\r\n        </button>\r\n\r\n    </div>\r\n    <div class="left-top-divider"></div>\r\n    <div class="list">\r\n        \r\n        <h3>\r\n            <%= chrome.i18n.getMessage(\'playlists\') %><i class="fa fa-caret-down" data-expanded="true"></i>\r\n        </h3>\r\n\r\n    </div>\r\n    <div class="context-buttons">\r\n        \r\n<!--        <div class="left-group">\r\n            <button class="button-label button-small disabled" title="YouTube signin not implemented quite yet. Hold on!" id="button-sign-in">\r\n                <i class="fa fa-sign-in"></i><%= chrome.i18n.getMessage(\'signIn\') %>\r\n            </button>\r\n        </div>-->\r\n\r\n        <div class="right-group">\r\n\r\n            <button class="button-icon button-small add" title="<%= chrome.i18n.getMessage(\'createPlaylist\') %>">\r\n                <i class="fa fa-plus"></i>\r\n            </button>\r\n\r\n            <button class="button-icon button-small edit" title="<%= chrome.i18n.getMessage(\'editPlaylist\') %>">\r\n                <i class="fa fa-pencil"></i>\r\n            </button>\r\n\r\n        </div>\r\n\r\n    </div>\r\n\r\n</div>'}),define("text!template/settings.html",[],function(){return"<div class=\"topic\">\r\n    <%= chrome.i18n.getMessage('general') %>\r\n</div>\r\n<div class=\"category\">\r\n\r\n    <ul>\r\n        <li>\r\n            <label id=\"suggestedQualitySelectLabel\" for=\"suggestedQualitySelect\">\r\n                <%= chrome.i18n.getMessage('videoQuality') %>\r\n            </label>\r\n            \r\n            <select id=\"suggestedQualitySelect\" name=\"suggestedQualitySelect\">\r\n            \r\n                <option value=\"highres\" <%= suggestedQuality === 'highres' ? 'selected' : '' %>>\r\n                    <%= chrome.i18n.getMessage('highest') %>\r\n                </option>\r\n\r\n                <option value=\"default\" <%= suggestedQuality === 'default' ? 'selected' : '' %>>\r\n                    <%= chrome.i18n.getMessage('auto') %>\r\n                </option>\r\n\r\n                <option value=\"small\" <%= suggestedQuality === 'small' ? 'selected' : '' %>>\r\n                    <%= chrome.i18n.getMessage('lowest') %>\r\n                </option>\r\n\r\n            </select>\r\n        </li>\r\n        <li>\r\n            <input type=\"checkbox\" id=\"showTooltips\" <%= showTooltips ? 'checked' : '' %>>\r\n            <label for=\"showTooltips\">\r\n                <%= chrome.i18n.getMessage('showTooltips') %>\r\n            </label>\r\n        </li>\r\n        <li>\r\n            <input type=\"checkbox\" id=\"alwaysOpenToSearch\" <%= alwaysOpenToSearch ? 'checked' : '' %> >\r\n            <label for=\"alwaysOpenToSearch\">\r\n                <%= chrome.i18n.getMessage('alwaysOpenToSearch') %>\r\n            </label>\r\n        </li>\r\n    </ul>\r\n\r\n</div>\r\n\r\n<div class=\"remindersLabel topic\">\r\n    <%= chrome.i18n.getMessage('reminders') %>\r\n</div>\r\n<div class=\"category\">\r\n    <ul>\r\n        <li>\r\n            <input type=\"checkbox\" id=\"remindClearStream\" <%= remindClearStream ? 'checked' : '' %>>\r\n            <label for=\"remindClearStream\">\r\n                <%= chrome.i18n.getMessage('remindClearStream') %>\r\n            </label>\r\n        </li>\r\n        <li>\r\n            <input type=\"checkbox\" id=\"remindDeletePlaylist\" <%= remindDeletePlaylist ? 'checked' : '' %>>\r\n            <label for=\"remindDeletePlaylist\">\r\n                <%= chrome.i18n.getMessage('remindDeletePlaylist') %>\r\n            </label>\r\n        </li>\r\n    </ul>\r\n</div>"
}),define("foreground/model/player",[],function(){"use strict";return chrome.extension.getBackgroundPage().YouTubePlayer}),define("common/view/settingsView",["foreground/view/genericForegroundView","foreground/model/foregroundViewManager","text!template/settings.html","foreground/model/player","foreground/model/settings"],function(e,t,i,n,r){"use strict";var o=Backbone.Marionette.ItemView.extend({className:"settings",template:_.template(i),model:r,ui:{suggestedQualitySelect:"#suggestedQualitySelect",showTooltipsCheckbox:"#showTooltips",remindClearStreamCheckbox:"#remindClearStream",remindDeletePlaylistCheckbox:"#remindDeletePlaylist",alwaysOpenToSearchCheckbox:"#alwaysOpenToSearch"},templateHelpers:{"chrome.i18n":chrome.i18n},initialize:function(){t.get("views").push(this)},doOk:function(){var e=this.ui.suggestedQualitySelect.val();r.set("suggestedQuality",e),n.setSuggestedQuality(e);var t=this.ui.remindClearStreamCheckbox.is(":checked");r.set("remindClearStream",t);var i=this.ui.remindDeletePlaylistCheckbox.is(":checked");r.set("remindDeletePlaylist",i);var o=this.ui.showTooltipsCheckbox.is(":checked");r.set("showTooltips",o),$("[title]").qtip("disable",!o);var l=this.ui.alwaysOpenToSearchCheckbox.is(":checked");r.set("alwaysOpenToSearch",l)}});return o}),define("text!template/deletePlaylistButton.html",[],function(){return'<i class="fa fa-trash-o"></i>'}),define("foreground/view/activeFolderArea/deletePlaylistButtonView",["foreground/view/genericForegroundView","foreground/model/foregroundViewManager","text!template/deletePlaylistButton.html","foreground/collection/folders","foreground/view/prompt/deletePlaylistPromptView"],function(e,t,i,n,r){"use strict";var o=Backbone.Marionette.ItemView.extend({tagName:"button",className:"button-icon button-small delete",template:_.template(i),enabledTitle:chrome.i18n.getMessage("deletePlaylist"),disabledTitle:chrome.i18n.getMessage("cantDeleteLastPlaylist"),events:{click:"showDeleteSelectedPlaylistPrompt"},onRender:function(){var e=n.getActiveFolder().get("playlists").canDelete();return e?this.$el.attr("title",this.enabledTitle).removeClass("disabled"):this.$el.attr("title",this.disabledTitle).addClass("disabled"),this},initialize:function(){this.listenTo(n.getActiveFolder().get("playlists"),"add remove reset",this.render),t.get("views").push(this)},showDeleteSelectedPlaylistPrompt:function(){var e=n.getActiveFolder().get("playlists"),t=e.canDelete();if(t){var i=e.getActivePlaylist(),o=0===i.get("items").length;if(o)i.destroy();else{var l=new r({playlist:i});l.fadeInAndShow()}}}});return o}),define("foreground/view/activeFolderArea/activeFolderAreaView",["foreground/view/genericForegroundView","foreground/view/activeFolderArea/playlistCollectionView","text!template/activeFolderArea.html","common/view/settingsView","foreground/view/prompt/genericPromptView","foreground/view/prompt/createPlaylistPromptView","foreground/view/createPlaylistView","foreground/view/prompt/editPlaylistPromptView","foreground/view/activeFolderArea/deletePlaylistButtonView","foreground/collection/folders"],function(e,t,i,n,r,o,l,s,a,d){"use strict";var u=e.extend({template:_.template(i),playlistCollectionView:null,deletePlaylistButtonView:null,panel:null,attributes:{id:"activeFolderArea"},events:{click:"hideIfClickOutsidePanel","click .hide":"destroyModel","click h3":"toggleActiveFolderVisibility","click .settings":"showSettingsPrompt","click .add":"showCreatePlaylistPrompt","click .edit":"showEditSelectedPlaylistPrompt"},render:function(){return this.$el.html(this.template(_.extend(this.model.toJSON(),{"chrome.i18n":chrome.i18n}))),this.$el.find(".list").append(this.playlistCollectionView.render().el),this.$el.find(".right-group").append(this.deletePlaylistButtonView.render().el),this.panel=this.$el.find(".panel"),this.initializeTooltips(),this},initialize:function(){this.playlistCollectionView=new t({collection:this.model.get("folder").get("playlists")}),this.deletePlaylistButtonView=new a,this.listenTo(this.model,"destroy",this.hide)},show:function(){this.$el.data("background",this.$el.css("background")).transition({background:"rgba(0, 0, 0, 0.5)"},"snap"),this.panel.transition({x:this.panel.width()},300,"snap")},destroyModel:function(){this.model.destroy()},hideIfClickOutsidePanel:function(e){e.target==e.currentTarget&&this.model.destroy()},hide:function(){var e=this;this.$el.transition({background:this.$el.data("background")},function(){e.remove()}),this.panel.transition({x:-20},300)},toggleActiveFolderVisibility:function(e){var t=$(e.currentTarget).find("i"),i=t.data("expanded");i&&t.data("expanded",!1),t.transitionStop().transition({rotate:i?-90:0},200),i?this.playlistCollectionView.collapse():this.playlistCollectionView.expand(function(){t.data("expanded",!0)})},showSettingsPrompt:function(){var e=new r({title:chrome.i18n.getMessage("settings"),okButtonText:chrome.i18n.getMessage("save"),model:new n});e.fadeInAndShow()},showCreatePlaylistPrompt:function(){var e=new o;e.fadeInAndShow()},showEditSelectedPlaylistPrompt:function(){var e=d.getActiveFolder().get("playlists").getActivePlaylist(),t=new s({playlist:e});t.fadeInAndShow()}});return u}),define("text!template/playlistItem.html",[],function(){return'<!-- Render non-lazily if view is set to instant -->\r\n<% if( instant ) { %>\r\n    <img class="item-thumb" src="http://img.youtube.com/vi/<%= video.get(\'id\') %>/default.jpg" />\r\n<% } else { %>\r\n    <img class="item-thumb lazy" data-original="http://img.youtube.com/vi/<%= video.get(\'id\') %>/default.jpg" />\r\n<% } %>\r\n\r\n\r\n<span class="item-title" title="<%= title %>"><%= title %></span>\r\n\r\n<span class="item-details">\r\n    <% if( video.get(\'highDefinition\') ) { %>\r\n        <%= chrome.i18n.getMessage(\'hd\') %> · \r\n    <% } %>\r\n    <span class="item-duration">\r\n        <%= video.get(\'prettyDuration\') %>	\r\n    </span>\r\n</span>\r\n\r\n<span class="hover-actions">\r\n    <button class="button-icon playInStream" title="<%= chrome.i18n.getMessage(\'play\') %>">\r\n        <i class="fa fa-play"></i>\r\n    </button>\r\n    \r\n    <button class="button-icon addToStream" title="<%= chrome.i18n.getMessage(\'enqueue\') %>">\r\n        <i class="fa fa-plus"></i>\r\n    </button>\r\n    \r\n    <button class="button-icon delete" title="<%= chrome.i18n.getMessage(\'delete\') %>">\r\n        <i class="fa fa-trash-o"></i>\r\n    </button>\r\n</span>'}),define("foreground/view/activePlaylistArea/playlistItemView",["foreground/view/genericForegroundView","text!template/playlistItem.html","foreground/collection/contextMenuGroups","foreground/collection/streamItems","enum/listItemType"],function(e,t,i,n,r){"use strict";var o=e.extend({className:"listItem playlistItem multiSelectItem",template:_.template(t),attributes:function(){return{"data-id":this.model.get("id"),"data-type":r.PlaylistItem}},instant:!1,events:{"click button.addToStream":"addToStream","click button.delete":"doDelete","click button.playInStream":"playInStream",dblclick:"playInStream","dblclick button.addToStream":"addToStream","dblclick button.playInStream":"playInStream"},triggers:{contextmenu:{event:"showContextMenu",preventDefault:!0}},render:function(){return this.$el.html(this.template(_.extend(this.model.toJSON(),{"chrome.i18n":chrome.i18n,instant:this.instant}))),this.setHighlight(),this},initialize:function(e){this.instant=e&&e.instant||!1,this.listenTo(this.model,"destroy",this.remove),this.listenTo(this.model,"change:selected",this.setHighlight)},setHighlight:function(){this.$el.toggleClass("selected",this.model.get("selected"))},doDelete:function(){return this.model.destroy(),!1},showContextMenu:function(){var e=this;i.reset(),i.add({items:[{text:chrome.i18n.getMessage("copyUrl"),onClick:function(){chrome.extension.sendMessage({method:"copy",text:e.model.get("video").get("url")})}},{text:chrome.i18n.getMessage("copyTitleAndUrl"),onClick:function(){chrome.extension.sendMessage({method:"copy",text:'"'+e.model.get("title")+'" - '+e.model.get("video").get("url")})}},{text:chrome.i18n.getMessage("deleteVideo"),onClick:function(){e.model.destroy()}},{text:chrome.i18n.getMessage("enqueue"),onClick:function(){var t=e.model.get("video");n.addByVideo(t)}},{text:chrome.i18n.getMessage("play"),onClick:function(){var t=e.model.get("video");n.addByVideo(t,!0)}},{text:chrome.i18n.getMessage("watchOnYouTube"),onClick:function(){chrome.tabs.create({url:e.model.get("video").get("url")})}}]})},playInStream:_.debounce(function(){return n.addByPlaylistItem(this.model,!0),!1},100,!0),addToStream:_.debounce(function(){return n.addByPlaylistItem(this.model,!1),!1},100,!0)});return o}),define("text!template/streamItem.html",[],function(){return'<!-- Render non-lazily if view is set to instant -->\r\n<% if( instant ) { %>\r\n    <img class="item-thumb" src="http://img.youtube.com/vi/<%= video.get(\'id\') %>/default.jpg" />\r\n<% } else { %>\r\n    <img class="item-thumb lazy" data-original="http://img.youtube.com/vi/<%= video.get(\'id\') %>/default.jpg" />\r\n<% } %>\r\n\r\n<span class="item-title" title="<%= title %>">\r\n    <%= title %>\r\n</span>\r\n\r\n<span class="item-details">\r\n    <% if( video.get(\'highDefinition\') ) { %>\r\n        <%= chrome.i18n.getMessage(\'hd\') %> · \r\n    <% } %>\r\n    <span class="item-duration">\r\n        <%= video.get(\'prettyDuration\') %>\r\n    </span>\r\n</span>\r\n\r\n<span class="hover-actions">\r\n    <button class="button-icon playInStream" title="<%= chrome.i18n.getMessage(\'play\') %>">\r\n        <i class="fa fa-play"></i>\r\n    </button>\r\n    \r\n    <button class="button-icon delete" title="<%= chrome.i18n.getMessage(\'delete\') %>">\r\n        <i class="fa fa-trash-o"></i>\r\n    </button>\r\n</span>'}),define("foreground/model/buttons/playPauseButton",[],function(){"use strict";return chrome.extension.getBackgroundPage().PlayPauseButton}),define("foreground/view/rightPane/stream/streamItemView",["foreground/view/genericForegroundView","foreground/collection/contextMenuGroups","common/model/utility","foreground/collection/streamItems","text!template/streamItem.html","foreground/collection/folders","foreground/model/buttons/playPauseButton","foreground/model/player","enum/listItemType"],function(e,t,i,n,r,o,l,s,a){"use strict";var d=e.extend({className:"listItem streamItem",template:_.template(r),instant:!1,attributes:function(){return{"data-id":this.model.get("id"),"data-type":a.StreamItem}},events:{click:"select","click button.delete":"doDelete","click button.playInStream":"play",contextmenu:"showContextMenu",dblclick:"togglePlayingState","dblclick button.playInStream":"play"},render:function(){return this.$el.html(this.template(_.extend(this.model.toJSON(),{"chrome.i18n":chrome.i18n,instant:this.instant}))),this.$el.toggleClass("selected",this.model.get("selected")),this.initializeTooltips(),this},initialize:function(e){this.instant=e&&e.instant||!1,this.listenTo(this.model,"destroy",this.remove),this.listenTo(this.model,"change:selected",this.toggleSelected)},select:function(){this.model.set("selected",!0)},togglePlayingState:function(){l.tryTogglePlayerState()},doDelete:function(){return this.model.destroy(),!1},toggleSelected:function(){this.$el.toggleClass("selected",this.model.get("selected"))},showContextMenu:function(e){var i=this;e.preventDefault(),t.reset();var r=o.getActiveFolder().getActivePlaylist(),l=r.get("items").videoAlreadyExists(i.model.get("video"));t.add({items:[{text:chrome.i18n.getMessage("save"),title:l?"Duplicates not allowed":"",disabled:l,onClick:function(){l||r.addByVideo(i.model.get("video"))}},{text:chrome.i18n.getMessage("copyUrl"),onClick:function(){chrome.extension.sendMessage({method:"copy",text:i.model.get("video").get("url")})}},{text:chrome.i18n.getMessage("copyTitleAndUrl"),onClick:function(){chrome.extension.sendMessage({method:"copy",text:'"'+i.model.get("title")+'" - '+i.model.get("video").get("url")})}},{text:chrome.i18n.getMessage("delete"),onClick:function(){i.model.destroy()}},{text:chrome.i18n.getMessage("banUntilClear"),disabled:n.getRelatedVideos().length<5,onClick:function(){n.ban(i.model),i.model.destroy()}},{text:chrome.i18n.getMessage("watchOnYouTube"),onClick:function(){chrome.tabs.create({url:i.model.get("video").get("url")})}}]})},play:_.debounce(function(){return this.model.get("selected")?s.play():(s.playOnceVideoChanges(),this.select()),!1},100,!0)});return d}),define("text!template/videoSearchResult.html",[],function(){return'<!--Render those items immediately visible as non-lazy. The rest can lazy in later.-->\r\n<% if( instant ) { %>\r\n    <img class="item-thumb" src="http://img.youtube.com/vi/<%= video.get(\'id\') %>/default.jpg" />\r\n<% } else { %>\r\n    <img class="item-thumb lazy" data-original="http://img.youtube.com/vi/<%= video.get(\'id\') %>/default.jpg" src="" />\r\n<% } %>\r\n\r\n<span class="item-title" title="<%= video.get(\'title\') %>"><%= video.get(\'title\') %></span>\r\n\r\n<span class="item-details">\r\n    <% if( video.get(\'highDefinition\') ) { %>\r\n        <%= chrome.i18n.getMessage(\'hd\') %> · \r\n    <% } %>\r\n    <span class="item-duration">\r\n        <%= video.get(\'prettyDuration\') %>	\r\n    </span>\r\n</span>\r\n\r\n<span class="hover-actions">\r\n    <button class="button-icon playInStream" title="<%= chrome.i18n.getMessage(\'play\') %>">\r\n        <i class="fa fa-play"></i>\r\n    </button>\r\n    \r\n    <button class="button-icon addToStream" title="<%= chrome.i18n.getMessage(\'enqueue\') %>">\r\n        <i class="fa fa-plus"></i>\r\n    </button>\r\n    \r\n    <button class="button-icon delete" title="<%= chrome.i18n.getMessage(\'delete\') %>">\r\n        <i class="fa fa-trash-o"></i>\r\n    </button>\r\n</span>'}),define("foreground/collection/videoSearchResults",[],function(){"use strict";return chrome.extension.getBackgroundPage().VideoSearchResults}),define("text!template/saveVideos.html",[],function(){return'<select class="submittable" placeholder="<%= chrome.i18n.getMessage(\'typeToCreateOrFilterPlaylists\') %>...">\r\n\r\n</select>'}),define("foreground/view/saveVideosView",["foreground/view/genericForegroundView","text!template/saveVideos.html","foreground/collection/folders"],function(e,t,i){"use strict";var n=e.extend({className:"saveVideos",template:_.template(t),creating:!1,render:function(){var e=this;this.$el.html(this.template({"chrome.i18n":chrome.i18n}));var t=i.getActiveFolder().get("playlists").map(function(e){return{id:e.get("id"),title:e.get("title"),displayInfo:e.get("displayInfo")}});this.playlistSelect=this.$el.find("select.submittable");var n=i.getActiveFolder().getActivePlaylist().get("id");return this.playlistSelect.selectize({persist:!1,maxItems:1,mode:"multi",valueField:"id",labelField:"title",searchField:["title"],options:t,plugins:["remove_button"],render:{item:function(e,t){return'<div><span class="title">'+t(e.title)+"</span>"+"</div>"},option:function(e,t){var i=e.id===n?"selected":"",r='<div class="'+i+'">';return r+='<span class="label">'+t(e.title)+"</span>",r+='<span class="caption">'+t(e.displayInfo)+"</span>",r+="</div>"}},create:function(t){var i=!1,n=$.trim(t);return""!==n&&(i={id:_.uniqueId("newPlaylist_"),title:n}),e.creating=!0,e.trigger("change:creating",e.creating),i},onDelete:function(){e.creating=!1,e.trigger("change:creating",e.creating)}}),this},validate:function(){var e=this.playlistSelect.val(),t=null!==e&&e.length>0;return t},doOk:function(){var e=this.playlistSelect.val();if(this.creating){var t=this.$el.find(".selectize-input").find("span.title").text();i.getActiveFolder().addPlaylistWithVideos(t,this.model)}else{var n=i.getActiveFolder().get("playlists").get(e);n.addByVideos(this.model)}}});return n}),define("foreground/view/prompt/saveVideosPromptView",["foreground/view/prompt/genericPromptView","foreground/view/saveVideosView"],function(e,t){"use strict";var i=e.extend({title:"",okButtonText:chrome.i18n.getMessage("save"),model:null,initialize:function(i){this.model=new t({model:i.videos}),this.title=1===i.videos.length?chrome.i18n.getMessage("saveVideo"):chrome.i18n.getMessage("saveVideos"),this.listenTo(this.model,"change:creating",function(e){e?this.okButton.text(chrome.i18n.getMessage("createPlaylist")):this.okButton.text(chrome.i18n.getMessage("save"))}),e.prototype.initialize.call(this,arguments)}});return i}),define("foreground/view/videoSearch/videoSearchResultView",["foreground/view/genericForegroundView","text!template/videoSearchResult.html","foreground/collection/contextMenuGroups","foreground/collection/videoSearchResults","foreground/collection/streamItems","foreground/collection/folders","foreground/view/prompt/saveVideosPromptView","enum/listItemType"],function(e,t,i,n,r,o,l,s){"use strict";var a=e.extend({className:"listItem videoSearchResult multiSelectItem",template:_.template(t),attributes:function(){return{"data-id":this.model.get("id"),"data-type":s.VideoSearchResult}},instant:!1,events:{"click button.playInStream":"playInStream","click button.addToStream":"addToStream","click button.save":"saveToPlaylist",contextmenu:"showContextMenu",dblclick:"playInStream","dblclick button.playInStream":"playInStream","dblclick button.save":"saveToPlaylist","dblclick button.addToStream":"addToStream"},render:function(){return this.$el.html(this.template(_.extend(this.model.toJSON(),{"chrome.i18n":chrome.i18n,instant:this.instant}))),this.setHighlight(),this},initialize:function(e){this.instant=e&&e.instant||!1,this.listenTo(this.model,"change:selected",this.setHighlight),this.listenTo(this.model,"destroy",this.remove)},setHighlight:function(){this.$el.toggleClass("selected",this.model.get("selected"))},playInStream:_.debounce(function(){var e=this.model.get("video");return r.addByVideo(e,!0),!1},100,!0),addToStream:_.debounce(function(){var e=this.model.get("video");return r.addByVideo(e,!1),!1},100,!0),saveToPlaylist:_.debounce(function(){var e=this.model.get("video"),t=new l({videos:[e]});return t.fadeInAndShow(),!1},100,!0),showContextMenu:function(e){var t=this.model.get("video");e.preventDefault(),i.reset(),i.add({items:[{text:chrome.i18n.getMessage("play"),onClick:function(){r.addByVideo(t,!0)}},{text:chrome.i18n.getMessage("enqueue"),onClick:function(){r.addByVideo(t,!1)}},{text:chrome.i18n.getMessage("copyUrl"),onClick:function(){chrome.extension.sendMessage({method:"copy",text:t.get("url")})}},{text:chrome.i18n.getMessage("copyTitleAndUrl"),onClick:function(){chrome.extension.sendMessage({method:"copy",text:'"'+t.get("title")+'" - '+t.get("url")})}},{text:chrome.i18n.getMessage("watchOnYouTube"),onClick:function(){chrome.tabs.create({url:t.get("url")})}}]})}});return a}),define("foreground/view/multiSelectView",["foreground/view/genericForegroundView","foreground/view/activePlaylistArea/playlistItemView","foreground/view/rightPane/stream/streamItemView","foreground/view/videoSearch/videoSearchResultView","enum/listItemType","foreground/collection/streamItems"],function(e,t,i,n,r,o){"use strict";var l=e.extend({events:{"click .listItem":"setSelectedOnClick"},render:function(){var e=this;return this.$el.sortable({connectWith:".droppable-list",cursorAt:{right:35,bottom:40},placeholder:"sortable-placeholder listItem hiddenUntilChange",helper:function(o,l){var s,a={model:e.model.get(l.data("id")),instant:!0},d=l.data("type");switch(d){case r.PlaylistItem:s=new t(a);break;case r.StreamItem:s=new i(a);break;case r.VideoSearchResult:s=new n(a);break;default:throw"Unhandled ListItemType: "+d}return this.copyHelper=s.render().$el.insertAfter(l),this.copyHelper.addClass("copyHelper"),this.backCopyHelper=l.prev(),this.backCopyHelper.addClass("copyHelper"),$(this).data("copied",!1),$("<span>",{"class":"selectedModelsLength"})},change:function(){$(".hiddenUntilChange").removeClass("hiddenUntilChange")},start:function(t,i){var n=e.model.get(i.item.data("id"));e.doSetSelected({modelToSelect:n,drag:!0}),this.selectedItems=e.$el.find(".selected"),this.selectedItems.css({opacity:".5"}),i.helper.text(e.model.selected().length),i.item.data("sortableItem").scrollParent=i.placeholder.parent(),i.item.data("sortableItem").overflowOffset=i.placeholder.parent().offset()},stop:function(e,t){this.backCopyHelper.removeClass("copyHelper");var i=$(this).data("copied");i?this.copyHelper.removeClass("copyHelper"):this.copyHelper.remove(),this.selectedItems.css({opacity:"1"}),this.copyHelper=null,this.backCopyHelper=null,this.selectedItems=null;var n=t.item.data("type")===r.VideoSearchResult;return i||!n},tolerance:"pointer",receive:function(t,i){var n=i.item.data("type");if(n===r.StreamItem){var l=i.item.data("id"),s=o.get(l);i.item.removeClass("selected");var a=e.model.videoAlreadyExists(s.get("video"));if(a)i.item.remove();else{e.model.addByVideoAtIndex(s.get("video"),i.item.index(),function(){i.item.remove()});var d=$(".playlistEmpty");d.length>0&&d.addClass("hidden")}}else console.error("Unsupported.");i.sender.data("copied",!0)},update:function(t,i){var n=i.item.data("id"),o=i.item.data("type");if(o===r.PlaylistItem){var l=parseInt(i.item.parent().children(".listItem").index(i.item));e.model.moveToIndex(n,l)}},over:function(e,t){t.item.data("sortableItem").scrollParent=t.placeholder.parent(),t.item.data("sortableItem").overflowOffset=t.placeholder.parent().offset()}}),this},setSelectedOnClick:function(e){var t=$(e.currentTarget).data("id"),i=this.model.get(t);this.doSetSelected({shiftKey:e.shiftKey,ctrlKey:e.ctrlKey,modelToSelect:i})},doSetSelected:function(e){var t=e.modelToSelect,i=e.shiftKey||!1,n=e.ctrlKey||!1,r=e.drag||!1,o=t.get("selected");if(t.set("selected",!o||r),i){var l=0,s=this.model.indexOf(t);this.model.selected().length>1&&(l=this.model.indexOf(this.model.firstSelected())),this.model.each(function(e,t){var i=s>=t&&t>=l,n=t>=s&&l>=t;e.set("selected",n||i)})}else n?t.set("firstSelected",!0):(!r||r&&!o)&&this.model.deselectAllExcept(t.cid)}});return l}),define("text!template/activePlaylistItems.html",[],function(){return""}),define("foreground/view/activePlaylistArea/activePlaylistItemsView",["foreground/view/multiSelectView","foreground/collection/contextMenuGroups","foreground/collection/streamItems","foreground/view/activePlaylistArea/playlistItemView","text!template/activePlaylistItems.html"],function(e,t,i,n,r){"use strict";var o=e.extend({className:"left-list droppable-list",template:_.template(r),events:function(){return _.extend({},e.prototype.events,{contextmenu:"showContextMenu"})},attributes:{id:"activePlaylistItems"},render:function(){this.$el.html(this.template());var t=200,i=_.toArray(this.model.groupBy(function(e,i){return Math.floor(i/t)}));return this.incrementalRender(i,function(){var e=this.$el.find("img.lazy"),t=_.filter(e,function(e){return $.inviewport(e,{threshold:0,container:this.el})}.bind(this)),i=_.filter(e,function(e){return!$.inviewport(e,{threshold:0,container:this.el})}.bind(this));$(t).lazyload({container:this.el}),$(i).lazyload({effect:"fadeIn",threshold:500,container:this.el,event:"scroll manualShow"})}.bind(this)),e.prototype.render.call(this,arguments),this},initialize:function(){this.listenTo(this.model,"add",this.addItem),this.listenTo(this.model,"remove",function(){this.$el.trigger("manualShow")})},incrementalRender:function(e,t){if(e.length>0){var i=e.shift(),r=_.map(i,function(e){var t=new n({model:e});return t.render().el});this.$el.append(r),setTimeout(function(){this.incrementalRender(e,t)}.bind(this))}else t()},addItem:function(e){var t=new n({model:e}),i=t.render().$el;if(this.$el.find(".playlistItem").length>0){var r=this.model.indexOf(e),o=this.model.at(r-1);if(o){var l=o.get("id"),s=this.$el.find('.playlistItem[data-id="'+l+'"]');s.after(i)}else this.$el.find(".playlistItem").first().before(i)}else this.$el.append(i);t.$el.find("img.lazy").lazyload({container:this.el,event:"scroll manualShow"}),this.scrollItemIntoView(e),this.initializeTooltips()},showContextMenu:function(e){if(e.preventDefault(),e.target===e.currentTarget||$(e.target).hasClass("big-text")||$(e.target).hasClass("i-4x")){t.reset();var n=this,r=0===this.model.length;t.add({items:[{text:chrome.i18n.getMessage("enqueuePlaylist"),disabled:r,title:r?chrome.i18n.getMessage("playlistEmpty"):"",onClick:function(){r||i.addByPlaylistItems(n.model,!1)}},{text:chrome.i18n.getMessage("playPlaylist"),disabled:r,title:r?chrome.i18n.getMessage("playlistEmpty"):"",onClick:function(){r||i.addByPlaylistItems(n.model,!0)}}]})}},scrollItemIntoView:function(e){var t=e.get("id"),i=this.$el.find('.listItem[data-id="'+t+'"]');i.length>0&&i.scrollIntoView(!0)}});return o}),define("text!template/activePlaylistArea.html",[],function(){return'<div class="left-top-bar">\r\n    <button class="button-icon show" title="<%= chrome.i18n.getMessage(\'openMenu\') %>">\r\n        <i class="fa fa-reorder"></i>\r\n    </button>\r\n\r\n    <div class="playlistTitle" title="<%= playlist.get(\'title\') %>">\r\n        <%= playlist.get(\'title\') %>\r\n    </div>\r\n    \r\n    <button class="button-icon" id="showVideoSearch" title="<%= chrome.i18n.getMessage(\'showVideoSearch\') %>">\r\n        <i class="fa fa-search"></i>\r\n    </button>\r\n</div>\r\n\r\n<div class="left-top-divider"></div>\r\n\r\n<div class="big-text-wrapper">\r\n    \r\n    <div class="big-text playlistEmpty">\r\n        <div class="big-text-header">\r\n            <%= chrome.i18n.getMessage(\'playlistEmpty\') %>\r\n        </div>\r\n        <%= chrome.i18n.getMessage(\'wouldYouLikeTo\') %> <span id="videoSearchLink" class="searchLink clickable lowercase"><%= chrome.i18n.getMessage(\'searchForVideos\') %></span>?\r\n    </div>\r\n\r\n    <div id="activePlaylistItemsView" class="view-placeholder">\r\n    </div>\r\n</div>\r\n\r\n<div class="left-bottom-menubar">\r\n    <div class="playlist-details lowercase">\r\n        <%= playlist.get(\'displayInfo\') %>\r\n    </div>\r\n    <div class="playlist-actions">\r\n        <div id="searchButtonView" class="view-placeholder"></div>\r\n        <div id="addAllButtonView" class="view-placeholder"></div>\r\n        <div id="playAllButtonView" class="view-placeholder"></div>\r\n    </div>\r\n</div>'}),define("text!template/playAllButton.html",[],function(){return"<i class=\"fa fa-play\"></i><%= chrome.i18n.getMessage('playAll') %>"}),define("foreground/view/activePlaylistArea/playAllButtonView",["foreground/view/genericForegroundView","foreground/model/foregroundViewManager","text!template/playAllButton.html","foreground/collection/streamItems"],function(e,t,i,n){"use strict";var r=Backbone.Marionette.ItemView.extend({tagName:"button",className:"button-label playAll",template:_.template(i),attributes:{title:chrome.i18n.getMessage("playAll")},events:{click:function(){n.addByPlaylistItems(this.model.get("items"),!0)}},initialize:function(){t.get("views").push(this),e.prototype.initializeTooltips.call(this)}});return r}),define("text!template/addAllButton.html",[],function(){return"<i class=\"fa fa-plus\"></i><%= chrome.i18n.getMessage('enqueueAll') %>"}),define("foreground/view/activePlaylistArea/addAllButtonView",["foreground/view/genericForegroundView","text!template/addAllButton.html","foreground/collection/streamItems"],function(e,t,i){"use strict";var n=e.extend({tagName:"button",className:"button-label addAll",template:_.template(t),attributes:{title:chrome.i18n.getMessage("enqueueAll")},events:{click:"addToStream"},render:function(){return this.$el.html(this.template()),this},addToStream:function(){i.addByPlaylistItems(this.model.get("items"),!1)}});return n}),define("text!template/searchButton.html",[],function(){return"<i class=\"fa fa-search\"></i><%= chrome.i18n.getMessage('search') %>"}),define("foreground/view/activePlaylistArea/searchButtonView",["foreground/view/genericForegroundView","text!template/searchButton.html"],function(e,t){"use strict";var i=e.extend({tagName:"button",className:"button-label searchPlaylist",template:_.template(t),attributes:{title:chrome.i18n.getMessage("search")},events:{click:"searchPlaylist"},render:function(){return this.$el.html(this.template()),this.$el.hide(),this},searchPlaylist:function(){}});return i}),define("foreground/view/activePlaylistArea/activePlaylistAreaView",["foreground/view/genericForegroundView","foreground/view/activePlaylistArea/activePlaylistItemsView","text!template/activePlaylistArea.html","foreground/view/activePlaylistArea/playAllButtonView","foreground/view/activePlaylistArea/addAllButtonView","foreground/view/activePlaylistArea/searchButtonView"],function(e,t,i,n,r,o){"use strict";var l=e.extend({className:"left-pane",template:_.template(i),activePlaylistItemsView:null,searchButtonView:null,addAllButtonView:null,playAllButtonView:null,playlistDetails:null,playlistTitle:null,playlistEmptyMessage:null,bottomMenubar:null,attributes:{id:"activePlaylistArea"},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.$el.html(this.template(_.extend(this.model.toJSON(),{"chrome.i18n":chrome.i18n}))),this.$el.find("#activePlaylistItemsView").replaceWith(this.activePlaylistItemsView.render().el),this.$el.find("#searchButtonView").replaceWith(this.searchButtonView.render().el),this.$el.find("#addAllButtonView").replaceWith(this.addAllButtonView.render().el),this.$el.find("#playAllButtonView").replaceWith(this.playAllButtonView.render().el),this.playlistDetails=this.$el.find(".playlist-details"),this.playlistTitle=this.$el.find(".playlistTitle"),this.playlistEmptyMessage=this.$el.find("div.playlistEmpty"),this.bottomMenubar=this.$el.find(".left-bottom-menubar"),this.initializeTooltips(),this.toggleBigText(),this.toggleBottomMenubar(),this},initialize:function(){this.activePlaylistItemsView=new t({model:this.model.get("playlist").get("items")}),this.searchButtonView=new o({mode:this.model.get("playlist")}),this.playAllButtonView=new n({model:this.model.get("playlist")}),this.addAllButtonView=new r({model:this.model.get("playlist")}),this.listenTo(this.model.get("playlist"),"change:displayInfo",this.updatePlaylistDetails),this.listenTo(this.model.get("playlist"),"change:title",this.updatePlaylistTitle),this.listenTo(this.model.get("playlist").get("items"),"add remove reset",function(){this.toggleBigText(),this.toggleBottomMenubar()})},updatePlaylistDetails:function(){this.playlistDetails.text(this.model.get("playlist").get("displayInfo"))},updatePlaylistTitle:function(){var e=this.model.get("playlist").get("title");this.playlistTitle.text(e),this.playlistTitle.qtip("option","content.text",e)},toggleBigText:function(){var e=0===this.model.get("playlist").get("items").length;this.playlistEmptyMessage.toggleClass("hidden",!e)},toggleBottomMenubar:function(){var e=0===this.model.get("playlist").get("items").length;e?this.bottomMenubar.hide():this.bottomMenubar.show()}});return l}),define("foreground/model/activePlaylistArea",[],function(){"use strict";var e=Backbone.Model.extend({defaults:function(){return{playlist:null}}});return e}),define("text!template/videoSearchResults.html",[],function(){return""}),define("foreground/view/videoSearch/videoSearchResultsView",["foreground/collection/videoSearchResults","foreground/view/multiSelectView","foreground/view/videoSearch/videoSearchResultView","text!template/videoSearchResults.html","common/model/utility","foreground/collection/contextMenuGroups","foreground/collection/streamItems"],function(e,t,i,n,r,o,l){"use strict";var s=t.extend({className:"left-list",template:_.template(n),attributes:{id:"searchResultsList"},model:e,events:function(){return _.extend({},t.prototype.events,{contextmenu:"showContextMenu"})},render:function(){return this.addAll(),this.$el.find("img.lazy").lazyload({effect:"fadeIn",threshold:500,container:this.el}),this.initializeTooltips(),t.prototype.render.call(this,arguments),this},initialize:function(){this.listenTo(this.model,"reset",this.render)},selectResultOnUpDown:function(e){var t=this.model.selected();t.length&&(t=t[0]);var i;i="Down"==e.keyIdentifier?t?this.model.at(this.model.indexOf(t)+1):this.model.at(0):t?this.model.at(this.model.indexOf(t)-1):this.model.at(0);
var n=i.get("video").get("id");this.model.getByVideoId(n),this.doSetSelected({modelToSelect:i})},destroyedHandler:function(){key.unbind("down, up")},addOne:function(e){var t=this.model.indexOf(e),n=new i({model:e,instant:8>=t});this.$el.append(n.render().el)},addAll:function(){var e=this.model.map(function(e,t){var n=new i({model:e,instant:8>=t});return n.render().el});this.$el.append(e)},showContextMenu:function(e){e.preventDefault(),(e.target===e.currentTarget||$(e.target).hasClass("big-text")||$(e.target).hasClass("i-4x"))&&o.reset();var t=this.model.selected(),i=0===t.length;o.add({items:[{text:chrome.i18n.getMessage("playSelected")+" ("+t.length+")",disabled:i,onClick:function(){if(!i){var e=_.map(t,function(e){return e.get("video")});l.addByVideos(e,!0)}}},{text:chrome.i18n.getMessage("enqueueSelected")+" ("+t.length+")",disabled:i,onClick:function(){if(!i){var e=_.map(t,function(e){return e.get("video")});l.addByVideos(e,!1)}}}]})}});return s}),define("text!template/videoSearch.html",[],function(){return'<div class="left-top-bar">\r\n    <div class="searchBar">\r\n        <input placeholder="<%= chrome.i18n.getMessage(\'search\') %>..." type="text">\r\n        <div class="underline"></div>\r\n    </div>\r\n    \r\n    <button class="button-icon remove" id="hideVideoSearch" title="<%= chrome.i18n.getMessage(\'hideVideoSearch\') %>">\r\n        <i class="fa fa-times"></i>\r\n    </button>\r\n</div>\r\n\r\n<div class="left-top-divider"></div>\r\n\r\n<div class="big-text-wrapper">\r\n    \r\n    <div class="big-text instructions">\r\n        <div class="big-text-header"><%= chrome.i18n.getMessage(\'startTyping\') %></div>\r\n        <%= chrome.i18n.getMessage(\'resultsWillAppearAsYouSearch\') %>.\r\n    </div>\r\n\r\n    <div class="big-text searching hidden">\r\n        <div class="big-text-header"><%= chrome.i18n.getMessage(\'searching\') %>...</div>\r\n        <div class="spinner spinner-medium"></div>\r\n    </div>\r\n\r\n    <div class="big-text noResults hidden">\r\n        <div class="big-text-header"><%= chrome.i18n.getMessage(\'noResultsFound\') %></div>\r\n        <%= chrome.i18n.getMessage(\'sorryAboutThat\') %>. <%= chrome.i18n.getMessage(\'trySearchingForSomethingElse\') %>.\r\n    </div>\r\n\r\n    <div id="videoSearchResultsView" class="view-placeholder">\r\n        \r\n    </div>\r\n</div>\r\n\r\n<div class="left-bottom-menubar">\r\n    <div class="playlist-actions">\r\n\r\n    </div>\r\n</div>'}),define("text!template/playSelectedButton.html",[],function(){return"<i class=\"fa fa-play\"></i><%= chrome.i18n.getMessage('playSelected') %>"}),define("foreground/view/videoSearch/playSelectedButtonView",["foreground/view/genericForegroundView","text!template/playSelectedButton.html","foreground/collection/videoSearchResults","foreground/collection/streamItems"],function(e,t,i,n){"use strict";var r=e.extend({tagName:"button",className:"button-label",template:_.template(t),attributes:{title:chrome.i18n.getMessage("playSelected")},events:{click:"playSelected"},render:function(){return this.$el.html(this.template({"chrome.i18n":chrome.i18n})),this},playSelected:function(){var e=_.map(i.selected(),function(e){return e.get("video")});n.addByVideos(e,!0)}});return r}),define("text!template/saveSelectedButton.html",[],function(){return"<i class=\"fa fa-save\"></i><%= chrome.i18n.getMessage('saveSelected') %>"}),define("foreground/view/videoSearch/saveSelectedButtonView",["foreground/view/genericForegroundView","text!template/saveSelectedButton.html","foreground/view/prompt/saveVideosPromptView","foreground/collection/videoSearchResults"],function(e,t,i,n){"use strict";var r=e.extend({tagName:"button",className:"button-label",template:_.template(t),attributes:{title:chrome.i18n.getMessage("saveSelected")},events:{click:"showSaveSelectedPrompt"},render:function(){return this.$el.html(this.template({"chrome.i18n":chrome.i18n})),this},showSaveSelectedPrompt:function(){var e=n.selected(),t=_.map(e,function(e){return e.get("video")}),r=new i({videos:t});r.fadeInAndShow()}});return r}),define("foreground/view/videoSearch/videoSearchView",["foreground/view/genericForegroundView","foreground/view/videoSearch/videoSearchResultsView","text!template/videoSearch.html","foreground/view/videoSearch/playSelectedButtonView","foreground/view/videoSearch/saveSelectedButtonView","foreground/collection/videoSearchResults","foreground/model/settings"],function(e,t,i,n,r,o,l){"use strict";var s=e.extend({className:"left-pane",template:_.template(i),videoSearchResultsView:null,attributes:{id:"videoSearch"},searchInput:null,playSelectedButtonView:null,saveSelectedButtonView:null,searchingMessage:null,instructions:null,noResultsMessage:null,bigTextWrapper:null,searchInputFocused:!1,clearResultsTimeout:null,bottomMenubar:null,events:{"input .searchBar input":"showVideoSuggestions","click button#hideVideoSearch":"destroyModel"},render:function(){this.$el.html(this.template(_.extend(this.model.toJSON(),{"chrome.i18n":chrome.i18n}))),this.$el.find("#videoSearchResultsView").replaceWith(this.videoSearchResultsView.render().el),this.bottomMenubar=this.$el.find(".left-bottom-menubar");var e=this.$el.find(".playlist-actions");e.append(this.playSelectedButtonView.render().el),e.append(this.saveSelectedButtonView.render().el),this.searchInput=this.$el.find(".searchBar input"),this.initializeTooltips(),this.searchingMessage=this.$el.find("div.searching"),this.instructions=this.$el.find("div.instructions"),this.noResultsMessage=this.$el.find("div.noResults"),this.bigTextWrapper=this.$el.find("div.big-text-wrapper"),this.toggleBigText(),this.toggleBottomMenubar();var t=l.get("searchQuery");return this.searchInput.val(t),""===t||0===o.length?this.searchInput.trigger("input"):this.model.set("searchQuery",t,{silent:!0}),this},initialize:function(){this.playSelectedButtonView=new n,this.saveSelectedButtonView=new r,this.videoSearchResultsView=new t,this.listenTo(this.model,"destroy",this.hide),this.listenTo(this.model,"change:searchJqXhr change:searchQuery",this.toggleBigText),this.listenTo(o,"reset",this.toggleBigText),this.listenTo(o,"change:selected",this.toggleBottomMenubar),$(window).unload(function(){this.saveSearchQuery(),this.startClearResultsTimeout()}.bind(this))},showAndFocus:function(e){this.$el.transition({x:this.$el.width()},e?0:void 0,"snap"),this.searchInput.focus(),clearTimeout(this.clearResultsTimeout)},destroyModel:function(){this.model.destroy()},hide:function(){this.$el.transition({x:-20},function(){this.remove(),this.startClearResultsTimeout()}.bind(this))},startClearResultsTimeout:function(){clearTimeout(this.clearResultsTimeout);var e=3e5;this.clearResultsTimeout=setTimeout(function(){this.model.set("searchQuery",""),o.clear()},e)},saveSearchQuery:function(){l.set("searchQuery",this.model.get("searchQuery"))},getSearchQuery:function(){var e=$.trim(this.searchInput.val());return e},showVideoSuggestions:function(){var e=this.getSearchQuery();this.model.set("searchQuery",e)},toggleBottomMenubar:function(){0===o.selected().length?(this.bottomMenubar.hide(),this.bigTextWrapper.addClass("extended")):(this.bottomMenubar.show(),this.bigTextWrapper.removeClass("extended"))},toggleBigText:function(){var e=null===this.model.get("searchJqXhr");this.searchingMessage.toggleClass("hidden",e);var t=o.length>0,i=this.model.get("searchQuery").length>0;this.instructions.toggleClass("hidden",t||i);var n=e&&i&&!t;this.noResultsMessage.toggleClass("hidden",!n)}});return s}),define("foreground/model/videoSearch",["foreground/collection/videoSearchResults","enum/dataSourceType","common/model/youTubeV2API","common/model/utility","common/model/dataSource"],function(e,t,i,n,r){"use strict";var o=Backbone.Model.extend({defaults:function(){return{searchQuery:"",searchJqXhr:null,playlist:null}},initialize:function(){var n=this;this.on("change:searchQuery",function(o,l){var s=this.get("searchJqXhr");if(s&&s.abort(),""===$.trim(l))return e.setFromVideoInformationList([]),void 0;var a,d=new r({urlToParse:l});a=d.get("type")===t.YouTubeVideo?i.getVideoInformation({videoId:d.get("sourceId"),success:function(t){e.setFromVideoInformation(t)},complete:function(){n.set("searchJqXhr",null)}}):i.search({text:l,success:function(t){l===n.get("searchQuery")&&e.setFromVideoInformationList(t)},complete:function(){n.set("searchJqXhr",null)}}),this.set("searchJqXhr",a)})}});return o}),define("text!template/rightPane.html",[],function(){return'<div class="top-bar">\r\n    \r\n    <div class="center-group">\r\n    </div>\r\n    <div class="right-group">\r\n\r\n    </div>\r\n</div>\r\n\r\n'}),define("text!template/streamItems.html",[],function(){return""}),define("text!template/clearStream.html",[],function(){return'<%= chrome.i18n.getMessage(\'areYouSureYouWantToClearYourStream\') %>\r\n\r\n<div class="reminder">\r\n    <input type="checkbox" id="remindClearStream">\r\n	<label for="remindClearStream"><%= chrome.i18n.getMessage(\'dontRemindMeAgain\') %></label>\r\n</div>\r\n'}),define("foreground/view/clearStreamView",["foreground/view/genericForegroundView","text!template/clearStream.html","foreground/model/settings","foreground/collection/streamItems"],function(e,t,i,n){"use strict";var r=e.extend({className:"clearStream",template:_.template(t),render:function(){return this.$el.html(this.template({"chrome.i18n":chrome.i18n})),this},doOk:function(){var e=!this.$el.find("input#remindClearStream").is(":checked");i.set("remindClearStream",e),n.clear()}});return r}),define("foreground/model/streamAction",["foreground/model/settings","foreground/collection/streamItems","foreground/view/prompt/genericPromptView","foreground/view/clearStreamView","foreground/view/saveVideosView"],function(e,t,i,n,r){var o=Backbone.Model.extend({clearStream:function(){if(t.length>0){var r=e.get("remindClearStream");if(r){var o=new i({title:chrome.i18n.getMessage("areYouSure"),model:new n});o.fadeInAndShow()}else t.clear()}},saveStream:function(){if(t.length>0){var e=t.pluck("video"),n=new i({title:1===t.length?chrome.i18n.getMessage("saveVideo"):chrome.i18n.getMessage("saveVideos"),okButtonText:chrome.i18n.getMessage("save"),model:new r({model:e})});n.listenTo(n.model,"change:creating",function(e){e?this.okButton.text(chrome.i18n.getMessage("createPlaylist")):this.okButton.text(chrome.i18n.getMessage("save"))}),n.fadeInAndShow()}}});return new o}),define("foreground/view/rightPane/stream/streamItemsView",["foreground/view/genericForegroundView","foreground/collection/streamItems","foreground/view/rightPane/stream/streamItemView","text!template/streamItems.html","foreground/collection/contextMenuGroups","common/model/utility","foreground/model/streamAction","foreground/collection/folders","foreground/collection/videoSearchResults","enum/listItemType"],function(e,t,i,n,r,o,l,s,a,d){"use strict";var u=e.extend({className:"left-list droppable-list",attributes:{id:"streamItemList"},template:_.template(n),events:{contextmenu:"showContextMenu"},render:function(){if(this.$el.html(this.template()),t.length>0){1===t.length?this.addItem(t.at(0)):this.addItems(t.models);var e=this.$el.find(".listItem"),i=e.filter(".selected");setTimeout(function(){i.scrollIntoView(!1),this.$el.trigger("scroll")}.bind(this))}return this},initialize:function(){this.listenTo(t,"add",this.addItem),this.listenTo(t,"remove reset",function(){this.$el.trigger("scroll"),0===t.length&&this.emptyStreamItemList()}),this.listenTo(t,"change:selected",function(){var e=this.$el.find(".listItem.selected");1===e.length&&e.scrollIntoView(!0),this.$el.trigger("scroll")}),this.$el.sortable({connectWith:".droppable-list",cursorAt:{right:35,bottom:40},placeholder:"sortable-placeholder listItem hiddenUntilChange",helper:function(e,n){var r=new i({model:t.get(n.data("id")),instant:!0});return this.copyHelper=r.render().$el.insertAfter(n),this.copyHelper.css({opacity:".5"}).addClass("copyHelper"),this.backCopyHelper=n.prev(),this.backCopyHelper.addClass("copyHelper"),$(this).data("copied",!1),$("<span>",{"class":"selectedModelsLength",text:"1"})},change:function(){$(".hiddenUntilChange").removeClass("hiddenUntilChange")},start:function(e,i){var n=i.item.data("id"),r=t.get(n),o=s.getActiveFolder().getActivePlaylist().get("items").videoAlreadyExists(r.get("video"));i.placeholder.toggleClass("noDrop",o),i.item.data("sortableItem").scrollParent=i.placeholder.parent(),i.item.data("sortableItem").overflowOffset=i.placeholder.parent().offset()},stop:function(){this.backCopyHelper.removeClass("copyHelper");var e=$(this).data("copied");e?this.copyHelper.css({opacity:1}).removeClass("copyHelper"):this.copyHelper.remove(),this.copyHelper=null,this.backCopyHelper=null},tolerance:"pointer",receive:function(e,i){var n=i.item.data("type");if(n===d.PlaylistItem){var r=s.getActiveFolder().getActivePlaylist().get("items"),o=r.selected();t.addByDraggedPlaylistItems(o,i.item.index()),r.deselectAll()}else if(n===d.VideoSearchResult){var l=a.selected();t.addByDraggedVideoSearchResults(l,i.item.index()),a.deselectAll()}i.item.remove(),i.sender.data("copied",!0)},update:function(e,i){var n=i.item.data("type");if(n===d.StreamItem){var r=parseInt(i.item.parent().children(".listItem").index(i.item)),o=i.item.data("id"),l=t.indexOf(t.get(o));t.models.splice(r,0,t.models.splice(l,1)[0]),t.trigger("sort")}},over:function(e,t){t.item.data("sortableItem").scrollParent=t.placeholder.parent(),t.item.data("sortableItem").overflowOffset=t.placeholder.parent().offset()}})},addItem:function(e){var n=new i({model:e}),r=t.indexOf(e),o=n.render().el;this.addElementsToStream(o,r),e.get("selected")&&n.$el.scrollIntoView()},addItems:function(e){var t=_.map(e,function(e){return new i({model:e})}),n=_.map(t,function(e){return e.render().el});this.addElementsToStream(n);var r=_.find(e,function(e){return e.get("selected")===!0}),o=_.findWhere(t,{model:r});void 0!==o&&o.$el.scrollIntoView()},addElementsToStream:function(e,t){if(void 0!==t){var i=this.$el.children().eq(t);i.length>0?i.after(e):this.$el.append(e)}else this.$el.append(e);setTimeout(function(){if(_.isArray(e)){var t=_.filter(e,function(e){return $.inviewport(e,{threshold:0,container:this.el})}.bind(this)),i=_.filter(e,function(e){return!$.inviewport(e,{threshold:0,container:this.el})}.bind(this));$(t).find("img.lazy").lazyload({container:this.el}),$(i).find("img.lazy").lazyload({effect:"fadeIn",threshold:500,container:this.el})}else{var n=$.inviewport(e,{threshold:0,container:this.el});$(e).find("img.lazy").lazyload({effect:n?void 0:"fadeIn",threshold:500,container:this.el})}}.bind(this))},showContextMenu:function(e){e.preventDefault(),e.target===e.currentTarget&&r.reset();var i=0===t.length;r.add({items:[{text:chrome.i18n.getMessage("clearStream"),title:i?chrome.i18n.getMessage("streamEmpty"):"",disabled:i,onClick:function(){l.clearStream()}},{text:chrome.i18n.getMessage("saveStream"),title:i?chrome.i18n.getMessage("streamEmpty"):"",disabled:i,onClick:function(){l.saveStream()}}]})},emptyStreamItemList:function(){this.$el.find(".streamItem").remove()}});return u}),define("text!template/stream.html",[],function(){return'<div class="big-text-wrapper">\r\n    \r\n    <div class="big-text streamEmpty">\r\n        <div class="big-text-header"><%= chrome.i18n.getMessage(\'streamEmpty\') %></div>\r\n        \r\n        <%= chrome.i18n.getMessage(\'whyNotAddAVideoFromAPlaylistOr\') %> <span id="videoSearchLink" class="searchLink clickable lowercase"><%= chrome.i18n.getMessage(\'searchForVideos\') %></span>?\r\n    </div>\r\n    \r\n    <div id="streamItemsView" class="view-placeholder"></div>\r\n</div>\r\n\r\n<div class="context-buttons">\r\n    \r\n    <div class="left-group">\r\n        <div id="shuffleButtonView" class="view-placeholder"></div>\r\n        <div id="repeatButtonView" class="view-placeholder"></div>\r\n        <div id="radioButtonView" class="view-placeholder"></div>\r\n    </div>\r\n    \r\n    <div class="right-group">\r\n        <div id="saveStreamButtonView" class="view-placeholder"></div>\r\n        <div id="clearStreamButtonView" class="view-placeholder"></div>\r\n    </div>\r\n\r\n</div>'}),define("enum/repeatButtonState",{Disabled:0,RepeatVideo:1,RepeatStream:2}),define("text!template/repeatButton.html",[],function(){return'<% if(state === RepeatButtonState.RepeatStream) { %>\r\n    <i class="fa fa-repeat repeatStream"></i>\r\n<% } else if( state === RepeatButtonState.RepeatVideo) { %>\r\n    <i class="fa fa-repeat repeatVideo"></i>\r\n<% } else { %>\r\n    <i class="fa fa-repeat"></i>\r\n<% } %>'}),define("foreground/view/rightPane/stream/repeatButtonView",["foreground/view/genericForegroundView","enum/repeatButtonState","text!template/repeatButton.html"],function(e,t,i){"use strict";var n=e.extend({tagName:"button",className:"button-icon button-small",template:_.template(i),events:{click:"toggleRepeat"},model:chrome.extension.getBackgroundPage().RepeatButton,disabledTitle:chrome.i18n.getMessage("repeatDisabled"),repeatVideoTitle:chrome.i18n.getMessage("repeatVideo"),repeatStreamTitle:chrome.i18n.getMessage("repeatStream"),render:function(){this.$el.html(this.template(_.extend(this.model.toJSON(),{RepeatButtonState:t})));var e=this.model.get("state");switch(this.$el.toggleClass("enabled",e!==t.Disabled),e){case t.Disabled:this.$el.attr("title",this.disabledTitle);break;case t.RepeatVideo:this.$el.attr("title",this.repeatVideoTitle);break;case t.RepeatStream:this.$el.attr("title",this.repeatStreamTitle);break;default:console.error("Unhandled repeatButtonState:",e)}return this},initialize:function(){this.listenTo(this.model,"change:state",this.render)},toggleRepeat:function(){this.model.toggleRepeat()}});return n}),define("text!template/shuffleButton.html",[],function(){return'<i class="fa fa-random"></i>'}),define("foreground/view/rightPane/stream/shuffleButtonView",["foreground/view/genericForegroundView","text!template/shuffleButton.html"],function(e,t){"use strict";var i=e.extend({tagName:"button",className:"button-icon button-small",template:_.template(t),events:{click:"toggleShuffle"},model:chrome.extension.getBackgroundPage().ShuffleButton,enabledTitle:chrome.i18n.getMessage("shuffleEnabled"),disabledTitle:chrome.i18n.getMessage("shuffleDisabled"),render:function(){this.$el.html(this.template(this.model.toJSON()));var e=this.model.get("enabled");return this.$el.toggleClass("enabled",e),e?this.$el.attr("title",this.enabledTitle):this.$el.attr("title",this.disabledTitle),this},initialize:function(){this.listenTo(this.model,"change:enabled",this.render)},toggleShuffle:function(){this.model.toggleEnabled()}});return i}),define("text!template/radioButton.html",[],function(){return'<i class="fa fa-rss"></i>'}),define("foreground/view/rightPane/stream/radioButtonView",["foreground/view/genericForegroundView","text!template/radioButton.html"],function(e,t){"use strict";var i=e.extend({tagName:"button",className:"button-icon button-small",template:_.template(t),model:chrome.extension.getBackgroundPage().RadioButton,events:{click:"toggleRadio"},enabledTitle:chrome.i18n.getMessage("radioEnabled"),disabledTitle:chrome.i18n.getMessage("radioDisabled"),render:function(){this.$el.html(this.template(this.model.toJSON()));var e=this.model.get("enabled");return this.$el.toggleClass("enabled",e),e?this.$el.attr("title",this.enabledTitle):this.$el.attr("title",this.disabledTitle),this},initialize:function(){this.listenTo(this.model,"change:enabled",this.render)},toggleRadio:function(){this.model.toggleRadio()}});return i}),define("text!template/saveStreamButton.html",[],function(){return'<i class="fa fa-save"></i>'}),define("foreground/view/rightPane/stream/saveStreamButtonView",["foreground/view/genericForegroundView","text!template/saveStreamButton.html","foreground/model/streamAction"],function(e,t,i){"use strict";var n=e.extend({tagName:"button",className:"button-icon button-small save",template:_.template(t),attributes:{title:chrome.i18n.getMessage("saveStream")},events:{click:"saveStream"},render:function(){return this.$el.html(this.template()),this},saveStream:function(){i.saveStream()}});return n}),define("text!template/clearStreamButton.html",[],function(){return'<i class="fa fa-trash-o"></i>'}),define("foreground/view/rightPane/stream/clearStreamButtonView",["foreground/view/genericForegroundView","text!template/clearStreamButton.html","foreground/collection/streamItems","foreground/model/streamAction"],function(e,t,i,n){"use strict";var r=e.extend({tagName:"button",className:"button-icon button-small clear",template:_.template(t),attributes:{title:chrome.i18n.getMessage("clearStream")},events:{click:"clearStream"},render:function(){return this.$el.html(this.template()),this},clearStream:function(){n.clearStream()}});return r}),define("foreground/view/rightPane/stream/streamView",["foreground/view/genericForegroundView","foreground/view/rightPane/stream/streamItemsView","text!template/stream.html","foreground/collection/streamItems","foreground/view/rightPane/stream/repeatButtonView","foreground/view/rightPane/stream/shuffleButtonView","foreground/view/rightPane/stream/radioButtonView","foreground/view/rightPane/stream/saveStreamButtonView","foreground/view/rightPane/stream/clearStreamButtonView"],function(e,t,i,n,r,o,l,s,a){"use strict";var d=e.extend({attributes:{id:"stream"},radioButtonView:null,shuffleButtonView:null,repeatButtonView:null,saveStreamButtonView:null,clearStreamButtonView:null,streamItemsView:null,contextButtons:null,streamEmptyMessage:null,template:_.template(i),render:function(){return this.$el.html(this.template()),this.$el.find("#streamItemsView").replaceWith(this.streamItemsView.render().el),this.$el.find("#saveStreamButtonView").replaceWith(this.saveStreamButtonView.render().el),this.$el.find("#clearStreamButtonView").replaceWith(this.clearStreamButtonView.render().el),this.$el.find("#shuffleButtonView").replaceWith(this.shuffleButtonView.render().el),this.$el.find("#repeatButtonView").replaceWith(this.repeatButtonView.render().el),this.$el.find("#radioButtonView").replaceWith(this.radioButtonView.render().el),this.streamEmptyMessage=this.$el.find(".streamEmpty"),this.contextButtons=this.$el.find(".context-buttons"),this.toggleBigText(),this.toggleContextButtons(),this},initialize:function(){this.radioButtonView=new l,this.shuffleButtonView=new o,this.repeatButtonView=new r,this.saveStreamButtonView=new s,this.clearStreamButtonView=new a,this.streamItemsView=new t,this.listenTo(n,"add remove reset",function(){this.toggleBigText(),this.toggleContextButtons()})},toggleBigText:function(){var e=0===n.length;this.streamEmptyMessage.toggleClass("hidden",!e)},toggleContextButtons:function(){0===n.length?this.contextButtons.hide():this.contextButtons.show()}});return d}),define("enum/playerState",{Unstarted:-1,Ended:0,Playing:1,Paused:2,Buffering:3,VideoCued:5}),define("text!template/playPauseButton.html",[],function(){return'<% if(playerState === PlayerState.Buffering) { %>\r\n    <div class="spinner spinner-small"></div>\r\n<% } else if(playerState === PlayerState.Playing) { %>\r\n    <i class="fa fa-pause fa-lg"></i>\r\n<% } else { %>\r\n    <i class="fa fa-play fa-lg"></i>\r\n<% } %>'}),define("foreground/view/rightPane/playPauseButtonView",["foreground/view/genericForegroundView","foreground/model/player","enum/playerState","text!template/playPauseButton.html"],function(e,t,i,n){"use strict";var r=e.extend({tagName:"button",className:"button-icon",template:_.template(n),model:chrome.extension.getBackgroundPage().PlayPauseButton,events:{click:"tryTogglePlayerState"},render:function(){this.$el.html(this.template(_.extend(this.model.toJSON(),{PlayerState:i,playerState:t.get("state")})));var e=this.model.get("enabled");return this.$el.toggleClass("disabled",!e),this},initialize:function(){this.listenTo(this.model,"change:enabled",this.render),this.listenTo(t,"change:state",this.render),this.render()},tryTogglePlayerState:function(){this.model.tryTogglePlayerState()}});return r}),define("text!template/previousButton.html",[],function(){return'<i class="fa fa-backward fa-lg"></i>'}),define("foreground/view/rightPane/previousButtonView",["foreground/view/genericForegroundView","text!template/previousButton.html"],function(e,t){"use strict";var i=e.extend({tagName:"button",className:"button-icon",template:_.template(t),model:chrome.extension.getBackgroundPage().PreviousButton,events:{click:"tryDoTimeBasedPrevious"},render:function(){this.$el.html(this.template(this.model.toJSON()));var e=this.model.get("enabled");return this.$el.toggleClass("disabled",!e),this},initialize:function(){this.listenTo(this.model,"change:enabled",this.render)},tryDoTimeBasedPrevious:function(){this.model.tryDoTimeBasedPrevious()}});return i}),define("text!template/nextButton.html",[],function(){return'<i class="fa fa-forward fa-lg"></i>'}),define("foreground/view/rightPane/nextButtonView",["foreground/view/genericForegroundView","text!template/nextButton.html"],function(e,t){"use strict";var i=e.extend({tagName:"button",className:"button-icon",model:chrome.extension.getBackgroundPage().NextButton,template:_.template(t),events:{click:"trySelectNextVideo"},render:function(){this.$el.html(this.template(this.model.toJSON()));var e=this.model.get("enabled");return this.$el.toggleClass("disabled",!e),this},initialize:function(){this.listenTo(this.model,"change:enabled",this.render)},trySelectNextVideo:function(){this.model.trySelectNextVideo()}});return i}),define("text!template/volumeControl.html",[],function(){return'<button class="mute button-icon<%= muted ? \' muted\' : \'\' %>">\r\n    \r\n</button>\r\n\r\n<div class="volume-slider">\r\n    \r\n    <div class="progress" style="height: <%= volume %>%">\r\n        \r\n    </div>\r\n\r\n    <input class="volumeRange" type="range" value="<%= volume %>">\r\n</div>'}),define("foreground/view/rightPane/volumeControlView",["foreground/view/genericForegroundView","text!template/volumeControl.html","foreground/model/player"],function(e,t,i){"use strict";var n=e.extend({className:"volumeControl",template:_.template(t),events:{"change input.volumeRange":"setVolume","click button.mute":"toggleMute",mousewheel:"scrollVolume"},rendered:!1,volumeSlider:null,progress:null,volumeRange:null,muteButton:null,render:function(){var e=i.get("volume"),t=i.get("muted");this.$el.html(this.template({"chrome.i18n":chrome.i18n,volume:e,muted:t})),this.volumeSlider=this.$el.children(".volume-slider"),this.progress=this.volumeSlider.children(".progress"),this.volumeRange=this.volumeSlider.children("input.volumeRange"),this.muteButton=this.$el.children("button.mute");var n=this.getVolumeIcon(e);return this.muteButton.html(n),this.rendered=!0,this},initialize:function(){this.listenTo(i,"change:muted",this.toggleMutedClass),this.listenTo(i,"change:volume",this.updateProgressAndVolumeIcon);var e={sensitivity:2,interval:5500},t=this;this.$el.hoverIntent(function(){$(this).data("oldheight",$(this).height()).transition({height:150},250,"snap"),t.volumeSlider.transition({opacity:1},250,"snap")},function(){$(this).transition({height:$(this).data("oldheight")},250),t.volumeSlider.transition({opacity:0},250)},e)},setVolume:function(){var e=parseInt(this.volumeRange.val());i.set("volume",e)},updateProgressAndVolumeIcon:function(){if(this.rendered){var e=parseInt(i.get("volume"));this.volumeRange.val(e),this.progress.height(e+"%");var t=this.getVolumeIcon(e);this.muteButton.html(t)}},getVolumeIcon:function(e){var t="off";e>50?t="up":e>0&&(t="down");var i=$("<i>",{"class":"fa fa-volume-"+t});return i},scrollVolume:function(e){var t=e.originalEvent.wheelDeltaY/120,n=parseInt(this.volumeRange.val())+3*t;n>100&&(n=100),0>n&&(n=0),i.set("volume",n)},toggleMute:function(){var e=i.get("muted");i.set("muted",!e)},toggleMutedClass:function(){if(this.rendered){var e=i.get("muted");this.muteButton.toggleClass("muted",e)}}});return n}),define("text!template/timeProgressArea.html",[],function(){return'<div class="time-slider">\r\n    <!--TODO: is this style property necessary? and default value on input?-->\r\n    <div class="progress" style="width: 33%"></div>\r\n    <input class="timeRange" type="range" value="33">\r\n</div>\r\n\r\n<span class="time-elapsed" title="<%= chrome.i18n.getMessage(\'elapsedTime\') %>"></span>\r\n<span class="duration" title="<%= chrome.i18n.getMessage(\'totalTime\') %>"></span>'}),define("foreground/view/rightPane/timeProgressAreaView",["foreground/view/genericForegroundView","text!template/timeProgressArea.html","foreground/collection/streamItems","foreground/model/player","common/model/utility","enum/playerState","foreground/model/settings"],function(e,t,i,n,r,o,l){"use strict";var s=e.extend({template:_.template(t),className:"timeProgressArea",events:{"change input.timeRange:not(.disabled)":"updateProgress","mousewheel input.timeRange:not(.disabled)":"mousewheelUpdateProgress","mousedown input.timeRange:not(.disabled)":"startSeeking","mouseup input.timeRange:not(.disabled)":"seekToTime","click .time-elapsed":"toggleShowTimeRemaining"},progress:null,timeRange:null,timeElapsedLabel:null,durationLabel:null,autoUpdate:!0,render:function(){return this.$el.html(this.template({"chrome.i18n":chrome.i18n})),this.progress=this.$el.find(".time-slider .progress"),this.timeRange=this.$el.find(".time-slider input.timeRange"),this.timeElapsedLabel=this.$el.find(".time-elapsed"),this.durationLabel=this.$el.find(".duration"),0===i.length&&this.timeRange.toggleClass("disabled",!0),this.setTotalTime(this.getCurrentVideoDuration()),this.setCurrentTime(n.get("currentTime")),this},initialize:function(){this.listenTo(i,"remove reset",this.clearOnEmpty),this.listenTo(i,"add",this.enable),this.listenTo(i,"change:selected",this.restart),this.listenTo(n,"change:currentTime",this.updateCurrentTime),this.listenTo(n,"change:state",this.stopSeeking)},mousewheelUpdateProgress:function(e){var t=e.originalEvent.wheelDeltaY/120,i=parseInt(this.timeRange.val());this.setCurrentTime(i+t),n.seekTo(i+t)},startSeeking:function(e){1===e.which&&(this.autoUpdate=!1)},stopSeeking:function(){var e=n.get("state");(e==o.Playing||e==o.Paused)&&(this.autoUpdate=!0)},seekToTime:function(e){if(1===e.which){var t=parseInt(this.timeRange.val());n.seekTo(t)}},toggleShowTimeRemaining:function(){var e=l.get("showTimeRemaining");l.set("showTimeRemaining",!e),e?this.timeElapsedLabel.attr("title",chrome.i18n.getMessage("elapsedTime")):this.timeElapsedLabel.attr("title",chrome.i18n.getMessage("timeRemaining")),this.timeElapsedLabel.toggleClass("timeRemaining",!e),this.updateProgress()},enable:function(){this.timeRange.toggleClass("disabled",!1)},clearOnEmpty:function(){0===i.length&&this.clear()},clear:function(){this.setCurrentTime(0),this.setTotalTime(0),this.timeRange.toggleClass("disabled",!0)},restart:function(){this.autoUpdate=!1,this.setCurrentTime(0),this.setTotalTime(this.getCurrentVideoDuration()),this.autoUpdate=!0},setCurrentTime:function(e){this.timeRange.val(e),this.updateProgress()},setTotalTime:function(e){this.timeRange.prop("max",e),this.updateProgress()},updateCurrentTime:function(){this.autoUpdate&&this.setCurrentTime(n.get("currentTime"))},updateProgress:function(){var e=parseInt(this.timeRange.val()),t=parseInt(this.timeRange.prop("max")),i=0===t?0:100*e/t;if(0>i||i>100)throw"Wow this really should not have been "+i;if(this.progress.width(i+"%"),l.get("showTimeRemaining")){var n=t-e;this.timeElapsedLabel.text(r.prettyPrintTime(n))}else this.timeElapsedLabel.text(r.prettyPrintTime(e));this.durationLabel.text(r.prettyPrintTime(t))},getCurrentVideoDuration:function(){var e=0;if(i.length>0){var t=i.getSelectedItem();e=t.get("video").get("duration")}return e}});return s}),define("foreground/model/buttons/videoDisplayButton",[],function(){"use strict";return chrome.extension.getBackgroundPage().VideoDisplayButton}),define("text!template/videoDisplayButton.html",[],function(){return'<i class="fa fa-film"></i>'}),define("foreground/view/rightPane/videoDisplayButtonView",["foreground/view/genericForegroundView","foreground/model/buttons/videoDisplayButton","text!template/videoDisplayButton.html"],function(e,t,i){"use strict";
var n=e.extend({tagName:"button",className:"button-icon videoDisplay",template:_.template(i),model:t,events:{click:"toggleVideoDisplay"},enabledTitle:chrome.i18n.getMessage("hideVideo"),disabledTitle:chrome.i18n.getMessage("showVideo"),render:function(){return this.$el.html(this.template()),this.subRender(),this.$el.hide(),this},initialize:function(){this.listenTo(this.model,"change:enabled change:disabled",this.subRender)},toggleVideoDisplay:function(){this.$el.hasClass("disabled")||this.model.toggleEnabled()},subRender:function(){var e=this.model.get("disabled");this.$el.toggleClass("disabled",e);var t=this.model.get("enabled");t?this.$el.attr("title",this.enabledTitle):this.$el.attr("title",this.disabledTitle)}});return n}),define("foreground/view/rightPane/rightPaneView",["foreground/view/genericForegroundView","text!template/rightPane.html","foreground/view/rightPane/stream/streamView","foreground/view/rightPane/playPauseButtonView","foreground/view/rightPane/previousButtonView","foreground/view/rightPane/nextButtonView","foreground/view/rightPane/volumeControlView","foreground/view/rightPane/timeProgressAreaView","foreground/view/rightPane/videoDisplayButtonView","foreground/collection/streamItems"],function(e,t,i,n,r,o,l,s,a){"use strict";var d=e.extend({className:"right-pane",template:_.template(t),streamView:null,playPauseButtonView:null,previousButtonView:null,nextButtonView:null,volumeControlView:null,timeProgressAreaView:null,videoDisplayButtonView:null,render:function(){this.$el.html(this.template());var e=this.$el.children(".top-bar");e.after(this.timeProgressAreaView.render().el);var t=e.children(".center-group");t.before(this.volumeControlView.render().el),t.append(this.previousButtonView.render().el),t.append(this.playPauseButtonView.render().el),t.append(this.nextButtonView.render().el);var i=e.children(".right-group");return i.append(this.videoDisplayButtonView.render().el),this.$el.append(this.streamView.render().el),this.initializeTooltips(),this},initialize:function(){this.streamView=new i,this.playPauseButtonView=new n,this.previousButtonView=new r,this.nextButtonView=new o,this.volumeControlView=new l,this.timeProgressAreaView=new s,this.videoDisplayButtonView=new a}});return d}),define("text!template/videoDisplay.html",[],function(){return'<div class="panel">\r\n    \r\n    <div class="top-bar">\r\n        <div class="left-side">\r\n            <span class="videoTitle">\r\n                <%= title %>\r\n            </span>\r\n            \r\n            <div id="timeProgressAreaView" class="view-placeholder"></div>\r\n        </div>\r\n        <div class="right-side">\r\n            \r\n            <div id="volumeControlView" class="view-placeholder"></div>\r\n\r\n            <div class="center-group">\r\n                <div id="previousButtonView" class="view-placeholder"></div>\r\n                <div id="playPauseButtonView" class="view-placeholder"></div>\r\n                <div id="nextButtonView" class="view-placeholder"></div>\r\n            </div>\r\n\r\n            <div class="right-group">\r\n                <button class="button-icon remove enabled">\r\n                    <i class="fa fa-film"></i>\r\n                </button>\r\n            </div>\r\n\r\n        </div>\r\n\r\n    </div>\r\n    \r\n\r\n</div>'}),define("common/view/videoView",["foreground/view/genericForegroundView","foreground/collection/streamItems","foreground/model/player","enum/playerState","foreground/collection/contextMenuGroups","foreground/model/buttons/playPauseButton"],function(e,t,i,n,r,o){"use strict";var l=e.extend({tagName:"canvas",events:{click:"togglePlayerState",dblclick:"goFullScreen"},attributes:{height:360,width:640},animationFrameRequestId:null,context:null,port:null,streamingImage:new Image(640,360),defaultImage:null,defaultImageLoaded:!1,render:function(){var e=t.length>0;if(this.$el.toggleClass("clickable",e),e){var r=i.get("state");r==n.Playing?this.connectPortDrawContinously():(this.disconnectPort(),i.get("currentTime")>0?this.connectPortDrawFrame():null!==this.defaultImage?this.defaultImageLoaded?this.context.drawImage(this.defaultImage,0,0,this.el.width,this.el.height):this.defaultImage.onload=function(){this.context.drawImage(this.defaultImage,0,0,this.el.width,this.el.height)}.bind(this):this.drawBlankImage())}else this.drawBlankImage();return this},initialize:function(){this.context=this.el.getContext("2d"),$(window).unload(this.disconnectPort.bind(this)),this.setDefaultImage(),this.listenTo(i,"change:loadedVideoId",this.setDefaultImage),this.listenTo(i,"change:state",this.render),this.listenTo(t,"add remove reset change:selected",this.render)},connectPortDrawContinously:function(){this.connectPort(),this.port.onMessage.addListener(this.drawImageFromDataURL.bind(this))},connectPortDrawFrame:function(){this.connectPort(),this.port.onMessage.addListener(function(e){this.drawImageFromDataURL(e),this.disconnectPort()}.bind(this))},connectPort:function(){null===this.port?this.port=chrome.runtime.connect({name:"videoViewPort"}):console.error("Port already connected.")},disconnectPort:function(){null!==this.port?(this.port.disconnect(),this.port=null):console.error("Port already disconnected.")},drawImageFromDataURL:function(e){this.streamingImage.src=e,this.context.drawImage(this.streamingImage,0,0)},setDefaultImage:function(){this.defaultImageLoaded=!1;var e=i.get("loadedVideoId");""===e?this.defaultImage=null:(this.defaultImage=new Image(640,360),this.defaultImage.src="http://i2.ytimg.com/vi/"+e+"/mqdefault.jpg",this.defaultImage.onload=function(){this.defaultImageLoaded=!0})},drawBlankImage:function(){this.context.rect(0,0,this.el.width,this.el.height),this.context.fillStyle="black",this.context.fill()},togglePlayerState:function(){o.tryTogglePlayerState()},goFullScreen:function(){window.screenTop||window.screenY?chrome.windows.create({url:"fullscreen.html",type:"popup",focused:!0},function(e){chrome.windows.update(e.id,{state:"fullscreen"})}):chrome.windows.getAll(function(e){var t=_.findWhere(e,{state:"fullscreen"});chrome.windows.remove(t.id)})},showContextMenu:function(e){e.preventDefault(),window.screenTop||window.screenY?r.add({items:[{text:chrome.i18n.getMessage("fullScreen"),onClick:function(){chrome.windows.create({url:"fullscreen.html",type:"popup",focused:!0},function(e){chrome.windows.update(e.id,{state:"fullscreen"})})}}]}):r.add({items:[{text:chrome.i18n.getMessage("exitFullScreen"),onClick:function(){chrome.windows.getAll(function(e){var t=_.findWhere(e,{state:"fullscreen"});chrome.windows.remove(t.id)})}}]})}});return l}),define("common/view/videoDisplayView",["foreground/view/genericForegroundView","foreground/collection/streamItems","foreground/model/player","enum/playerState","foreground/collection/contextMenuGroups","text!template/videoDisplay.html","common/view/videoView","foreground/model/buttons/videoDisplayButton","foreground/view/rightPane/playPauseButtonView","foreground/view/rightPane/previousButtonView","foreground/view/rightPane/nextButtonView","foreground/view/rightPane/volumeControlView","foreground/view/rightPane/timeProgressAreaView"],function(e,t,i,n,r,o,l,s,a,d,u,c,h){"use strict";var m=e.extend({attributes:{id:"videoDisplay"},template:_.template(o),panel:null,videoView:null,playPauseButtonView:null,previousButtonView:null,nextButtonView:null,volumeControlView:null,timeProgressAreaView:null,events:{"click .remove":"toggleVideoDisplay"},render:function(){return this.$el.html(this.template({"chrome.i18n":chrome.i18n,title:t.getSelectedItem().get("title")})),this.panel=this.$el.find(".panel"),this.panel.append(this.videoView.render().el),this.$el.find("#timeProgressAreaView").replaceWith(this.timeProgressAreaView.render().el),this.$el.find("#volumeControlView").replaceWith(this.volumeControlView.render().el),this.$el.find("#previousButtonView").replaceWith(this.previousButtonView.render().el),this.$el.find("#playPauseButtonView").replaceWith(this.playPauseButtonView.render().el),this.$el.find("#nextButtonView").replaceWith(this.nextButtonView.render().el),this.title=this.$el.find(".title"),this},initialize:function(){this.videoView=new l,this.listenTo(s,"change:enabled",this.hideOnDisabled),this.listenTo(t,"change:selected",this.updateTitle),this.playPauseButtonView=new a,this.previousButtonView=new d,this.nextButtonView=new u,this.volumeControlView=new c,this.timeProgressAreaView=new h},toggleVideoDisplay:function(){s.toggleEnabled()},hideOnDisabled:function(){var e=s.get("enabled");e||this.hide()},show:function(e){this.$el.data("background",this.$el.css("background")).transition({background:"rgba(0, 0, 0, 0.5)"},e?0:void 0,"snap"),this.panel.transition({x:this.$el.width()},e?0:void 0,"snap")},hide:function(){this.$el.transition({background:this.$el.data("background")},function(){this.remove(),this.videoView.disconnectPort(),this.videoView.remove()}.bind(this)),this.panel.transition({x:-20})},updateTitle:function(){this.title.text(t.getSelectedItem().get("title"))}});return m}),define("enum/youTubePlayerError",{None:-1,InvalidParameter:2,VideoNotFound:100,NoPlayEmbedded:101,NoPlayEmbedded2:150}),define("text!template/notification.html",[],function(){return"<%= text %>"}),define("foreground/view/notificationView",["foreground/view/genericForegroundView","text!template/notification.html"],function(e,t){"use strict";var i=e.extend({className:"notification",template:_.template(t),text:"",render:function(){return this.$el.html(this.template({text:this.text})),this},initialize:function(e){if(this.text=e.text,""===$.trim(this.text))throw"NotificationView expects to be initialized with text"}});return i}),define("foreground/view/backgroundDependentForegroundView",["foreground/view/genericForegroundView","foreground/view/prompt/genericPromptView","foreground/model/activeFolderArea","foreground/view/activeFolderArea/activeFolderAreaView","foreground/view/activePlaylistArea/activePlaylistAreaView","foreground/model/activePlaylistArea","foreground/view/videoSearch/videoSearchView","foreground/model/videoSearch","foreground/collection/videoSearchResults","foreground/view/rightPane/rightPaneView","common/view/videoDisplayView","foreground/collection/folders","enum/youTubePlayerError","foreground/view/notificationView","foreground/model/player","foreground/model/buttons/videoDisplayButton","foreground/model/settings"],function(e,t,i,n,r,o,l,s,a,d,u,c,h,m,g,p,f){var v=e.extend({el:$("body"),activeFolderAreaView:null,activePlaylistAreaView:null,videoSearchView:null,videoDisplayView:null,rightPaneView:null,events:{"click button#showVideoSearch":"onClickShowVideoSearch","click #activePlaylistArea button.show":"showActiveFolderArea","click #videoSearchLink":"onClickShowVideoSearch"},initialize:function(){this.rightPaneView=new d,this.$el.append(this.rightPaneView.render().el),this.showActivePlaylistArea(),f.get("alwaysOpenToSearch")&&this.showVideoSearch(!0),this.listenTo(c.getActiveFolder().get("playlists"),"change:active",this.showActivePlaylistArea),this.listenTo(g,"error",this.showYouTubeError),p.get("enabled")&&this.showVideoDisplay(!0),this.listenTo(p,"change:enabled",function(e,t){t?this.showVideoDisplay(!1):this.videoDisplayView=null}),$(window).unload(function(){c.getActiveFolder().get("playlists").getActivePlaylist().get("items").deselectAll(),a.deselectAll()}),this.$el.click(function(e){var t=$(e.target).hasClass(".multiSelectItem"),i=$(e.target).closest(".multiSelectItem").length>0;t||i||(c.getActiveFolder().get("playlists").getActivePlaylist().get("items").deselectAll(),a.deselectAll())})},showActivePlaylistArea:function(){var e=c.getActiveFolder().getActivePlaylist();if(null===this.activePlaylistAreaView||this.activePlaylistAreaView.model.get("playlist")!==e){null!==this.activePlaylistAreaView&&this.activePlaylistAreaView.remove();var t=new o({playlist:e});this.activePlaylistAreaView=new r({model:t}),this.$el.append(this.activePlaylistAreaView.render().el)}},showActiveFolderArea:function(){if(null===this.activeFolderAreaView){var e=new i({folder:c.getActiveFolder()});this.activeFolderAreaView=new n({model:e}),this.$el.append(this.activeFolderAreaView.render().el),this.activeFolderAreaView.show(),this.listenToOnce(e,"destroy",function(){this.activeFolderAreaView=null})}},onClickShowVideoSearch:function(){this.showVideoSearch(!1)},showVideoDisplay:function(e){null===this.videoDisplayView&&(this.videoDisplayView=new u,this.$el.append(this.videoDisplayView.render().el),this.videoDisplayView.show(e))},showVideoSearch:_.throttle(function(e){if(null===this.videoSearchView){var t=new s({playlist:c.getActiveFolder().getActivePlaylist()});this.videoSearchView=new l({model:t}),this.$el.append(this.videoSearchView.render().el),this.videoSearchView.showAndFocus(e),this.listenToOnce(t,"destroy",function(){this.videoSearchView=null})}else this.videoSearchView.$el.effect("shake")},400),showYouTubeError:function(e){var i=chrome.i18n.getMessage("errorEncountered");switch(e){case h.InvalidParameter:i=chrome.i18n.getMessage("youTubePlayerErrorInvalidParameter");break;case h.VideoNotFound:i=chrome.i18n.getMessage("youTubePlayerErrorVideoNotFound");break;case h.NoPlayEmbedded:case h.NoPlayEmbedded2:i=chrome.i18n.getMessage("youTubePlayerErrorNoPlayEmbedded")}var n=new t({title:chrome.i18n.getMessage("errorEncountered"),model:new m({text:i})});n.fadeInAndShow()}});return new v});