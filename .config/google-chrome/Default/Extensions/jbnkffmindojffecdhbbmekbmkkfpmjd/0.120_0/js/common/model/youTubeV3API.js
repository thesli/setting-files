define(["common/model/utility","enum/dataSourceType","common/googleAPI"],function(t,e,i){"use strict";var n=Backbone.Model.extend({defaults:function(){return{loading:!1,loaded:!1}},initialize:function(){this.set("loading",!0),this.setApiKey(),i.client.load("youtube","v3",function(){this.set("loading",!1),this.set("loaded",!0)}.bind(this))},setApiKey:function(){i.client.setApiKey("AIzaSyCTeTdPhakrauzhWfMK9rC7Su47qdbaAGU")},getAutoGeneratedPlaylistData:function(e,n){if(this.get("loading"))return this.once("change:loaded",function(){this.getAutoGeneratedPlaylistData(e,n)}),void 0;if(!this.get("loaded"))throw"gapi youtube v3 must be loaded before calling";var o=i.client.youtube.playlistItems.list({part:"contentDetails",maxResults:50,playlistId:e});o.execute(function(e){var o=_.map(e.items,function(t){return t.contentDetails.videoId}),a=i.client.youtube.videos.list({part:"contentDetails,snippet",maxResults:50,id:o.join(",")});a.execute(function(e){var i=_.map(e.items,function(e){return{id:e.id,duration:t.iso8061DurationToSeconds(e.contentDetails.duration),title:e.snippet.title,author:e.snippet.channelTitle}});n&&n({results:i})})})},getAutoGeneratedPlaylistTitle:function(t,e){if(this.get("loading"))return this.once("change:loaded",function(){this.getAutoGeneratedPlaylistData(t,e)}),void 0;var n=i.client.youtube.playlists.list({part:"snippet",id:t});n.execute(function(t){if(e){var i="";t.items&&t.items.length>0&&(i=t.items[0].snippet.title),e(i)}})},getDataSourceResults:function(t){if(!t.isV3())throw"YouTubeV3 API getDataSourceResults expects a V3 dataSource";return t.get("type")===e.YouTubeAutoGenerated?(console.error("not implemeneted yet"),null):void 0},getRelatedVideoInformation:function(t){if(this.get("loading"))return this.once("change:loaded",function(){this.getRelatedVideoInformation(t)}),void 0;if(!this.get("loaded"))throw"gapi youtube v3 must be loaded before calling";var e=i.client.youtube.search.list({part:"snippet",relatedToVideoId:t.videoId,maxResults:10,type:"video"});e.execute(function(e){t.success(e)})}});return new n});