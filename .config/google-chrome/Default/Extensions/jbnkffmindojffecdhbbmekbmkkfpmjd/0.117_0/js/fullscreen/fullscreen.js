define("foreground/model/foregroundViewManager",[],function(){"use strict";var e=Backbone.Model.extend({defaults:function(){return{views:[]}},initialize:function(){$(window).unload(function(){this.allViewsStopListening()}.bind(this))},allViewsStopListening:function(){_.each(this.get("views"),function(e){e.stopListening()})},subscribe:function(e){var t=this.get("views"),i=t.indexOf(e);-1===i&&t.push(e)},unsubscribe:function(e){var t=this.get("views"),i=t.indexOf(e);i>-1&&t.splice(i,1)}});return new e}),define("foreground/model/settings",[],function(){"use strict";return chrome.extension.getBackgroundPage().Settings}),define("foreground/view/genericForegroundView",["foreground/model/foregroundViewManager","foreground/model/settings"],function(e,t){"use strict";var i=function(t){e.subscribe(this),Backbone.View.apply(this,[t])};return _.extend(i.prototype,Backbone.View.prototype,{initializeTooltips:function(){t.get("showTooltips")&&setTimeout(function(){var e=this.$el.find("[title]");e.filter(function(){var e=!1;return($(this).hasClass("playlistTitle")||$(this).hasClass("title")||$(this).hasClass("item-title"))&&(e=this.offsetWidth===this.scrollWidth),e}).attr("title",""),e.qtip({position:{viewport:$(window),my:"top center",at:"bottom center"},style:{classes:"qtip-light qtip-shadow"}})}.bind(this))}}),i.extend=Backbone.View.extend,i}),define("foreground/collection/streamItems",[],function(){"use strict";return chrome.extension.getBackgroundPage().StreamItems}),define("foreground/model/player",[],function(){"use strict";return chrome.extension.getBackgroundPage().YouTubePlayer}),define("enum/playerState",{Unstarted:-1,Ended:0,Playing:1,Paused:2,Buffering:3,VideoCued:5}),define("foreground/model/contextMenuItem",[],function(){"use strict";var e=Backbone.Model.extend({defaults:function(){return{text:"",disabled:!1,title:"",onClick:null}}});return e}),define("foreground/collection/contextMenuItems",["foreground/model/contextMenuItem"],function(e){"use strict";var t=Backbone.Collection.extend({model:e});return t}),define("foreground/model/contextMenuGroup",["foreground/collection/contextMenuItems"],function(e){"use strict";var t=Backbone.Model.extend({defaults:function(){return{items:new e}},initialize:function(){var t=this.get("items");t instanceof Backbone.Collection||(t=new e(t),this.set("items",t,{silent:!0}))}});return t}),define("foreground/collection/contextMenuGroups",["foreground/model/contextMenuGroup"],function(e){"use strict";var t=Backbone.Collection.extend({model:e});return new t}),define("text",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),define("text!template/videoDisplay.html",[],function(){return'<div class="panel">\r\n    \r\n    <div class="top-bar">\r\n        <div class="left-side">\r\n            <span class="videoTitle">\r\n                <%= title %>\r\n            </span>\r\n            \r\n            <div id="timeProgressAreaView" class="view-placeholder"></div>\r\n        </div>\r\n        <div class="right-side">\r\n            \r\n            <div id="volumeControlView" class="view-placeholder"></div>\r\n\r\n            <div class="center-group">\r\n                <div id="previousButtonView" class="view-placeholder"></div>\r\n                <div id="playPauseButtonView" class="view-placeholder"></div>\r\n                <div id="nextButtonView" class="view-placeholder"></div>\r\n            </div>\r\n\r\n            <div class="right-group">\r\n                <button class="button-icon remove enabled">\r\n                    <i class="fa fa-film"></i>\r\n                </button>\r\n            </div>\r\n\r\n        </div>\r\n\r\n    </div>\r\n    \r\n\r\n</div>'}),define("foreground/model/buttons/playPauseButton",[],function(){"use strict";return chrome.extension.getBackgroundPage().PlayPauseButton}),define("common/view/videoView",["foreground/view/genericForegroundView","foreground/collection/streamItems","foreground/model/player","enum/playerState","foreground/collection/contextMenuGroups","foreground/model/buttons/playPauseButton"],function(e,t,i,n,o,r){"use strict";var s=e.extend({tagName:"canvas",events:{click:"togglePlayerState",dblclick:"goFullScreen"},attributes:{height:360,width:640},animationFrameRequestId:null,context:null,port:null,streamingImage:new Image(640,360),defaultImage:null,defaultImageLoaded:!1,render:function(){var e=t.length>0;if(this.$el.toggleClass("clickable",e),e){var o=i.get("state");o==n.Playing?this.connectPortDrawContinously():(this.disconnectPort(),i.get("currentTime")>0?this.connectPortDrawFrame():null!==this.defaultImage?this.defaultImageLoaded?this.context.drawImage(this.defaultImage,0,0,this.el.width,this.el.height):this.defaultImage.onload=function(){this.context.drawImage(this.defaultImage,0,0,this.el.width,this.el.height)}.bind(this):this.drawBlankImage())}else this.drawBlankImage();return this},initialize:function(){this.context=this.el.getContext("2d"),$(window).unload(this.disconnectPort.bind(this)),this.setDefaultImage(),this.listenTo(i,"change:loadedVideoId",this.setDefaultImage),this.listenTo(i,"change:state",this.render),this.listenTo(t,"add remove reset change:selected",this.render)},connectPortDrawContinously:function(){this.connectPort(),this.port.onMessage.addListener(this.drawImageFromDataURL.bind(this))},connectPortDrawFrame:function(){this.connectPort(),this.port.onMessage.addListener(function(e){this.drawImageFromDataURL(e),this.disconnectPort()}.bind(this))},connectPort:function(){null===this.port?this.port=chrome.runtime.connect({name:"videoViewPort"}):console.error("Port already connected.")},disconnectPort:function(){null!==this.port?(this.port.disconnect(),this.port=null):console.error("Port already disconnected.")},drawImageFromDataURL:function(e){this.streamingImage.src=e,this.context.drawImage(this.streamingImage,0,0)},setDefaultImage:function(){this.defaultImageLoaded=!1;var e=i.get("loadedVideoId");""===e?this.defaultImage=null:(this.defaultImage=new Image(640,360),this.defaultImage.src="http://i2.ytimg.com/vi/"+e+"/mqdefault.jpg",this.defaultImage.onload=function(){this.defaultImageLoaded=!0})},drawBlankImage:function(){this.context.rect(0,0,this.el.width,this.el.height),this.context.fillStyle="black",this.context.fill()},togglePlayerState:function(){r.tryTogglePlayerState()},goFullScreen:function(){window.screenTop||window.screenY?chrome.windows.create({url:"fullscreen.html",type:"popup",focused:!0},function(e){chrome.windows.update(e.id,{state:"fullscreen"})}):chrome.windows.getAll(function(e){var t=_.findWhere(e,{state:"fullscreen"});chrome.windows.remove(t.id)})},showContextMenu:function(e){e.preventDefault(),window.screenTop||window.screenY?o.add({items:[{text:chrome.i18n.getMessage("fullScreen"),onClick:function(){chrome.windows.create({url:"fullscreen.html",type:"popup",focused:!0},function(e){chrome.windows.update(e.id,{state:"fullscreen"})})}}]}):o.add({items:[{text:chrome.i18n.getMessage("exitFullScreen"),onClick:function(){chrome.windows.getAll(function(e){var t=_.findWhere(e,{state:"fullscreen"});chrome.windows.remove(t.id)})}}]})}});return s}),define("foreground/model/buttons/videoDisplayButton",[],function(){"use strict";return chrome.extension.getBackgroundPage().VideoDisplayButton}),define("text!template/playPauseButton.html",[],function(){return'<% if(playerState === PlayerState.Buffering) { %>\r\n    <div class="spinner spinner-small"></div>\r\n<% } else if(playerState === PlayerState.Playing) { %>\r\n    <i class="fa fa-pause fa-lg"></i>\r\n<% } else { %>\r\n    <i class="fa fa-play fa-lg"></i>\r\n<% } %>'}),define("foreground/view/rightPane/playPauseButtonView",["foreground/view/genericForegroundView","foreground/model/player","enum/playerState","text!template/playPauseButton.html"],function(e,t,i,n){"use strict";var o=e.extend({tagName:"button",className:"button-icon",template:_.template(n),model:chrome.extension.getBackgroundPage().PlayPauseButton,events:{click:"tryTogglePlayerState"},render:function(){this.$el.html(this.template(_.extend(this.model.toJSON(),{PlayerState:i,playerState:t.get("state")})));var e=this.model.get("enabled");return this.$el.toggleClass("disabled",!e),this},initialize:function(){this.listenTo(this.model,"change:enabled",this.render),this.listenTo(t,"change:state",this.render),this.render()},tryTogglePlayerState:function(){this.model.tryTogglePlayerState()}});return o}),define("text!template/previousButton.html",[],function(){return'<i class="fa fa-backward fa-lg"></i>'}),define("foreground/view/rightPane/previousButtonView",["foreground/view/genericForegroundView","text!template/previousButton.html"],function(e,t){"use strict";var i=e.extend({tagName:"button",className:"button-icon",template:_.template(t),model:chrome.extension.getBackgroundPage().PreviousButton,events:{click:"tryDoTimeBasedPrevious"},render:function(){this.$el.html(this.template(this.model.toJSON()));var e=this.model.get("enabled");return this.$el.toggleClass("disabled",!e),this},initialize:function(){this.listenTo(this.model,"change:enabled",this.render)},tryDoTimeBasedPrevious:function(){this.model.tryDoTimeBasedPrevious()}});return i}),define("text!template/nextButton.html",[],function(){return'<i class="fa fa-forward fa-lg"></i>'}),define("foreground/view/rightPane/nextButtonView",["foreground/view/genericForegroundView","text!template/nextButton.html"],function(e,t){"use strict";var i=e.extend({tagName:"button",className:"button-icon",model:chrome.extension.getBackgroundPage().NextButton,template:_.template(t),events:{click:"trySelectNextVideo"},render:function(){this.$el.html(this.template(this.model.toJSON()));var e=this.model.get("enabled");return this.$el.toggleClass("disabled",!e),this},initialize:function(){this.listenTo(this.model,"change:enabled",this.render)},trySelectNextVideo:function(){this.model.trySelectNextVideo()}});return i}),define("text!template/volumeControl.html",[],function(){return'<button class="mute button-icon<%= muted ? \' muted\' : \'\' %>">\r\n    \r\n</button>\r\n\r\n<div class="volume-slider">\r\n    \r\n    <div class="progress" style="height: <%= volume %>%">\r\n        \r\n    </div>\r\n\r\n    <input class="volumeRange" type="range" value="<%= volume %>">\r\n</div>'}),define("foreground/view/rightPane/volumeControlView",["foreground/view/genericForegroundView","text!template/volumeControl.html","foreground/model/player"],function(e,t,i){"use strict";var n=e.extend({className:"volumeControl",template:_.template(t),events:{"change input.volumeRange":"setVolume","click button.mute":"toggleMute",mousewheel:"scrollVolume"},rendered:!1,volumeSlider:null,progress:null,volumeRange:null,muteButton:null,render:function(){var e=i.get("volume"),t=i.get("muted");this.$el.html(this.template({"chrome.i18n":chrome.i18n,volume:e,muted:t})),this.volumeSlider=this.$el.children(".volume-slider"),this.progress=this.volumeSlider.children(".progress"),this.volumeRange=this.volumeSlider.children("input.volumeRange"),this.muteButton=this.$el.children("button.mute");var n=this.getVolumeIcon(e);return this.muteButton.html(n),this.rendered=!0,this},initialize:function(){this.listenTo(i,"change:muted",this.toggleMutedClass),this.listenTo(i,"change:volume",this.updateProgressAndVolumeIcon);var e={sensitivity:2,interval:5500},t=this;this.$el.hoverIntent(function(){$(this).data("oldheight",$(this).height()).transition({height:150},250,"snap"),t.volumeSlider.transition({opacity:1},250,"snap")},function(){$(this).transition({height:$(this).data("oldheight")},250),t.volumeSlider.transition({opacity:0},250)},e)},setVolume:function(){var e=parseInt(this.volumeRange.val());i.set("volume",e)},updateProgressAndVolumeIcon:function(){if(this.rendered){var e=parseInt(i.get("volume"));this.volumeRange.val(e),this.progress.height(e+"%");var t=this.getVolumeIcon(e);this.muteButton.html(t)}},getVolumeIcon:function(e){var t="off";e>50?t="up":e>0&&(t="down");var i=$("<i>",{"class":"fa fa-volume-"+t});return i},scrollVolume:function(e){var t=e.originalEvent.wheelDeltaY/120,n=parseInt(this.volumeRange.val())+3*t;n>100&&(n=100),0>n&&(n=0),i.set("volume",n)},toggleMute:function(){var e=i.get("muted");i.set("muted",!e)},toggleMutedClass:function(){if(this.rendered){var e=i.get("muted");this.muteButton.toggleClass("muted",e)}}});return n}),define("text!template/timeProgressArea.html",[],function(){return'<div class="time-slider">\r\n    <!--TODO: is this style property necessary? and default value on input?-->\r\n    <div class="progress" style="width: 33%"></div>\r\n    <input class="timeRange" type="range" value="33">\r\n</div>\r\n\r\n<span class="time-elapsed" title="<%= chrome.i18n.getMessage(\'elapsedTime\') %>"></span>\r\n<span class="duration" title="<%= chrome.i18n.getMessage(\'totalTime\') %>"></span>'}),define("common/model/utility",[],function(){"use strict";var e=Backbone.Model.extend({prettyPrintTime:function(e){isNaN(e)&&(e=0);var t=Math.floor(e/3600),i=e%3600,n=Math.floor(i/60);i%=60,10>n&&(n="0"+n),10>i&&(i="0"+i);var o=n+":"+i;return t>0&&(o=t+":"+o),o},iso8061DurationToSeconds:function(e){var t=e.match(/(\d+)H/),i=parseInt(t?t[1]:0),n=e.match(/(\d+)M/),o=parseInt(n?n[1]:0),r=e.match(/(\d+)S/),s=parseInt(r?r[1]:0),a=s+60*o+3600*i;return a},cleanseVideoTitle:function(e){return e=$.trim(e),e=e.replace(/\s*\*+\s?\S+\s?\*+$/,""),e=e.replace(/\s*\[[^\]]+\]$/,""),e=e.replace(/\s*\([^\)]*version\)$/i,""),e=e.replace(/\s*\.(avi|wmv|mpg|mpeg|flv)$/i,""),e=e.replace(/\s*(of+icial\s*)?(music\s*)?video/i,""),e=e.replace(/\s*(ALBUM TRACK\s*)?(album track\s*)/i,""),e=e.replace(/\s*\(\s*of+icial\s*\)/i,""),e=e.replace(/\s*\(\s*[0-9]{4}\s*\)/i,""),e=e.replace(/\s+\(\s*(HD|HQ)\s*\)$/,""),e=e.replace(/\s+(HD|HQ)\s*$/,""),e=e.replace(/\s*video\s*clip/i,""),e=e.replace(/\s+\(?live\)?$/i,""),e=e.replace(/\(\s*\)/,""),e=e.replace(/\(.*lyrics?\)/i,""),e=e.replace(/\s*with\s+lyrics?\s*$/i,""),e=e.replace(/^(|.*\s)"(.*)"(\s.*|)$/,"$2"),e=e.replace(/^(|.*\s)'(.*)'(\s.*|)$/,"$2"),e=e.replace(/^[\/\s,:;~-\s"]+/,""),e=e.replace(/[\/\s,:;~-\s"\s!]+$/,"")},getLevenshteinDistance:function(e,t){var i=[],n=e.length,o=t.length;if(0===n)return o;if(0===o)return n;for(var r=n;r>=0;r--)i[r]=[];for(var s=n;s>=0;s--)i[s][0]=s;for(var a=o;a>=0;a--)i[0][a]=a;for(var l=1;n>=l;l++)for(var u=e.charAt(l-1),d=1;o>=d;d++){if(l==d&&i[l][d]>4)return n;var c=t.charAt(d-1),h=u==c?0:1,m=i[l-1][d]+1,g=i[l][d-1]+1,f=i[l-1][d-1]+h;m>g&&(m=g),m>f&&(m=f),i[l][d]=m,l>1&&d>1&&u==t.charAt(d-2)&&e.charAt(l-2)==c&&(i[l][d]=Math.min(i[l][d],i[l-2][d-2]+h))}return i[n][o]},escapeRegExp:function(e){var t=e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");return t}});return new e}),define("foreground/view/rightPane/timeProgressAreaView",["foreground/view/genericForegroundView","text!template/timeProgressArea.html","foreground/collection/streamItems","foreground/model/player","common/model/utility","enum/playerState","foreground/model/settings"],function(e,t,i,n,o,r,s){"use strict";var a=e.extend({template:_.template(t),className:"timeProgressArea",events:{"change input.timeRange:not(.disabled)":"updateProgress","mousewheel input.timeRange:not(.disabled)":"mousewheelUpdateProgress","mousedown input.timeRange:not(.disabled)":"startSeeking","mouseup input.timeRange:not(.disabled)":"seekToTime","click .time-elapsed":"toggleShowTimeRemaining"},progress:null,timeRange:null,timeElapsedLabel:null,durationLabel:null,autoUpdate:!0,render:function(){return this.$el.html(this.template({"chrome.i18n":chrome.i18n})),this.progress=this.$el.find(".time-slider .progress"),this.timeRange=this.$el.find(".time-slider input.timeRange"),this.timeElapsedLabel=this.$el.find(".time-elapsed"),this.durationLabel=this.$el.find(".duration"),0===i.length&&this.timeRange.toggleClass("disabled",!0),this.setTotalTime(this.getCurrentVideoDuration()),this.setCurrentTime(n.get("currentTime")),this},initialize:function(){this.listenTo(i,"remove reset",this.clearOnEmpty),this.listenTo(i,"add",this.enable),this.listenTo(i,"change:selected",this.restart),this.listenTo(n,"change:currentTime",this.updateCurrentTime),this.listenTo(n,"change:state",this.stopSeeking)},mousewheelUpdateProgress:function(e){var t=e.originalEvent.wheelDeltaY/120,i=parseInt(this.timeRange.val());this.setCurrentTime(i+t),n.seekTo(i+t)},startSeeking:function(e){1===e.which&&(this.autoUpdate=!1)},stopSeeking:function(){var e=n.get("state");(e==r.Playing||e==r.Paused)&&(this.autoUpdate=!0)},seekToTime:function(e){if(1===e.which){var t=parseInt(this.timeRange.val());n.seekTo(t)}},toggleShowTimeRemaining:function(){var e=s.get("showTimeRemaining");s.set("showTimeRemaining",!e),e?this.timeElapsedLabel.attr("title",chrome.i18n.getMessage("elapsedTime")):this.timeElapsedLabel.attr("title",chrome.i18n.getMessage("timeRemaining")),this.timeElapsedLabel.toggleClass("timeRemaining",!e),this.updateProgress()},enable:function(){this.timeRange.toggleClass("disabled",!1)},clearOnEmpty:function(){0===i.length&&this.clear()},clear:function(){this.setCurrentTime(0),this.setTotalTime(0),this.timeRange.toggleClass("disabled",!0)},restart:function(){this.autoUpdate=!1,this.setCurrentTime(0),this.setTotalTime(this.getCurrentVideoDuration()),this.autoUpdate=!0},setCurrentTime:function(e){this.timeRange.val(e),this.updateProgress()},setTotalTime:function(e){this.timeRange.prop("max",e),this.updateProgress()},updateCurrentTime:function(){this.autoUpdate&&this.setCurrentTime(n.get("currentTime"))},updateProgress:function(){var e=parseInt(this.timeRange.val()),t=parseInt(this.timeRange.prop("max")),i=0===t?0:100*e/t;if(0>i||i>100)throw"Wow this really should not have been "+i;if(this.progress.width(i+"%"),s.get("showTimeRemaining")){var n=t-e;this.timeElapsedLabel.text(o.prettyPrintTime(n))}else this.timeElapsedLabel.text(o.prettyPrintTime(e));this.durationLabel.text(o.prettyPrintTime(t))},getCurrentVideoDuration:function(){var e=0;if(i.length>0){var t=i.getSelectedItem();e=t.get("video").get("duration")}return e}});return a}),define("common/view/videoDisplayView",["foreground/view/genericForegroundView","foreground/collection/streamItems","foreground/model/player","enum/playerState","foreground/collection/contextMenuGroups","text!template/videoDisplay.html","common/view/videoView","foreground/model/buttons/videoDisplayButton","foreground/view/rightPane/playPauseButtonView","foreground/view/rightPane/previousButtonView","foreground/view/rightPane/nextButtonView","foreground/view/rightPane/volumeControlView","foreground/view/rightPane/timeProgressAreaView"],function(e,t,i,n,o,r,s,a,l,u,d,c,h){"use strict";var m=e.extend({attributes:{id:"videoDisplay"},template:_.template(r),panel:null,videoView:null,playPauseButtonView:null,previousButtonView:null,nextButtonView:null,volumeControlView:null,timeProgressAreaView:null,events:{"click .remove":"toggleVideoDisplay"},render:function(){return this.$el.html(this.template({"chrome.i18n":chrome.i18n,title:t.getSelectedItem().get("title")})),this.panel=this.$el.find(".panel"),this.panel.append(this.videoView.render().el),this.$el.find("#timeProgressAreaView").replaceWith(this.timeProgressAreaView.render().el),this.$el.find("#volumeControlView").replaceWith(this.volumeControlView.render().el),this.$el.find("#previousButtonView").replaceWith(this.previousButtonView.render().el),this.$el.find("#playPauseButtonView").replaceWith(this.playPauseButtonView.render().el),this.$el.find("#nextButtonView").replaceWith(this.nextButtonView.render().el),this.title=this.$el.find(".title"),this},initialize:function(){this.videoView=new s,this.listenTo(a,"change:enabled",this.hideOnDisabled),this.listenTo(t,"change:selected",this.updateTitle),this.playPauseButtonView=new l,this.previousButtonView=new u,this.nextButtonView=new d,this.volumeControlView=new c,this.timeProgressAreaView=new h},toggleVideoDisplay:function(){a.toggleEnabled()},hideOnDisabled:function(){var e=a.get("enabled");e||this.hide()},show:function(e){this.$el.data("background",this.$el.css("background")).transition({background:"rgba(0, 0, 0, 0.5)"},e?0:void 0,"snap"),this.panel.transition({x:this.$el.width()},e?0:void 0,"snap")},hide:function(){this.$el.transition({background:this.$el.data("background")},function(){this.remove(),this.videoView.disconnectPort(),this.videoView.remove()}.bind(this)),this.panel.transition({x:-20})},updateTitle:function(){this.title.text(t.getSelectedItem().get("title"))}});return m}),define("fullscreen/fullscreen",["common/view/videoDisplayView"],function(e){"use strict";var t=Backbone.View.extend({initialize:function(){var t=new e,i=t.render().el;i.width=window.innerWidth,i.height=window.innerHeight,$("body").append(i),$(window).on("resize",function(){i.width=window.innerWidth,i.height=window.innerHeight,(screen.availHeight||screen.height-30)<=window.innerHeight?t.render():chrome.windows.getAll(function(e){var t=_.findWhere(e,{focused:!0});chrome.windows.remove(t.id)})}),$(window).keydown(function(e){return 122===e.keyCode&&chrome.windows.getAll(function(e){var t=_.findWhere(e,{state:"fullscreen"});chrome.windows.remove(t.id)}),e.stopPropagation(),!1})}});return new t});