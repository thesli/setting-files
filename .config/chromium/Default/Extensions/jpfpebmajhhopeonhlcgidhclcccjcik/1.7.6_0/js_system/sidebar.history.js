function restoreTabs(){if(localStorage._restore_tabs&&typeof localStorage._restore_tabs!="undefined"){restore_tabs=JSON.parse(localStorage._restore_tabs);var b=/^(http:|https:|ftp:|file:)/;for(var a in restore_tabs){if(restore_tabs[a].url&&b.test(restore_tabs[a].url)&&!restore_tabs[a].pinned){window.open(restore_tabs[a].url)}}}}function renderHistory(e){var d=new Date(e.lastVisitTime);var b=document.createElement("li");var c=document.createElement("a");c.setAttribute("href",e.url);c.innerHTML=(e.title?"<b>"+(safestr(e.title))+"</b>":"<b>No title</b>")+"<br />"+d.toDateString()+" "+d.toLocaleTimeString();b.style.backgroundImage="url(chrome://favicon/"+e.url+")";b.setAttribute("class","openurl");b.setAttribute("rel",e.url);b.appendChild(c);return b}function renderHistoryItems(){$("#history ul#history_items").html("");if(localStorage._restore_tabs&&typeof localStorage._restore_tabs!="undefined"){restore_tabs=JSON.parse(localStorage._restore_tabs);var e=0;var h=/^(http:|https:|ftp:|file:)/;for(var g in restore_tabs){if(restore_tabs[g].url&&h.test(restore_tabs[g].url)&&!restore_tabs[g].pinned){e++}}if(e>0){$("#history ul#history_items").append('<li class="openurl" style="background:url(images/sidebar.restore-tabs.png) 6px 6px #FAFF75 no-repeat"><a style="font-weight:bold;color:#000;display:block;margin-top:3px;" id="click-restore-tabs">Restore '+e+" tabs.</a></li>")}}if(localStorage._closed_tabs&&typeof localStorage._closed_tabs!="undefined"){var d=JSON.parse(localStorage._closed_tabs);if(!d){return false}for(var g=d.length-1;g>=0;g--){var b=document.createElement("li");var c=document.createElement("a");c.setAttribute("href",d[g].url);c.innerHTML=(d[g].title?"<b>"+(safestr(d[g].title))+"</b>":"<b>No title</b>")+"<br />";b.style.backgroundImage="url(chrome://favicon/"+d[g].url+")";b.setAttribute("class","openurl");b.setAttribute("rel",d[g].url);b.appendChild(c);$("#history ul#history_items").append(b)}var f=document.createElement("li");var c=document.createElement("a");c.innerHTML="Clear recently closed tabs list";c.setAttribute("id","clear-history");c.addEventListener("click",function(){localStorage.removeItem("_closed_tabs");localStorage.removeItem("_opened_tabs");localStorage.removeItem("_restore_tabs");$("#history ul#history_items").html("")});f.appendChild(c);$("#history ul#history_items").append(f)}}$(function(){$("#history #history-search").keyup(function(a){query=$("#history #history-search").val();if(query.length<3){return false}chrome.history.search({text:query,maxResults:25},function(c){$("#history ul").html("");for(var b=0;b<c.length;b++){$("#history ul").append(renderHistory(c[b]))}})});renderHistoryItems()});