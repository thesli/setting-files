function initialize(a,b){var c;if(a===view){b="act"}$("#tracks").empty();$("#notification").empty();chrome.extension.sendRequest({requestlist:"playview"},function(d){if(a==="startup"){view=d.sendlist;looking=d.sendlist;c=d.sendlist}else{c=a}chrome.extension.sendRequest({requestlist:"current"},function(d){playing=d.sendlist;chrome.extension.sendRequest({requestlist:"give,"+a},function(a){if(a.sendlist.length>0){for(i=0;i<a.sendlist.length;i++){var d;if(i%2===0){d="even"}else{d="odd"}$('<li class="'+d+'">'+(i+1)+". "+a.sendlist[i]+"</li>").appendTo("#tracks")}$(".tLink").tipTip({maxWidth:"300"});actions(playing,c,b)}else{$("#tracklist").hide();$("#volumecontrol").hide();$('<div id="message"><h1>Extension Startup</h1><p>The Economist Radio extension is still gathering the data it needs. Open this window again in a few seconds.</p></div>').appendTo("#notification");chrome.extension.sendRequest({requestlist:"reset"})}})})})}function actions(a,b,c){child=parseInt(a,10)+1;$("#tracks").show();if(view===looking&&c==="next"){c="act"}if(view!==looking&&c==="next"){chrome.extension.sendRequest({requestlist:"datastring"},function(a){var c=a.sendlist;$("#access").empty();$(c).appendTo("#access");generateTrack("#access a",b,0,1)})}if(c==="act"){generateTrack("ol li:nth-child("+child+") a",b)}$(".tLink").click(function(){child=$("ol li a").index($(this))+1;view=b;generateTrack(this,b,1)})}function generateTrack(a,b,c,d){$("li").removeClass("active");$("#track").empty();$("#playing").empty();playing=$(a).text();var e=$(a).attr("id").split(",");$('<div id="tInfo"><h3><a href="'+e[0]+'" target="_new">'+$(a).text()+"</a></h3></div>").appendTo("#track");$('<div id="tSharing">sharing<div class="networks"><a href="https://www.facebook.com/sharer.php?u='+e[0]+"&t="+$(a).text()+'" target="_blank"><img src="images/facebook.png" alt="Share on Facebook"/></a><a href="http://twitter.com/share?url='+e[0]+'" target="_blank"><img src="images/twitter.png" alt="Share on Twitter"/></a><a href="https://plusone.google.com/_/+1/confirm?hl=en&url='+e[0]+'" target="_blank"><img src="images/googleplus.png" alt="Share on Google Plus"/></a></div></div>').appendTo("#track");$("#tInfo").css("padding-top",(56-$("#tInfo").height())/2);$('<div id="player"><div class="playPauseC"><a href="#" id="playPause" class="play"></a></div><div id="time">00:00</div><div id="total">00:00</div><div id="waveform"><div id="buffering"></div><div id="progress"></div><div id="loading"></div></div></div>').appendTo("#playing");if(!d){$("ol li:nth-child("+child+")").addClass("active")}if(c){chrome.extension.sendRequest({requestlist:"changetracks,"+b+","+(child-1)})}generateController(e[5]);chrome.extension.sendRequest({requestlist:"forceshift"})}function generateController(){$("#playPause").click(function(){chrome.extension.sendRequest({requestlist:"playback"});chrome.extension.sendRequest({requestlist:"forceshift"})});$("#waveform").click(function(a){var b=$("#waveform").offset();var c=a.pageX-b.left;chrome.extension.sendRequest({requestlist:"scrub,"+c})});initialized=true}var playing,child,view="inc",initialized=false,looking="inc";$(function(){initialize("startup","act");chrome.extension.sendRequest({requestlist:"getvolume"},function(a){$("#volume").slider({range:"min",value:a.sendlist,min:0,max:100,slide:function(a,b){chrome.extension.sendRequest({requestlist:"volume,"+b.value})}})});var a=Math.floor(Math.random()*9e7)+1e7;var b='<a href="http://ad.doubleclick.net/jump/teg.fmsq/smlk;subs=n;wsub=n;sdn=n;dcopt=ist;pos=banner_top;sz=468x60;tile=1;ord='+a+'?" target="_blank"><img src="http://ad.doubleclick.net/ad/teg.fmsq/smlk;subs=n;wsub=n;sdn=n;dcopt=ist;pos=banner_top;sz=468x60;tile=1;ord='+a+'?" /></a>';$("#ad").html(b);$("#ad").click(function(a){_gaq.push(["_trackEvent","ChromeExtension","ad","clicked"])})});var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-29038090-4"]);_gaq.push(["_trackPageview"]);(function(){var a=document.createElement("script");a.type="text/javascript";a.async=true;a.src="https://ssl.google-analytics.com/ga.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)})();chrome.extension.onRequest.addListener(function(a,b,c){if(initialized===true){var d;if(a.requestlist==="new"){initialize("startup","act");c({})}else if(a.requestlist.substring(0,6)==="buffer"){d=a.requestlist.split(",");$("#buffering").width(d[1]);$("#progress").width(d[2]);$("#time").html(d[3].replace(".",":"));$("#total").html(d[4].replace(".",":"));if(d[4]!="00.00"){$("#loading").hide()}c({})}else if(a.requestlist.substring(0,9)==="playstate"){d=a.requestlist.split(",");$("#playPause").removeClass("pause play");$("#playPause").addClass(d[1]);c({})}else if(a.requestlist.substring(0,4)==="next"){d=a.requestlist.split(",");actions(d[1],view,"next");c({})}else{c({})}}else{c({})}})