function initialize(e,t,n){var r=0;if(!n){n=5}clearInterval(intTimer);if(!t){limit=20}else{limit=t}if(!localStorage.autoplay){localStorage.autoplay=1}if(!localStorage.desknote){localStorage.desknote=1}SC.initialize({client_id:"33b60341bf6399c5184f835bcb1e512f"});intTimer=setInterval(fetchTracks,60*n*1e3);if(e===1){for(r=0;r<trackData.length;r++){trackData[r].length=0}fetchTracks(0)}}function fetchTracks(e){if(e===null){e=1}SC.get("/playlists/1599393.json",{limit:limit},function(t){$.each(t.tracks,function(){var t=this;if(t.title!==undefined){var n=formatTrack(t.title,t.permalink_url,t.description);if($.inArray(n,trackData[0])<0&&$.inArray(t.id,trackData[2])<0){if(e===0){trackData[0].push(n);trackData[1].push(t.stream_url);trackData[2].push(t.id);trackData[3].push(t.description);trackData[4].push(t.title)}else{if(t.id>trackData[2][0]){tNew++;trackData[0].unshift(n);trackData[1].unshift(t.stream_url);trackData[2].unshift(t.id);trackData[3].unshift(t.description);trackData[4].unshift(t.title)}}}}});if(tNew>0){tNewCount=tNewCount+tNew;chrome.browserAction.setBadgeText({text:tNewCount+""});if(view==="inc"){viewlength=trackData[0].length;current=inBounds(parseInt(current)+parseInt(tNew),viewlength)}tNew=0;views=chrome.extension.getViews({type:"popup"});if(views[0]){chrome.extension.sendRequest({requestlist:"new"})}}if(e===0){viewlength=trackData[0].length;trackPlayback(0,view)}})}function formatTrack(e,t,n){var r='<a href="#" class="tLink" id="'+t+'" title="'+n+'">'+e+"</a>";return r}function inBounds(e,t){if(e>t-1){e=t-1}return parseInt(e,10)}function trackPlayback(e,t,n){var r,i,s=0;if(t==="inc"){r=trackData[1][e];if(trackData[1][e+1]){i=trackData[1][e+1]}else{i=0}view="inc"}clearTimeout(buffTimer);current=inBounds(parseInt(e),viewlength);buffered=0;buffTimer=setTimeout(tShift,500);if($("#playingA").attr("src")){if($("#playingA").attr("src").substring(0,$("#playingA").attr("src").indexOf("?"))==r){s="A"}}if($("#playingB").attr("src")){if($("#playingB").attr("src").substring(0,$("#playingB").attr("src").indexOf("?"))==r){s="B"}}if($("#streamA").is(":empty")||!s){stream="A";$("#streamA").html('<audio id="playingA" name="playingA" src="'+r+'?client_id=33b60341bf6399c5184f835bcb1e512f" preload="auto"></audio>');$("#playingA")[0].addEventListener("ended",function(){endPlayback("next")},false);$("#playingA").bind("timeupdate",tShift);$("#playingA")[0].volume=volume/100;_gaq.push(["_trackEvent","ChromeExtension","trackCalled",trackData[4][e]]);if(i){$("#streamB").html('<audio id="playingB" name="playingB" src="'+i+'?client_id=33b60341bf6399c5184f835bcb1e512f" preload="auto"></audio>');$("#playingB")[0].volume=0}else{$("#streamB").empty()}}else{if(s=="A"){stream="A";$("#playingA")[0].addEventListener("ended",function(){endPlayback("next")},false);$("#playingA").bind("timeupdate",tShift);$("#playingA")[0].volume=volume/100;_gaq.push(["_trackEvent","ChromeExtension","trackCalled",trackData[4][e]]);if(i){$("#streamB").html('<audio id="playingB" name="playingB" src="'+i+'?client_id=33b60341bf6399c5184f835bcb1e512f" preload="auto"></audio>');$("#playingB")[0].volume=0}else{$("#streamB").empty()}}else{stream="B";$("#playingB")[0].addEventListener("ended",function(){endPlayback("next")},false);$("#playingB").bind("timeupdate",tShift);$("#playingB")[0].volume=volume/100;_gaq.push(["_trackEvent","ChromeExtension","trackCalled",trackData[4][e]]);if(i){$("#streamA").html('<audio id="playingA" name="playingA" src="'+i+'?client_id=33b60341bf6399c5184f835bcb1e512f" preload="auto"></audio>');$("#playingA")[0].volume=0}else{$("#streamA").empty()}}}if(n){autoplay=1}}function tShift(e){if($("#playing"+stream)[0].readyState>1){if($("#playing"+stream)[0].paused&&autoplay===1){autoplay=0;$("#playing"+stream)[0].play();e=1}var t=$("#playing"+stream)[0].currentTime/$("#playing"+stream)[0].duration*347;if(t<0){t=0}buffered=$("#playing"+stream)[0].buffered.end($("#playing"+stream)[0].buffered.length-1)/$("#playing"+stream)[0].duration*347;var n=Math.floor(Math.floor($("#playing"+stream)[0].currentTime)/60),r=Math.floor($("#playing"+stream)[0].currentTime)%60,i=Math.floor(Math.floor($("#playing"+stream)[0].duration)/60),s=Math.floor($("#playing"+stream)[0].duration)%60;if(r<10){r="0"+r}if(s<10){s="0"+s}if(n<10){n="0"+n}if(i<10){i="0"+i}views=chrome.extension.getViews({type:"popup"});if(views[0]){chrome.extension.sendRequest({requestlist:"buffer,"+Math.round(buffered)+","+Math.round(t)+","+n+"."+r+","+i+"."+s})}}if($("#playing"+stream)[0].paused&&buffered!==347){buffTimer=setTimeout(tShift,500)}if(e===1){views=chrome.extension.getViews({type:"popup"});if($("#playing"+stream)[0].paused){if(views[0]){chrome.extension.sendRequest({requestlist:"playstate,play"})}}else{if(views[0]){chrome.extension.sendRequest({requestlist:"playstate,pause"})}}}}function endPlayback(e){if(e==="next"){e=parseInt(current)+1}if(localStorage.autoplay==="1"&&e<viewlength){current=inBounds(parseInt(e,10),viewlength);views=chrome.extension.getViews({type:"popup"});if(views[0]){chrome.extension.sendRequest({requestlist:"next,"+current})}trackPlayback(current,view,1,0);if(localStorage.desknote==="1"){var t=trackData[0][e].replace(/(<([^>]+)>)/ig,"");notification=webkitNotifications.createNotification("icon48.png",t,trackData[3][e]);notification.show()}}}var tNew=0,tNewCount=0,autoplay=0,view="inc",viewlength=0,extrafav=0;var trackData=[[],[],[],[],[]];var token,limit,intTimer,buffered,buffTimer,current=0,linkcount,inc,notification,volume=100,views,stream="A";initialize(0,localStorage.limit,localStorage.interval);$(function(){fetchTracks(0)});var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-29038090-4"]);_gaq.push(["_trackPageview"]);(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="https://ssl.google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})();chrome.extension.onRequest.addListener(function(e,t,n){var r;if(e.requestlist.substring(0,4)==="give"){inc=e.requestlist.split(",");if(inc[1]==="startup"){if(view==="inc"){tNewCount=0;chrome.browserAction.setBadgeText({text:""});n({sendlist:trackData[0]})}}if(inc[1]==="inc"){tNewCount=0;chrome.browserAction.setBadgeText({text:""});n({sendlist:trackData[0]})}}else if(e.requestlist==="view"){n({sendlist:view})}else if(e.requestlist.substring(0,6)==="update"){inc=e.requestlist.split(";");initialize(1,inc[1],inc[2]);n({})}else if(e.requestlist==="reset"){initialize(0,localStorage.limit,localStorage.interval);n({})}else if(e.requestlist==="forceshift"){tShift(1);n({})}else if(e.requestlist==="playback"){if(buffered>0){if($("#playing"+stream)[0].paused){clearTimeout(buffTimer);$("#playing"+stream)[0].play();_gaq.push(["_trackEvent","ChromeExtension","play","clicked"])}else{if(buffered!==347){buffTimer=setTimeout(tShift,500)}$("#playing"+stream)[0].pause();_gaq.push(["_trackEvent","ChromeExtension","pause","clicked"])}autoplay=0}n({})}else if(e.requestlist.substring(0,5)==="scrub"){inc=e.requestlist.split(",");if(buffered<inc[1]){$("#playing"+stream)[0].currentTime=buffered/347*$("#playing"+stream)[0].duration}else{$("#playing"+stream)[0].currentTime=inc[1]/347*$("#playing"+stream)[0].duration}n({})}else if(e.requestlist.substring(0,6)==="volume"){volume=parseInt(e.requestlist.split(",")[1]);$("#playing"+stream)[0].volume=volume/100;n({})}else if(e.requestlist==="getvolume"){n({sendlist:volume})}else if(e.requestlist.substring(0,12)==="changetracks"){inc=e.requestlist.split(",");if(inc[1]==="inc"){viewlength=trackData[0].length}current=inBounds(parseInt(inc[2],10),viewlength);trackPlayback(parseInt(inc[2],10),inc[1],1,1);n({})}else if(e.requestlist==="datastring"){if(view==="inc"){n({sendlist:trackData[0][current]})}}else if(e.requestlist==="current"){n({sendlist:current})}else if(e.requestlist==="playview"){n({sendlist:view})}else{n({})}})