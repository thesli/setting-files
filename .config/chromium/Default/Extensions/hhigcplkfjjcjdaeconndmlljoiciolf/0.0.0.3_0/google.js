var extPath=chrome.extension.getURL("");var gItems=$("");var timer=null;function injectCssFile(b,a){var c=a.createElement("link");c.type="text/css";c.rel="stylesheet";c.href=b;a.getElementsByTagName("head")[0].appendChild(c)}function previewEnter(c){var b=$(".zFrameDiv",this);var a=$("iframe",b);if(a.attr("src")==""){a.attr("src",a.attr("href"))}b.show();$(".zMagIcon",this).css("border-color","lightgreen")}function previewLeave(b){var a=$(".zFrameDiv",this);a.hide();$(".zMagIcon",this).css("border-color","white")}function setupPreview(d,e){var a='<span class="zPreview"><img class="zMagIcon" src="'+extPath+'images/preview16.png"></span>';function c(h){return'<div class="zFrameDiv"><iframe src="" href="'+h+'" height="100%" width="'+(window.innerWidth-210)+'px" scrolling="yes" frameborder="1" sandbox></iframe></div>'}var f=$(e);if(!f.is(":visible")){return}if($("a.l",f).length>1){$("a.l",f).each(setupPreview)}else{console.log(f);if(f.hasClass("zPreviewSet")){return}f.addClass("zPreviewSet").prepend(a);var g=$(".zPreview",f);var b=f.attr("href")||$("a:first",f).attr("href");if($('span.b.w.xsm:contains("[")',f).length){b="https://viewer.zoho.com/docs/urlview.do?url="+encodeURIComponent(b)}g.append(c(b));g.mouseenter(previewEnter).mouseleave(previewLeave);$("div.fc > a",f).each(function(){var h=$(a).insertBefore(this);h.append(c(this.href));h.mouseenter(previewEnter).mouseleave(previewLeave)})}}function setupAllPreviews(){gItems.each(setupPreview);var b=0;var d=$(".zFrameDiv > iframe");var c=d.length;if(!c){return}var a=setInterval(function(){while(b<c){var e=d.eq(b++);if(e.attr("src")==""){e.attr("src",e.attr("href"));console.log(e.attr("href"));break}}if(b==c){clearInterval(a)}},2500)}function searchResult(b){var a=null;if($(b).filter("li.g").length){a=$(b).filter("li.g:not(.zPreviewSet)")}else{if($("li.g",b).length){a=$("li.g:not(.zPreviewSet)",b)}}if(a){gItems=gItems.add(a);clearTimeout(timer);timer=setTimeout(setupAllPreviews,1000)}}function init(){injectCssFile(extPath+"google.css",document);document.addEventListener("DOMNodeInserted",function(a){searchResult(a.target);$("#knavm").css("top","20px")},false);searchResult(document)}init();