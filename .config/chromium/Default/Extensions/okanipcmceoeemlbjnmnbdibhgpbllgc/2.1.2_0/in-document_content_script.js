(function(){ /*
 Copyright 2010 Google Inc.  All Rights Reserved.
 Your use of this software is subject to the Terms of Service located
 at https://chrome.google.com/extensions/intl/en/gallery_tos.html.
*/
var idcs_;var idcs_a=function(a,c,b){return a.call.apply(a.bind,arguments)},idcs_b=function(a,c,b){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var b=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(b,d);return a.apply(c,b)}}return function(){return a.apply(c,arguments)}},idcs_c=function(a,c,b){idcs_c=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?idcs_a:idcs_b;return idcs_c.apply(null,arguments)},
idcs_d=function(a,c){function b(){}b.prototype=c.prototype;a.superClass_=c.prototype;a.prototype=new b;a.prototype.constructor=a};Function.prototype.bind=Function.prototype.bind||function(a,c){if(1<arguments.length){var b=Array.prototype.slice.call(arguments,1);b.unshift(this,a);return idcs_c.apply(null,b)}return idcs_c(this,a)};Function.prototype.partial=function(a){var c=Array.prototype.slice.call(arguments);c.unshift(this,null);return idcs_c.apply(null,c)};
Function.prototype.inherits=function(a){idcs_d(this,a)};Function.prototype.mixin=function(a){var c=this.prototype,b;for(b in a)c[b]=a[b]};var idcs_e=function(a,c){this.buffer_=[];for(var b=this.tail_=this.head_=0;b<c+1;b++)this.buffer_.push({character:"",node:null,offset:0});this.read_=-1;this.iterator_=a};idcs_=idcs_e.prototype;idcs_.next=function(){this.read_=(this.read_+1)%this.buffer_.length;if(this.read_!=this.tail_)return!0;var a=this.iterator_.next();if(a){var c=this.buffer_[this.tail_];c.character=this.iterator_.character();c.offset=this.iterator_.offset();c.node=this.iterator_.node();this.tail_=(this.tail_+1)%this.buffer_.length}return a};
idcs_.character=function(){return this.buffer_[this.read_].character};idcs_.node=function(){return this.buffer_[this.read_].node};idcs_.offset=function(){return this.buffer_[this.read_].offset};idcs_.count=function(){return this.iterator_.count()};var idcs_f=RegExp("https?://(?:.+\\.)?google\\.[a-z]{2,3}(?:\\.[a-z]{2})?(?:\\:[0-9]+)?/(?:advanced_)?search.*(([?&]q=)([^&]+))"),idcs_g=RegExp("https?://(?:.+\\.)?google\\.[a-z]{2,3}(?:\\.[a-z]{2})?(?:\\:[0-9]+)?/(?:webhp[^#]*)?(#((?:.+&)?q=)([^&]+)(.*)&fp=[^&]+)"),idcs_h=/&/g,idcs_i=/</g,idcs_j=/>/g,idcs_k=/\"/g;
function idcs_l(a){var c;c=document.createTreeWalker(a,window.NodeFilter.SHOW_TEXT,null,!1);for(a=[];c.nextNode();)a.push(c.currentNode);for(c=0;c<a.length;c++){var b=a[c],d=b.data.match(idcs_m);if(d){for(var f=b.parentNode,e=0;e<d.length;e++){var g=d[e];if(2>g.length||20<g.length||idcs_n(g.charAt(0)))f.insertBefore(document.createTextNode(g),b);else{var h=jQuery('<span class="goog_qs-nowrap"/>').get(0);h.appendChild(document.createTextNode(g.charAt(0)));h.appendChild(document.createElement("img"));
h.appendChild(document.createTextNode(g.substring(1)));f.insertBefore(h,b)}}f.removeChild(b)}}}var idcs_m=/\s+|\S+/g,idcs_o=String.fromCharCode(160);function idcs_n(a){a=a.charCodeAt(0);return 97<=a?122>=a?!1:128<=a?!1:!0:65<=a?90>=a?!1:!0:48<=a&&57>=a?!1:!0}function idcs_p(a,c,b,d,f,e,g,h){return idcs_c.apply(null,arguments)};var idcs_q=function(a,c){this.iterator_=a;this.filterFn_=c;this.character_=null;this.returnedWhitespace_=!0;this.lastNode_=null};idcs_=idcs_q.prototype;
idcs_.next=function(){for(;this.iterator_.next();){if(this.node()!=this.lastNode_){for(;idcs_r(this,this.node());)if(!this.iterator_.nextNode())return!1;this.lastNode_=this.node()}var a=this.iterator_.character(),c=" "==a||"\n"==a||a==idcs_o||"\r"==a||"\t"==a;if(!this.returnedWhitespace_||!c)return this.character_=(this.returnedWhitespace_=c)?" ":"\u2018"==a||"\u2019"==a?"'":a,!0}return!1};idcs_.character=function(){return this.character_};idcs_.node=function(){return this.iterator_.node()};
idcs_.offset=function(){return this.iterator_.offset()};idcs_.count=function(){return this.iterator_.count()};var idcs_s=function(a,c){return c.style&&"none"==c.style.display||c.parentNode&&idcs_s(a,c.parentNode)?!0:!1},idcs_r=function(a,c){return idcs_s(a,c.parentNode)||a.filterFn_&&a.filterFn_(c)};var idcs_t=function(a,c,b){this.tidbit_=a;this.htmlTidbit_=c;this.elements_=b};idcs_t.prototype.getTidbit=function(){return this.tidbit_};idcs_t.prototype.getElements=function(){return this.elements_};var idcs_u=function(a,c,b){this.searchUrl=a;this.query=c;this.ei=b;this.tidbits=[];this.htmlTidbits=[];this.hasEbmTidbits=!0;this.ved=this.href=null;this.seen=this.minimized=!1;this.debug=null;this.fromVisualSnippet=!1;this.vsClickedTidbitIndex=-1};idcs_u.prototype.setClickedTidbitIndex=function(a){this.vsClickedTidbitIndex=a};idcs_u.prototype.addTidbit=function(a,c){this.tidbits.push(a);this.htmlTidbits.push(c)};idcs_u.prototype.toString=function(){return"{"+this.href+" ["+this.tidbits.length+" tidbits]}"};var idcs_v=function(a){return(a=a.match(idcs_f)||a.match(idcs_g))?decodeURIComponent(a[3].replace(/\+/g," ")):null};var idcs_y=function(a,c,b){var d=jQuery(a).find("#res");if(0==d.length)return[];var f=idcs_w(a,c),e=[];d.find("li.g").each(function(a,d){e.push(idcs_x(d,c,f,b))});return e},idcs_w=function(a,c){var b=jQuery(a).find("#sflas").get(0);return b?idcs_v(b.href):idcs_v(c)},idcs_x=function(a,c,b,d){c=new idcs_u(c,b,d);b=jQuery(a).find("h3.r > a");if(0<b.length){d=b.get(0).href;var f=d.match(idcs_z)||d.match(idcs_A);c.href=f?decodeURIComponent(f[1]):d;b=b.get(0);var e;b=b.getAttribute("onmousedown")&&(e=b.getAttribute("onmousedown").match(idcs_B))?
e[1]:(e=b.href.match(idcs_C))?e[1]:null;c.ved=b}idcs_D(a,c);return c},idcs_z=/https?:\/\/(?:.+\.)?google\.[a-z]{2,3}(?:\.[a-z]{2})?(?:\:[0-9]+)?\/url.*[?&]url=([^&]+)/,idcs_A=/https?:\/\/(?:.+\.)?google\.[a-z]{2,3}(?:\.[a-z]{2})?(?:\:[0-9]+)?\/url.*[?&]q=([^&]+)/,idcs_B=/clk\(this.href,'.*','.*','.*','.*','.*','([^']+)'\)/,idcs_C=/https?:\/\/(?:.+\.)?google\.[a-z]{2,3}(?:\.[a-z]{2})?(?:\:[0-9]+)?\/url\?(?:q|url)=.+&ved=([^&]+)/,idcs_D=function(a,c){var b=jQuery(a).find(".s").first().find(".ft");0==
b.length&&(c.hasEbmTidbits=!1,b=jQuery(a).find(".s").first().find(".nft"));b.each(function(a,b){var e;e=b.textContent.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").replace(/\s+/g," ");var g=b.innerHTML;5<=e.length&&(0<c.tidbits.length||!(13>=e.length&&/\d{4}/.test(e)))&&c.addTidbit(e,g)})};var idcs_E=function(a,c,b){this.walker_=c.createTreeWalker(b,a.NodeFilter.SHOW_TEXT||4,null,!1);this.currentNode_=null;this.nodeOffset_=-1;this.charCount_=0};idcs_=idcs_E.prototype;idcs_.next=function(){return this.currentNode_&&++this.nodeOffset_<this.currentNode_.length?(this.charCount_++,!0):this.nextNode()};
idcs_.nextNode=function(){for(;this.walker_.nextNode();)if(this.currentNode_=this.walker_.currentNode,0<this.currentNode_.length)return this.nodeOffset_=0,this.charCount_++,!0;this.currentNode_=null;return!1};idcs_.character=function(){return null==this.currentNode_?null:this.currentNode_.data.charAt(this.nodeOffset_)};idcs_.node=function(){return this.currentNode_};idcs_.offset=function(){return this.nodeOffset_};idcs_.count=function(){return this.charCount_};var idcs_F=function(a,c,b,d){this.win_=a;this.document_=c;this.doneCallback_=b;this.tidbitIndexStart_=d||0;this.htmlTidbits_=this.tidbits_=null;this.matchedTidbits_=[];this.startTime_=(new Date).getTime();this.pauseAtCharCount_=3E5};idcs_F.prototype.showTidbitsOnPage=function(a){this.tidbits_=a.tidbits;this.htmlTidbits_=a.htmlTidbits;this.result_=a;0==this.tidbits_.length?this.doneCallback_(a,[]):idcs_G(this,0)};
var idcs_G=function(a,c){idcs_H(a,a.document_.body,a.tidbits_[c],idcs_p(a.foundFragments_,a,c))},idcs_H=function(a,c,b,d){var f=b.length+5+250,e;a.tidbitIndexStart_&&(e=function(a){return-1!=a.parentNode.className.indexOf("goog_qs")});c=new idcs_e(new idcs_q(new idcs_E(a.win_,a.document_,c),e),f);a.findMatchingNodesInternal_(b,c,0,[],[],d)};
idcs_F.prototype.findMatchingNodesInternal_=function(a,c,b,d,f,e){for(;c.next()&&b<a.length;){for(var g=c.character();a.charAt(b)!=g&&idcs_n(a.charAt(b))&&b<a.length-1;)++b;if(5<b){if(a.charAt(b)!=g&&"("==g)i:{for(var g=c,h=1,n=0;g.next();){var k=g.character();if(250<=++n){g=k;break i}if("("==k)++h;else if(")"==k&&(--h,0==h)){if(g.next()){g=g.character();break i}break}}g=null}for(h=0;a.charAt(b)!=g&&5>h&&c.next();)g=c.character(),h++}if(a.charAt(b)!=g)this.tidbitIndexStart_?b=!1:(b=idcs_I(d),b=15>
b?!1:b>idcs_I(f)),b&&(f=d.slice()),b=c,b.read_=b.head_,b.head_=(b.head_+1)%b.buffer_.length,b=d.length=0;else{0<d.length&&d[d.length-1].node==c.node()?d[d.length-1].stop=c.offset():d.push(new idcs_J(c.node(),c.offset(),c.offset()));if(b==a.length-1){e(idcs_K(d));return}++b}if(c.count()>=this.pauseAtCharCount_){if(5E3<(new Date).getTime()-this.startTime_){e(null);return}c.count();this.pauseAtCharCount_+=3E5;this.win_.setTimeout(idcs_p(this.findMatchingNodesInternal_,this,a,c,b,d,f,e),150);return}}e(0<
f.length?idcs_K(f):null)};var idcs_K=function(a){for(var c=[],b=0;b<a.length;b++)" "!=a[b].node.data.slice(a[b].start,a[b].stop+1).replace(/\s+/g," ")&&c.push(a[b]);return c},idcs_I=function(a){for(var c=0,b=0;b<a.length;++b)c+=a[b].stop-a[b].start+1;return c};
idcs_F.prototype.foundFragments_=function(a,c){if(null!=c){for(var b=this.document_,d=this.matchedTidbits_.length,f=Array(c.length),e=0;e<c.length;++e){var g=f,h=e,n=b,k=c[e],q=d,m=k.node,p=m.parentNode;if(0<k.start){var l=m.data.slice(0,k.start);p.insertBefore(n.createTextNode(l),m)}k.stop<m.data.length-1&&(l=m.data.slice(k.stop+1),m.parentNode.insertBefore(n.createTextNode(l),m.nextSibling));l=n.createElement("span");jQuery(l).addClass("goog_qs-tidbit goog_qs-tidbit-"+(q+this.tidbitIndexStart_));
this.tidbitIndexStart_&&jQuery(l).addClass("goog_qs-tidbit-added");k=k.node.data.slice(k.start,k.stop+1);l.appendChild(n.createTextNode(k));p.replaceChild(l,m);g[h]=l}this.matchedTidbits_.push(new idcs_t(this.tidbits_[a],this.htmlTidbits_[a],f))}b=(new Date).getTime()-this.startTime_;a<this.tidbits_.length-1&&5E3>b?idcs_G(this,a+1):this.doneCallback_(this.result_,this.matchedTidbits_)};var idcs_J=function(a,c,b){this.node=a;this.start=c;this.stop=b};
idcs_F.prototype.addFindyStylesheet=function(a){var c=a.getElementsByTagName("head")[0],b=a.getElementById("findy_css");b||(b=a.createElement("link"),b.id="findy_css",b.type="text/css",b.rel="stylesheet",b.href="chrome://findy/skin/findy-in-document.css",c.appendChild(b))};window.Findy_TidbitHighlighter=idcs_F;idcs_F.prototype.showTidbitsOnPage=idcs_F.prototype.showTidbitsOnPage;function idcs_L(a,c,b){var d=chrome.extension.connect({name:"log-event"});a={result:a,action:c};b&&(a.params=b);d.postMessage(a)}function idcs_M(){var a=chrome.extension.getURL("about.html");chrome.extension.connect({name:"open-link"}).postMessage({url:a})}
function idcs_N(a){a=jQuery(a);var c=a.get(0);if(!c||!c.parentNode)return!1;var b=a.offset().top-20;jQuery("body").stop();jQuery("body").animate({scrollTop:b},"normal","swing",function(){document.body.scrollTop!=b&&c.scrollIntoView()});return!0}function idcs_O(a){return"url("+chrome.extension.getURL("images/"+a)+")"}
function idcs_P(a,c,b){a.css("background-image",idcs_O(c));a.mouseover(function(){jQuery("body").hasClass("goog_qs-closed")||jQuery(this).css("background-image",idcs_O(b))});a.mouseout(function(){jQuery("body").hasClass("goog_qs-closed")||jQuery(this).css("background-image",idcs_O(c))})};var idcs_Q=function(a,c,b){this.legacyHighlightsHandled_=!1;this.foundTidbits_=c;this.addedTidbitCount_=0;this.result_=a;var d=jQuery('<div id="goog_qs-box-help" />');idcs_P(d,"help.png","help_on.png");d.attr("title",chrome.i18n.getMessage("qs_tidbit_box_help_tooltip"));d.click(function(){idcs_M()});var f=jQuery('<div id="goog_qs-box-toggle" />');idcs_P(f,"minimize.png","minimize_on.png");f.attr("title",chrome.i18n.getMessage("qs_tidbit_box_minimize_tooltip"));f.click(idcs_p(this.toggleGQS,this));
var e=jQuery('<div id="goog_qs-box-info" />');e.html(chrome.i18n.getMessage("qs_tidbit_box_matches"));e.css("backgroundImage",idcs_O("icon16x16.png"));e.find(".goog_qs-query").text(a.query||"");this.tidbitsDiv_=jQuery('<div id="goog_qs-box-tidbits" />');if(c)for(var g=0;g<c.length;g++)this.addTidbit(c[g]);c=jQuery('<div id="goog_qs-wrapper" />');c.append(f);c.append(d);c.append(e);a.hasEbmTidbits||(d=jQuery('<div id="goog_qs-box-msg" />'),d.html(chrome.i18n.getMessage("qs_info_non_ebm_result",a.query?
a.query.replace(idcs_h,"&amp;").replace(idcs_i,"&lt;").replace(idcs_j,"&gt;").replace(idcs_k,"&quot;"):"")),d.find(".goog_qs-learn-more").click(function(){idcs_M()}),c.append(d));c.append(this.tidbitsDiv_);d=jQuery('<div id="goog_qs-box-bottom"/>');a.hasEbmTidbits&&(d.append(jQuery('<div class="goog_qs-more-matches" id="goog_qs-box-more-tidbits">'+chrome.i18n.getMessage("qs_more_matches")+'</div><div class="goog_qs-more-matches" id="goog_qs-box-fewer-tidbits"      style="display:none">'+chrome.i18n.getMessage("qs_fewer_matches")+
"</div>")),d.find("#goog_qs-box-more-tidbits").click(idcs_p(this.moreTidbits_,this)),d.find("#goog_qs-box-fewer-tidbits").click(idcs_p(this.fewerTidbits_,this)));0<d.children().length&&(c.append(d),c.append('<div style="clear:both" />'));d=jQuery('<div id="goog_qs_tidbit_box" />');d.addClass("notranslate");a.seen||d.addClass("goog_qs-slideup");d.append(c);b||idcs_l(d.get(0));this.div_=d};idcs_=idcs_Q.prototype;
idcs_.addTidbit=function(a,c){var b=jQuery('<div class="goog_qs-box-tidbit" />');a.div=b;c?(b.addClass("goog_qs-box-tidbit-added"),a.prev?b.insertAfter(a.prev.div):this.tidbitsDiv_.prepend(b)):this.tidbitsDiv_.append(b);var d=a.htmlTidbit_,d=d.replace(/([^\.])$/,"$1...");b.html(d+' <span class="goog_qs-go">&#187;</span>');b.attr("title",chrome.i18n.getMessage("qs_tidbit_box_tidbit_tooltip"));d=idcs_p(this.goToTidbit,this,a,this.addedTidbitCount_,b,c);b.click(d);this.result_&&(this.result_.fromVisualSnippet&&
this.result_.vsClickedTidbitIndex==this.addedTidbitCount_)&&window.setTimeout(d,0);this.addedTidbitCount_++;return b.get(0)};idcs_.get=function(){return this.div_};
idcs_.toggleGQS=function(){jQuery("body").toggleClass("goog_qs-closed");jQuery("#goog_qs_tidbit_box").removeClass("goog_qs-slideup");var a=jQuery("body").hasClass("goog_qs-closed"),c=a?chrome.i18n.getMessage("qs_tidbit_box_restore_tooltip"):chrome.i18n.getMessage("qs_tidbit_box_minimize_tooltip"),b=a?"closed":"opened";jQuery("#goog_qs-box-toggle").attr("title",c);c="";c=a?"icon16x16.png":"minimize.png";jQuery("#goog_qs-box-toggle").css("backgroundImage",idcs_O(c));a?(jQuery(".goog_qs-tidbit-hilite").removeClass("goog_qs-tidbit-hilite"),
jQuery(".goog_qs-box-tidbit-selected").removeClass("goog_qs-box-tidbit-selected")):jQuery("#goog_qs_tidbit_box").show();chrome.extension.connect({name:"minimized-state"}).postMessage({result:this.result_,minimized:a});"none"!=jQuery("#goog_qs_tidbit_box").css("display")&&idcs_L(this.result_,b,{ebm:this.result_.hasEbmTidbits})};
idcs_.closeGQS=function(){jQuery(".goog_qs-tidbit").removeClass("goog_qs-tidbit-hilite").removeClass("goog_qs-tidbit");jQuery("#goog_qs_tidbit_box").hide();idcs_L(this.result_,"removed",{ebm:this.result_.hasEbmTidbits})};
idcs_.goToTidbit=function(a,c,b,d){jQuery(".goog_qs-tidbit-hilite").removeClass("goog_qs-tidbit-hilite");a=".goog_qs-tidbit-"+c;idcs_N(a)||(a="body "+a,idcs_N(a));jQuery(a).addClass("goog_qs-tidbit-hilite");jQuery(".goog_qs-box-tidbit-selected").removeClass("goog_qs-box-tidbit-selected");b.addClass("goog_qs-box-tidbit-selected");c={index:c};d&&(c["more-tidbit"]=!0);idcs_L(this.result_,"go-to-tidbit",c)};
idcs_.logUseful=function(a){idcs_L(this.result_,"feedback",{useful:a});jQuery("#goog_qs-box-useful").hide();jQuery("#goog_qs-box-thanks").fadeIn("normal");a||window.setTimeout(this.toggleGQS,750)};
idcs_.moreTidbits_=function(){0<jQuery(".goog_qs-box-tidbit-added").length?(jQuery("body").removeClass("goog_qs-hide-added"),jQuery(".goog_qs-box-tidbit-added").show(),jQuery("#goog_qs-box-more-tidbits").hide(),jQuery("#goog_qs-box-fewer-tidbits").show()):(jQuery("#goog_qs_tidbit_box").addClass("goog_qs-wait"),idcs_R(this,function(){jQuery("#goog_qs_tidbit_box").removeClass("goog_qs-wait");jQuery("#goog_qs-box-more-tidbits").hide();jQuery("#goog_qs-box-fewer-tidbits").show()}));idcs_L(this.result_,
"more-tidbits")};idcs_.fewerTidbits_=function(){jQuery("body").addClass("goog_qs-hide-added");jQuery(".goog_qs-box-tidbit-added").hide();jQuery("#goog_qs-box-more-tidbits").show();jQuery("#goog_qs-box-fewer-tidbits").hide();idcs_L(this.result_,"less-tidbits")};
var idcs_R=function(a,c){var b=a.result_,d=b.searchUrl,f=encodeURIComponent("info:"+b.href+" "+b.query),b=d.match(idcs_f),d=(b?d.replace(b[1],b[2]+f):(b=d.match(idcs_g))?d.replace(b[1],"search?"+b[2]+f+b[4]):d)+"&num=1",d=d+"&qscrl=3",b=chrome.extension.connect({name:"get-more-tidbits"});b.onMessage.addListener(idcs_p(a.processNewTidbits_,a,c));b.postMessage({url:d})};
idcs_Q.prototype.processNewTidbits_=function(a,c){try{var b=jQuery(c.content).filter("#main"),d=idcs_y(b.get(0),this.result_.searchUrl,this.result_.ei);1!=d.length||(new idcs_F(window,document,idcs_p(this.onFoundNewTidbits_,this),this.addedTidbitCount_)).showTidbitsOnPage(d[0])}finally{a()}};
idcs_Q.prototype.onFoundNewTidbits_=function(a,c){if(0!=c.length){var b=this.foundTidbits_.concat(c),d=-1;jQuery(".goog_qs-tidbit").each(function(){var a=this.className.match(/goog_qs-tidbit-(\d+)/);a&&(a=a[1],a!=d&&(b[a].prev=b[d],d=a))});for(var f=0;f<c.length;f++){var e=this.addTidbit(c[f],!0);idcs_l(e)}}};idcs_Q.prototype.hideTidbitContainer=function(){this.tidbitsDiv_.hide()};var idcs_S,idcs_T=window.qs_result;idcs_T&&idcs_T.href==document.location.href&&idcs_U();function idcs_U(){var a=idcs_T;(new idcs_F(window,document,idcs_p(idcs_V,this))).showTidbitsOnPage(a)}
function idcs_V(a,c){var b=chrome.extension.connect({name:"found-tidbits"}),d={result:a};if(a&&c&&0<c.length){var f=idcs_S=new idcs_Q(a,c);jQuery("body").append(f.get());f.get().get(0);a.hasEbmTidbits?a.minimized&&idcs_S.toggleGQS():(jQuery("#goog_qs_tidbit_box").hide(),idcs_S.toggleGQS());d.foundTidbits=!0;d.logParams={num:c.length};a.tidbits.length!=c.length&&(d.logParams.expected=a.tidbits.length)}else d.foundTidbits=!1;b.postMessage(d)}
chrome.extension.onRequest.addListener(function(a){a.toggle&&idcs_S&&idcs_S.toggleGQS()}); })();
